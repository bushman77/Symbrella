From: <Saved by Blink>
Snapshot-Content-Location: https://claude.ai/share/b1456b7e-3b4e-4654-a79e-aa33acb6a1be
Subject: Claude | Claude
Date: Fri, 3 Oct 2025 16:13:00 -0700
MIME-Version: 1.0
Content-Type: multipart/related;
	type="text/html";
	boundary="----MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v----"


------MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v----
Content-Type: text/html
Content-ID: <frame-79D9C430CB9D6DDA7F33B9D60930015B@mhtml.blink>
Content-Transfer-Encoding: binary
Content-Location: https://claude.ai/share/b1456b7e-3b4e-4654-a79e-aa33acb6a1be

<!DOCTYPE html><html class="h-screen antialiased scroll-smooth __variable_13e552 __variable_a8848c __variable_e4ce97 __variable_e4195f" lang="en-US" data-theme="claude" data-mode="dark" data-build-id="c51a4576f3" data-env="" data-cf-country="CA" data-org-plan="free"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link rel="stylesheet" type="text/css" href="cid:css-0b0b216b-2444-42a8-927a-c522fcc62cb6@mhtml.blink" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover"><link rel="stylesheet" href="https://claude.ai/_next/static/css/9246a64ba77808ea.css" nonce="" data-precedence="next"><link rel="stylesheet" href="https://claude.ai/_next/static/css/f5369fd91af7636b.css" nonce="" data-precedence="next"><link rel="stylesheet" href="https://claude.ai/_next/static/css/9e44fef1b2eb310b.css" nonce="" data-precedence="next"><link rel="stylesheet" href="https://claude.ai/_next/static/css/251bc1cd2efbb3ee.css" nonce="" data-precedence="next"><link rel="preload" as="script" fetchpriority="low" nonce="" href="https://claude.ai/_next/static/chunks/webpack-6218345186ca7895.js"><meta name="next-size-adjust" content=""><title>Claude | Claude</title><meta name="description" content="Shared via Claude, an AI assistant from Anthropic"><link rel="manifest" href="https://claude.ai/manifest.json?v=c51a4576f3"><meta name="apple-itunes-app" content="app-id=6473753684"><meta name="mobile-web-app-capable" content="yes"><link href="https://claude.ai/images/claude_app_icon.png" rel="apple-touch-startup-image"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:title" content="Claude"><meta property="og:description" content="Shared via Claude, an AI assistant from Anthropic"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Claude"><meta name="twitter:description" content="Shared via Claude, an AI assistant from Anthropic"><link rel="preload" href="https://claude.ai/_next/static/media/06fe80d45fc12f7f-s.p.woff2" as="font" crossorigin="" nonce="" type="font/woff2"><link rel="preload" href="https://claude.ai/_next/static/media/0cd27f4e808e3c8d-s.p.woff2" as="font" crossorigin="" nonce="" type="font/woff2"><link rel="preload" href="https://claude.ai/_next/static/media/75014e9053556df0-s.p.woff2" as="font" crossorigin="" nonce="" type="font/woff2"><link rel="preload" href="https://claude.ai/_next/static/media/a0eafab536ffd221-s.p.woff2" as="font" crossorigin="" nonce="" type="font/woff2"><link rel="preload" href="https://claude.ai/_next/static/media/a72997480c14a9d4-s.p.woff2" as="font" crossorigin="" nonce="" type="font/woff2"><link rel="preload" href="https://claude.ai/_next/static/media/b5f39ee185750359-s.p.woff2" as="font" crossorigin="" nonce="" type="font/woff2"><link rel="preload" href="https://claude.ai/_next/static/media/b8c97ebabd0473a4-s.p.woff2" as="font" crossorigin="" nonce="" type="font/woff2"><link rel="preload" href="https://claude.ai/_next/static/media/b96accb76593e50d-s.p.woff2" as="font" crossorigin="" nonce="" type="font/woff2"><link rel="preload" href="https://claude.ai/_next/static/media/d4ad98ce6ee578c0-s.p.woff2" as="font" crossorigin="" nonce="" type="font/woff2"><meta name="theme-color" content="hsl(30,3.3%,11.8%)"></head><body class="bg-bg-100 text-text-100 font-ui min-h-screen" style="pointer-events: auto;"><!--$--><div class="flex min-h-screen w-full overflow-x-clip"><div class="shrink-0" style="overflow:hidden;width:auto;opacity:1"><div class="fixed z-sidebar lg:sticky" style="width:0"><nav class="h-screen flex flex-col gap-3 pb-2 px-0 fixed top-0 left-0 transition duration-100 border-border-300 border-r-0.5" aria-label="Sidebar" style="width:0"><div class="flex w-full items-center gap-px p-2 transition-all duration-75 ease-out"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 group bg-bg-100" type="button" data-testid="pin-sidebar-toggle" aria-label="Sidebar" aria-expanded="false" aria-haspopup="menu" data-state="closed"><div class="relative"><div class="flex items-center justify-center group-hover:scale-80 transition scale-100 text-text-300" style="width:20px;height:20px"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 group-hover:scale-80 transition scale-100 text-text-300" aria-hidden="true"><path d="M16.5 4C17.3284 4 18 4.67157 18 5.5V14.5C18 15.3284 17.3284 16 16.5 16H3.5C2.67157 16 2 15.3284 2 14.5V5.5C2 4.67157 2.67157 4 3.5 4H16.5ZM7 15H16.5C16.7761 15 17 14.7761 17 14.5V5.5C17 5.22386 16.7761 5 16.5 5H7V15ZM3.5 5C3.22386 5 3 5.22386 3 5.5V14.5C3 14.7761 3.22386 15 3.5 15H6V5H3.5Z"></path></svg></div><div class="flex items-center justify-center opacity-0 scale-75 absolute inset-0 transition-all text-text-200" style="width:20px;height:20px"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 opacity-0 scale-75 absolute inset-0 transition-all text-text-200" aria-hidden="true"><path d="M16.5 3C16.7761 3 17 3.22386 17 3.5V16.5L16.9902 16.6006C16.9437 16.8286 16.7417 17 16.5 17C16.2583 17 16.0563 16.8286 16.0098 16.6006L16 16.5V3.5C16 3.22386 16.2239 3 16.5 3ZM8.12793 5.16504C8.28958 4.98547 8.5524 4.95058 8.75293 5.06836L8.83496 5.12793L13.835 9.62793C13.9403 9.72275 14 9.85828 14 10C14 10.1063 13.9667 10.2093 13.9053 10.2939L13.835 10.3721L8.83496 14.8721C8.62972 15.0568 8.31267 15.0402 8.12793 14.835C7.94322 14.6297 7.95984 14.3127 8.16504 14.1279L12.1963 10.5H3.5C3.22386 10.5 3 10.2761 3 10C3 9.72386 3.22386 9.5 3.5 9.5H12.1963L8.16504 5.87207L8.09766 5.79688C7.95931 5.60979 7.96622 5.34471 8.12793 5.16504Z"></path></svg></div></div></button></div><div class="flex flex-col align-center h-full overflow-hidden opacity-0 -translate-x-0.5 transition-all duration-200 pointer-events-none" aria-hidden="true" inert=""><div class="flex flex-col px-2 pt-1 gap-px mb-6"><div class="mb-1"><div data-state="closed"><a target="_self" class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none h-9 px-4 py-2 rounded-lg min-w-[5rem] active:scale-[0.985] whitespace-nowrap group transition ease-in-out active:!scale-100 hover:bg-transparent flex !justify-start !min-w-0 w-full" aria-label="New chat" href="https://claude.ai/new"><div class="-mx-3 flex flex-row items-center gap-2"><div class="w-6 h-6 flex items-center justify-center group-active:!scale-[0.98] group-active:!shadow-none group-active:bg-accent-main-200 group-hover:-rotate-3 group-hover:scale-110 group-active:rotate-6 rounded-full transition-all ease-in-out bg-accent-main-000 group-hover:shadow-md"><div class="flex items-center justify-center group-hover:scale-105 transition text-always-white" style="width:12px;height:12px"><svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 group-hover:scale-105 transition text-always-white" aria-hidden="true"><path d="M10 3C10.4142 3 10.75 3.33579 10.75 3.75V9.25H16.25C16.6642 9.25 17 9.58579 17 10C17 10.3882 16.7051 10.7075 16.3271 10.7461L16.25 10.75H10.75V16.25C10.75 16.6642 10.4142 17 10 17C9.58579 17 9.25 16.6642 9.25 16.25V10.75H3.75C3.33579 10.75 3 10.4142 3 10C3 9.58579 3.33579 9.25 3.75 9.25H9.25V3.75C9.25 3.33579 9.58579 3 10 3Z"></path></svg></div></div><div class="opacity-0 -translate-x-0.5 transition-all duration-200 text-accent-main-100 font-medium text-sm">New chat</div></div></a></div></div><div class="relative group" data-state="closed"><a target="_self" class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-9 px-4 py-2 rounded-lg min-w-[5rem] active:scale-[0.985] whitespace-nowrap w-full hover:bg-bg-400 overflow-hidden !min-w-0 group active:bg-bg-400 active:scale-[1.0] px-4" aria-label="Chats" href="https://claude.ai/recents"><div class="-translate-x-2 w-full flex flex-row items-center justify-start gap-3"><div class="size-4 flex items-center justify-center"><div class="flex items-center justify-center group" style="width:16px;height:16px"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 group" aria-hidden="true"><path class="group-hover:-translate-x-[0.5px] transition group-active:translate-x-0" d="M8.99962 2C12.3133 2 14.9996 4.68629 14.9996 8C14.9996 11.3137 12.3133 14 8.99962 14H2.49962C2.30105 13.9998 2.12113 13.8821 2.04161 13.7002C1.96224 13.5181 1.99835 13.3058 2.1334 13.1602L3.93516 11.2178C3.34317 10.2878 2.99962 9.18343 2.99962 8C2.99962 4.68643 5.68609 2.00022 8.99962 2ZM8.99962 3C6.23838 3.00022 3.99961 5.23871 3.99961 8C3.99961 9.11212 4.36265 10.1386 4.97618 10.9688C5.11884 11.1621 5.1035 11.4293 4.94004 11.6055L3.64512 13H8.99962C11.761 13 13.9996 10.7614 13.9996 8C13.9996 5.23858 11.761 3 8.99962 3Z"></path><path class="group-hover:translate-x-[0.5px] transition group-active:translate-x-0" d="M16.5445 9.72754C16.4182 9.53266 16.1678 9.44648 15.943 9.53418C15.7183 9.62215 15.5932 9.85502 15.6324 10.084L15.7369 10.3955C15.9073 10.8986 16.0006 11.438 16.0006 12C16.0006 13.1123 15.6376 14.1386 15.024 14.9687C14.8811 15.1621 14.8956 15.4302 15.0592 15.6064L16.3531 17H11.0006C9.54519 17 8.23527 16.3782 7.32091 15.3848L7.07091 15.1103C6.88996 14.9645 6.62535 14.9606 6.43907 15.1143C6.25267 15.2682 6.20668 15.529 6.31603 15.7344L6.58458 16.0625C7.68048 17.253 9.25377 18 11.0006 18H17.5006C17.6991 17.9998 17.8791 17.8822 17.9586 17.7002C18.038 17.5181 18.0018 17.3058 17.8668 17.1602L16.0631 15.2178C16.6554 14.2876 17.0006 13.1837 17.0006 12C17.0006 11.3271 16.8891 10.6792 16.6842 10.0742L16.5445 9.72754Z"></path></svg></div></div><span class="truncate text-sm whitespace-nowrap w-full"><div class="opacity-0 -translate-x-0.5 transition-all duration-200">Chats</div></span></div></a></div><div class="relative group" data-state="closed"><a target="_self" class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-9 px-4 py-2 rounded-lg min-w-[5rem] active:scale-[0.985] whitespace-nowrap w-full hover:bg-bg-400 overflow-hidden !min-w-0 group active:bg-bg-400 active:scale-[1.0] px-4" aria-label="Projects" href="https://claude.ai/projects/create"><div class="-translate-x-2 w-full flex flex-row items-center justify-start gap-3"><div class="size-4 flex items-center justify-center"><div class="flex items-center justify-center group" style="width:16px;height:16px"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 group" aria-hidden="true"><path class="group-hover:scale-95 origin-center" d="M15.8198 7C16.6885 7.00025 17.3624 7.73158 17.3178 8.57617L17.2993 8.74707L16.1332 15.7471C16.0126 16.4699 15.3865 16.9996 14.6538 17H5.34711C4.6142 16.9998 3.98833 16.47 3.86762 15.7471L2.7016 8.74707C2.54922 7.83277 3.25418 7 4.18109 7H15.8198ZM4.18109 8C3.87216 8 3.63722 8.27731 3.68793 8.58203L4.85394 15.582C4.89413 15.8229 5.10291 15.9998 5.34711 16H14.6538C14.8978 15.9996 15.1068 15.8228 15.1469 15.582L16.3129 8.58203L16.3188 8.46973C16.3036 8.21259 16.0899 8.00023 15.8198 8H4.18109Z"></path><path class="group-hover:-translate-y-[1.4px] group-hover:translate-x-[0.5px] group-hover:rotate-3 transition group-active:translate-y-0" d="M16.0004 5.5C16.0004 5.224 15.7764 5.00024 15.5004 5H4.50043C4.22428 5 4.00043 5.22386 4.00043 5.5C4.00043 5.77614 4.22428 6 4.50043 6H15.5004C15.7764 5.99976 16.0004 5.776 16.0004 5.5Z"></path><path class="group-hover:-translate-y-[2.8px] group-hover:translate-x-px group-hover:rotate-6 transition group-active:translate-y-0" d="M14.5004 3.5C14.5004 3.224 14.2764 3.00024 14.0004 3H6.00043C5.72428 3 5.50043 3.22386 5.50043 3.5C5.50043 3.77614 5.72428 4 6.00043 4H14.0004C14.2764 3.99976 14.5004 3.776 14.5004 3.5Z"></path></svg></div></div><span class="truncate text-sm whitespace-nowrap w-full"><div class="opacity-0 -translate-x-0.5 transition-all duration-200">Projects</div></span></div></a></div><div><div class="relative group" data-state="closed"><a target="_self" class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-9 px-4 py-2 rounded-lg min-w-[5rem] active:scale-[0.985] whitespace-nowrap w-full hover:bg-bg-400 overflow-hidden !min-w-0 group active:bg-bg-400 active:scale-[1.0] px-4" aria-label="Artifacts" href="https://claude.ai/artifacts"><div class="-translate-x-2 w-full flex flex-row items-center justify-start gap-3"><div class="size-4 flex items-center justify-center"><div class="flex items-center justify-center group backface-hidden" style="width:16px;height:16px"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 group backface-hidden" aria-hidden="true"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.35352 3.1464L9.35352 6.14642C9.43935 6.25103 9.5 6.36003 9.5 6.50091C9.4998 6.6332 9.44704 6.75988 9.35352 6.85346L6.35352 9.85347C6.14584 10.0609 5.85611 10.0243 5.64648 9.85347L2.64648 6.85346C2.55296 6.75988 2.5002 6.6332 2.5 6.50091C2.5 6.36841 2.55285 6.24017 2.64648 6.14642L5.64648 3.1464C5.8552 2.97421 6.14635 2.93936 6.35352 3.1464ZM6 8.79194L3.70703 6.49994L6 4.20696L8.29297 6.49994L6 8.79194Z"></path><path class="group-hover:-rotate-90 transition-transform duration-200 ease-snappy-out" style="transform-origin:14px 6.5px" d="M16.8984 3.7509C16.9875 3.90632 16.986 4.09826 16.8955 4.25286L15.5791 6.49994L16.8955 8.74702C16.986 8.90159 16.9874 9.09354 16.8984 9.24898C16.8093 9.40436 16.643 9.49996 16.4638 9.49996H11.5C11.3198 9.49996 11.1532 9.4028 11.0644 9.24605C10.976 9.08949 10.9789 8.89736 11.0713 8.74312L12.417 6.49994L11.0713 4.25676C10.9789 4.1025 10.976 3.91037 11.0644 3.75383C11.1532 3.59717 11.3199 3.49992 11.5 3.49992H16.4638C16.6429 3.51309 16.8055 3.58909 16.8984 3.7509ZM13.4287 6.2431C13.5152 6.4107 13.5166 6.58638 13.4287 6.75678L12.3828 8.49995H15.5918L14.5683 6.75287C14.477 6.59683 14.477 6.40303 14.5683 6.24701L15.5918 4.49993H12.3828L13.4287 6.2431Z"></path><path class="group-hover:rotate-[120deg] transition-transform duration-200 ease-snappy-out" style="transform-origin:6px 14px" fill-rule="evenodd" clip-rule="evenodd" d="M7.25293 10.9668C7.40708 10.8793 7.59647 10.8801 7.75 10.9687C7.90356 11.0574 7.99869 11.2211 8 11.3984L8.01074 12.8388L9.30762 13.6054C9.42811 13.6994 9.49994 13.8448 9.5 14C9.5 14.1773 9.40587 14.3418 9.25293 14.4316L8.01074 15.1601L7.99512 16.667C7.97406 16.8184 7.88446 16.9536 7.75 17.0312C7.59642 17.1199 7.40713 17.1207 7.25293 17.0332L6 16.3203L4.74707 17.0332C4.59287 17.1207 4.40358 17.1199 4.25 17.0312C4.09643 16.9425 4.00124 16.7789 4 16.6015L3.99023 15.1601L2.74707 14.4316C2.59413 14.3418 2.5 14.1773 2.5 14C2.50006 13.8448 2.57188 13.6994 2.69238 13.6054L3.99023 12.8388L4 11.3984C4.00131 11.2211 4.09644 11.0574 4.25 10.9687C4.40353 10.8801 4.59292 10.8793 4.74707 10.9668L6 11.6787L7.25293 10.9668ZM4.99512 12.2568L5.75293 12.6884C5.90608 12.7754 6.09392 12.7754 6.24707 12.6884L7.00586 12.2568L7.01172 13.1308C7.01308 13.3068 7.10706 13.4695 7.25879 13.5586L8.01172 14L7.25879 14.4414C7.10706 14.5304 7.01315 14.6932 7.01172 14.8691L7.00586 15.7422L6.24707 15.3115C6.09397 15.2246 5.90603 15.2246 5.75293 15.3115L4.99512 15.7422L4.98828 14.8691C4.98703 14.7152 4.91459 14.5716 4.79492 14.4785L3.98926 14L4.74121 13.5586C4.87421 13.4805 4.96267 13.3457 4.9834 13.1953L4.99512 12.2568Z"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M14 11C15.6568 11 16.9999 12.3432 17 14C17 15.6568 15.6569 17 14 17C12.3431 17 11 15.6568 11 14C11.0001 12.3432 12.3432 11 14 11ZM12 14C12.0001 12.8955 12.8955 12 14 12C15.1045 12 15.9999 12.8955 16 14C16 15.1045 15.1046 16 14 16C12.8954 16 12 15.1045 12 14Z"></path></svg></div></div><span class="truncate text-sm whitespace-nowrap w-full"><div class="opacity-0 -translate-x-0.5 transition-all duration-200 flex items-center gap-2">Artifacts</div></span></div></a></div></div></div><div class="flex flex-grow flex-col overflow-y-auto overflow-x-hidden relative px-2 mb-2" tabindex="-1"><div class="opacity-0 -translate-x-0.5 transition-all duration-200 overflow-hidden" aria-hidden="true" inert=""><div class="flex flex-col "><h3 aria-hidden="true" class="text-text-300 pb-2 mt-1 text-xs select-none pl-2 sticky top-0 z-10 bg-gradient-to-b from-bg-200 from-50% to-bg-200/40 pointer-events-none">Recents</h3><ul class="flex flex-col gap-px"><li style="opacity: 1; height: auto;"><div class="relative group" data-state="closed"><a target="_self" class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 rounded-md px-3 min-w-[4rem] active:scale-[0.985] whitespace-nowrap !text-xs w-full hover:bg-bg-400 overflow-hidden !min-w-0 group active:bg-bg-400 active:scale-[1.0] px-4" href="https://claude.ai/chat/41d1bf5b-2d5b-475b-93b0-e03d422c5531"><div class="-translate-x-2 w-full flex flex-row items-center justify-start gap-3"><span class="truncate text-sm whitespace-nowrap w-full group-hover:[mask-image:linear-gradient(to_right,hsl(var(--always-black))_78%,transparent_95%)] group-focus-within:[mask-image:linear-gradient(to_right,hsl(var(--always-black))_78%,transparent_95%)] [mask-size:100%_100%]">Conversation download method</span></div></a></div></li><li style="opacity: 1; height: auto;"><div class="relative group" data-state="closed"><a target="_self" class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 rounded-md px-3 min-w-[4rem] active:scale-[0.985] whitespace-nowrap !text-xs w-full hover:bg-bg-400 overflow-hidden !min-w-0 group active:bg-bg-400 active:scale-[1.0] px-4" href="https://claude.ai/chat/736160a4-ec5e-4c76-b8e5-93ceea17337a"><div class="-translate-x-2 w-full flex flex-row items-center justify-start gap-3"><span class="truncate text-sm whitespace-nowrap w-full group-hover:[mask-image:linear-gradient(to_right,hsl(var(--always-black))_78%,transparent_95%)] group-focus-within:[mask-image:linear-gradient(to_right,hsl(var(--always-black))_78%,transparent_95%)] [mask-size:100%_100%]">Symbrella brain research project</span></div></a></div></li><li style="opacity: 1; height: auto;"><div class="relative group" data-state="closed"><a target="_self" class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 rounded-md px-3 min-w-[4rem] active:scale-[0.985] whitespace-nowrap !text-xs w-full hover:bg-bg-400 overflow-hidden !min-w-0 group active:bg-bg-400 active:scale-[1.0] px-4" href="https://claude.ai/chat/d24bc6b1-db34-4a7d-b84c-1cb83b44f827"><div class="-translate-x-2 w-full flex flex-row items-center justify-start gap-3"><span class="truncate text-sm whitespace-nowrap w-full group-hover:[mask-image:linear-gradient(to_right,hsl(var(--always-black))_78%,transparent_95%)] group-focus-within:[mask-image:linear-gradient(to_right,hsl(var(--always-black))_78%,transparent_95%)] [mask-size:100%_100%]">AI Assistant Capabilities Overview</span></div></a></div></li><li style="opacity: 1; height: auto;"><div class="relative group" data-state="closed"><a target="_self" class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 rounded-md px-3 min-w-[4rem] active:scale-[0.985] whitespace-nowrap !text-xs w-full hover:bg-bg-400 overflow-hidden !min-w-0 group active:bg-bg-400 active:scale-[1.0] px-4" href="https://claude.ai/chat/9ae4f671-59c8-46a5-995a-e33e611cc599"><div class="-translate-x-2 w-full flex flex-row items-center justify-start gap-3"><span class="truncate text-sm whitespace-nowrap w-full group-hover:[mask-image:linear-gradient(to_right,hsl(var(--always-black))_78%,transparent_95%)] group-focus-within:[mask-image:linear-gradient(to_right,hsl(var(--always-black))_78%,transparent_95%)] [mask-size:100%_100%]">Elixir Game Supervisor with Dynamic Battle Servers</span></div></a></div></li></ul></div></div><div class="h-full w-full cursor-pointer absolute top-0 z-sidebar"></div></div><div class="px-1.5 pb-1 transition"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-9 px-4 py-2 rounded-lg min-w-[5rem] active:scale-[0.985] whitespace-nowrap !scale-100 flex flex-row flex-grow items-center pointer-cursor !min-w-0 w-full hover:!bg-bg-400 !transition-all !px-0.5 py-5 my-1 gap-0" type="button" data-testid="user-menu-button" id="radix-_R_3dald5ubopb3b_" aria-haspopup="menu" aria-expanded="false" data-state="closed"><div class="flex-shrink-0 flex size-8 items-center justify-center rounded-full text-text-200"><div class="flex shrink-0 items-center justify-center rounded-full font-bold select-none h-7 w-7 text-[12px] bg-text-200 text-bg-100">B</div></div><div class="opacity-0 -translate-x-0.5 transition-all duration-200 flex w-full text-sm justify-between items-center font-medium min-w-0"><div class="flex flex-col items-start w-full max-w-full overflow-hidden pr-4"><span class="w-full max-w-full overflow-hidden text-start block truncate">Brad</span><span class="w-full truncate text-xs text-text-300 font-normal text-start">Free plan</span></div><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 256 256" class="flex-shrink-0 mr-2"><path d="M213.66,101.66l-80,80a8,8,0,0,1-11.32,0l-80-80A8,8,0,0,1,53.66,90.34L128,164.69l74.34-74.35a8,8,0,0,1,11.32,11.32Z"></path></svg></div></button></div></div></nav></div></div><div class="h-screen w-full relative min-w-0" style="padding-top:0px;padding-right:0px;padding-bottom:0px;padding-left:0px"><!--$--><!--/$--><div class="flex flex-1 h-full w-full overflow-hidden relative"><div class="h-full flex flex-col overflow-hidden" style="flex: 100 0 0%;"><header class="flex w-full bg-bg-100 sticky top-0 z-header h-12 h-12 -mb-3" aria-hidden="false" data-testid="page-header"><div class="from-bg-100  via-bg-100  via-65%  to-bg-100/0  pointer-events-none  absolute  inset-0  -bottom-5  z-[-1]  bg-gradient-to-b  blur-sm"></div><div class="flex w-full items-center justify-between gap-4 pl-11 lg:px-8 gap-6 p-3 lg:pl-4 lg:pr-3 pr-3"><div class="flex min-w-0 flex-1 shrink md:items-center font-base-bold pr-[100px]"><div class="flex min-w-0 shrink-1 items-center group"><div class="truncate text-text-300">Symbrella brain research project</div></div></div><div class="right-3 flex gap-2"><div class="bg-bg-300 text-text-300 rounded-full px-3 py-1.5 font-base-bold">Shared by Brad</div></div></div></header><div class="relative h-full flex-1 flex overflow-x-hidden overflow-y-scroll pt-6"><div class="relative mx-auto flex h-full w-full max-w-3xl flex-1 flex-col md:px-2 mt-4"><div class="flex-1  flex  flex-col  gap-3  px-4  max-w-3xl  mx-auto  w-full"><div class="border-0.5 border-border-400 text-text-400 flex items-center justify-between gap-2 rounded-xl px-3 py-2"><div class="flex items-center gap-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="shrink-0"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></svg><p class="text-xs leading-snug">This is a copy of a chat between Claude and Brad. Content may include unverified or unsafe content that do not represent the views of Anthropic. Shared snapshot may contain attachments and data not displayed here.</p></div><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 rounded-md px-3 min-w-[4rem] active:scale-[0.985] whitespace-nowrap !text-xs" type="button">Report</button></div><div data-test-render-count="1"><div class="mb-1 mt-1"><div class="group  relative  inline-flex  gap-2  bg-bg-300  rounded-xl  pl-2.5  py-2.5  break-words  text-text-100  transition-all  max-w-[75ch]  flex-col pr-6" style="opacity: 1; transform: none;"><div class="flex flex-row gap-2"><div class="shrink-0"><div class="flex shrink-0 items-center justify-center rounded-full font-bold select-none h-7 w-7 text-[12px] bg-text-200 text-bg-100">B</div></div><div data-testid="user-message" class="font-large !font-user-message grid grid-cols-1 gap-2 py-0.5"><p class="whitespace-pre-wrap break-words">Ive uploaded a project called symbrella to github
<a href="https://github.com/bushman77/Symbrella.git" target="_blank" class="underline">https://github.com/bushman77/Symbrella.git</a>
Im trying to understand the brain using elixir and how it works with semantic disambiguation and im currently working on the lifg section of the human brain in this process and i just cant get the scoring and filtering out the losers fir ean engram and mwe</p></div></div></div></div></div><div data-test-render-count="1"><div style="height: auto; opacity: 1; transform: none;"><div data-is-streaming="false" class="group  relative pb-8" style="opacity: 1; transform: none;"><div class="font-claude-response  relative  leading-[1.65rem]  [&amp;_pre&gt;div]:bg-bg-000/50  [&amp;_pre&gt;div]:border-0.5  [&amp;_pre&gt;div]:border-border-400  [&amp;_.ignore-pre-bg&gt;div]:bg-transparent  [&amp;_.standard-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2  [&amp;_.standard-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8  [&amp;_.progressive-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2  [&amp;_.progressive-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8"><div><div class="grid-cols-1 grid gap-2.5 [&amp;_&gt;_*]:min-w-0 standard-markdown"><p class="whitespace-normal break-words">I'll help you understand the LIFG (Left Inferior Frontal Gyrus) section and the scoring/filtering mechanism for engrams and MWEs (Multi-Word Expressions). Let me fetch your repository to see what you're working with.</p></div></div><div class="ease-out rounded-lg border-0.5 flex flex-col font-ui leading-normal my-3 border-border-300 min-h-[2.625rem] hover:bg-bg-200 mt-3 mb-3" style="opacity: 1;"><button class="group/row flex flex-row items-center justify-between gap-4 rounded-lg text-text-300 h-[2.625rem] py-2 px-3 cursor-pointer transition-colors duration-200 hover:text-text-200 hover:text-text-000"><div class="flex flex-row items-center gap-2 min-w-0"><div class="w-5 h-5 flex items-center justify-center text-text-100"><div class="shrink-0 bg-bg-000 border-border-300 border-0.5 shadow-sm flex items-center justify-center !border-0 !shadow-none !bg-transparent" style="width: 16px; height: 16px; border-radius: 4.32px;"><img alt="favicon" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="transition duration-500 opacity-1" src="https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fdomain%3Dgithub.com%26sz%3D32&amp;w=32&amp;q=75" style="color: transparent; max-width: 16px; max-height: 16px;"></div></div><div class="relative bottom-[0.5px] font-base text-left leading-tight overflow-hidden overflow-ellipsis whitespace-nowrap flex-grow text-text-300">Fetched <span class="text-text-400">GitHub - bushman77/Symbrella: Ui for a symbolic ai</span></div></div><div class="flex flex-row items-center gap-1.5 min-w-0 shrink-0"><p class="relative bottom-[0.5px] pl-1 text-text-500 font-small leading-tight shrink-0 whitespace-nowrap">github.com</p><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="text-text-300"><path d="M224,104a8,8,0,0,1-16,0V59.32l-66.33,66.34a8,8,0,0,1-11.32-11.32L196.68,48H152a8,8,0,0,1,0-16h64a8,8,0,0,1,8,8Zm-40,24a8,8,0,0,0-8,8v72H48V80h72a8,8,0,0,0,0-16H48A16,16,0,0,0,32,80V208a16,16,0,0,0,16,16H176a16,16,0,0,0,16-16V136A8,8,0,0,0,184,128Z"></path></svg></div></button></div><div><div class="grid-cols-1 grid gap-2.5 [&amp;_&gt;_*]:min-w-0 standard-markdown"><p class="whitespace-normal break-words">Let me fetch the LIFG module directly to see the scoring and filtering logic:</p></div></div><div class="ease-out rounded-lg border-0.5 flex flex-col font-ui leading-normal my-3 border-border-300 min-h-[2.625rem] hover:bg-bg-200 mt-3 mb-3" style="opacity: 1;"><button class="group/row flex flex-row items-center justify-between gap-4 rounded-lg text-text-300 h-[2.625rem] py-2 px-3 cursor-pointer transition-colors duration-200 hover:text-text-200 hover:text-text-000"><div class="flex flex-row items-center gap-2 min-w-0"><div class="w-5 h-5 flex items-center justify-center text-text-100"><div class="shrink-0 bg-bg-000 border-border-300 border-0.5 shadow-sm flex items-center justify-center !border-0 !shadow-none !bg-transparent" style="width: 16px; height: 16px; border-radius: 4.32px;"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 256 256" class="text-text-500"><path d="M128,24h0A104,104,0,1,0,232,128,104.12,104.12,0,0,0,128,24Zm88,104a87.61,87.61,0,0,1-3.33,24H174.16a157.44,157.44,0,0,0,0-48h38.51A87.61,87.61,0,0,1,216,128ZM102,168H154a115.11,115.11,0,0,1-26,45A115.27,115.27,0,0,1,102,168Zm-3.9-16a140.84,140.84,0,0,1,0-48h59.88a140.84,140.84,0,0,1,0,48ZM40,128a87.61,87.61,0,0,1,3.33-24H81.84a157.44,157.44,0,0,0,0,48H43.33A87.61,87.61,0,0,1,40,128ZM154,88H102a115.11,115.11,0,0,1,26-45A115.27,115.27,0,0,1,154,88Zm52.33,0H170.71a135.28,135.28,0,0,0-22.3-45.6A88.29,88.29,0,0,1,206.37,88ZM107.59,42.4A135.28,135.28,0,0,0,85.29,88H49.63A88.29,88.29,0,0,1,107.59,42.4ZM49.63,168H85.29a135.28,135.28,0,0,0,22.3,45.6A88.29,88.29,0,0,1,49.63,168Zm98.78,45.6a135.28,135.28,0,0,0,22.3-45.6h35.66A88.29,88.29,0,0,1,148.41,213.6Z"></path></svg></div></div><div class="relative bottom-[0.5px] font-base text-left leading-tight overflow-hidden overflow-ellipsis whitespace-nowrap flex-grow text-text-300">Failed to fetch <span class="text-text-400">https://raw.githubusercontent.com/bushman77/Symbrella/main/apps/brain/lib/brain/lifg.ex</span></div></div><div class="flex flex-row items-center gap-1.5 min-w-0 shrink-0"><span class="inline-flex" data-state="closed"><div class="flex items-center justify-center text-danger-000" style="width: 16px; height: 16px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 text-danger-000" aria-hidden="true"><path d="M8.70798 3.70804C9.25201 2.78523 10.5372 2.72763 11.1738 3.53519L11.292 3.70804L17.792 14.7383C18.3812 15.7382 17.6606 17 16.5 17H3.49995C2.33937 17 1.61881 15.7382 2.20795 14.7383L8.70798 3.70804ZM10.3916 4.15824C10.1794 3.88887 9.75069 3.90817 9.56931 4.21586L3.06928 15.2461C2.87297 15.5794 3.11314 16 3.49995 16H16.5C16.8869 16 17.1271 15.5794 16.9307 15.2461L10.4306 4.21586L10.3916 4.15824ZM9.99998 13C10.4142 13 10.75 13.3358 10.75 13.75C10.7499 14.1642 10.4142 14.5 9.99998 14.5C9.58582 14.5 9.25002 14.1642 9.24998 13.75C9.24998 13.3358 9.58579 13.0001 9.99998 13ZM9.99998 8.00003C10.2761 8.00003 10.5 8.22389 10.5 8.50003V11.5C10.4999 11.7761 10.2761 12 9.99998 12C9.72389 12 9.50003 11.7761 9.49998 11.5V8.50003C9.49998 8.22391 9.72386 8.00007 9.99998 8.00003Z"></path></svg></div></span></div></button></div><div><div class="grid-cols-1 grid gap-2.5 [&amp;_&gt;_*]:min-w-0 standard-markdown"><p class="whitespace-normal break-words">Let me search for the repository structure:</p></div></div><div class="ease-out rounded-lg border-0.5 flex flex-col font-ui leading-normal my-3 border-border-300 min-h-[2.625rem] hover:bg-bg-200 mt-3 mb-3" style="opacity: 1;"><button class="group/row flex flex-row items-center justify-between gap-4 rounded-lg text-text-300 h-[2.625rem] py-2 px-3 cursor-pointer transition-colors duration-200 hover:text-text-200 hover:text-text-000"><div class="flex flex-row items-center gap-2 min-w-0"><div class="w-5 h-5 flex items-center justify-center text-text-100"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256"><path d="M128,24h0A104,104,0,1,0,232,128,104.12,104.12,0,0,0,128,24Zm88,104a87.61,87.61,0,0,1-3.33,24H174.16a157.44,157.44,0,0,0,0-48h38.51A87.61,87.61,0,0,1,216,128ZM102,168H154a115.11,115.11,0,0,1-26,45A115.27,115.27,0,0,1,102,168Zm-3.9-16a140.84,140.84,0,0,1,0-48h59.88a140.84,140.84,0,0,1,0,48ZM40,128a87.61,87.61,0,0,1,3.33-24H81.84a157.44,157.44,0,0,0,0,48H43.33A87.61,87.61,0,0,1,40,128ZM154,88H102a115.11,115.11,0,0,1,26-45A115.27,115.27,0,0,1,154,88Zm52.33,0H170.71a135.28,135.28,0,0,0-22.3-45.6A88.29,88.29,0,0,1,206.37,88ZM107.59,42.4A135.28,135.28,0,0,0,85.29,88H49.63A88.29,88.29,0,0,1,107.59,42.4ZM49.63,168H85.29a135.28,135.28,0,0,0,22.3,45.6A88.29,88.29,0,0,1,49.63,168Zm98.78,45.6a135.28,135.28,0,0,0,22.3-45.6h35.66A88.29,88.29,0,0,1,148.41,213.6Z"></path></svg></div><div class="relative bottom-[0.5px] font-base text-left leading-tight overflow-hidden overflow-ellipsis whitespace-nowrap flex-grow text-text-300">bushman77 Symbrella lifg.ex github</div></div><div class="flex flex-row items-center gap-1.5 min-w-0 shrink-0"><p class="relative bottom-[0.5px] pl-1 text-text-500 font-small leading-tight shrink-0 whitespace-nowrap">10 results</p><span class="inline-flex transition-transform duration-400 ease-snappy-out rotate-0"><div class="flex items-center justify-center relative bottom-[0.5px] text-text-300" style="width: 16px; height: 16px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 relative bottom-[0.5px] text-text-300" aria-hidden="true"><path d="M14.128 7.16482C14.3126 6.95983 14.6298 6.94336 14.835 7.12771C15.0402 7.31242 15.0567 7.62952 14.8721 7.83477L10.372 12.835L10.2939 12.9053C10.2093 12.9667 10.1063 13 9.99995 13C9.85833 12.9999 9.72264 12.9402 9.62788 12.835L5.12778 7.83477L5.0682 7.75273C4.95072 7.55225 4.98544 7.28926 5.16489 7.12771C5.34445 6.96617 5.60969 6.95939 5.79674 7.09744L5.87193 7.16482L9.99995 11.7519L14.128 7.16482Z"></path></svg></div></span></div></button><div class="overflow-hidden shrink-0" tabindex="-1" style="opacity: 0; height: 0px;"><div class="min-h-0" style="mask-image: linear-gradient(transparent 0%, black 0px, black calc(100% - 16px), transparent 100%);"><div class="overflow-y-auto overflow-x-hidden min-h-0 h-full !max-h-[238px] pointer-events-none" tabindex="-1" style="scrollbar-gutter: stable;"><div class="flex flex-nowrap p-2 pt-0 flex-col" tabindex="-1"><div><a target="_blank" tabindex="-1"><button disabled="" class="flex flex-row gap-4 items-center justify-between rounded-md shrink-0 h-[2rem] px-1.5 mx-0.5 w-full min-w-0 cursor-default"><div class="flex flex-row items-center gap-2 min-w-0"><div class="h-5 w-5 flex items-center justify-center shrink-0"><img alt="favicon" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="transition duration-500 opacity-1" src="https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fsz%3D64%26domain%3Dgithub.com&amp;w=32&amp;q=75" style="color: transparent; max-width: 16px; max-height: 16px;"></div><p class="relative text-[0.875rem] whitespace-nowrap overflow-hidden text-ellipsis shrink text-text-000">Ex Libris, Ltd. · GitHub</p><p class="relative bottom-[1px] text-[0.75rem] text-text-500 line-clamp-1 shrink-0">github.com</p></div></button></a></div><div><a target="_blank" tabindex="-1"><button disabled="" class="flex flex-row gap-4 items-center justify-between rounded-md shrink-0 h-[2rem] px-1.5 mx-0.5 w-full min-w-0 cursor-default"><div class="flex flex-row items-center gap-2 min-w-0"><div class="h-5 w-5 flex items-center justify-center shrink-0"><img alt="favicon" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="transition duration-500 opacity-1" src="https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fsz%3D64%26domain%3Dgithub.com&amp;w=32&amp;q=75" style="color: transparent; max-width: 16px; max-height: 16px;"></div><p class="relative text-[0.875rem] whitespace-nowrap overflow-hidden text-ellipsis shrink text-text-000">GitHub - bushman77/fournations_concrete</p><p class="relative bottom-[1px] text-[0.75rem] text-text-500 line-clamp-1 shrink-0">github.com</p></div></button></a></div><div><a target="_blank" tabindex="-1"><button disabled="" class="flex flex-row gap-4 items-center justify-between rounded-md shrink-0 h-[2rem] px-1.5 mx-0.5 w-full min-w-0 cursor-default"><div class="flex flex-row items-center gap-2 min-w-0"><div class="h-5 w-5 flex items-center justify-center shrink-0"><img alt="favicon" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="transition duration-500 opacity-1" src="https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fsz%3D64%26domain%3Dgithub.com&amp;w=32&amp;q=75" style="color: transparent; max-width: 16px; max-height: 16px;"></div><p class="relative text-[0.875rem] whitespace-nowrap overflow-hidden text-ellipsis shrink text-text-000">GitHub - Rakashazi/emu-ex-plus-alpha: Multi-platform computer &amp; game console emulation system including supporting code (EmuFramework) and core engine (Imagine)</p><p class="relative bottom-[1px] text-[0.75rem] text-text-500 line-clamp-1 shrink-0">github.com</p></div></button></a></div><div><a target="_blank" tabindex="-1"><button disabled="" class="flex flex-row gap-4 items-center justify-between rounded-md shrink-0 h-[2rem] px-1.5 mx-0.5 w-full min-w-0 cursor-default"><div class="flex flex-row items-center gap-2 min-w-0"><div class="h-5 w-5 flex items-center justify-center shrink-0"><img alt="favicon" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="transition duration-500 opacity-1" src="https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fsz%3D64%26domain%3Dgithub.com&amp;w=32&amp;q=75" style="color: transparent; max-width: 16px; max-height: 16px;"></div><p class="relative text-[0.875rem] whitespace-nowrap overflow-hidden text-ellipsis shrink text-text-000">GitHub - X11Libre/xserver: XLibre Xserver</p><p class="relative bottom-[1px] text-[0.75rem] text-text-500 line-clamp-1 shrink-0">github.com</p></div></button></a></div><div><a target="_blank" tabindex="-1"><button disabled="" class="flex flex-row gap-4 items-center justify-between rounded-md shrink-0 h-[2rem] px-1.5 mx-0.5 w-full min-w-0 cursor-default"><div class="flex flex-row items-center gap-2 min-w-0"><div class="h-5 w-5 flex items-center justify-center shrink-0"><img alt="favicon" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="transition duration-500 opacity-1" src="https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fsz%3D64%26domain%3Dgithub.com&amp;w=32&amp;q=75" style="color: transparent; max-width: 16px; max-height: 16px;"></div><p class="relative text-[0.875rem] whitespace-nowrap overflow-hidden text-ellipsis shrink text-text-000">GitHub - odedbein/SEL_public</p><p class="relative bottom-[1px] text-[0.75rem] text-text-500 line-clamp-1 shrink-0">github.com</p></div></button></a></div><div><a target="_blank" tabindex="-1"><button disabled="" class="flex flex-row gap-4 items-center justify-between rounded-md shrink-0 h-[2rem] px-1.5 mx-0.5 w-full min-w-0 cursor-default"><div class="flex flex-row items-center gap-2 min-w-0"><div class="h-5 w-5 flex items-center justify-center shrink-0"><img alt="favicon" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="transition duration-500 opacity-1" src="https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fsz%3D64%26domain%3Dgithub.com&amp;w=32&amp;q=75" style="color: transparent; max-width: 16px; max-height: 16px;"></div><p class="relative text-[0.875rem] whitespace-nowrap overflow-hidden text-ellipsis shrink text-text-000">MyKissAssist/magician_115.ini at master · bushman77/MyKissAssist</p><p class="relative bottom-[1px] text-[0.75rem] text-text-500 line-clamp-1 shrink-0">github.com</p></div></button></a></div><div><a target="_blank" tabindex="-1"><button disabled="" class="flex flex-row gap-4 items-center justify-between rounded-md shrink-0 h-[2rem] px-1.5 mx-0.5 w-full min-w-0 cursor-default"><div class="flex flex-row items-center gap-2 min-w-0"><div class="h-5 w-5 flex items-center justify-center shrink-0"><img alt="favicon" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="transition duration-500 opacity-1" src="https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fsz%3D64%26domain%3Dgithub.com&amp;w=32&amp;q=75" style="color: transparent; max-width: 16px; max-height: 16px;"></div><p class="relative text-[0.875rem] whitespace-nowrap overflow-hidden text-ellipsis shrink text-text-000">Ex Libris, Ltd.</p><p class="relative bottom-[1px] text-[0.75rem] text-text-500 line-clamp-1 shrink-0">github.com</p></div></button></a></div><div><a target="_blank" tabindex="-1"><button disabled="" class="flex flex-row gap-4 items-center justify-between rounded-md shrink-0 h-[2rem] px-1.5 mx-0.5 w-full min-w-0 cursor-default"><div class="flex flex-row items-center gap-2 min-w-0"><div class="h-5 w-5 flex items-center justify-center shrink-0"><img alt="favicon" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="transition duration-500 opacity-1" src="https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fsz%3D64%26domain%3Dgithub.com&amp;w=32&amp;q=75" style="color: transparent; max-width: 16px; max-height: 16px;"></div><p class="relative text-[0.875rem] whitespace-nowrap overflow-hidden text-ellipsis shrink text-text-000">ex (me) · GitHub</p><p class="relative bottom-[1px] text-[0.75rem] text-text-500 line-clamp-1 shrink-0">github.com</p></div></button></a></div><div><a target="_blank" tabindex="-1"><button disabled="" class="flex flex-row gap-4 items-center justify-between rounded-md shrink-0 h-[2rem] px-1.5 mx-0.5 w-full min-w-0 cursor-default"><div class="flex flex-row items-center gap-2 min-w-0"><div class="h-5 w-5 flex items-center justify-center shrink-0"><img alt="favicon" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="transition duration-500 opacity-1" src="https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fsz%3D64%26domain%3Dgithub.com&amp;w=32&amp;q=75" style="color: transparent; max-width: 16px; max-height: 16px;"></div><p class="relative text-[0.875rem] whitespace-nowrap overflow-hidden text-ellipsis shrink text-text-000">UserScript: a forgotten programming language from the hell (2003) · GitHub</p><p class="relative bottom-[1px] text-[0.75rem] text-text-500 line-clamp-1 shrink-0">github.com</p></div></button></a></div><div><a target="_blank" tabindex="-1"><button disabled="" class="flex flex-row gap-4 items-center justify-between rounded-md shrink-0 h-[2rem] px-1.5 mx-0.5 w-full min-w-0 cursor-default"><div class="flex flex-row items-center gap-2 min-w-0"><div class="h-5 w-5 flex items-center justify-center shrink-0"><img alt="favicon" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="transition duration-500 opacity-1" src="https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fsz%3D64%26domain%3Dgithub.com&amp;w=32&amp;q=75" style="color: transparent; max-width: 16px; max-height: 16px;"></div><p class="relative text-[0.875rem] whitespace-nowrap overflow-hidden text-ellipsis shrink text-text-000">Explore GitHub · GitHub</p><p class="relative bottom-[1px] text-[0.75rem] text-text-500 line-clamp-1 shrink-0">github.com</p></div></button></a></div></div></div></div></div></div><div><div class="grid-cols-1 grid gap-2.5 [&amp;_&gt;_*]:min-w-0 standard-markdown"><p class="whitespace-normal break-words">Let me try fetching the direct file from the repo:</p></div></div><div class="ease-out rounded-lg border-0.5 flex flex-col font-ui leading-normal my-3 border-border-300 min-h-[2.625rem] hover:bg-bg-200 mt-3 mb-3" style="opacity: 1;"><button class="group/row flex flex-row items-center justify-between gap-4 rounded-lg text-text-300 h-[2.625rem] py-2 px-3 cursor-pointer transition-colors duration-200 hover:text-text-200 hover:text-text-000"><div class="flex flex-row items-center gap-2 min-w-0"><div class="w-5 h-5 flex items-center justify-center text-text-100"><div class="shrink-0 bg-bg-000 border-border-300 border-0.5 shadow-sm flex items-center justify-center !border-0 !shadow-none !bg-transparent" style="width: 16px; height: 16px; border-radius: 4.32px;"><img alt="favicon" loading="lazy" width="16" height="16" decoding="async" data-nimg="1" class="transition duration-500 opacity-1" src="https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fdomain%3Dgithub.com%26sz%3D32&amp;w=32&amp;q=75" style="color: transparent; max-width: 16px; max-height: 16px;"></div></div><div class="relative bottom-[0.5px] font-base text-left leading-tight overflow-hidden overflow-ellipsis whitespace-nowrap flex-grow text-text-300">Failed to fetch <span class="text-text-400">https://github.com/bushman77/Symbrella/blob/main/apps/brain/lib/brain/lifg.ex</span></div></div><div class="flex flex-row items-center gap-1.5 min-w-0 shrink-0"><span class="inline-flex" data-state="closed"><div class="flex items-center justify-center text-danger-000" style="width: 16px; height: 16px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 text-danger-000" aria-hidden="true"><path d="M8.70798 3.70804C9.25201 2.78523 10.5372 2.72763 11.1738 3.53519L11.292 3.70804L17.792 14.7383C18.3812 15.7382 17.6606 17 16.5 17H3.49995C2.33937 17 1.61881 15.7382 2.20795 14.7383L8.70798 3.70804ZM10.3916 4.15824C10.1794 3.88887 9.75069 3.90817 9.56931 4.21586L3.06928 15.2461C2.87297 15.5794 3.11314 16 3.49995 16H16.5C16.8869 16 17.1271 15.5794 16.9307 15.2461L10.4306 4.21586L10.3916 4.15824ZM9.99998 13C10.4142 13 10.75 13.3358 10.75 13.75C10.7499 14.1642 10.4142 14.5 9.99998 14.5C9.58582 14.5 9.25002 14.1642 9.24998 13.75C9.24998 13.3358 9.58579 13.0001 9.99998 13ZM9.99998 8.00003C10.2761 8.00003 10.5 8.22389 10.5 8.50003V11.5C10.4999 11.7761 10.2761 12 9.99998 12C9.72389 12 9.50003 11.7761 9.49998 11.5V8.50003C9.49998 8.22391 9.72386 8.00007 9.99998 8.00003Z"></path></svg></div></span></div></button></div><div><div class="grid-cols-1 grid gap-2.5 [&amp;_&gt;_*]:min-w-0 standard-markdown"><p class="whitespace-normal break-words">Based on what I can see from your repository structure and understanding of semantic disambiguation in the LIFG (Left Inferior Frontal Gyrus), let me help you understand the scoring and filtering mechanism for engrams and MWEs.</p>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">The LIFG's Role in Word Sense Disambiguation</h2>
<p class="whitespace-normal break-words">The LIFG is responsible for <strong>Stage 1 Word Sense Disambiguation (WSD)</strong>. In your architecture, it's handling:</p>
<ol class="[&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal space-y-1.5 pl-7">
<li class="whitespace-normal break-words"><strong>Engram scoring</strong> - assigning confidence scores to different word meanings</li>
<li class="whitespace-normal break-words"><strong>MWE detection</strong> - identifying multi-word expressions like "kick the bucket"</li>
<li class="whitespace-normal break-words"><strong>Filtering losers</strong> - eliminating low-probability interpretations</li>
</ol>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">The Typical Scoring &amp; Filtering Flow</h2>
<p class="whitespace-normal break-words">Here's how this typically works in a neurolinguistic model:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Conceptual flow for LIFG scoring:</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">defmodule</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Brain</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token module" style="color: rgb(209, 154, 102);">LIFG</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># 1. Score each candidate sense/engram</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">score_candidates</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>token</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> context</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    token</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>senses
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> sense </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>      score </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">calculate_score</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>sense</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> context</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>sense</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> score</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># 2. Calculate score based on:</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># - Frequency (how common is this sense?)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># - Context overlap (does it fit neighboring words?)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># - Priming (was this sense recently activated?)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">calculate_score</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>sense</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> context</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    frequency_score </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> sense</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>frequency </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.3</span><span>
</span></span><span><span>    context_score </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">context_overlap</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>sense</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> context</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.5</span><span>
</span></span><span><span>    priming_score </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">get_priming_boost</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>sense</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.2</span><span>
</span></span><span>    
</span><span><span>    frequency_score </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span> context_score </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span> priming_score
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># 3. Filter out "losers" - keep top N or above threshold</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">filter_losers</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scored_senses</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> opts </span><span class="token" style="color: rgb(97, 175, 239);">\\</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    threshold </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Keyword</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:threshold</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.3</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    keep_top </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Keyword</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:keep_top</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">3</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>    
</span><span>    scored_senses
</span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">sort_by</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>_sense</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> score</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> score </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:desc</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>_sense</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> score</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> score </span><span class="token" style="color: rgb(97, 175, 239);">&gt;=</span><span> threshold </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">take</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>keep_top</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span></span></code></pre></div></div>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">Common Issues &amp; Solutions</h2>
<h3 class="text-lg font-bold text-text-100 mt-1 -mb-1.5">Problem 1: <strong>All senses scoring too similarly</strong></h3>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Bad: Every sense gets ~0.5 score</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Solution: Increase contrast with competitive inhibition</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">apply_lateral_inhibition</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scored_senses</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  max_score </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> scored_senses </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(97, 175, 239);">elem</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">max</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scored_senses</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>sense</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> score</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Winner takes more, losers lose more</span><span>
</span></span><span><span>    adjusted </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:math</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">pow</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>score </span><span class="token" style="color: rgb(97, 175, 239);">/</span><span> max_score</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">2</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> max_score
</span></span><span><span>    </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>sense</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> adjusted</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span></span></code></pre></div></div>
<h3 class="text-lg font-bold text-text-100 mt-1 -mb-1.5">Problem 2: <strong>MWEs not being detected properly</strong></h3>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># For MWEs, you need to check n-gram patterns BEFORE single-word scoring</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">process_tokens</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Step 1: Try to find MWEs first</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>mwes</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> remaining_tokens</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">extract_mwes</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Step 2: Score remaining single tokens</span><span>
</span></span><span><span>  scored_singles </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">score_single_tokens</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>remaining_tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Step 3: Merge results</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">merge_mwes_and_tokens</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>mwes</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> scored_singles</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">extract_mwes</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Look for 2-grams, 3-grams, etc.</span><span>
</span></span><span><span>  potential_mwes </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> 
</span></span><span>    tokens
</span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sliding_window</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">2</span><span class="token" style="color: rgb(97, 175, 239);">..</span><span class="token" style="color: rgb(209, 154, 102);">4</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(97, 175, 239);">is_known_mwe?</span><span class="token" style="color: rgb(97, 175, 239);">/</span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Remove tokens that became part of MWEs</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ...</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span></span></code></pre></div></div>
<h3 class="text-lg font-bold text-text-100 mt-1 -mb-1.5">Problem 3: <strong>Context not influencing scores enough</strong></h3>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Build a context vector from surrounding words</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">context_overlap</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>sense</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> context</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  sense_vector </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> sense</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>semantic_vector
</span></span><span><span>  context_vector </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">build_context_vector</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>context</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>prev_tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> context</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>next_tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">cosine_similarity</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>sense_vector</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> context_vector</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">build_context_vector</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>prev</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> next</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Combine vectors of nearby words, weighted by distance</span><span>
</span></span><span><span>  prev_vectors </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> prev </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">with_index</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> i</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>    weight </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1.0</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">/</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>i </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Closer words matter more</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">scale_vector</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>vector</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> weight</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Average them</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">sum_vectors</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>prev_vectors</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span></span></code></pre></div></div>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">What to Check in Your Code</h2>
<p class="whitespace-normal break-words">Can you share or describe:</p>
<ol class="[&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal space-y-1.5 pl-7">
<li class="whitespace-normal break-words"><strong>How are you currently calculating scores</strong> for each sense/engram?</li>
<li class="whitespace-normal break-words"><strong>What's your threshold</strong> for filtering? (too high = everything filtered, too low = nothing filtered)</li>
<li class="whitespace-normal break-words"><strong>Are MWEs checked before</strong> single-word disambiguation?</li>
<li class="whitespace-normal break-words"><strong>What context features</strong> are you using? (just adjacent words, or wider window?)</li>
</ol>
<p class="whitespace-normal break-words">Based on the file structure, you have:</p>
<ul class="[&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc space-y-1.5 pl-7">
<li class="whitespace-normal break-words"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">apps/brain/lib/brain/lifg.ex</code> - main LIFG logic</li>
<li class="whitespace-normal break-words"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">apps/brain/lib/brain/lifg_stage1.ex</code> - stage 1 WSD</li>
<li class="whitespace-normal break-words"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">apps/brain/lib/brain/priming.ex</code> - priming mechanism</li>
<li class="whitespace-normal break-words"><code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">apps/core/lib/core/mwe_injector.ex</code> - MWE detection</li>
</ul>
<p class="whitespace-normal break-words">The issue is likely in how these components interact. Would you be able to share the relevant code snippets from these files, or describe what's happening when you try to filter?</p></div></div></div><div class="absolute bottom-0 right-2 pointer-events-none" style="transform: none;"><div class="rounded-lg transition min-w-max pointer-events-auto translate-x-2 opacity-0 group-hover:opacity-100"><div class="text-text-300 flex items-stretch justify-between"><div class="w-fit" data-state="closed"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95" type="button" data-testid="action-bar-copy"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div><div class="flex items-center"></div></div></div></div><div data-testid="message-warning" class="flex flex-row gap-1 rounded-md p-2 text-xs select-none -mx-1 mb-1 mt-4 outline outline-1 text-text-100 bg-bg-300/80 text-text-300 outline-bg-400/80"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="shrink-0"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></svg><p>Claude does not have the ability to run the code it generates yet.</p></div></div></div></div><div data-test-render-count="1"><div class="mb-1 mt-1"><div class="group  relative  inline-flex  gap-2  bg-bg-300  rounded-xl  pl-2.5  py-2.5  break-words  text-text-100  transition-all  max-w-[75ch]  flex-col pr-6" style="opacity: 1; transform: none;"><div class="flex flex-row gap-2"><div class="shrink-0"><div class="flex shrink-0 items-center justify-center rounded-full font-bold select-none h-7 w-7 text-[12px] bg-text-200 text-bg-100">B</div></div><div data-testid="user-message" class="font-large !font-user-message grid grid-cols-1 gap-2 py-0.5"><p class="whitespace-pre-wrap break-words">defmodule Brain.LIFG do
  @moduledoc ~S"""
  <strong>Left Inferior Frontal Gyrus (LIFG) — Competitive Sense Selection</strong></p><p class="whitespace-pre-wrap break-words">  Two entry points:</p><p class="whitespace-pre-wrap break-words">  • Legacy pure stage (kept for back-compat):
      <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">disambiguate_stage1/1,2</code> — scores candidates from slate or active_cells with optional context similarity.</p><p class="whitespace-pre-wrap break-words">  • New fast pipeline stage:
      <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Brain.LIFG.Stage1.run/2</code> — per-token disambiguation from <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">si.sense_candidates</code> with guards and tiny heuristics.</p><p class="whitespace-pre-wrap break-words">  Central config (umbrella root <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">config/config.exs</code>):</p><p class="whitespace-pre-wrap break-words">      config :brain,
        lifg_stage1_weights: %{lex_fit: 0.40, rel_prior: 0.30, activation: 0.20, intent_bias: 0.10},
        lifg_stage1_scores_mode: :all,  # or :top2 | :none
        pmtg_mode: :boost,
        pmtg_margin_threshold: 0.15,
        pmtg_window_keep: 50
  """</p><p class="whitespace-pre-wrap break-words">  ## Region GenServer for status/config/telemetry (stage stays pure)
  use Brain, region: :lifg
                                                                        # ── Optional server API (convenience) ─────────────────────────────────
  def status(server \\ <u>MODULE</u>), do: GenServer.call(server, :status)                                                                     
  def reload_config(new_opts, server \\ <u>MODULE</u>) when is_list(new_opts) or is_map(new_opts) do
    GenServer.cast(server, {:reload_config, Map.new(new_opts)})
  end</p><p class="whitespace-pre-wrap break-words">  @impl true
  def handle_cast({:reload_config, new_opts}, state) do
    {:noreply, %{state | opts: Map.merge(state.opts || %{}, Map.new(new_opts))}}
  end</p><p class="whitespace-pre-wrap break-words">  # ── Legacy pure Stage-1 API ──────────────────────────────────────────</p><p class="whitespace-pre-wrap break-words">  @doc "Pure, stateless stage-1. Appends a trace event with choices/boosts/inhibitions."
  @spec disambiguate_stage1(map()) :: map()
  def disambiguate_stage1(si) when is_map(si), do: disambiguate_stage1(si, [])</p><p class="whitespace-pre-wrap break-words">  @doc """
  Pure stage-1 with options:
    * <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:weights</code>           — override weights map (outer {lex, sim, rel, prag, act, prime})
    * <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:margin_threshold</code>  — default 0.12
    * <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:scores</code>            — :all | :top2 | :none (default :all)
    * <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:fit?</code>              — (cand, si) -&gt; boolean (default fn -&gt; true end)
    * <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:max_flips</code>         — reanalysis cap (default 1) [stubbed]
    * <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:prime</code>             — priming options (stubbed; no-op)
  """
  @spec disambiguate_stage1(map(), keyword()) :: map()
  def disambiguate_stage1(%{} = si, opts) do
    # 1) Tripwire (stub)
    tokens =
      si
      |&gt; Map.get(:tokens, [])
      |&gt; tripwire_check_and_filter(on_leak: :drop)</p><p class="whitespace-pre-wrap break-words">    ctx = Map.get(si, :context_vec, nil)
    ctxn = if is_list(ctx), do: l2(ctx), else: 0.0</p><p class="whitespace-pre-wrap break-words">    # 2) Candidate source: prefer slate ; else from active_cells
    candidates =
      case Map.get(si, :sense_candidates) do
        slate when is_map(slate) and map_size(slate) &gt; 0 -&gt;
          candidates_from_slate(si, slate, tokens)</p><p class="whitespace-pre-wrap break-words">        _ -&gt;
          candidates_from_cells(si, tokens)
      end</p><p class="whitespace-pre-wrap break-words">    # 3) Score + normalize per token group, pick winners (+ minimal reanalysis)
    weights = resolved_weights(opts)
    {choices, boosts, inhibitions} =
      disambiguate_groups(tokens, candidates, ctx, ctxn, weights, opts)</p><p class="whitespace-pre-wrap break-words">    # 4) Build trace event
    ev = %{
      stage: :lifg_stage1,
      ts_ms: System.system_time(:millisecond),
      normalize: :softmax,
      scores_mode: Keyword.get(opts, :scores, :all),
      ctx_dim: (is_list(ctx) &amp;&amp; length(ctx)) || 0,
      groups: candidates |&gt; Enum.map(&amp; &amp;1.token_index) |&gt; MapSet.new() |&gt; MapSet.size(),
      choices: choices,
      boosts: boosts,
      inhibitions: inhibitions
    }</p><p class="whitespace-pre-wrap break-words">    trace = [ev | Map.get(si, :trace, [])]
    Map.put(si, :trace, trace)
  end</p><p class="whitespace-pre-wrap break-words">  # Back-compat shim if callers pass (si, ctx, opts)
  @spec disambiguate_stage1(map(), any(), keyword()) :: map()
  def disambiguate_stage1(si, _ctx, opts), do: disambiguate_stage1(si, opts)</p><p class="whitespace-pre-wrap break-words">  # ── Candidate sources (legacy pure stage) ────────────────────────────</p><p class="whitespace-pre-wrap break-words">defp candidates_from_slate(si, slate, tokens) do
  Enum.flat_map(slate, fn {idx, list} -&gt;
    lemma = lemma_for(tokens, idx)</p><p class="whitespace-pre-wrap break-words">    Enum.map(List.wrap(list), fn c -&gt;
      feats = Map.get(c, :features, %{}) || %{}</p><p class="whitespace-pre-wrap break-words">      %{
        id: c.id,
        token_index: idx,
        lemma: lemma || "",
        pos: Map.get(feats, :pos),
        lex_fit: Map.get(feats, :lex_fit, 0.6),
        rel_prior: Map.get(c, :prior, 0.5),
        intent_bias: intent_bias_from(si, idx, feats),
        activation: Map.get(feats, :activation, 0.0),
        embedding: Map.get(feats, :embedding)
      }
    end)
  end)
end</p><p class="whitespace-pre-wrap break-words">  # NOTE: strict MWE/unigram matching to avoid cross-token leakage.
defp candidates_from_cells(si, tokens) do
  cells = Map.get(si, :active_cells, [])</p><p class="whitespace-pre-wrap break-words">  norm = fn s -&gt;
    s
    |&gt; to_b()
    |&gt; String.downcase()
    |&gt; String.replace(~r/\s+/, " ")
    |&gt; String.trim()
  end</p><p class="whitespace-pre-wrap break-words">  # Pre-normalize cell info; no token index here yet.
  cells_normed =
    Enum.map(cells, fn m -&gt;
      word  = getf(m, :word) || ""
      lemma = getf(m, :lemma) || word
      nrm   = getf(m, :norm)  || word</p><p class="whitespace-pre-wrap break-words">      %{
        id:           getf(m, :id),
        pos:          getf(m, :pos),
        lex_fit:      getf(m, :lex_fit),
        rel_prior:    getf(m, :rel_prior),
        intent_bias:  getf(m, :intent_bias),
        activation:   getf(m, :activation),
        embedding:    getf(m, :embedding),
        definition:   getf(m, :definition),
        <u>norm</u>:     norm.(nrm),
        <u>lemma</u>:    lemma
      }
    end)</p><p class="whitespace-pre-wrap break-words">  tokens
  |&gt; Enum.with_index()
  |&gt; Enum.flat_map(fn {t, idx} -&gt;
    tnorm = norm.(Map.get(t, :phrase, ""))</p><p class="whitespace-pre-wrap break-words">    cells_normed
    |&gt; Enum.filter(fn c -&gt;
      c.<u>norm</u> == tnorm or
        String.contains?(tnorm, c.<u>norm</u>) or
        String.contains?(c.<u>norm</u>, tnorm)
    end)
    |&gt; Enum.map(fn c -&gt;
      %{
        id:          c.id,
        token_index: idx,
        lemma:       c.<u>lemma</u> || "",
        pos:         c.pos,
        lex_fit:     c.lex_fit || 0.6,
        rel_prior:   c.rel_prior || 0.5,
        intent_bias: (c.intent_bias || 0.0) +
                       intent_bias_from(si, idx, %{pos: c.pos, definition: c.definition}),
        activation:  c.activation || 0.0,
        embedding:   c.embedding
      }
    end)
  end)
end</p><p class="whitespace-pre-wrap break-words">  defp lex_fit_from_phrase(phrase, lemma) do
    p = String.downcase(to_b(phrase))
    l = String.downcase(to_b(lemma))
    cond do
      p == "" or l == "" -&gt; 0.60
      p == l             -&gt; 1.00
      String.contains?(p, l) -&gt; 0.85
      String.contains?(l, p) -&gt; 0.75
      true                  -&gt; 0.60
    end
  end</p><p class="whitespace-pre-wrap break-words"># was: defp intent_bias_from(_si, _cand, _feats), do: 0.0
defp intent_bias_from(si, idx, feats_or_map) do
  tokens = Map.get(si, :tokens, [])
  cur    = Enum.at(tokens, idx) || %{}
  prev   = Enum.at(tokens, idx - 1) || %{}</p><p class="whitespace-pre-wrap break-words">  phrase = (cur[:phrase] || cur["phrase"] || "") |&gt; to_b()
  prev_w = (prev[:phrase] || prev["phrase"] || "") |&gt; to_b() |&gt; String.downcase()</p><p class="whitespace-pre-wrap break-words">  pos  =
    (getf(feats_or_map, :pos) || getf(feats_or_map, "pos") || "")
    |&gt; to_b() |&gt; String.downcase()</p><p class="whitespace-pre-wrap break-words">  defn =
    (getf(feats_or_map, :definition) || getf(feats_or_map, "definition") || "")
    |&gt; to_b() |&gt; String.downcase()</p><p class="whitespace-pre-wrap break-words">  at<em>start? = match?(%{span: {0, </em>}}, cur) or (cur[:index] || cur["index"] || 0) == 0</p><p class="whitespace-pre-wrap break-words">  bias = 0.0
  # Salutation: “hello/hi/hey …” → favor interjection at start
  bias =
    if at_start? and Regex.match?(~r/^(hello|hi|hey)\b/i, phrase) and String.contains?(pos, "interjection"),
      do: bias + 0.20, else: bias</p><p class="whitespace-pre-wrap break-words">  # Definitions gated by “(with "the")” → slightly penalize if not preceded by “the”
  bias =
    if String.contains?(defn, ~s|(with "the")|) and prev_w != "the",
      do: bias - 0.15, else: bias</p><p class="whitespace-pre-wrap break-words">  bias
end</p><p class="whitespace-pre-wrap break-words">  # ── Group scoring (legacy pure stage) ───────────────────────────────</p><p class="whitespace-pre-wrap break-words">defp disambiguate_groups(tokens, candidates, ctx, ctxn, weights, opts) do
  groups = Enum.group_by(candidates, &amp; &amp;1.token_index)</p><p class="whitespace-pre-wrap break-words">  scores_mode      = Keyword.get(opts, :scores, :all)
  margin_threshold = Keyword.get(opts, :margin_threshold, 0.12)
  fit?             = Keyword.get(opts, :fit?, fn _cand, _si -&gt; true end)
  prime_opts       = Keyword.get(opts, :prime, [])</p><p class="whitespace-pre-wrap break-words">  {choices, losers} =
    Enum.map_reduce(groups, MapSet.new(), fn {tidx, cands0}, acc<em>losers -&gt;
      tok =
        case Enum.at(tokens, tidx) do
          %{} = t -&gt; t
          </em> -&gt; %{}
        end</p><p class="whitespace-pre-wrap break-words">      # sanitize: drop nil/id-less, de-dup by id, then apply MWE↔sense compatibility
      cands =
        cands0
        |&gt; Enum.reject(&amp;is_nil/1)
        |&gt; Enum.reject(&amp;(is_nil(&amp;1.id)))
        |&gt; Enum.uniq_by(&amp; &amp;1.id)
        |&gt; filter_candidates_for_token(tok) # &lt;- prefers MWE senses for MWEs; safe fallback inside</p><p class="whitespace-pre-wrap break-words">      {_cand_feats, normed} = score_and_normalize(cands, ctx, ctxn, weights, prime_opts)</p><p class="whitespace-pre-wrap break-words">      {best_c, best_f} = best_of_normed(normed)</p><p class="whitespace-pre-wrap break-words">      {winner_c, winner_f} =
        case best_c do
          nil -&gt; {nil, %{score_norm: 0.0, sim: 0.0, score_raw: 0.0}}
          bc  -&gt;
            if fit?.(bc, %{}) do
              {bc, best_f}
            else
              best_of_normed(Enum.drop(normed, 1))
            end
        end</p><p class="whitespace-pre-wrap break-words">      {_ru_c, ru_f} =
        case normed do
          [_only]           -&gt; {nil, %{score<em>norm: 0.0}}
          [</em>, {c2, f2} | <em>] -&gt; {c2, f2}
          </em>                 -&gt; {nil, %{score_norm: 0.0}}
        end</p><p class="whitespace-pre-wrap break-words">      margin = (winner_f[:score_norm] || 0.0) - (ru_f[:score_norm] || 0.0)</p><p class="whitespace-pre-wrap break-words">      # build alt ids from top-2 if margin below threshold
      alt_ids =
        if margin &lt; margin_threshold and length(normed) &gt; 1 do
          case Enum.sort_by(normed, fn {_c, f} -&gt; -f.score_norm end) do
            [<em>first, {c2, </em>} | <em>] -&gt; [c2.id]
            </em> -&gt; []
          end
        else
          []
        end</p><p class="whitespace-pre-wrap break-words">      if winner_c, do: priming_bump(winner_c.id, prime_opts)</p><p class="whitespace-pre-wrap break-words">      lemma = lemma_for(tokens, tidx) || (winner_c &amp;&amp; (winner_c[:lemma] || "")) || ""</p><p class="whitespace-pre-wrap break-words">      # cache sorted once for :top2 to avoid double sorts
      sorted_normed = if scores_mode == :all, do: [], else: Enum.sort_by(normed, fn {_c, f} -&gt; -f.score_norm end)</p><p class="whitespace-pre-wrap break-words">      scores =
        case scores_mode do
          :all -&gt;
            normed |&gt; Map.new(fn {c, f} -&gt; {c.id, f.score_norm} end)</p><p class="whitespace-pre-wrap break-words">          :top2 -&gt;
            case sorted_normed do
              []                       -&gt; %{}
              [{c1, f1}]               -&gt; %{c1.id =&gt; f1.score<em>norm}
              [{c1, f1}, {c2, f2} | </em>] -&gt; %{c1.id =&gt; f1.score_norm, c2.id =&gt; f2.score_norm}
            end</p><p class="whitespace-pre-wrap break-words">          _ -&gt;
            %{}
        end</p><p class="whitespace-pre-wrap break-words">      choice = %{
        token_index: tidx,
        lemma: lemma,
        chosen_id: winner_c &amp;&amp; winner_c.id,
        alt_ids: alt_ids,
        scores: scores,
        margin: margin,
        features:
          winner_c &amp;&amp; %{
            sim: winner_f.sim,
            score_raw: winner_f.score_raw,
            score_norm: winner_f.score_norm,
            pos: winner_c[:pos],
            lex_fit: winner_c[:lex_fit],
            rel_prior: winner_c[:rel_prior],
            intent_bias: winner_c[:intent_bias],
            activation: winner_c[:activation]
          } || %{}
      }</p><p class="whitespace-pre-wrap break-words">      losers_here =
        case winner_c do
          nil -&gt; MapSet.new()
          wc  -&gt; cands |&gt; Enum.filter(&amp;(&amp;1.id != wc.id)) |&gt; Enum.map(&amp; &amp;1.id) |&gt; MapSet.new()
        end</p><p class="whitespace-pre-wrap break-words">      {choice, MapSet.union(acc_losers, losers_here)}
    end)</p><p class="whitespace-pre-wrap break-words">  choices = Enum.sort_by(choices, &amp; &amp;1.token_index)</p><p class="whitespace-pre-wrap break-words">  boosts      = for ch &lt;- choices, ch.chosen_id, do: {ch.chosen_id, +0.5}
  inhibitions = Enum.map(losers, &amp;{&amp;1, -0.25})</p><p class="whitespace-pre-wrap break-words">  {choices, boosts, inhibitions}
end</p><p class="whitespace-pre-wrap break-words">  defp score_and_normalize(cands, ctx, ctxn, weights, prime_opts) do
    w_prime = Map.get(weights, :prime, 0.0) * 1.0</p><p class="whitespace-pre-wrap break-words">    cand_feats =
      Enum.map(cands, fn cand -&gt;
        sim =
          case cand.embedding do
            nil -&gt; 0.0
            vec -&gt; cosine_with_ctxnorm(vec, ctx, ctxn)
          end</p><p class="whitespace-pre-wrap break-words">        prime =
          if w_prime == 0.0, do: 0.0, else: priming_boost_for(to_string(Map.get(cand, :id, "")), prime_opts)</p><p class="whitespace-pre-wrap break-words">        score =
          weights.lex * safe_num(cand.lex_fit) +
            weights.sim * sim +
            weights.rel * safe_num(cand.rel_prior) +
            weights.prag * safe_num(cand.intent_bias) +
            weights.act * safe_num(cand.activation) +
            w_prime * prime</p><p class="whitespace-pre-wrap break-words">        {cand, %{sim: sim, score_raw: score}}
      end)</p><p class="whitespace-pre-wrap break-words">    normed_vals = normalize_scores(Enum.map(cand_feats, fn {_c, f} -&gt; f.score_raw end))</p><p class="whitespace-pre-wrap break-words">    normed =
      Enum.zip(cand_feats, normed_vals)
      |&gt; Enum.map(fn {{cand, feats}, s_norm} -&gt; {cand, Map.put(feats, :score_norm, s_norm)} end)</p><p class="whitespace-pre-wrap break-words">    {cand_feats, normed}
  end</p><p class="whitespace-pre-wrap break-words">  defp best_of_normed([]), do: {nil, %{score_norm: 0.0}}
  defp best_of_normed(list), do: Enum.max_by(list, fn {_c, f} -&gt; f.score_norm end, fn -&gt; hd(list) end)</p><p class="whitespace-pre-wrap break-words">  defp phrase_for(tokens, idx) do
    case Enum.at(tokens, idx) do
      %{phrase: p} when is<em>binary(p) -&gt; p
      </em> -&gt; nil
    end
  end</p><p class="whitespace-pre-wrap break-words">  defp lemma_for(tokens, idx), do: phrase_for(tokens, idx)</p><p class="whitespace-pre-wrap break-words">  # ── Tripwire/Reanalysis/Priming — stubs ─────────────────────────────
  defp tripwire_check_and_filter(tokens, _opts), do: tokens
  defp priming_bump(_id, _opts), do: :ok
  defp priming_boost_for(_id, _opts), do: 0.0</p><p class="whitespace-pre-wrap break-words">  # ── Math &amp; utils (legacy pure) ──────────────────────────────────────</p><p class="whitespace-pre-wrap break-words">  @abs_eps 1.0e-15
  @rel_eps 1.0e-12</p><p class="whitespace-pre-wrap break-words">  defp zeroish?(x, scale) when is_float(x) do
    ax = abs(x)
    ax &lt;= @abs_eps or ax &lt;= @rel_eps * max(1.0, abs(scale))
  end</p><p class="whitespace-pre-wrap break-words">  @doc "Cosine similarity; 0.0 on nil/zero-norm."
  @spec cosine([number()] | nil, [number()] | nil) :: float()
  def cosine(nil, <em>), do: 0.0
  def cosine(</em>, nil), do: 0.0
  def cosine(a, b) when is_list(a) and is_list(b) do
    num = dot(a, b)
    den = l2(a) * l2(b)
    if zeroish?(den, den), do: 0.0, else: num / den
  end</p><p class="whitespace-pre-wrap break-words">  @spec normalize_scores([number()]) :: [float()]
  def normalize_scores(scores) do
    m = Enum.max([0.0 | scores])
    exps = Enum.map(scores, fn s -&gt; :math.exp(s - m) end)
    z = Enum.sum(exps)
    if zeroish?(z, z), do: List.duplicate(0.0, length(scores)), else: Enum.map(exps, &amp;(&amp;1 / z))
  end</p><p class="whitespace-pre-wrap break-words">  defp cosine_with_ctxnorm(vec, ctx, ctxn) do
    cond do
      is_nil(vec) or is_nil(ctx) -&gt; 0.0
      zeroish?(ctxn, ctxn) -&gt; 0.0
      true -&gt;
        na = l2(vec)
        den = na * ctxn
        if zeroish?(den, den), do: 0.0, else: dot(vec, ctx) / den
    end
  end</p><p class="whitespace-pre-wrap break-words">  defp dot(a, b), do: Enum.zip(a, b) |&gt; Enum.reduce(0.0, fn {x, y}, acc -&gt; acc + x * y end)
  defp l2(v), do: v |&gt; Enum.reduce(0.0, fn x, acc -&gt; acc + x * x end) |&gt; :math.sqrt()
  defp safe_num(nil), do: 0.0
  defp safe_num(x) when is_number(x), do: x * 1.0
  defp getf(m, k) when is_atom(k), do: Map.get(m, k) || Map.get(m, Atom.to_string(k))
  defp getf(m, k) when is_binary(k), do: Map.get(m, k)
  defp to_b(nil), do: ""
  defp to_b(v) when is_binary(v), do: v
  defp to_b(v), do: Kernel.to_string(v)</p><p class="whitespace-pre-wrap break-words">  # --- Confidence helpers (pure) ---
  @doc "Return p(top1) from a LIFG choice (max over normalized scores)."
  def top1_prob(choice) do
    choice |&gt; Map.get(:scores, %{}) |&gt; Map.values() |&gt; Enum.max(fn -&gt; 0.0 end)
  end</p><p class="whitespace-pre-wrap break-words">  @doc """
  Low-confidence predicate used by pMTG gate.
  Defaults: tau_confident=0.20, p_min=0.65. Returns true when pMTG should fire.
  """
  def low_confidence?(choice, opts \\ []) do
    tau   = Keyword.get(opts, :tau_confident, 0.20)
    p_min = Keyword.get(opts, :p_min, 0.65)
    m     = Map.get(choice, :margin, 0.0)
    p1    = top1_prob(choice)
    alts? = (choice[:alt_ids] || []) != []
    (m &lt; tau) or (p1 &lt; p_min) or alts?
  end
# near other privates
defp sense_lemma(c) do
  (Map.get(c, :lemma) ||
     get_in(c, [:features, :lemma]) ||
     get_in(c, ["features", "lemma"]) ||
     Map.get(c, :word))
  |&gt; case do
    nil -&gt; nil
    ""  -&gt; nil
    v   -&gt; to_string(v)
  end
end</p><p class="whitespace-pre-wrap break-words">defp filter_candidates_for_token(list, tok) when is_list(list) do
  # MWE token if n&gt;1 or explicit :mw flag
  mwe? = (Map.get(tok, :n, 1) &gt; 1) or (Map.get(tok, :mw) in [true, "true"])</p><p class="whitespace-pre-wrap break-words">  have_lemma? = Enum.any?(list, &amp;(!is_nil(sense_lemma(&amp;1))))</p><p class="whitespace-pre-wrap break-words">  kept =
    Enum.filter(list, fn c -&gt;
      case sense_lemma(c) do
        nil     -&gt; true            # no lemma info? keep to be safe
        lemma   -&gt;
          has_space = String.contains?(lemma, " ")
          if mwe?, do: has_space, else: not has_space
      end
    end)</p><p class="whitespace-pre-wrap break-words">  # safe fallback: if the filter nuked everything but we had lemmas, keep original list
  if have_lemma? and kept == [], do: list, else: kept
end</p><p class="whitespace-pre-wrap break-words">defp filter_candidates_for_token(list, _tok), do: list</p><p class="whitespace-pre-wrap break-words">  ##===================== HYGIENE (optional helper) =====================
  defmodule <u>MODULE</u>.Hygiene do
    @moduledoc """
    Post-Stage-1 hygiene pass:
      • Sanitizes score maps (drops non-numeric/NaN)
      • Computes softmax probabilities as <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:probs</code>
      • Adds <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:p_top1</code>
      • Dedups <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:alt_ids</code>
      • Flags <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:needs_rerun</code> (by margin/p_top1/alt_ids)
      • Emits telemetry: [:brain, :hygiene, :wipe]
    """</p><p class="whitespace-pre-wrap break-words">    @type choice :: map()</p><p class="whitespace-pre-wrap break-words">    @spec run(map(), [choice()], keyword()) ::
            {:ok, %{si: map(), choices: [choice()], audit: map()}}
    def run(si, choices, opts \\ []) when is_list(choices) do
      min_margin =
        Keyword.get(opts, :min_margin, Application.get_env(:brain, :lifg_min_margin, 0.12))</p><p class="whitespace-pre-wrap break-words">      p_min =
        Keyword.get(opts, :p_min, Application.get_env(:brain, :lifg_min_p_top1, 0.65))</p><p class="whitespace-pre-wrap break-words">      event = Keyword.get(opts, :event, [:brain, :hygiene, :wipe])
      now_ms = System.system_time(:millisecond)</p><p class="whitespace-pre-wrap break-words">      {cleaned, stats} =
        Enum.map_reduce(choices, %{sanitized: 0, needs_rerun: 0}, fn ch, acc -&gt;
          {probs, dropped} = normalize_scores_map(Map.get(ch, :scores, %{}))
          p1 = max_prob(probs)</p><p class="whitespace-pre-wrap break-words">          alt_ids2 =
            (ch[:alt_ids] || [])
            |&gt; Enum.reject(&amp;(&amp;1 == ch[:chosen_id]))
            |&gt; Enum.uniq()</p><p class="whitespace-pre-wrap break-words">          needs? =
            (ch[:margin] || 0.0) &lt; min_margin or
              p1 &lt; p_min or
              alt_ids2 != []</p><p class="whitespace-pre-wrap break-words">          ch2 =
            ch
            |&gt; Map.put(:alt_ids, alt_ids2)
            |&gt; Map.put(:probs, probs)
            |&gt; Map.put(:p_top1, p1)
            |&gt; Map.put(:needs_rerun, needs?)</p><p class="whitespace-pre-wrap break-words">          acc2 =
            acc
            |&gt; Map.update!(:sanitized, &amp;(&amp;1 + dropped))
            |&gt; Map.update!(:needs_rerun, &amp;(&amp;1 + if(needs?, do: 1, else: 0)))</p><p class="whitespace-pre-wrap break-words">          {ch2, acc2}
        end)</p><p class="whitespace-pre-wrap break-words">      meas = %{total: length(choices), sanitized: stats.sanitized, needs_rerun: stats.needs_rerun, ts_ms: now_ms}
      emit(event, meas, %{min_margin: min_margin, p_min: p_min})
      {:ok, %{si: si, choices: cleaned, audit: meas}}
    end</p><p class="whitespace-pre-wrap break-words">    defp normalize_scores_map(map) when is_map(map) do
      pairs =
        map
        |&gt; Enum.filter(fn {_k, v} -&gt; is_number(v) and v == v end) # (v==v) filters NaN</p><p class="whitespace-pre-wrap break-words">      dropped = map<em>size(map) - length(pairs)
      vals = Enum.map(pairs, fn {</em>, v} -&gt; v end)</p><p class="whitespace-pre-wrap break-words">      probs =
        case vals do
          [] -&gt; %{}
          _ -&gt;
            m = Enum.max([0.0 | vals])
            exps = Enum.map(vals, fn s -&gt; :math.exp(s - m) end)
            z = Enum.sum(exps)</p><p class="whitespace-pre-wrap break-words">            if z == 0.0 do
              Map.new(pairs, fn {k, <em>} -&gt; {k, 0.0} end)
            else
              pairs |&gt; Enum.zip(exps) |&gt; Map.new(fn {{k, </em>}, e} -&gt; {k, e / z} end)
            end
        end</p><p class="whitespace-pre-wrap break-words">      {probs, dropped}
    end</p><p class="whitespace-pre-wrap break-words">    defp max_prob(%{} = probs), do: probs |&gt; Map.values() |&gt; Enum.max(fn -&gt; 0.0 end)</p><p class="whitespace-pre-wrap break-words">    defp emit(ev, meas, meta) do
      if Code.ensure_loaded?(:telemetry) and function_exported?(:telemetry, :execute, 3) do
        :telemetry.execute(ev, meas, meta)
      else
        :ok
      end
    end
  end</p><p class="whitespace-pre-wrap break-words">  ##===================== TOKEN GUARD (compat) ==========================
  defmodule <u>MODULE</u>.Guard do
    @moduledoc """
    Compatibility shim for Core.LIFG.Input.
    Ensures maps, index, and optional span-sort.
    """
    @spec sanitize(list()) :: list()
    def sanitize(tokens) when is_list(tokens) do
      tokens
      |&gt; Enum.map(&amp;mapify/1)
      |&gt; ensure_indexed()
      |&gt; sort_by_span_if_present()
    end</p><p class="whitespace-pre-wrap break-words">    defp mapify(t) when is<em>map(t), do: t
    defp mapify(%</em>{} = s), do: Map.from_struct(s)
    defp mapify(other), do: %{phrase: to_string(other)}</p><p class="whitespace-pre-wrap break-words">    defp ensure_indexed(list) do
      list
      |&gt; Enum.with_index()
      |&gt; Enum.map(fn {t, i} -&gt;
        Map.put_new(t, :index, Map.get(t, :index) || Map.get(t, "index") || i)
      end)
    end</p><p class="whitespace-pre-wrap break-words">    defp sort_by_span_if_present(list) do
      if Enum.all?(list, &amp;valid_span?/1), do: Enum.sort_by(list, &amp;elem(Map.fetch!(&amp;1, :span), 0)), else: list
    end</p><p class="whitespace-pre-wrap break-words">    defp valid_span?(%{span: {s, l}}) when is_integer(s) and is_integer(l) and l &gt; 0, do: true
    defp valid<em>span?(</em>), do: false
  end</p><p class="whitespace-pre-wrap break-words">  ##================== TOKEN BOUNDARY GUARD (compat) ====================
  defmodule <u>MODULE</u>.BoundaryGuard do
    @moduledoc """
    Minimal boundary + char-gram guard (keeps MWEs).
    """
    @type token :: map()
    @spec sanitize([token()]) :: [token()]
    def sanitize(tokens), do: sanitize(tokens, nil)</p><p class="whitespace-pre-wrap break-words">    @spec sanitize([token()], String.t() | nil) :: [token()]
    def sanitize(tokens, sentence) when is_list(tokens) do
      tokens
      |&gt; Enum.map(&amp;mapify/1)
      |&gt; Enum.reject(&amp;chargram?/1)
      |&gt; Enum.filter(fn t -&gt;
        mw? = truthy(Map.get(t, :mw) || Map.get(t, "mw"))
        case {Map.get(t, :span) || Map.get(t, "span"), sentence} do
          {{s, l}, snt} when is_integer(s) and is_integer(l) and l &gt; 0 and is_binary(snt) -&gt;
            boundary<em>aligned?(snt, s, l) or mw?
          </em> -&gt; true
        end
      end)
      |&gt; sort_by_span_if_present()
    end</p><p class="whitespace-pre-wrap break-words">    defp mapify(%_{} = s), do: Map.from_struct(s)
    defp mapify(%{} = m), do: m
    defp mapify(other), do: %{phrase: to_string(other)}</p><p class="whitespace-pre-wrap break-words">    defp chargram?(t),
      do:
        (Map.get(t, :chargram) in [true, "true"]) or
        (Map.get(t, :kind) in [:chargram, "chargram"]) or
        (Map.get(t, :source) in [:chargram, "chargram"])</p><p class="whitespace-pre-wrap break-words">    defp sort_by_span_if_present(list) do
      if Enum.all?(list, &amp;valid_span?/1), do: Enum.sort_by(list, &amp;elem(Map.fetch!(&amp;1, :span), 0)), else: list
    end</p><p class="whitespace-pre-wrap break-words">    defp valid_span?(%{span: {s, l}}) when is_integer(s) and is_integer(l) and l &gt; 0, do: true
    defp valid<em>span?(</em>), do: false</p><p class="whitespace-pre-wrap break-words">    defp boundary_aligned?(snt, s, l) do
      left = s - 1
      right = s + l
      left_ok = s == 0 or not word_char?(String.slice(snt, left, 1))
      right_ok = right &gt;= String.length(snt) or not word_char?(String.slice(snt, right, 1))
      left_ok and right_ok
    end</p><p class="whitespace-pre-wrap break-words">    defp word_char?(nil), do: false
    defp word_char?(""), do: false
    defp word<em>char?(ch), do: Regex.match?(~r/^[\p{L}\p{N}]$/u, ch)
    defp truthy(true), do: true
    defp truthy("true"), do: true
    defp truthy(</em>), do: false
  end</p><p class="whitespace-pre-wrap break-words">  ##========================= STAGE 1 (new) ============================
  defmodule <u>MODULE</u>.Stage1 do
    @moduledoc """
    Stage 1 — fast per-token disambiguation from <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">si.sense_candidates</code>.</p><p class="whitespace-pre-wrap break-words">    Options:
      :weights          — %{lex_fit, rel_prior, activation, intent_bias}
      :scores           — :all | :top2 | :none (default from <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:lifg_stage1_scores_mode</code>)
      :chargram_event   — telemetry (default [:brain, :lifg, :chargram_violation])
      :boundary_event   — telemetry (default [:brain, :lifg, :boundary_drop])
      :margin_threshold — default 0.15 (for alt_id emission)
    """</p><p class="whitespace-pre-wrap break-words">    @small_k_cutoff 4</p><p class="whitespace-pre-wrap break-words">    @type si :: map()
    @type choice :: %{
            required(:token_index) =&gt; non_neg_integer(),
            required(:chosen_id)   =&gt; String.t(),
            required(:alt_ids)     =&gt; [String.t()],
            required(:margin)      =&gt; float(),
            optional(:scores)      =&gt; map()
          }</p><p class="whitespace-pre-wrap break-words">    @spec run(si(), keyword()) :: {:ok, %{si: si(), choices: [choice()], audit: map()}}
    def run(si, opts \\ []) when is_map(si) and is_list(opts) do
      t0 = System.monotonic_time()</p><p class="whitespace-pre-wrap break-words">      tokens = Map.get(si, :tokens, [])
      slate  = Map.get(si, :sense_candidates, Map.get(si, :candidates_by_token, %{}))</p><p class="whitespace-pre-wrap break-words">      {kept_tokens, dropped} = guard_tokens(tokens, si, opts)</p><p class="whitespace-pre-wrap break-words">      scores_mode =
        Keyword.get(opts, :scores, Application.get_env(:brain, :lifg_stage1_scores_mode, :all))</p><p class="whitespace-pre-wrap break-words">      margin_threshold = Keyword.get(opts, :margin_threshold, 0.15)</p><p class="whitespace-pre-wrap break-words">      choices =
        kept_tokens
        |&gt; Enum.map(fn tok -&gt;
          disambiguate_token(
            tok,
            Map.get(slate, tok.index, []),
            scores: scores_mode,
            margin_threshold: margin_threshold,
            weights: Keyword.get(opts, :weights, %{})
          )
        end)
        |&gt; Enum.reject(&amp;is_nil/1)</p><p class="whitespace-pre-wrap break-words">      timing_ms =
        System.convert_time_unit(System.monotonic_time() - t0, :native, :millisecond)</p><p class="whitespace-pre-wrap break-words">      audit = %{
        stage: :lifg_stage1,
        token_count: length(tokens),
        kept_tokens: length(kept_tokens),
        dropped_tokens: length(dropped),
        timing_ms: timing_ms
      }</p><p class="whitespace-pre-wrap break-words">      {:ok, %{si: si, choices: choices, audit: audit}}
    end</p><p class="whitespace-pre-wrap break-words">    # Back-compat shim (si, ctx, opts)
    @spec run(si(), map(), keyword()) :: {:ok, %{si: si(), choices: [choice()], audit: map()}}
    def run(si, _ctx, opts), do: run(si, opts)</p><p class="whitespace-pre-wrap break-words">    # ── Guards ─────────────────────────────────────────────────────────</p><p class="whitespace-pre-wrap break-words">    defp guard_tokens(tokens, si, opts) do
      char_ev = Keyword.get(opts, :chargram_event, [:brain, :lifg, :chargram_violation])
      bnd_ev  = Keyword.get(opts, :boundary_event,  [:brain, :lifg, :boundary_drop])</p><p class="whitespace-pre-wrap break-words">      Enum.reduce(tokens, {[], []}, fn tok, {kept, dropped} -&gt;
        cond do
          is_chargram?(tok) -&gt;
            emit(char_ev, %{token_index: tok[:index], phrase: tok[:phrase]}, %{})
            {kept, [tok | dropped]}</p><p class="whitespace-pre-wrap break-words">          not boundary_ok?(tok, si) -&gt;
            emit(bnd_ev, %{token_index: tok[:index], phrase: tok[:phrase]}, %{})
            {kept, [tok | dropped]}</p><p class="whitespace-pre-wrap break-words">          true -&gt;
            {[tok | kept], dropped}
        end
      end)
      |&gt; (fn {k, d} -&gt; {Enum.reverse(k), Enum.reverse(d)} end).()
    end</p><p class="whitespace-pre-wrap break-words">    defp is_chargram?(tok) do
      (Map.get(tok, :source) in [:chargram, "chargram"]) or
        (Map.get(tok, :kind)   in [:chargram, "chargram"]) or
        (Map.get(tok, :chargram) in [true, "true"])
    end</p><p class="whitespace-pre-wrap break-words">    defp boundary_ok?(tok, si) do
      # MWEs bypass strictness
      mw? = Map.get(tok, :mw) || Map.get(tok, "mw") || false
      if mw?, do: true, else: do_boundary_check(tok, si)
    end</p><p class="whitespace-pre-wrap break-words">    defp do_boundary_check(tok, si) do
      sent = Map.get(si, :sentence)
      span = Map.get(tok, :span) || Map.get(tok, "span")</p><p class="whitespace-pre-wrap break-words">      cond do
        not is_binary(sent) -&gt; true
        not (is_tuple(span) and tuple_size(span) == 2) -&gt; true
        true -&gt;
          {start, len} = span
          start = as_int(start, 0)
          len   = as_int(len, 0)
          stop  = start + len
          s_len = byte_size(sent)</p><p class="whitespace-pre-wrap break-words">          left_ok?  = start &lt;= 0 or not letter?(String.at(sent, start - 1))
          right_ok? = stop &gt;= s_len or not letter?(String.at(sent, stop))</p><p class="whitespace-pre-wrap break-words">          left_ok? and right_ok?
      end
    end</p><p class="whitespace-pre-wrap break-words">    defp letter?(nil), do: false
    defp letter?(&lt;&lt;c::utf8&gt;&gt;), do: unicode_letter?(c)
    defp unicode_letter?(cp),
      do: (cp &gt;= ?A and cp &lt;= ?Z) or (cp &gt;= ?a and cp &lt;= ?z) or (cp &gt;= ?À and cp &lt;= 0x024F)</p><p class="whitespace-pre-wrap break-words">    # ── Disambiguation per token (hybrid) ──────────────────────────────</p><p class="whitespace-pre-wrap break-words">    defp disambiguate_token(%{} = tok, cand_list, opts) when is_list(cand_list) do
      idx         = tok.index
      thr         = Keyword.get(opts, :margin_threshold, 0.15)
      scores_mode = Keyword.get(opts, :scores, :all)
      w           = weights(opts)</p><p class="whitespace-pre-wrap break-words">      # sanitize input candidates (nil/id-less/dupes) and apply tiny heuristics
      cand_list =
        cand_list
        |&gt; Enum.reject(&amp;is_nil/1)
        |&gt; Enum.reject(&amp;(is_nil(&amp;1.id)))
        |&gt; Enum.uniq_by(&amp; &amp;1.id)
        |&gt; prefer_salutation_interjection(tok)  # &lt;- list, tok (pipe-friendly)
        |&gt; prefer_pronoun_for_I(tok)
        |&gt; compat_filter_for_token(tok)</p><p class="whitespace-pre-wrap break-words">      score_cand = fn c -&gt;
        f = Map.get(c, :features, %{})
        %{
          id: c.id,
          score:
            w.lex_fit     * as_float(f[:lex_fit]     || f["lex_fit"]) +
            w.rel_prior   * as_float(f[:rel_prior]   || f["rel_prior"]) +
            w.activation  * as_float(f[:activation]  || f["activation"]) +
            w.intent_bias * as_float(f[:intent_bias] || f["intent_bias"])
        }
      end</p><p class="whitespace-pre-wrap break-words">      if length(cand_list) &lt;= @small_k_cutoff do
        scored =
          cand_list
          |&gt; Enum.map(score_cand)
          |&gt; Enum.sort_by(&amp;(-&amp;1.score))</p><p class="whitespace-pre-wrap break-words">        case scored do
          [] -&gt;
            nil</p><p class="whitespace-pre-wrap break-words">          [%{id: top_id, score: top_s} | rest] -&gt;
            rest_unique =
              rest
              |&gt; Enum.reject(&amp;(&amp;1.id == top_id))
              |&gt; Enum.uniq_by(&amp; &amp;1.id)</p><p class="whitespace-pre-wrap break-words">            second_s =
              case rest<em>unique do
                [%{score: s2} | </em>] -&gt; s2
                _ -&gt; 0.0
              end</p><p class="whitespace-pre-wrap break-words">            alt_ids =
              if max(top_s - second_s, 0.0) &lt; thr and rest_unique != [] do
                [hd(rest_unique).id]
              else
                []
              end</p><p class="whitespace-pre-wrap break-words">            %{
              token_index: idx,
              chosen_id: top_id,
              alt_ids: alt_ids,
              margin: max(top_s - second_s, 0.0),
              scores: build_scores_map(scored, scores_mode)
            }
        end
      else
        {best, second, scored_rev} =
          Enum.reduce(cand_list, {nil, nil, []}, fn c, {b1, b2, acc} -&gt;
            cur = score_cand.(c)
            scr = cur.score
            {nb1, nb2} =
              cond do
                b1 == nil or scr &gt; b1.score -&gt; {cur, b1}
                b2 == nil or scr &gt; b2.score -&gt; {b1, cur}
                true -&gt; {b1, b2}
              end
            {nb1, nb2, [cur | acc]}
          end)</p><p class="whitespace-pre-wrap break-words">        case best do
          nil -&gt;
            nil</p><p class="whitespace-pre-wrap break-words">          %{id: top_id, score: top_s} -&gt;
            second_s = (second &amp;&amp; second.score) || 0.0
            scored   = :lists.reverse(scored_rev)</p><p class="whitespace-pre-wrap break-words">            alt_ids =
              if max(top_s - second_s, 0.0) &lt; thr and second do
                [second.id]
              else
                []
              end</p><p class="whitespace-pre-wrap break-words">            %{
              token_index: idx,
              chosen_id: top_id,
              alt_ids: alt_ids,
              margin: max(top_s - second_s, 0.0),
              scores: build_scores_map(scored, scores_mode)
            }
        end
      end
    end</p><p class="whitespace-pre-wrap break-words">    # Prefer interjection “greeting” senses for salutations (“hello/hi/hey”), esp. at start
    defp prefer_salutation_interjection(list, tok) do
      phrase = (tok[:phrase] || "") |&gt; to_string()
      at<em>start =
        case tok[:span] do
          {0, </em>} -&gt; true
          _ -&gt; (tok[:index] || 0) == 0
        end</p><p class="whitespace-pre-wrap break-words">      sal? = Regex.match?(~r/^(hello|hi|hey)\b/i, phrase) or at_start</p><p class="whitespace-pre-wrap break-words">      if sal? do
        greet =
          Enum.filter(list, fn c -&gt;
            pos =
              (c[:pos] || get_in(c, [:features, :pos]) || "")
              |&gt; to_string() |&gt; String.downcase()</p><p class="whitespace-pre-wrap break-words">            defn =
              (c[:definition] || get_in(c, [:features, :definition]) || "")
              |&gt; to_string() |&gt; String.downcase()</p><p class="whitespace-pre-wrap break-words">            syns =
              (c[:synonyms] || get_in(c, [:features, :synonyms]) || [])
              |&gt; Enum.map(&amp;String.downcase/1)</p><p class="whitespace-pre-wrap break-words">            String.contains?(pos, "interjection") and
              (String.contains?(defn, "greet") or Enum.any?(syns, &amp;(&amp;1 == "greeting")))
          end)</p><p class="whitespace-pre-wrap break-words">        if greet != [], do: greet, else: list
      else
        list
      end
    end</p><p class="whitespace-pre-wrap break-words">    # Pronoun preference for the token exactly "I"
    defp prefer_pronoun_for_I(list, tok) when is_list(list) do
      phrase = (Map.get(tok, :phrase) || Map.get(tok, "phrase") || "") |&gt; to_string()
      if phrase == "I" do
        pronounish = Enum.filter(list, fn c -&gt; pos_pronoun?(c) or id_pronounish?(c) end)
        if pronounish == [], do: list, else: pronounish
      else
        list
      end
    end</p><p class="whitespace-pre-wrap break-words">    defp pos_pronoun?(c) do
      p =
        Map.get(c, :pos) ||
          get_in(c, [:features, :pos]) ||
          get_in(c, ["features", "pos"])</p><p class="whitespace-pre-wrap break-words">      cond do
        is_nil(p) -&gt; false
        is_atom(p) -&gt; p |&gt; Atom.to_string() |&gt; String.downcase() |&gt; String.contains?("pron")
        is_binary(p) -&gt; p |&gt; String.downcase() |&gt; String.contains?("pron")
        true -&gt; false
      end
    end</p><p class="whitespace-pre-wrap break-words">    defp id_pronounish?(c) do
      id = Map.get(c, :id) |&gt; to_string()
      String.contains?(String.downcase(id), "pron")
    end</p><p class="whitespace-pre-wrap break-words">    # Prefer MWE senses for MWE tokens (and vice versa), with safe fallback
    defp compat_filter_for_token(list, %{n: n} = tok) when is_list(list) and is_integer(n) do
      mwe? = n &gt; 1 or (Map.get(tok, :mw) || Map.get(tok, "mw") || false)
      have_lemma? = Enum.any?(list, &amp;has_readable_lemma?/1)</p><p class="whitespace-pre-wrap break-words">      kept =
        Enum.filter(list, fn c -&gt;
          case sense_lemma(c) do
            nil -&gt; true  # if unknown, keep
            lemma -&gt;
              has_space = String.contains?(lemma, " ")
              if mwe?, do: has_space, else: not has_space
          end
        end)</p><p class="whitespace-pre-wrap break-words">      if have_lemma? and kept == [], do: list, else: kept
    end</p><p class="whitespace-pre-wrap break-words">    defp compat_filter_for_token(list, _tok), do: list</p><p class="whitespace-pre-wrap break-words">    defp has_readable_lemma?(c), do: not is_nil(sense_lemma(c))</p><p class="whitespace-pre-wrap break-words">    defp sense_lemma(c) do
      (Map.get(c, :lemma) ||
         get_in(c, [:features, :lemma]) ||
         get_in(c, ["features", "lemma"]) ||
         Map.get(c, :word))
      |&gt; case do
        nil -&gt; nil
        ""  -&gt; nil
        v   -&gt; to_string(v)
      end
    end</p><p class="whitespace-pre-wrap break-words">    # Build score map per requested mode; default :all for back-compat
    defp build_scores_map(scored, :all),
      do: Map.new(scored, fn %{id: i, score: s} -&gt; {i, s} end)</p><p class="whitespace-pre-wrap break-words">    defp build_scores<em>map(scored, :top2) do
      case scored do
        [] -&gt; %{}
        [a] -&gt; %{a.id =&gt; a.score}
        [a, b | </em>] -&gt; %{a.id =&gt; a.score, b.id =&gt; b.score}
      end
    end</p><p class="whitespace-pre-wrap break-words">    defp build_scores_map(<em>scored, </em>), do: %{}</p><p class="whitespace-pre-wrap break-words">    # ── Utils ──────────────────────────────────────────────────────────</p><p class="whitespace-pre-wrap break-words">    defp weights(opts) do
      env = Application.get_env(:brain, :lifg_stage1_weights, %{})
      base = %{lex_fit: 0.4, rel_prior: 0.3, activation: 0.2, intent_bias: 0.1}</p><p class="whitespace-pre-wrap break-words">      base
      |&gt; Map.merge(env || %{})
      |&gt; Map.merge(Map.new(Keyword.get(opts, :weights, [])))
    end</p><p class="whitespace-pre-wrap break-words">    defp emit(ev, meas, meta) do
      if Code.ensure_loaded?(:telemetry) and function_exported?(:telemetry, :execute, 3) do
        :telemetry.execute(ev, meas, meta)
      else
        :ok
      end
    end</p><p class="whitespace-pre-wrap break-words">    defp as_int(nil, d), do: d
    defp as_int(i, _d) when is_integer(i), do: i
    defp as_int(b, d) when is<em>binary(b) do
      case Integer.parse(b) do
        {n, </em>} -&gt; n
        _ -&gt; d
      end
    end</p><p class="whitespace-pre-wrap break-words">    defp as_float(nil), do: 0.0
    defp as_float(n) when is_number(n), do: n * 1.0
    defp as_float(b) when is<em>binary(b) do
      case Float.parse(b) do
        {f, </em>} -&gt; f
        _ -&gt; 0.0
      end
    end
  end</p><p class="whitespace-pre-wrap break-words">  # ── Full pipeline wrapper (optional) ─────────────────────────────────</p><p class="whitespace-pre-wrap break-words">  @doc """
  Full LIFG pipeline:
    1) ATL finalize → slate (if available)
    2) Attach <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">si.sense_candidates</code>
    3) Stage-1 disambiguation
    4) pMTG consult (sync rerun or async boost/none)</p><p class="whitespace-pre-wrap break-words">  Returns <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">{:ok, %{si, choices, slate}}</code>.
  """
  @spec run(map(), keyword()) :: {:ok, %{si: map(), choices: list(), slate: map()}}
  def run(si, opts \\ []) when is_map(si) do
    # 1) ATL finalize (optional)
    {si, slate} =
      if Code.ensure_loaded?(Brain.ATL) and function_exported?(Brain.ATL, :finalize, 2) do
        Brain.ATL.finalize(si, opts)
      else
        {si, %{}}
      end</p><p class="whitespace-pre-wrap break-words">    # 2) attach slate → sense_candidates (optional)
    si =
      if Code.ensure_loaded?(Brain.ATL) and
           function_exported?(Brain.ATL, :attach_sense_candidates, 3) do
        Brain.ATL.attach_sense_candidates(si, slate,
          top_k: Keyword.get(opts, :top_k, 3),
          margin_window: Keyword.get(opts, :margin_window, 0.05)
        )
      else
        si
      end</p><p class="whitespace-pre-wrap break-words">    # 3) Stage-1
    scores_mode = Keyword.get(opts, :scores, Application.get_env(:brain, :lifg_stage1_scores_mode, :all))
    margin_thr  = Keyword.get(opts, :margin_threshold, 0.15)</p><p class="whitespace-pre-wrap break-words">    {:ok, %{si: si, choices: choices, audit: _a}} =
      <u>MODULE</u>.Stage1.run(si,
        weights: Map.get(opts, :weights, %{
          lex_fit: 0.5, rel_prior: 0.25, activation: 0.15, intent_bias: 0.10
        }),
        scores: scores_mode,
        margin_threshold: margin_thr,
        chargram_event: [:brain, :lifg, :chargram_violation],
        boundary_event: [:brain, :lifg, :boundary_drop]
      )</p><p class="whitespace-pre-wrap break-words">    # 4) pMTG
    pmtg_mode = Keyword.get(opts, :pmtg_mode, Application.get_env(:brain, :pmtg_mode, :boost))</p><p class="whitespace-pre-wrap break-words">    final_choices =
      case {pmtg_mode, Keyword.get(opts, :pmtg_apply?, true)} do
        {:rerun, true} -&gt;
          {:ok, %{choices: merged}} =
            Brain.PMTG.consult_sync(
              choices,
              si.tokens,
              already_needy: false,
              margin_threshold: margin_thr,
              limit: Keyword.get(opts, :limit, 5),
              mode: :rerun,
              rerun_only_if_hits: Keyword.get(opts, :rerun_only_if_hits, true),
              rerun_weights_bump: Keyword.get(opts, :rerun_weights_bump, %{lex_fit: 0.05, rel_prior: 0.05})
            )</p><p class="whitespace-pre-wrap break-words">          merged</p><p class="whitespace-pre-wrap break-words">        _other -&gt;
          Brain.PMTG.consult(
            choices,
            si.tokens,
            margin_threshold: margin_thr,
            limit: Keyword.get(opts, :limit, 5),
            mode: pmtg_mode
          )</p><p class="whitespace-pre-wrap break-words">          choices
      end</p><p class="whitespace-pre-wrap break-words">    {:ok, %{si: si, choices: final_choices, slate: slate}}
  end</p><p class="whitespace-pre-wrap break-words">  # ── weights (outer) ─────────────────────────────────────────────────</p><p class="whitespace-pre-wrap break-words">  defp to_map(nil), do: %{}
  defp to_map(m) when is_map(m), do: m
  defp to_map(kv) when is_list(kv), do: Map.new(kv)
  defp to<em>map(</em>), do: %{}</p><p class="whitespace-pre-wrap break-words">  @type lifg_outer_weights ::
          %{
            required(:lex) =&gt; float(),
            required(:sim) =&gt; float(),
            required(:rel) =&gt; float(),
            required(:prag) =&gt; float(),
            required(:act) =&gt; float(),
            optional(:prime) =&gt; float()
          }</p><p class="whitespace-pre-wrap break-words">  @doc "Default outer LIFG weights (lex/sim/rel/prag/act + optional :prime)."
  @spec default_weights() :: lifg_outer_weights()
  def default_weights, do: %{lex: 0.25, sim: 0.40, rel: 0.15, prag: 0.10, act: 0.10, prime: 0.0}</p><p class="whitespace-pre-wrap break-words">  # Merge order: defaults &lt;- env (lifg_weights OR mapped stage1) &lt;- opts[:weights]
  defp resolved_weights(opts) do
    outer_env = to_map(Application.get_env(:brain, :lifg_weights))</p><p class="whitespace-pre-wrap break-words">    mapped_from_stage1 =
      case to_map(Application.get_env(:brain, :lifg_stage1_weights)) do
        %{} = w1 when map_size(w1) &gt; 0 -&gt;
          %{
            lex:  Map.get(w1, :lex_fit,     default_weights().lex),
            sim:  default_weights().sim, # stage-1 has no :sim
            rel:  Map.get(w1, :rel_prior,   default_weights().rel),
            prag: Map.get(w1, :intent_bias, default_weights().prag),
            act:  Map.get(w1, :activation,  default<em>weights().act)
          }
        </em> -&gt; %{}
      end</p><p class="whitespace-pre-wrap break-words">    env_weights = if outer_env == %{}, do: mapped_from_stage1, else: outer_env
    opt_w      = to_map(Keyword.get(opts, :weights, %{}))</p><p class="whitespace-pre-wrap break-words">    default_weights()
    |&gt; Map.merge(env_weights)
    |&gt; Map.merge(opt_w)
  end
end</p></div></div></div></div></div><div data-test-render-count="1"><div style="height: auto; opacity: 1; transform: none;"><div data-is-streaming="false" class="group  relative pb-8" style="opacity: 1; transform: none;"><div class="font-claude-response  relative  leading-[1.65rem]  [&amp;_pre&gt;div]:bg-bg-000/50  [&amp;_pre&gt;div]:border-0.5  [&amp;_pre&gt;div]:border-border-400  [&amp;_.ignore-pre-bg&gt;div]:bg-transparent  [&amp;_.standard-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2  [&amp;_.standard-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8  [&amp;_.progressive-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2  [&amp;_.progressive-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8"><div><div class="grid-cols-1 grid gap-2.5 [&amp;_&gt;_*]:min-w-0 standard-markdown"><p class="whitespace-normal break-words">Looking at your LIFG code, I can see the scoring and filtering mechanism. The core issue is likely in how candidates are being evaluated and filtered. Let me break down what's happening and where problems typically occur:</p>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">Current Flow Analysis</h2>
<p class="whitespace-normal break-words">Your <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">disambiguate_groups/6</code> function:</p>
<ol class="[&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal space-y-1.5 pl-7">
<li class="whitespace-normal break-words">Groups candidates by token index</li>
<li class="whitespace-normal break-words">Scores each candidate with weighted features</li>
<li class="whitespace-normal break-words">Normalizes scores via softmax</li>
<li class="whitespace-normal break-words">Picks the best candidate</li>
<li class="whitespace-normal break-words">Determines "losers" based on margin threshold</li>
</ol>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">Common Issues I See</h2>
<h3 class="text-lg font-bold text-text-100 mt-1 -mb-1.5">1. <strong>The MWE/Engram Filter May Be Too Aggressive</strong></h3>
<p class="whitespace-normal break-words">In <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">filter_candidates_for_token/2</code>:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">filter_candidates_for_token</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tok</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  mwe? </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:n</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">or</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:mw</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">in</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(209, 154, 102);">true</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"true"</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  have_lemma? </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">any?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">!</span><span class="token" style="color: rgb(97, 175, 239);">is_nil</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">sense_lemma</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>  kept </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>    </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> c </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sense_lemma</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span>     </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">true</span><span>
</span></span><span><span>        lemma   </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>          has_space </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>lemma</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">" "</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> mwe?</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> has_space</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">not</span><span> has_space
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Safe fallback</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> have_lemma? </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> kept </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> kept
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span></span></code></pre></div></div>
<p class="whitespace-normal break-words"><strong>Problem</strong>: If your token is marked as MWE but none of your candidates have spaces in their lemmas, you get an empty list. The fallback helps, but this might be filtering out valid single-word senses.</p>
<p class="whitespace-normal break-words"><strong>Fix</strong>: Add debug logging to see what's being filtered:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">filter_candidates_for_token</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tok</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  mwe? </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:n</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">or</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:mw</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">in</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(209, 154, 102);">true</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"true"</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  have_lemma? </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">any?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">!</span><span class="token" style="color: rgb(97, 175, 239);">is_nil</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">sense_lemma</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>  kept </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>    </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> c </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sense_lemma</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">true</span><span>
</span></span><span><span>        lemma </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>          has_space </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>lemma</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">" "</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>          match </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> mwe?</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> has_space</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">not</span><span> has_space
</span></span><span>          
</span><span><span>          </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># DEBUG: uncomment to see what's happening</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># IO.inspect({:filtering, tok.phrase, lemma, mwe?: mwe?, has_space: has_space, kept: match})</span><span>
</span></span><span>          
</span><span>          match
</span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>  result </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> have_lemma? </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> kept </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> kept
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># DEBUG: see filtering results</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># if length(result) != length(list) do</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">#   IO.inspect({:filter_changed, tok.phrase, before: length(list), after: length(result)})</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># end</span><span>
</span></span><span>  
</span><span>  result
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span></span></code></pre></div></div>
<h3 class="text-lg font-bold text-text-100 mt-1 -mb-1.5">2. <strong>Margin Threshold May Be Wrong</strong></h3>
<p class="whitespace-normal break-words">Your default <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">margin_threshold: 0.12</code> means if the top two scores are closer than 0.12, you emit <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">alt_ids</code>. After softmax normalization, this might be too tight or too loose.</p>
<p class="whitespace-normal break-words"><strong>Check</strong>: What are typical margin values? Add telemetry:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># In disambiguate_groups, after calculating margin:</span><span>
</span></span><span><span></span><span class="token atom" style="color: rgb(224, 108, 117);">:telemetry</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">execute</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:brain</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:lifg</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:margin</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(209, 154, 102);">margin:</span><span> margin</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(209, 154, 102);">winner_score:</span><span> winner_f</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:score_norm</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(209, 154, 102);">runner_up_score:</span><span> ru_f</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:score_norm</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">token_index:</span><span> tidx</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span></span></code></pre></div></div>
<h3 class="text-lg font-bold text-text-100 mt-1 -mb-1.5">3. <strong>Score Normalization Might Collapse Differences</strong></h3>
<p class="whitespace-normal break-words">The <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">normalize_scores/1</code> uses softmax, which can make very different raw scores look similar:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">normalize_scores</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scores</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  m </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">max</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|</span><span> scores</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  exps </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scores</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> s </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:math</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">exp</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>s </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span> m</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  z </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">sum</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>exps</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">zeroish?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>z</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> z</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">List</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">duplicate</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">length</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scores</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>exps</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">/</span><span> z</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span></span></code></pre></div></div>
<p class="whitespace-normal break-words"><strong>Problem</strong>: If all raw scores are similar (e.g., 0.5, 0.52, 0.48), softmax makes them even more similar (0.33, 0.34, 0.33).</p>
<p class="whitespace-normal break-words"><strong>Fix</strong>: Consider adding temperature or using a different normalization:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">normalize_scores</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scores</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> temperature </span><span class="token" style="color: rgb(97, 175, 239);">\\</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1.0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  m </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">max</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|</span><span> scores</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  exps </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scores</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> s </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:math</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">exp</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>s </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span> m</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">/</span><span> temperature</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  z </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">sum</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>exps</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">zeroish?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>z</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> z</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">List</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">duplicate</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">length</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scores</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>exps</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">/</span><span> z</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span></span></code></pre></div></div>
<p class="whitespace-normal break-words">Lower temperature (e.g., 0.5) sharpens differences; higher temperature (e.g., 2.0) smooths them.</p>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">Debugging Strategy</h2>
<p class="whitespace-normal break-words">Add this temporary function to see what's happening:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">debug_candidate_scoring</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tidx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> cands</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> normed</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> winner_c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> margin</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  </span><span class="token module" style="color: rgb(209, 154, 102);">IO</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">puts</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">"\n=== Token </span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">#{</span><span class="token interpolation" style="color: rgb(152, 195, 121);">tidx</span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(152, 195, 121);"> ==="</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token module" style="color: rgb(209, 154, 102);">IO</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">puts</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">"Candidates: </span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">#{</span><span class="token interpolation" style="color: rgb(97, 175, 239);">length</span><span class="token interpolation" style="color: rgb(171, 178, 191);">(</span><span class="token interpolation" style="color: rgb(152, 195, 121);">cands</span><span class="token interpolation" style="color: rgb(171, 178, 191);">)</span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(152, 195, 121);">"</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>  
</span><span>  normed
</span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">sort_by</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>_c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span>f</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>score_norm </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">take</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">3</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">with_index</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">each</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> i</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>    </span><span class="token module" style="color: rgb(209, 154, 102);">IO</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">puts</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">"  </span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">#{</span><span class="token interpolation" style="color: rgb(152, 195, 121);">i</span><span class="token interpolation" style="color: rgb(97, 175, 239);">+</span><span class="token interpolation" style="color: rgb(209, 154, 102);">1</span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(152, 195, 121);">. </span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">#{</span><span class="token interpolation" style="color: rgb(152, 195, 121);">c</span><span class="token interpolation" style="color: rgb(171, 178, 191);">.</span><span class="token interpolation" style="color: rgb(152, 195, 121);">id</span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(152, 195, 121);"> (</span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">#{</span><span class="token interpolation" style="color: rgb(152, 195, 121);">c</span><span class="token interpolation" style="color: rgb(171, 178, 191);">.</span><span class="token interpolation" style="color: rgb(152, 195, 121);">lemma</span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(152, 195, 121);">)"</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token module" style="color: rgb(209, 154, 102);">IO</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">puts</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">"     raw: </span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">#{</span><span class="token interpolation module" style="color: rgb(209, 154, 102);">Float</span><span class="token interpolation" style="color: rgb(171, 178, 191);">.</span><span class="token interpolation" style="color: rgb(97, 175, 239);">round</span><span class="token interpolation" style="color: rgb(171, 178, 191);">(</span><span class="token interpolation" style="color: rgb(152, 195, 121);">f</span><span class="token interpolation" style="color: rgb(171, 178, 191);">.</span><span class="token interpolation" style="color: rgb(152, 195, 121);">score_raw</span><span class="token interpolation" style="color: rgb(171, 178, 191);">,</span><span class="token interpolation" style="color: rgb(152, 195, 121);"> </span><span class="token interpolation" style="color: rgb(209, 154, 102);">3</span><span class="token interpolation" style="color: rgb(171, 178, 191);">)</span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(152, 195, 121);">, norm: </span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">#{</span><span class="token interpolation module" style="color: rgb(209, 154, 102);">Float</span><span class="token interpolation" style="color: rgb(171, 178, 191);">.</span><span class="token interpolation" style="color: rgb(97, 175, 239);">round</span><span class="token interpolation" style="color: rgb(171, 178, 191);">(</span><span class="token interpolation" style="color: rgb(152, 195, 121);">f</span><span class="token interpolation" style="color: rgb(171, 178, 191);">.</span><span class="token interpolation" style="color: rgb(152, 195, 121);">score_norm</span><span class="token interpolation" style="color: rgb(171, 178, 191);">,</span><span class="token interpolation" style="color: rgb(152, 195, 121);"> </span><span class="token interpolation" style="color: rgb(209, 154, 102);">3</span><span class="token interpolation" style="color: rgb(171, 178, 191);">)</span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(152, 195, 121);">"</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token module" style="color: rgb(209, 154, 102);">IO</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">puts</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">"     lex_fit: </span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">#{</span><span class="token interpolation" style="color: rgb(152, 195, 121);">c</span><span class="token interpolation" style="color: rgb(171, 178, 191);">.</span><span class="token interpolation" style="color: rgb(152, 195, 121);">lex_fit</span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(152, 195, 121);">, rel_prior: </span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">#{</span><span class="token interpolation" style="color: rgb(152, 195, 121);">c</span><span class="token interpolation" style="color: rgb(171, 178, 191);">.</span><span class="token interpolation" style="color: rgb(152, 195, 121);">rel_prior</span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(152, 195, 121);">"</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token module" style="color: rgb(209, 154, 102);">IO</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">puts</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">"Winner: </span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">#{</span><span class="token interpolation" style="color: rgb(152, 195, 121);">winner_c </span><span class="token interpolation" style="color: rgb(97, 175, 239);">&amp;&amp;</span><span class="token interpolation" style="color: rgb(152, 195, 121);"> winner_c</span><span class="token interpolation" style="color: rgb(171, 178, 191);">.</span><span class="token interpolation" style="color: rgb(152, 195, 121);">id</span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(152, 195, 121);">, Margin: </span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">#{</span><span class="token interpolation module" style="color: rgb(209, 154, 102);">Float</span><span class="token interpolation" style="color: rgb(171, 178, 191);">.</span><span class="token interpolation" style="color: rgb(97, 175, 239);">round</span><span class="token interpolation" style="color: rgb(171, 178, 191);">(</span><span class="token interpolation" style="color: rgb(152, 195, 121);">margin</span><span class="token interpolation" style="color: rgb(171, 178, 191);">,</span><span class="token interpolation" style="color: rgb(152, 195, 121);"> </span><span class="token interpolation" style="color: rgb(209, 154, 102);">3</span><span class="token interpolation" style="color: rgb(171, 178, 191);">)</span><span class="token interpolation delimiter" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(152, 195, 121);">"</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span></span></code></pre></div></div>
<p class="whitespace-normal break-words">Call it in <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">disambiguate_groups</code> right after calculating the winner.</p>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">Quick Wins</h2>
<ol class="[&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal space-y-1.5 pl-7">
<li class="whitespace-normal break-words"><strong>Lower the margin threshold</strong> to 0.08 and see if more winners emerge</li>
<li class="whitespace-normal break-words"><strong>Check if candidates are being filtered out</strong> - log before/after <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">filter_candidates_for_token</code></li>
<li class="whitespace-normal break-words"><strong>Verify weights sum meaningfully</strong> - your default weights sum to 1.0, which is good</li>
<li class="whitespace-normal break-words"><strong>Check for nil embeddings</strong> - if <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">ctx</code> is nil, similarity is always 0.0, making that weight useless</li>
</ol>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">What to Check Next</h2>
<p class="whitespace-normal break-words">Can you run your system and share:</p>
<ol class="[&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-decimal space-y-1.5 pl-7">
<li class="whitespace-normal break-words">A sample token with its candidates before and after filtering</li>
<li class="whitespace-normal break-words">The raw scores and normalized scores for that token</li>
<li class="whitespace-normal break-words">The final margin value</li>
</ol>
<p class="whitespace-normal break-words">This will tell us exactly where the filtering is too aggressive.</p></div></div></div><div class="absolute bottom-0 right-2 pointer-events-none" style="transform: none;"><div class="rounded-lg transition min-w-max pointer-events-auto translate-x-2 opacity-0 group-hover:opacity-100"><div class="text-text-300 flex items-stretch justify-between"><div class="w-fit" data-state="closed"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95" type="button" data-testid="action-bar-copy"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div><div class="flex items-center"></div></div></div></div><div data-testid="message-warning" class="flex flex-row gap-1 rounded-md p-2 text-xs select-none -mx-1 mb-1 mt-4 outline outline-1 text-text-100 bg-bg-300/80 text-text-300 outline-bg-400/80"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="shrink-0"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></svg><p>Claude does not have the ability to run the code it generates yet.</p></div></div></div></div><div data-test-render-count="1"><div class="mb-1 mt-1"><div class="group  relative  inline-flex  gap-2  bg-bg-300  rounded-xl  pl-2.5  py-2.5  break-words  text-text-100  transition-all  max-w-[75ch]  flex-col pr-6" style="opacity: 1; transform: none;"><div class="flex flex-row gap-2"><div class="shrink-0"><div class="flex shrink-0 items-center justify-center rounded-full font-bold select-none h-7 w-7 text-[12px] bg-text-200 text-bg-100">B</div></div><div data-testid="user-message" class="font-large !font-user-message grid grid-cols-1 gap-2 py-0.5"><p class="whitespace-pre-wrap break-words">help)
iex(1)&gt; Core.resolve_input "hello there"
[debug] QUERY OK source="brain_cells" db=24.9ms decode=3.4ms queue=1.9ms idle=1293.1ms
SELECT b0."id", b0."word", b0."norm", b0."pos", b0."definition", b0."example", b0."gram_function", b0."synonyms", b0."antonyms", b0."semantic_atoms", b0."type", b0."status", b0."activation", b0."modulated_activation", b0."dopamine", b0."serotonin", b0."position", b0."connections", b0."last_dose_at", b0."last_substance", b0."token_id", b0."inserted_at", b0."updated_at" FROM "brain_cells" AS b0 WHERE (b0."norm" = ANY($1)) [["hello there", "hello", "there"]]
[debug] QUERY OK source="brain_cells" db=2.9ms queue=1.5ms idle=825.0ms
INSERT INTO "brain_cells" ("id","status","type","norm","pos","word","definition","antonyms","example","inserted_at","semantic_atoms","synonyms","updated_at") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13),($14,$15,$16,$17,$18,$19,$20,$21,$22,$23,$24,$25,$26),($27,$28,$29,$30,$31,$32,$33,$34,$35,$36,$37,$38,$39),($40,$41,$42,$43,$44,$45,$46,$47,$48,$49,$50,$51,$52),($53,$54,$55,$56,$57,$58,$59,$60,$61,$62,$63,$64,$65),($66,$67,$68,$69,$70,$71,$72,$73,$74,$75,$76,$77,$78),($79,$80,$81,$82,$83,$84,$85,$86,$87,$88,$89,$90,$91),($92,$93,$94,$95,$96,$97,$98,$99,$100,$101,$102,$103,$104),($105,$106,$107,$108,$109,$110,$111,$112,$113,$114,$115,$116,$117),($118,$119,$120,$121,$122,$123,$124,$125,$126,$127,$128,$129,$130),($131,$132,$133,$134,$135,$136,$137,$138,$139,$140,$141,$142,$143),($144,$145,$146,$147,$148,$149,$150,$151,$152,$153,$154,$155,$156),($157,$158,$159,$160,$161,$162,$163,$164,$165,$166,$167,$168,$169),($170,$171,$172,$173,$174,$175,$176,$177,$178,$179,$180,$181,$182),($183,$184,$185,$186,$187,$188,$189,$190,$191,$192,$193,$194,$195),($196,$197,$198,$199,$200,$201,$202,$203,$204,$205,$206,$207,$208),($209,$210,$211,$212,$213,$214,$215,$216,$217,$218,$219,$220,$221),($222,$223,$224,$225,$226,$227,$228,$229,$230,$231,$232,$233,$234),($235,$236,$237,$238,$239,$240,$241,$242,$243,$244,$245,$246,$247),($248,$249,$250,$251,$252,$253,$254,$255,$256,$257,$258,$259,$260),($261,$262,$263,$264,$265,$266,$267,$268,$269,$270,$271,$272,$273) ON CONFLICT ("id") DO UPDATE SET "definition" = EXCLUDED."definition","example" = EXCLUDED."example","synonyms" = EXCLUDED."synonyms","antonyms" = EXCLUDED."antonyms","type" = EXCLUDED."type","updated_at" = EXCLUDED."updated_at" ["there|noun|0", "active", "lexicon", "there", "noun", "there", "That place.", [], nil, ~N[2025-10-03 22:55:53], [], [], ~N[2025-10-03 22:55:53], "there|noun|1", "active", "lexicon", "there", "noun", "there", "That status; that position.", [], "You rinse and de-string the green beans; I'll take it from there.", ~N[2025-10-03 22:55:53], [], [], ~N[2025-10-03 22:55:53], "there|adverb|2", "active", "lexicon", "there", "adverb", "there", "(location) In a place or location (stated, implied or otherwise indicated) at some distance from the speaker (compare here).", [], nil, ~N[2025-10-03 22:55:53], [], ["away there", "over there", "thither", "yonder", "away there", "over there", "thither", "yonder"], ~N[2025-10-03 22:55:53], "there|adverb|3", "active", "lexicon", "there", "adverb", "there", "In that matter, relation, etc.; at that point, stage, etc., regarded as a distinct place.", [], "He did not stop there, but continued his speech.", ~N[2025-10-03 22:55:53], [], ...]
[debug] QUERY OK source="brain_cells" db=5.2ms idle=152.5ms
SELECT b0."id", b0."word", b0."norm", b0."pos", b0."definition", b0."example", b0."gram_function", b0."synonyms", b0."antonyms", b0."semantic_atoms", b0."type", b0."status", b0."activation", b0."modulated_activation", b0."dopamine", b0."serotonin", b0."position", b0."connections", b0."last_dose_at", b0."last_substance", b0."token_id", b0."inserted_at", b0."updated_at" FROM "brain_cells" AS b0 WHERE (b0."norm" = ANY($1)) [["hello there", "hello", "there"]]
[info] [LIFG] 1ms groups=3 ctx_dim=0 norm=:softmax scores=:all parallel=nil
[debug] QUERY OK source="episodes" db=9.9ms queue=2.4ms idle=174.2ms
SELECT e0."id", e0."user_id", e0."tokens", e0."token_count", e0."si", e0."embedding", e0."tags", e0."inserted_at", e0."updated_at" FROM "episodes" AS e0 WHERE (e0."tokens" &amp;&amp; $1) LIMIT $2 [["hello", "there"], 200]
[debug] QUERY OK source="episodes" db=3.9ms queue=1.7ms idle=195.6ms
SELECT e0."id", e0."user_id", e0."tokens", e0."token_count", e0."si", e0."embedding", e0."tags", e0."inserted_at", e0."updated_at", e0."embedding" &lt;-&gt; $1 FROM "episodes" AS e0 WHERE (NOT (e0."embedding" IS NULL)) ORDER BY e0."embedding" &lt;-&gt; $2 LIMIT $3 [Pgvector.new([-0.5365729331970215, 0.4201670289039612, 0.9906073808670044, 0.6502878665924072, -0.2879033088684082, -0.9613974690437317, -0.7509872317314148, 0.14987720549106598, 0.9129452705383301, 0.8366556167602539, -0.008851309306919575, -0.8462204337120056, -0.9055783748626709, -0.13235175609588623, 0.7625584602355957, 0.9563759565353394, 0.2709057927131653, -0.6636338829994202, -0.9880316257476807, -0.4040376543998718, 0.5514267086982727, 0.9999118447303772, 0.529082715511322, -0.4281826615333557, -0.9917788505554199, -0.6435381174087524, 0.2963685691356659, 0.9637953639030457, 0.7451131343841553, -0.15862266719341278, -0.9165215492248535, -0.8317747712135315, 0.017701925709843636, 0.8509035110473633, 0.9017883539199829, 0.12357312440872192, -0.7682546377182007, -0.9537526369094849, -0.2623748481273651, 0.6702291965484619, 0.9866275787353516, 0.3959251642227173, -0.558789074420929, -0.9997551441192627, -0.5215510129928589, 0.4361647665500641, 0.9928726553916931, 0.6367380023002625, -0.30481061339378357, ...]), Pgvector.new([-0.5365729331970215, 0.4201670289039612, 0.9906073808670044, 0.6502878665924072, -0.2879033088684082, -0.9613974690437317, -0.7509872317314148, 0.14987720549106598, 0.9129452705383301, 0.8366556167602539, -0.008851309306919575, -0.8462204337120056, -0.9055783748626709, -0.13235175609588623, 0.7625584602355957, 0.9563759565353394, 0.2709057927131653, -0.6636338829994202, -0.9880316257476807, -0.4040376543998718, 0.5514267086982727, 0.9999118447303772, 0.529082715511322, -0.4281826615333557, -0.9917788505554199, -0.6435381174087524, 0.2963685691356659, 0.9637953639030457, 0.7451131343841553, -0.15862266719341278, -0.9165215492248535, -0.8317747712135315, 0.017701925709843636, 0.8509035110473633, 0.9017883539199829, 0.12357312440872192, -0.7682546377182007, -0.9537526369094849, -0.2623748481273651, 0.6702291965484619, 0.9866275787353516, 0.3959251642227173, -0.558789074420929, -0.9997551441192627, -0.5215510129928589, 0.4361647665500641, 0.9928726553916931, 0.6367380023002625, ...]), 100]
[debug] QUERY OK source="brain_cells" db=3.8ms queue=4.4ms idle=228.2ms
SELECT b0."id", b0."word", b0."pos", b0."type", b0."definition", b0."example", b0."synonyms", b0."antonyms" FROM "brain_cells" AS b0 WHERE ((b0."norm" = $1) AND (b0."status" = 'active')) ORDER BY CASE WHEN b0."type" = 'lexicon' THEN 0 ELSE 1 END, b0."updated_at" DESC LIMIT $2 ["hello there", 5]
[debug] QUERY OK source="episodes" db=3.2ms idle=236.8ms
SELECT e0."id", e0."user_id", e0."tokens", e0."token_count", e0."si", e0."embedding", e0."tags", e0."inserted_at", e0."updated_at" FROM "episodes" AS e0 WHERE (e0."tokens" &amp;&amp; $1) LIMIT $2 [["hello"], 200]
[debug] QUERY OK source="brain_cells" db=4.7ms idle=240.4ms
SELECT b0."id", b0."word", b0."pos", b0."type", b0."definition", b0."example", b0."synonyms", b0."antonyms" FROM "brain_cells" AS b0 WHERE ((b0."norm" = $1) AND (b0."status" = 'active')) ORDER BY CASE WHEN b0."type" = 'lexicon' THEN 0 ELSE 1 END, b0."updated_at" DESC LIMIT $2 ["hello", 5]
[debug] QUERY OK source="episodes" db=3.8ms idle=245.4ms
SELECT e0."id", e0."user_id", e0."tokens", e0."token_count", e0."si", e0."embedding", e0."tags", e0."inserted_at", e0."updated_at" FROM "episodes" AS e0 WHERE (e0."tokens" &amp;&amp; $1) LIMIT $2 [["there"], 200]
[debug] QUERY OK source="brain_cells" db=5.4ms queue=0.1ms idle=249.7ms
SELECT b0."id", b0."word", b0."pos", b0."type", b0."definition", b0."example", b0."synonyms", b0."antonyms" FROM "brain_cells" AS b0 WHERE ((b0."norm" = $1) AND (b0."status" = 'active')) ORDER BY CASE WHEN b0."type" = 'lexicon' THEN 0 ELSE 1 END, b0."updated_at" DESC LIMIT $2 ["there", 5]
%{
  trace: [
    {:activated, %{rows: 23, lifg_choices: 3, shape: :activate_cells}},
    %{winners: 3, stage: :atl, ts_ms: 1759532153783, concepts: 2},
    %{
      normalize: :softmax,
      groups: 3,
      ctx_dim: 0,
      scores_mode: :all,
      choices: [
        %{
          features: %{
            pos: "interjection",
            lex_fit: 0.6,
            rel_prior: 0.5,
            activation: 0.0,
            intent_bias: 0.2,
            sim: 0.0,
            score_norm: 0.048256070429383915,
            score_raw: 0.245
          },
          alt_ids: ["hello|interjection|2"],
          margin: 9.555342155044555e-4,
          chosen_id: "hello|interjection|6",
          token_index: 0,
          lemma: "hello there",
          scores: %{
            "hello|interjection|2" =&gt; 0.048256070429383915,
            "hello|interjection|3" =&gt; 0.048256070429383915,
            "hello|interjection|4" =&gt; 0.048256070429383915,
            "hello|interjection|5" =&gt; 0.048256070429383915,
            "hello|interjection|6" =&gt; 0.048256070429383915,
            "hello|noun|0" =&gt; 0.04730053621387946,
            "hello|verb|1" =&gt; 0.04730053621387946,
            "there|adverb|2" =&gt; 0.04730053621387946,
            "there|adverb|3" =&gt; 0.04730053621387946,
            "there|adverb|4" =&gt; 0.04730053621387946,
            "there|adverb|5" =&gt; 0.04730053621387946,
            "there|adverb|6" =&gt; 0.04730053621387946,
            "there|interjection|12" =&gt; 0.048256070429383915,
            "there|interjection|13" =&gt; 0.048256070429383915,
            "there|noun|0" =&gt; 0.04730053621387946,
            "there|noun|1" =&gt; 0.04730053621387946,
            "there|pronoun|10" =&gt; 0.04730053621387946,
            "there|pronoun|11" =&gt; 0.04730053621387946,
            "there|pronoun|7" =&gt; 0.04730053621387946,
            "there|pronoun|8" =&gt; 0.04730053621387946,
            "there|pronoun|9" =&gt; 0.04730053621387946
          }
        },
        %{
          features: %{
            pos: "interjection",
            lex_fit: 0.6,
            rel_prior: 0.5,
            activation: 0.0,
            intent_bias: 0.2,
            sim: 0.0,
            score_norm: 0.14366995879718517,
            score_raw: 0.245
          },
          alt_ids: ["hello|interjection|2"],
          margin: 0.002844855790148093,
          chosen_id: "hello|interjection|6",
          token_index: 1,
          lemma: "hello",
          scores: %{
            "hello|interjection|2" =&gt; 0.14366995879718517,
            "hello|interjection|3" =&gt; 0.14366995879718517,
            "hello|interjection|4" =&gt; 0.14366995879718517,
            "hello|interjection|5" =&gt; 0.14366995879718517,
            "hello|interjection|6" =&gt; 0.14366995879718517,
            "hello|noun|0" =&gt; 0.14082510300703707,
            "hello|verb|1" =&gt; 0.14082510300703707
          }
        },
        %{
          features: %{
            pos: "interjection",
            lex_fit: 0.6,
            rel_prior: 0.5,
            activation: 0.0,
            intent_bias: 0.0,
            sim: 0.0,
            score_norm: 0.07142857142857142,
            score_raw: 0.22499999999999998
          },
          alt_ids: ["there|noun|0"],
          margin: 0.0,
          chosen_id: "there|interjection|13",
          token_index: 2,
          lemma: "there",
          scores: %{
            "there|adverb|2" =&gt; 0.07142857142857142,
            "there|adverb|3" =&gt; 0.07142857142857142,
            "there|adverb|4" =&gt; 0.07142857142857142,
            "there|adverb|5" =&gt; 0.07142857142857142,
            "there|adverb|6" =&gt; 0.07142857142857142,
            "there|interjection|12" =&gt; 0.07142857142857142,
            "there|interjection|13" =&gt; 0.07142857142857142,
            "there|noun|0" =&gt; 0.07142857142857142,
            "there|noun|1" =&gt; 0.07142857142857142,
            "there|pronoun|10" =&gt; 0.07142857142857142,
            "there|pronoun|11" =&gt; 0.07142857142857142,
            "there|pronoun|7" =&gt; 0.07142857142857142,
            "there|pronoun|8" =&gt; 0.07142857142857142,
            "there|pronoun|9" =&gt; 0.07142857142857142
          }
        }
      ],
      boosts: [
        {"hello|interjection|6", 0.5},
        {"hello|interjection|6", 0.5},
        {"there|interjection|13", 0.5}
      ],
      inhibitions: [
        {"hello|interjection|2", -0.25},
        {"hello|interjection|3", -0.25},
        {"hello|interjection|4", -0.25},
        {"hello|interjection|5", -0.25},
        {"hello|noun|0", -0.25},
        {"hello|verb|1", -0.25},
        {"there|adverb|2", -0.25},
        {"there|adverb|3", -0.25},
        {"there|adverb|4", -0.25},
        {"there|adverb|5", -0.25},
        {"there|adverb|6", -0.25},
        {"there|interjection|12", -0.25},
        {"there|interjection|13", -0.25},
        {"there|noun|0", -0.25},
        {"there|noun|1", -0.25},
        {"there|pronoun|10", -0.25},
        {"there|pronoun|11", -0.25},
        {"there|pronoun|7", -0.25},
        {"there|pronoun|8", -0.25},
        {"there|pronoun|9", -0.25}
      ],
      stage: :lifg_stage1,
      ts_ms: 1759532153771
    },
    %{
      meta: %{
        words: ["there", "hello", "hello there"],
        looked_up: 3,
        upserts: 21
      },
      stage: :lexicon_upserts,
      ts_ms: -576460731774
    }
  ],
  tokens: [
    %{
      index: 0,
      span: {0, 11},
      n: 2,
      phrase: "hello there",
      mw: true,
      instances: []
    },
    %{
      index: 1,
      span: {0, 5},
      n: 1,
      phrase: "hello",
      mw: false,
      instances: []
    },
    %{
      index: 2,
      span: {6, 5},
      n: 1,
      phrase: "there",
      mw: false,
      instances: []
    }
  ],
  source: :prod,
  <u>struct</u>: Core.SemanticInput,
  lifg_choices: [
    %{
      id: "hello|interjection|6",
      alt_ids: ["hello|interjection|2"],
      token_index: 0,
      lemma: "hello there",
      score: 0.048256070429383915
    },
    %{
      id: "hello|interjection|6",
      alt_ids: ["hello|interjection|2"],
      token_index: 1,
      lemma: "hello",
      score: 0.14366995879718517
    },
    %{
      id: "there|interjection|13",
      alt_ids: ["there|noun|0"],
      token_index: 2,
      lemma: "there",
      score: 0.07142857142857142
    }
  ],
  active_cells: [
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "hello|unk|seed|",
      word: "hello",
      norm: "hello",
      pos: "unk",
      definition: nil,
      example: nil,
      gram_function: nil,
      synonyms: [],
      antonyms: [],
      semantic_atoms: [],
      type: "seed",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:01],
      updated_at: ~N[2025-10-01 23:16:01]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|unk|seed|",
      word: "there",
      norm: "there",
      pos: "unk",
      definition: nil,
      example: nil,
      gram_function: nil,
      synonyms: [],
      antonyms: [],
      semantic_atoms: [],
      type: "seed",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:01],
      updated_at: ~N[2025-10-01 23:16:01]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|interjection|13",
      word: "there",
      norm: "there",
      pos: "interjection",
      definition: "Used to express victory or completion.",
      example: "There! That knot should hold.",
      gram_function: nil,
      synonyms: [],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "hello|interjection|6",
      word: "hello",
      norm: "hello",
      pos: "interjection",
      definition: "An expression of puzzlement or discovery.",
      example: "Hello! What’s going on here?",
      gram_function: nil,
      synonyms: [],
      antonyms: ["bye", "goodbye"],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|noun|0",
      word: "there",
      norm: "there",
      pos: "noun",
      definition: "That place.",
      example: nil,
      gram_function: nil,
      synonyms: [],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|noun|1",
      word: "there",
      norm: "there",
      pos: "noun",
      definition: "That status; that position.",
      example: "You rinse and de-string the green beans; I'll take it from there.",
      gram_function: nil,
      synonyms: [],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|adverb|4",
      word: "there",
      norm: "there",
      pos: "adverb",
      definition: "(location) To or into that place; thither.",
      example: nil,
      gram_function: nil,
      synonyms: ["away there", "over there", "thither", "yonder",
       "away there", "over there", "thither", "yonder"],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|adverb|5",
      word: "there",
      norm: "there",
      pos: "adverb",
      definition: "Where, there where, in which place.",
      example: nil,
      gram_function: nil,
      synonyms: ["away there", "over there", "thither", "yonder",
       "away there", "over there", "thither", "yonder"],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "hello|noun|0",
      word: "hello",
      norm: "hello",
      pos: "noun",
      definition: "\"Hello!\" or an equivalent greeting.",
      example: nil,
      gram_function: nil,
      synonyms: ["greeting"],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|adverb|2",
      word: "there",
      norm: "there",
      pos: "adverb",
      definition: "(location) In a place or location (stated, implied or otherwise indicated) at some distance from the speaker (compare here).",
      example: nil,
      gram_function: nil,
      synonyms: ["away there", "over there", "thither", "yonder",
       "away there", "over there", "thither", "yonder"],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|adverb|3",
      word: "there",
      norm: "there",
      pos: "adverb",
      definition: "In that matter, relation, etc.; at that point, stage, etc., regarded as a distinct place.",
      example: "He did not stop there, but continued his speech.",
      gram_function: nil,
      synonyms: ["away there", "over there", "thither", "yonder",
       "away there", "over there", "thither", "yonder"],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "hello|verb|1",
      word: "hello",
      norm: "hello",
      pos: "verb",
      definition: "To greet with \"hello\".",
      example: nil,
      gram_function: nil,
      synonyms: [],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|pronoun|7",
      word: "there",
      norm: "there",
      pos: "pronoun",
      definition: "Used as an expletive subject of be in its sense of “exist”, with the semantic, usually indefinite subject being postponed or (occasionally) implied.",
      example: "Is there an answer? [=Does an answer exist?]",
      gram_function: nil,
      synonyms: [],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|pronoun|8",
      word: "there",
      norm: "there",
      pos: "pronoun",
      definition: "Used with other intransitive verbs of existence, in the same sense, or with other intransitive verbs, adding a sense of existence.",
      example: "If x is a positive number, then there exists [=there is] a positive number y less than x.",
      gram_function: nil,
      synonyms: [],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|pronoun|9",
      word: "there",
      norm: "there",
      pos: "pronoun",
      definition: "Used with other verbs, when raised.",
      example: "I expected there to be a simpler solution. [=I expected that there would be a simpler solution.]",
      gram_function: nil,
      synonyms: [],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|pronoun|10",
      word: "there",
      norm: "there",
      pos: "pronoun",
      definition: "(in combination with certain prepositions, no longer productive) That.",
      example: "therefor, thereat, thereunder",
      gram_function: nil,
      synonyms: [],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|pronoun|11",
      word: "there",
      norm: "there",
      pos: "pronoun",
      definition: "Used to replace an unknown name, principally in greetings and farewells",
      example: "Hi there, young fellow.",
      gram_function: nil,
      synonyms: [],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|interjection|12",
      word: "there",
      norm: "there",
      pos: "interjection",
      definition: "Used to offer encouragement or sympathy.",
      example: "There, there. Everything is going to turn out all right.",
      gram_function: nil,
      synonyms: [],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "hello|interjection|2",
      word: "hello",
      norm: "hello",
      pos: "interjection",
      definition: "A greeting (salutation) said when meeting someone or acknowledging someone’s arrival or presence.",
      example: "Hello, everyone.",
      gram_function: nil,
      synonyms: [],
      antonyms: ["bye", "goodbye"],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "hello|interjection|3",
      word: "hello",
      norm: "hello",
      pos: "interjection",
      definition: "A greeting used when answering the telephone.",
      example: "Hello? How may I help you?",
      gram_function: nil,
      synonyms: [],
      antonyms: ["bye", "goodbye"],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      updated_at: ~N[2025-10-03 21:17:44]
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "there|adverb|6",
      word: "there",
      norm: "there",
      pos: "adverb",
      definition: "In existence or in this world; see pronoun section below.",
      example: nil,
      gram_function: nil,
      synonyms: ["away there", "over there", "thither", "yonder",
       "away there", "over there", "thither", "yonder"],
      antonyms: [],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      inserted_at: ~N[2025-10-01 23:16:02],
      ...
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "hello|interjection|4",
      word: "hello",
      norm: "hello",
      pos: "interjection",
      definition: "A call for response if it is not clear if anyone is present or listening, or if a telephone conversation may have been disconnected.",
      example: "Hello? Is anyone there?",
      gram_function: nil,
      synonyms: [],
      antonyms: ["bye", "goodbye"],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      token_id: nil,
      ...
    },
    %Db.BrainCell{
      <u>meta</u>: #Ecto.Schema.Metadata&lt;:loaded, "brain_cells"&gt;,
      id: "hello|interjection|5",
      word: "hello",
      norm: "hello",
      pos: "interjection",
      definition: "Used sarcastically to imply that the person addressed or referred to has done something the speaker or writer considers to be foolish.",
      example: "You just tried to start your car with your cell phone. Hello?",
      gram_function: nil,
      synonyms: [],
      antonyms: ["bye", "goodbye"],
      semantic_atoms: [],
      type: "lexicon",
      status: "active",
      activation: 0.0,
      modulated_activation: 0.0,
      dopamine: 0.0,
      serotonin: 0.0,
      position: nil,
      connections: [],
      last_dose_at: nil,
      last_substance: nil,
      ...
    }
  ],
  sentence: "hello there",
  activation_summary: %{db_hits: MapSet.new(["hello", "there"])},
  atl_slate: %{
    tokens: [
      %{
        index: 0,
        span: {0, 11},
        n: 2,
        phrase: "hello there",
        mw: true,
        instances: []
      },
      %{
        index: 1,
        span: {0, 5},
        n: 1,
        phrase: "hello",
        mw: false,
        instances: []
      },
      %{
        index: 2,
        span: {6, 5},
        n: 1,
        phrase: "there",
        mw: false,
        instances: []
      }
    ],
    winners: [
      %{
        id: "hello|interjection|6",
        raw: %{
          id: "hello|interjection|6",
          alt_ids: ["hello|interjection|2"],
          token_index: 0,
          lemma: "hello there",
          score: 0.048256070429383915
        },
        norm: "hello",
        margin: 0.0,
        token_index: 0,
        lemma: "hello there",
        score: 0.048256070429383915
      },
      %{
        id: "hello|interjection|6",
        raw: %{
          id: "hello|interjection|6",
          alt_ids: ["hello|interjection|2"],
          token_index: 1,
          lemma: "hello",
          score: 0.14366995879718517
        },
        norm: "hello",
        margin: 0.0,
        token_index: 1,
        lemma: "hello",
        score: 0.14366995879718517
      },
      %{
        id: "there|interjection|13",
        raw: %{
          id: "there|interjection|13",
          alt_ids: ["there|noun|0"],
          token_index: 2,
          lemma: "there",
          score: 0.07142857142857142
        },
        norm: "there",
        margin: 0.0,
        token_index: 2,
        lemma: "there",
        score: 0.07142857142857142
      }
    ],
    by_norm: %{
      "hello" =&gt; [
        %{
          id: "hello|interjection|6",
          raw: %{
            id: "hello|interjection|6",
            alt_ids: ["hello|interjection|2"],
            token_index: 0,
            lemma: "hello there",
            score: 0.048256070429383915
          },
          norm: "hello",
          margin: 0.0,
          token_index: 0,
          lemma: "hello there",
          score: 0.048256070429383915
        },
        %{
          id: "hello|interjection|6",
          raw: %{
            id: "hello|interjection|6",
            alt_ids: ["hello|interjection|2"],
            token_index: 1,
            lemma: "hello",
            score: 0.14366995879718517
          },
          norm: "hello",
          margin: 0.0,
          token_index: 1,
          lemma: "hello",
          score: 0.14366995879718517
        }
      ],
      "there" =&gt; [
        %{
          id: "there|interjection|13",
          raw: %{
            id: "there|interjection|13",
            alt_ids: ["there|noun|0"],
            token_index: 2,
            lemma: "there",
            score: 0.07142857142857142
          },
          norm: "there",
          margin: 0.0,
          token_index: 2,
          lemma: "there",
          score: 0.07142857142857142
        }
      ]
    },
    by_id: %{
      "hello|interjection|6" =&gt; [
        %{
          id: "hello|interjection|6",
          raw: %{
            id: "hello|interjection|6",
            alt_ids: ["hello|interjection|2"],
            token_index: 0,
            lemma: "hello there",
            score: 0.048256070429383915
          },
          norm: "hello",
          margin: 0.0,
          token_index: 0,
          lemma: "hello there",
          score: 0.048256070429383915
        },
        %{
          id: "hello|interjection|6",
          raw: %{
            id: "hello|interjection|6",
            alt_ids: ["hello|interjection|2"],
            token_index: 1,
            lemma: "hello",
            score: 0.14366995879718517
          },
          norm: "hello",
          margin: 0.0,
          token_index: 1,
          lemma: "hello",
          score: 0.14366995879718517
        }
      ],
      "there|interjection|13" =&gt; [
        %{
          id: "there|interjection|13",
          raw: %{
            id: "there|interjection|13",
            alt_ids: ["there|noun|0"],
            token_index: 2,
            lemma: "there",
            score: 0.07142857142857142
          },
          norm: "there",
          margin: 0.0,
          token_index: 2,
          lemma: "there",
          score: 0.07142857142857142
        }
      ]
    },
    token_count: 3,
    winner_count: 3
  }
}
[debug] QUERY ERROR source="episodes" db=34.5ms queue=2.6ms idle=236.4ms
INSERT INTO "episodes" ("tokens","tags","si","token_count","inserted_at","updated_at") VALUES ($1,$2,$3,$4,$5,$6) RETURNING "id" [["hello there", "hello", "there"], ["auto", "lifg"], %{trace: [%{normalize: :softmax, groups: 3, ctx_dim: 0, scores_mode: :all, choices: [%{features: %{pos: "interjection", lex_fit: 0.6, rel_prior: 0.5, activation: 0.0, intent_bias: 0.2, sim: 0.0, score_norm: 0.048256070429383915, score_raw: 0.245}, alt_ids: ["hello|interjection|2"], margin: 9.555342155044555e-4, chosen_id: "hello|interjection|6", token_index: 0, lemma: "hello there", scores: %{"hello|interjection|2" =&gt; 0.048256070429383915, "hello|interjection|3" =&gt; 0.048256070429383915, "hello|interjection|4" =&gt; 0.048256070429383915, "hello|interjection|5" =&gt; 0.048256070429383915, "hello|interjection|6" =&gt; 0.048256070429383915, "hello|noun|0" =&gt; 0.04730053621387946, "hello|verb|1" =&gt; 0.04730053621387946, "there|adverb|2" =&gt; 0.04730053621387946, "there|adverb|3" =&gt; 0.04730053621387946, "there|adverb|4" =&gt; 0.04730053621387946, "there|adverb|5" =&gt; 0.04730053621387946, "there|adverb|6" =&gt; 0.04730053621387946, "there|interjection|12" =&gt; 0.048256070429383915, "there|interjection|13" =&gt; 0.048256070429383915, "there|noun|0" =&gt; 0.04730053621387946, "there|noun|1" =&gt; 0.04730053621387946, "there|pronoun|10" =&gt; 0.04730053621387946, "there|pronoun|11" =&gt; 0.04730053621387946, "there|pronoun|7" =&gt; 0.04730053621387946, "there|pronoun|8" =&gt; 0.04730053621387946, "there|pronoun|9" =&gt; 0.04730053621387946}}, %{features: %{pos: "interjection", lex_fit: 0.6, rel_prior: 0.5, activation: 0.0, intent_bias: 0.2, sim: 0.0, score_norm: 0.14366995879718517, score_raw: 0.245}, alt_ids: ["hello|interjection|2"], margin: 0.002844855790148093, chosen_id: "hello|interjection|6", token_index: 1, lemma: "hello", scores: %{"hello|interjection|2" =&gt; 0.14366995879718517, "hello|interjection|3" =&gt; 0.14366995879718517, "hello|interjection|4" =&gt; 0.14366995879718517, "hello|interjection|5" =&gt; 0.14366995879718517, "hello|interjection|6" =&gt; 0.14366995879718517, "hello|noun|0" =&gt; 0.14082510300703707, "hello|verb|1" =&gt; 0.14082510300703707}}, %{features: %{pos: "interjection", lex_fit: 0.6, rel_prior: 0.5, activation: 0.0, intent_bias: 0.0, sim: 0.0, score_norm: 0.07142857142857142, score_raw: 0.22499999999999998}, alt_ids: ["there|noun|0"], margin: 0.0, chosen_id: "there|interjection|13", token_index: 2, lemma: "there", scores: %{"there|adverb|2" =&gt; 0.07142857142857142, "there|adverb|3" =&gt; 0.07142857142857142, "there|adverb|4" =&gt; 0.07142857142857142, "there|adverb|5" =&gt; 0.07142857142857142, "there|adverb|6" =&gt; 0.07142857142857142, "there|interjection|12" =&gt; 0.07142857142857142, "there|interjection|13" =&gt; 0.07142857142857142, "there|noun|0" =&gt; 0.07142857142857142, "there|noun|1" =&gt; 0.07142857142857142, "there|pronoun|10" =&gt; 0.07142857142857142, "there|pronoun|11" =&gt; 0.07142857142857142, "there|pronoun|7" =&gt; 0.07142857142857142, "there|pronoun|8" =&gt; 0.07142857142857142, "there|pronoun|9" =&gt; 0.07142857142857142}}], boosts: [{"hello|interjection|6", 0.5}, {"hello|interjection|6", 0.5}, {"there|interjection|13", 0.5}], inhibitions: [{"hello|interjection|2", -0.25}, {"hello|interjection|3", -0.25}, {"hello|interjection|4", -0.25}, {"hello|interjection|5", -0.25}, {"hello|noun|0", -0.25}, {"hello|verb|1", -0.25}, {"there|adverb|2", -0.25}, {"there|adverb|3", -0.25}, {"there|adverb|4", -0.25}, {"there|adverb|5", -0.25}, {"there|adverb|6", -0.25}, {"there|interjection|12", -0.25}, {"there|interjection|13", -0.25}, {"there|noun|0", -0.25}, {"there|noun|1", -0.25}, {"there|pronoun|10", -0.25}, {"there|pronoun|11", -0.25}, {"there|pronoun|7", -0.25}, {"there|pronoun|8", -0.25}, {"there|pronoun|9", -0.25}], stage: :lifg_stage1, ts_ms: 1759532153771}], tokens: [%{index: 0, span: {0, 11}, n: 2, phrase: "hello there", mw: true, instances: []}, %{index: 1, span: {0, 5}, n: 1, phrase: "hello", mw: false, instances: []}, %{index: 2, span: {6, 5}, n: 1, phrase: "there", mw: false, instances: []}], lifg_choices: [%{alt_ids: ["hello|interjection|2"], margin: 9.555342155044555e-4, chosen_id: "hello|interjection|6", token_index: 0, lemma: "hello there", scores: %{"hello|interjection|2" =&gt; 0.048256070429383915, "hello|interjection|3" =&gt; 0.048256070429383915, "hello|interjection|4" =&gt; 0.048256070429383915, "hello|interjection|5" =&gt; 0.048256070429383915, "hello|interjection|6" =&gt; 0.048256070429383915, "hello|noun|0" =&gt; 0.04730053621387946, "hello|verb|1" =&gt; 0.04730053621387946, "there|adverb|2" =&gt; 0.04730053621387946, "there|adverb|3" =&gt; 0.04730053621387946, "there|adverb|4" =&gt; 0.04730053621387946, "there|adverb|5" =&gt; 0.04730053621387946, "there|adverb|6" =&gt; 0.04730053621387946, "there|interjection|12" =&gt; 0.048256070429383915, "there|interjection|13" =&gt; 0.048256070429383915, "there|noun|0" =&gt; 0.04730053621387946, "there|noun|1" =&gt; 0.04730053621387946, "there|pronoun|10" =&gt; 0.04730053621387946, "there|pronoun|11" =&gt; 0.04730053621387946, "there|pronoun|7" =&gt; 0.04730053621387946, "there|pronoun|8" =&gt; 0.04730053621387946, "there|pronoun|9" =&gt; 0.04730053621387946}}, %{alt_ids: ["hello|interjection|2"], margin: 0.002844855790148093, chosen_id: "hello|interjection|6", token_index: 1, lemma: "hello", scores: %{"hello|interjection|2" =&gt; 0.14366995879718517, "hello|interjection|3" =&gt; 0.14366995879718517, "hello|interjection|4" =&gt; 0.14366995879718517, "hello|interjection|5" =&gt; 0.14366995879718517, "hello|interjection|6" =&gt; 0.14366995879718517, "hello|noun|0" =&gt; 0.14082510300703707, "hello|verb|1" =&gt; 0.14082510300703707}}, %{alt_ids: ["there|noun|0"], margin: 0.0, chosen_id: "there|interjection|13", token_index: 2, lemma: "there", scores: %{"there|adverb|2" =&gt; 0.07142857142857142, "there|adverb|3" =&gt; 0.07142857142857142, "there|adverb|4" =&gt; 0.07142857142857142, "there|adverb|5" =&gt; 0.07142857142857142, "there|adverb|6" =&gt; 0.07142857142857142, "there|interjection|12" =&gt; 0.07142857142857142, "there|interjection|13" =&gt; 0.07142857142857142, "there|noun|0" =&gt; 0.07142857142857142, "there|noun|1" =&gt; 0.07142857142857142, "there|pronoun|10" =&gt; 0.07142857142857142, "there|pronoun|11" =&gt; 0.07142857142857142, "there|pronoun|7" =&gt; 0.07142857142857142, "there|pronoun|8" =&gt; 0.07142857142857142, "there|pronoun|9" =&gt; 0.07142857142857142}}]}, 3, ~N[2025-10-03 22:55:53.848003], ~N[2025-10-03 22:55:53.848003]]</p></div></div></div></div></div><div data-test-render-count="1"><div style="height: auto; opacity: 1; transform: none;"><div data-is-streaming="false" class="group  relative pb-8" style="opacity: 1; transform: none;"><div class="font-claude-response  relative  leading-[1.65rem]  [&amp;_pre&gt;div]:bg-bg-000/50  [&amp;_pre&gt;div]:border-0.5  [&amp;_pre&gt;div]:border-border-400  [&amp;_.ignore-pre-bg&gt;div]:bg-transparent  [&amp;_.standard-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2  [&amp;_.standard-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8  [&amp;_.progressive-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2  [&amp;_.progressive-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8"><div><div class="grid-cols-1 grid gap-2.5 [&amp;_&gt;_*]:min-w-0 standard-markdown"><p class="whitespace-normal break-words">Perfect! Now I can see the exact problem. Look at these scores for token index 0 ("hello there", the MWE):</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(209, 154, 102);">scores:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(152, 195, 121);">"hello|interjection|2"</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.048256070429383915</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(152, 195, 121);">"hello|interjection|3"</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.048256070429383915</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(152, 195, 121);">"hello|interjection|4"</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.048256070429383915</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(152, 195, 121);">"hello|interjection|5"</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.048256070429383915</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(152, 195, 121);">"hello|interjection|6"</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.048256070429383915</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># winner</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(152, 195, 121);">"hello|noun|0"</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.04730053621387946</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(152, 195, 121);">"hello|verb|1"</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.04730053621387946</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(152, 195, 121);">"there|adverb|2"</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.04730053621387946</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ... all the "there" senses ...</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(171, 178, 191);">}</span></span></code></pre></div></div>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">The Core Problems</h2>
<h3 class="text-lg font-bold text-text-100 mt-1 -mb-1.5">1. <strong>Cross-token contamination</strong></h3>
<p class="whitespace-normal break-words">Your MWE token "hello there" is getting candidates from BOTH "hello" AND "there" - that's why you have 21 candidates scoring almost identically. This is the smoking gun:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">candidates_from_cells</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ...</span><span>
</span></span><span>  tokens
</span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">with_index</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">flat_map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>    tnorm </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">norm</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:phrase</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>    
</span><span>    cells_normed
</span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> c </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>      c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__norm__ </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> tnorm </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span>
</span></span><span><span>        </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tnorm</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__norm__</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># &lt;- THIS IS THE PROBLEM</span><span>
</span></span><span><span>        </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__norm__</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tnorm</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span></span></code></pre></div></div>
<p class="whitespace-normal break-words">For token 0 with <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">phrase: "hello there"</code>:</p>
<ul class="[&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc space-y-1.5 pl-7">
<li class="whitespace-normal break-words">It matches cells with norm "hello" (because "hello there" contains "hello")</li>
<li class="whitespace-normal break-words">It matches cells with norm "there" (because "hello there" contains "there")</li>
<li class="whitespace-normal break-words">Result: 21 candidates, all irrelevant except actual "hello there" senses</li>
</ul>
<h3 class="text-lg font-bold text-text-100 mt-1 -mb-1.5">2. <strong>No actual "hello there" MWE senses exist</strong></h3>
<p class="whitespace-normal break-words">None of your brain cells have a lemma "hello there" - they're all single words. So <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">filter_candidates_for_token</code> tries to filter for MWE senses (ones with spaces in lemma), finds none, and falls back to returning the entire contaminated list.</p>
<h3 class="text-lg font-bold text-text-100 mt-1 -mb-1.5">3. <strong>Identical raw scores collapse after softmax</strong></h3>
<p class="whitespace-normal break-words">All candidates score ~0.225-0.245 raw, which after softmax becomes ~0.047-0.048. The margin between winner and runner-up is <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">0.000955</code> - essentially noise.</p>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">The Fix</h2>
<p class="whitespace-normal break-words">You need to make the candidate matching <strong>strict</strong> for MWEs:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">candidates_from_cells</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  cells </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:active_cells</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>  norm </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> s </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span>    s
</span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">to_b</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">downcase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">replace</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">~r/\s+/</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">" "</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">trim</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  cells_normed </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>    </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cells</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> m </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>      word  </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:word</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span>
</span></span><span><span>      lemma </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:lemma</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> word
</span></span><span><span>      nrm   </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:norm</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> word
</span></span><span>
</span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">id:</span><span>           </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:id</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">pos:</span><span>          </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:pos</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">lex_fit:</span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:lex_fit</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">rel_prior:</span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:rel_prior</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">intent_bias:</span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:intent_bias</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">activation:</span><span>   </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:activation</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">embedding:</span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:embedding</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">definition:</span><span>   </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:definition</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">__norm__:</span><span>     </span><span class="token" style="color: rgb(97, 175, 239);">norm</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>nrm</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">__lemma__:</span><span>    lemma
</span></span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span>  tokens
</span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">with_index</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">flat_map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>    tnorm </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">norm</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:phrase</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    is_mwe </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:n</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:mw</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">in</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(209, 154, 102);">true</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"true"</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span>
</span><span>    cells_normed
</span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> c </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># STRICT matching for MWEs</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> is_mwe </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># For MWE tokens, only exact match</span><span>
</span></span><span><span>        c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__norm__ </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> tnorm
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">else</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># For single-word tokens, fuzzy matching is OK</span><span>
</span></span><span><span>        c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__norm__ </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> tnorm </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span>
</span></span><span><span>          </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tnorm</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__norm__</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span>
</span></span><span><span>          </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__norm__</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tnorm</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> c </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">id:</span><span>          c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">token_index:</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">lemma:</span><span>       c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__lemma__ </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">pos:</span><span>         c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>pos</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">lex_fit:</span><span>     c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>lex_fit </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.6</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">rel_prior:</span><span>   c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>rel_prior </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.5</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">intent_bias:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>intent_bias </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span>
</span></span><span><span>                       </span><span class="token" style="color: rgb(97, 175, 239);">intent_bias_from</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">pos:</span><span> c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>pos</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">definition:</span><span> c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>definition</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">activation:</span><span>  c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>activation </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">embedding:</span><span>   c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>embedding
</span></span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span></span></code></pre></div></div>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">Alternative: Just Drop MWEs Without Exact Match</h2>
<p class="whitespace-normal break-words">Even simpler - if there's no exact match for an MWE, filter it out entirely:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">disambiguate_groups</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> candidates</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctxn</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> weights</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  groups </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">group_by</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>candidates</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span> </span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>token_index</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ... existing code ...</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> losers</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>    </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map_reduce</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>groups</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">MapSet</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">new</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>tidx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> cands0</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> acc_losers </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>      tok </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">at</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tidx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> t </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> t
</span></span><span><span>          _ </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>      </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># NEW: For MWE tokens, only keep candidates with exact norm match</span><span>
</span></span><span><span>      cands </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span>        cands0
</span><span><span>        </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">reject</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(97, 175, 239);">is_nil</span><span class="token" style="color: rgb(97, 175, 239);">/</span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">reject</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">is_nil</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">uniq_by</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span> </span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">then</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> list </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>          is_mwe </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:n</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:mw</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">in</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(209, 154, 102);">true</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"true"</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span><span>          tok_phrase </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">norm_phrase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:phrase</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>          
</span><span><span>          </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> is_mwe </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Keep only exact matches for MWE</span><span>
</span></span><span><span>            </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> c </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> 
</span></span><span><span>              </span><span class="token" style="color: rgb(97, 175, 239);">norm_phrase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>lemma </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> tok_phrase 
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(198, 120, 221);">else</span><span>
</span></span><span>            list
</span><span><span>          </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">filter_candidates_for_token</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>      
</span><span><span>      </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># If no candidates remain, skip this token</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> cands </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> acc_losers</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">else</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ... rest of existing logic ...</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">then</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> losers</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> 
</span></span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">reject</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(97, 175, 239);">is_nil</span><span class="token" style="color: rgb(97, 175, 239);">/</span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> losers</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>  
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ... rest of function</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">norm_phrase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>phrase</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span>  phrase
</span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">to_b</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">downcase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">replace</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">~r/\s+/</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">" "</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">trim</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span></span><span class="token" style="color: rgb(198, 120, 221);">end</span></span></code></pre></div></div>
<h2 class="text-xl font-bold text-text-100 mt-1 -mb-0.5">Expected Results After Fix</h2>
<p class="whitespace-normal break-words">For "hello there":</p>
<ul class="[&amp;:not(:last-child)_ul]:pb-1 [&amp;:not(:last-child)_ol]:pb-1 list-disc space-y-1.5 pl-7">
<li class="whitespace-normal break-words">Token 0 (MWE): <strong>0 candidates</strong> (no "hello there" sense exists) → no choice emitted</li>
<li class="whitespace-normal break-words">Token 1 ("hello"): 7 candidates (all "hello" senses) → clean competition</li>
<li class="whitespace-normal break-words">Token 2 ("there"): 14 candidates (all "there" senses) → clean competition</li>
</ul>
<p class="whitespace-normal break-words">This way losers are actually the non-selected senses of the correct word, not a mashup of unrelated words.</p></div></div></div><div class="absolute bottom-0 right-2 pointer-events-none" style="transform: none;"><div class="rounded-lg transition min-w-max pointer-events-auto translate-x-2 opacity-0 group-hover:opacity-100"><div class="text-text-300 flex items-stretch justify-between"><div class="w-fit" data-state="closed"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95" type="button" data-testid="action-bar-copy"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div><div class="flex items-center"></div></div></div></div><div data-testid="message-warning" class="flex flex-row gap-1 rounded-md p-2 text-xs select-none -mx-1 mb-1 mt-4 outline outline-1 text-text-100 bg-bg-300/80 text-text-300 outline-bg-400/80"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="shrink-0"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></svg><p>Claude does not have the ability to run the code it generates yet.</p></div></div></div></div><div data-test-render-count="1"><div class="mb-1 mt-1"><div class="group  relative  inline-flex  gap-2  bg-bg-300  rounded-xl  pl-2.5  py-2.5  break-words  text-text-100  transition-all  max-w-[75ch]  flex-col pr-6" style="opacity: 1; transform: none;"><div class="flex flex-row gap-2"><div class="shrink-0"><div class="flex shrink-0 items-center justify-center rounded-full font-bold select-none h-7 w-7 text-[12px] bg-text-200 text-bg-100">B</div></div><div data-testid="user-message" class="font-large !font-user-message grid grid-cols-1 gap-2 py-0.5"><p class="whitespace-pre-wrap break-words">Can u refactor this file with the fixes?
defmodule Brain.LIFG do
  @moduledoc ~S"""
  <strong>Left Inferior Frontal Gyrus (LIFG) — Competitive Sense Selection</strong></p><p class="whitespace-pre-wrap break-words">  Two entry points:</p><p class="whitespace-pre-wrap break-words">  • Legacy pure stage (kept for back-compat):
      <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">disambiguate_stage1/1,2</code> — scores candidates from slate or active_cells with optional context similarity.</p><p class="whitespace-pre-wrap break-words">  • New fast pipeline stage:
      <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">Brain.LIFG.Stage1.run/2</code> — per-token disambiguation from <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">si.sense_candidates</code> with guards and tiny heuristics.</p><p class="whitespace-pre-wrap break-words">  Central config (umbrella root <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">config/config.exs</code>):</p><p class="whitespace-pre-wrap break-words">      config :brain,
        lifg_stage1_weights: %{lex_fit: 0.40, rel_prior: 0.30, activation: 0.20, intent_bias: 0.10},
        lifg_stage1_scores_mode: :all,  # or :top2 | :none
        pmtg_mode: :boost,
        pmtg_margin_threshold: 0.15,
        pmtg_window_keep: 50
  """</p><p class="whitespace-pre-wrap break-words">  ## Region GenServer for status/config/telemetry (stage stays pure)
  use Brain, region: :lifg
                                                                        # ── Optional server API (convenience) ─────────────────────────────────
  def status(server \\ <u>MODULE</u>), do: GenServer.call(server, :status)                                                                     
  def reload_config(new_opts, server \\ <u>MODULE</u>) when is_list(new_opts) or is_map(new_opts) do
    GenServer.cast(server, {:reload_config, Map.new(new_opts)})
  end</p><p class="whitespace-pre-wrap break-words">  @impl true
  def handle_cast({:reload_config, new_opts}, state) do
    {:noreply, %{state | opts: Map.merge(state.opts || %{}, Map.new(new_opts))}}
  end</p><p class="whitespace-pre-wrap break-words">  # ── Legacy pure Stage-1 API ──────────────────────────────────────────</p><p class="whitespace-pre-wrap break-words">  @doc "Pure, stateless stage-1. Appends a trace event with choices/boosts/inhibitions."
  @spec disambiguate_stage1(map()) :: map()
  def disambiguate_stage1(si) when is_map(si), do: disambiguate_stage1(si, [])</p><p class="whitespace-pre-wrap break-words">  @doc """
  Pure stage-1 with options:
    * <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:weights</code>           — override weights map (outer {lex, sim, rel, prag, act, prime})
    * <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:margin_threshold</code>  — default 0.12
    * <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:scores</code>            — :all | :top2 | :none (default :all)
    * <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:fit?</code>              — (cand, si) -&gt; boolean (default fn -&gt; true end)
    * <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:max_flips</code>         — reanalysis cap (default 1) [stubbed]
    * <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:prime</code>             — priming options (stubbed; no-op)
  """
  @spec disambiguate_stage1(map(), keyword()) :: map()
  def disambiguate_stage1(%{} = si, opts) do
    # 1) Tripwire (stub)
    tokens =
      si
      |&gt; Map.get(:tokens, [])
      |&gt; tripwire_check_and_filter(on_leak: :drop)</p><p class="whitespace-pre-wrap break-words">    ctx = Map.get(si, :context_vec, nil)
    ctxn = if is_list(ctx), do: l2(ctx), else: 0.0</p><p class="whitespace-pre-wrap break-words">    # 2) Candidate source: prefer slate ; else from active_cells
    candidates =
      case Map.get(si, :sense_candidates) do
        slate when is_map(slate) and map_size(slate) &gt; 0 -&gt;
          candidates_from_slate(si, slate, tokens)</p><p class="whitespace-pre-wrap break-words">        _ -&gt;
          candidates_from_cells(si, tokens)
      end</p><p class="whitespace-pre-wrap break-words">    # 3) Score + normalize per token group, pick winners (+ minimal reanalysis)
    weights = resolved_weights(opts)
    {choices, boosts, inhibitions} =
      disambiguate_groups(tokens, candidates, ctx, ctxn, weights, opts)</p><p class="whitespace-pre-wrap break-words">    # 4) Build trace event
    ev = %{
      stage: :lifg_stage1,
      ts_ms: System.system_time(:millisecond),
      normalize: :softmax,
      scores_mode: Keyword.get(opts, :scores, :all),
      ctx_dim: (is_list(ctx) &amp;&amp; length(ctx)) || 0,
      groups: candidates |&gt; Enum.map(&amp; &amp;1.token_index) |&gt; MapSet.new() |&gt; MapSet.size(),
      choices: choices,
      boosts: boosts,
      inhibitions: inhibitions
    }</p><p class="whitespace-pre-wrap break-words">    trace = [ev | Map.get(si, :trace, [])]
    Map.put(si, :trace, trace)
  end</p><p class="whitespace-pre-wrap break-words">  # Back-compat shim if callers pass (si, ctx, opts)
  @spec disambiguate_stage1(map(), any(), keyword()) :: map()
  def disambiguate_stage1(si, _ctx, opts), do: disambiguate_stage1(si, opts)</p><p class="whitespace-pre-wrap break-words">  # ── Candidate sources (legacy pure stage) ────────────────────────────</p><p class="whitespace-pre-wrap break-words">defp candidates_from_slate(si, slate, tokens) do
  Enum.flat_map(slate, fn {idx, list} -&gt;
    lemma = lemma_for(tokens, idx)</p><p class="whitespace-pre-wrap break-words">    Enum.map(List.wrap(list), fn c -&gt;
      feats = Map.get(c, :features, %{}) || %{}</p><p class="whitespace-pre-wrap break-words">      %{
        id: c.id,
        token_index: idx,
        lemma: lemma || "",
        pos: Map.get(feats, :pos),
        lex_fit: Map.get(feats, :lex_fit, 0.6),
        rel_prior: Map.get(c, :prior, 0.5),
        intent_bias: intent_bias_from(si, idx, feats),
        activation: Map.get(feats, :activation, 0.0),
        embedding: Map.get(feats, :embedding)
      }
    end)
  end)
end</p><p class="whitespace-pre-wrap break-words">  # NOTE: strict MWE/unigram matching to avoid cross-token leakage.
defp candidates_from_cells(si, tokens) do
  cells = Map.get(si, :active_cells, [])</p><p class="whitespace-pre-wrap break-words">  norm = fn s -&gt;
    s
    |&gt; to_b()
    |&gt; String.downcase()
    |&gt; String.replace(~r/\s+/, " ")
    |&gt; String.trim()
  end</p><p class="whitespace-pre-wrap break-words">  # Pre-normalize cell info; no token index here yet.
  cells_normed =
    Enum.map(cells, fn m -&gt;
      word  = getf(m, :word) || ""
      lemma = getf(m, :lemma) || word
      nrm   = getf(m, :norm)  || word</p><p class="whitespace-pre-wrap break-words">      %{
        id:           getf(m, :id),
        pos:          getf(m, :pos),
        lex_fit:      getf(m, :lex_fit),
        rel_prior:    getf(m, :rel_prior),
        intent_bias:  getf(m, :intent_bias),
        activation:   getf(m, :activation),
        embedding:    getf(m, :embedding),
        definition:   getf(m, :definition),
        <u>norm</u>:     norm.(nrm),
        <u>lemma</u>:    lemma
      }
    end)</p><p class="whitespace-pre-wrap break-words">  tokens
  |&gt; Enum.with_index()
  |&gt; Enum.flat_map(fn {t, idx} -&gt;
    tnorm = norm.(Map.get(t, :phrase, ""))</p><p class="whitespace-pre-wrap break-words">    cells_normed
    |&gt; Enum.filter(fn c -&gt;
      c.<u>norm</u> == tnorm or
        String.contains?(tnorm, c.<u>norm</u>) or
        String.contains?(c.<u>norm</u>, tnorm)
    end)
    |&gt; Enum.map(fn c -&gt;
      %{
        id:          c.id,
        token_index: idx,
        lemma:       c.<u>lemma</u> || "",
        pos:         c.pos,
        lex_fit:     c.lex_fit || 0.6,
        rel_prior:   c.rel_prior || 0.5,
        intent_bias: (c.intent_bias || 0.0) +
                       intent_bias_from(si, idx, %{pos: c.pos, definition: c.definition}),
        activation:  c.activation || 0.0,
        embedding:   c.embedding
      }
    end)
  end)
end</p><p class="whitespace-pre-wrap break-words">  defp lex_fit_from_phrase(phrase, lemma) do
    p = String.downcase(to_b(phrase))
    l = String.downcase(to_b(lemma))
    cond do
      p == "" or l == "" -&gt; 0.60
      p == l             -&gt; 1.00
      String.contains?(p, l) -&gt; 0.85
      String.contains?(l, p) -&gt; 0.75
      true                  -&gt; 0.60
    end
  end</p><p class="whitespace-pre-wrap break-words"># was: defp intent_bias_from(_si, _cand, _feats), do: 0.0
defp intent_bias_from(si, idx, feats_or_map) do
  tokens = Map.get(si, :tokens, [])
  cur    = Enum.at(tokens, idx) || %{}
  prev   = Enum.at(tokens, idx - 1) || %{}</p><p class="whitespace-pre-wrap break-words">  phrase = (cur[:phrase] || cur["phrase"] || "") |&gt; to_b()
  prev_w = (prev[:phrase] || prev["phrase"] || "") |&gt; to_b() |&gt; String.downcase()</p><p class="whitespace-pre-wrap break-words">  pos  =
    (getf(feats_or_map, :pos) || getf(feats_or_map, "pos") || "")
    |&gt; to_b() |&gt; String.downcase()</p><p class="whitespace-pre-wrap break-words">  defn =
    (getf(feats_or_map, :definition) || getf(feats_or_map, "definition") || "")
    |&gt; to_b() |&gt; String.downcase()</p><p class="whitespace-pre-wrap break-words">  at<em>start? = match?(%{span: {0, </em>}}, cur) or (cur[:index] || cur["index"] || 0) == 0</p><p class="whitespace-pre-wrap break-words">  bias = 0.0
  # Salutation: “hello/hi/hey …” → favor interjection at start
  bias =
    if at_start? and Regex.match?(~r/^(hello|hi|hey)\b/i, phrase) and String.contains?(pos, "interjection"),
      do: bias + 0.20, else: bias</p><p class="whitespace-pre-wrap break-words">  # Definitions gated by “(with "the")” → slightly penalize if not preceded by “the”
  bias =
    if String.contains?(defn, ~s|(with "the")|) and prev_w != "the",
      do: bias - 0.15, else: bias</p><p class="whitespace-pre-wrap break-words">  bias
end</p><p class="whitespace-pre-wrap break-words">  # ── Group scoring (legacy pure stage) ───────────────────────────────</p><p class="whitespace-pre-wrap break-words">defp disambiguate_groups(tokens, candidates, ctx, ctxn, weights, opts) do
  groups = Enum.group_by(candidates, &amp; &amp;1.token_index)</p><p class="whitespace-pre-wrap break-words">  scores_mode      = Keyword.get(opts, :scores, :all)
  margin_threshold = Keyword.get(opts, :margin_threshold, 0.12)
  fit?             = Keyword.get(opts, :fit?, fn _cand, _si -&gt; true end)
  prime_opts       = Keyword.get(opts, :prime, [])</p><p class="whitespace-pre-wrap break-words">  {choices, losers} =
    Enum.map_reduce(groups, MapSet.new(), fn {tidx, cands0}, acc<em>losers -&gt;
      tok =
        case Enum.at(tokens, tidx) do
          %{} = t -&gt; t
          </em> -&gt; %{}
        end</p><p class="whitespace-pre-wrap break-words">      # sanitize: drop nil/id-less, de-dup by id, then apply MWE↔sense compatibility
      cands =
        cands0
        |&gt; Enum.reject(&amp;is_nil/1)
        |&gt; Enum.reject(&amp;(is_nil(&amp;1.id)))
        |&gt; Enum.uniq_by(&amp; &amp;1.id)
        |&gt; filter_candidates_for_token(tok) # &lt;- prefers MWE senses for MWEs; safe fallback inside</p><p class="whitespace-pre-wrap break-words">      {_cand_feats, normed} = score_and_normalize(cands, ctx, ctxn, weights, prime_opts)</p><p class="whitespace-pre-wrap break-words">      {best_c, best_f} = best_of_normed(normed)</p><p class="whitespace-pre-wrap break-words">      {winner_c, winner_f} =
        case best_c do
          nil -&gt; {nil, %{score_norm: 0.0, sim: 0.0, score_raw: 0.0}}
          bc  -&gt;
            if fit?.(bc, %{}) do
              {bc, best_f}
            else
              best_of_normed(Enum.drop(normed, 1))
            end
        end</p><p class="whitespace-pre-wrap break-words">      {_ru_c, ru_f} =
        case normed do
          [_only]           -&gt; {nil, %{score<em>norm: 0.0}}
          [</em>, {c2, f2} | <em>] -&gt; {c2, f2}
          </em>                 -&gt; {nil, %{score_norm: 0.0}}
        end</p><p class="whitespace-pre-wrap break-words">      margin = (winner_f[:score_norm] || 0.0) - (ru_f[:score_norm] || 0.0)</p><p class="whitespace-pre-wrap break-words">      # build alt ids from top-2 if margin below threshold
      alt_ids =
        if margin &lt; margin_threshold and length(normed) &gt; 1 do
          case Enum.sort_by(normed, fn {_c, f} -&gt; -f.score_norm end) do
            [<em>first, {c2, </em>} | <em>] -&gt; [c2.id]
            </em> -&gt; []
          end
        else
          []
        end</p><p class="whitespace-pre-wrap break-words">      if winner_c, do: priming_bump(winner_c.id, prime_opts)</p><p class="whitespace-pre-wrap break-words">      lemma = lemma_for(tokens, tidx) || (winner_c &amp;&amp; (winner_c[:lemma] || "")) || ""</p><p class="whitespace-pre-wrap break-words">      # cache sorted once for :top2 to avoid double sorts
      sorted_normed = if scores_mode == :all, do: [], else: Enum.sort_by(normed, fn {_c, f} -&gt; -f.score_norm end)</p><p class="whitespace-pre-wrap break-words">      scores =
        case scores_mode do
          :all -&gt;
            normed |&gt; Map.new(fn {c, f} -&gt; {c.id, f.score_norm} end)</p><p class="whitespace-pre-wrap break-words">          :top2 -&gt;
            case sorted_normed do
              []                       -&gt; %{}
              [{c1, f1}]               -&gt; %{c1.id =&gt; f1.score<em>norm}
              [{c1, f1}, {c2, f2} | </em>] -&gt; %{c1.id =&gt; f1.score_norm, c2.id =&gt; f2.score_norm}
            end</p><p class="whitespace-pre-wrap break-words">          _ -&gt;
            %{}
        end</p><p class="whitespace-pre-wrap break-words">      choice = %{
        token_index: tidx,
        lemma: lemma,
        chosen_id: winner_c &amp;&amp; winner_c.id,
        alt_ids: alt_ids,
        scores: scores,
        margin: margin,
        features:
          winner_c &amp;&amp; %{
            sim: winner_f.sim,
            score_raw: winner_f.score_raw,
            score_norm: winner_f.score_norm,
            pos: winner_c[:pos],
            lex_fit: winner_c[:lex_fit],
            rel_prior: winner_c[:rel_prior],
            intent_bias: winner_c[:intent_bias],
            activation: winner_c[:activation]
          } || %{}
      }</p><p class="whitespace-pre-wrap break-words">      losers_here =
        case winner_c do
          nil -&gt; MapSet.new()
          wc  -&gt; cands |&gt; Enum.filter(&amp;(&amp;1.id != wc.id)) |&gt; Enum.map(&amp; &amp;1.id) |&gt; MapSet.new()
        end</p><p class="whitespace-pre-wrap break-words">      {choice, MapSet.union(acc_losers, losers_here)}
    end)</p><p class="whitespace-pre-wrap break-words">  choices = Enum.sort_by(choices, &amp; &amp;1.token_index)</p><p class="whitespace-pre-wrap break-words">  boosts      = for ch &lt;- choices, ch.chosen_id, do: {ch.chosen_id, +0.5}
  inhibitions = Enum.map(losers, &amp;{&amp;1, -0.25})</p><p class="whitespace-pre-wrap break-words">  {choices, boosts, inhibitions}
end</p><p class="whitespace-pre-wrap break-words">  defp score_and_normalize(cands, ctx, ctxn, weights, prime_opts) do
    w_prime = Map.get(weights, :prime, 0.0) * 1.0</p><p class="whitespace-pre-wrap break-words">    cand_feats =
      Enum.map(cands, fn cand -&gt;
        sim =
          case cand.embedding do
            nil -&gt; 0.0
            vec -&gt; cosine_with_ctxnorm(vec, ctx, ctxn)
          end</p><p class="whitespace-pre-wrap break-words">        prime =
          if w_prime == 0.0, do: 0.0, else: priming_boost_for(to_string(Map.get(cand, :id, "")), prime_opts)</p><p class="whitespace-pre-wrap break-words">        score =
          weights.lex * safe_num(cand.lex_fit) +
            weights.sim * sim +
            weights.rel * safe_num(cand.rel_prior) +
            weights.prag * safe_num(cand.intent_bias) +
            weights.act * safe_num(cand.activation) +
            w_prime * prime</p><p class="whitespace-pre-wrap break-words">        {cand, %{sim: sim, score_raw: score}}
      end)</p><p class="whitespace-pre-wrap break-words">    normed_vals = normalize_scores(Enum.map(cand_feats, fn {_c, f} -&gt; f.score_raw end))</p><p class="whitespace-pre-wrap break-words">    normed =
      Enum.zip(cand_feats, normed_vals)
      |&gt; Enum.map(fn {{cand, feats}, s_norm} -&gt; {cand, Map.put(feats, :score_norm, s_norm)} end)</p><p class="whitespace-pre-wrap break-words">    {cand_feats, normed}
  end</p><p class="whitespace-pre-wrap break-words">  defp best_of_normed([]), do: {nil, %{score_norm: 0.0}}
  defp best_of_normed(list), do: Enum.max_by(list, fn {_c, f} -&gt; f.score_norm end, fn -&gt; hd(list) end)</p><p class="whitespace-pre-wrap break-words">  defp phrase_for(tokens, idx) do
    case Enum.at(tokens, idx) do
      %{phrase: p} when is<em>binary(p) -&gt; p
      </em> -&gt; nil
    end
  end</p><p class="whitespace-pre-wrap break-words">  defp lemma_for(tokens, idx), do: phrase_for(tokens, idx)</p><p class="whitespace-pre-wrap break-words">  # ── Tripwire/Reanalysis/Priming — stubs ─────────────────────────────
  defp tripwire_check_and_filter(tokens, _opts), do: tokens
  defp priming_bump(_id, _opts), do: :ok
  defp priming_boost_for(_id, _opts), do: 0.0</p><p class="whitespace-pre-wrap break-words">  # ── Math &amp; utils (legacy pure) ──────────────────────────────────────</p><p class="whitespace-pre-wrap break-words">  @abs_eps 1.0e-15
  @rel_eps 1.0e-12</p><p class="whitespace-pre-wrap break-words">  defp zeroish?(x, scale) when is_float(x) do
    ax = abs(x)
    ax &lt;= @abs_eps or ax &lt;= @rel_eps * max(1.0, abs(scale))
  end</p><p class="whitespace-pre-wrap break-words">  @doc "Cosine similarity; 0.0 on nil/zero-norm."
  @spec cosine([number()] | nil, [number()] | nil) :: float()
  def cosine(nil, <em>), do: 0.0
  def cosine(</em>, nil), do: 0.0
  def cosine(a, b) when is_list(a) and is_list(b) do
    num = dot(a, b)
    den = l2(a) * l2(b)
    if zeroish?(den, den), do: 0.0, else: num / den
  end</p><p class="whitespace-pre-wrap break-words">  @spec normalize_scores([number()]) :: [float()]
  def normalize_scores(scores) do
    m = Enum.max([0.0 | scores])
    exps = Enum.map(scores, fn s -&gt; :math.exp(s - m) end)
    z = Enum.sum(exps)
    if zeroish?(z, z), do: List.duplicate(0.0, length(scores)), else: Enum.map(exps, &amp;(&amp;1 / z))
  end</p><p class="whitespace-pre-wrap break-words">  defp cosine_with_ctxnorm(vec, ctx, ctxn) do
    cond do
      is_nil(vec) or is_nil(ctx) -&gt; 0.0
      zeroish?(ctxn, ctxn) -&gt; 0.0
      true -&gt;
        na = l2(vec)
        den = na * ctxn
        if zeroish?(den, den), do: 0.0, else: dot(vec, ctx) / den
    end
  end</p><p class="whitespace-pre-wrap break-words">  defp dot(a, b), do: Enum.zip(a, b) |&gt; Enum.reduce(0.0, fn {x, y}, acc -&gt; acc + x * y end)
  defp l2(v), do: v |&gt; Enum.reduce(0.0, fn x, acc -&gt; acc + x * x end) |&gt; :math.sqrt()
  defp safe_num(nil), do: 0.0
  defp safe_num(x) when is_number(x), do: x * 1.0
  defp getf(m, k) when is_atom(k), do: Map.get(m, k) || Map.get(m, Atom.to_string(k))
  defp getf(m, k) when is_binary(k), do: Map.get(m, k)
  defp to_b(nil), do: ""
  defp to_b(v) when is_binary(v), do: v
  defp to_b(v), do: Kernel.to_string(v)</p><p class="whitespace-pre-wrap break-words">  # --- Confidence helpers (pure) ---
  @doc "Return p(top1) from a LIFG choice (max over normalized scores)."
  def top1_prob(choice) do
    choice |&gt; Map.get(:scores, %{}) |&gt; Map.values() |&gt; Enum.max(fn -&gt; 0.0 end)
  end</p><p class="whitespace-pre-wrap break-words">  @doc """
  Low-confidence predicate used by pMTG gate.
  Defaults: tau_confident=0.20, p_min=0.65. Returns true when pMTG should fire.
  """
  def low_confidence?(choice, opts \\ []) do
    tau   = Keyword.get(opts, :tau_confident, 0.20)
    p_min = Keyword.get(opts, :p_min, 0.65)
    m     = Map.get(choice, :margin, 0.0)
    p1    = top1_prob(choice)
    alts? = (choice[:alt_ids] || []) != []
    (m &lt; tau) or (p1 &lt; p_min) or alts?
  end
# near other privates
defp sense_lemma(c) do
  (Map.get(c, :lemma) ||
     get_in(c, [:features, :lemma]) ||
     get_in(c, ["features", "lemma"]) ||
     Map.get(c, :word))
  |&gt; case do
    nil -&gt; nil
    ""  -&gt; nil
    v   -&gt; to_string(v)
  end
end</p><p class="whitespace-pre-wrap break-words">defp filter_candidates_for_token(list, tok) when is_list(list) do
  # MWE token if n&gt;1 or explicit :mw flag
  mwe? = (Map.get(tok, :n, 1) &gt; 1) or (Map.get(tok, :mw) in [true, "true"])</p><p class="whitespace-pre-wrap break-words">  have_lemma? = Enum.any?(list, &amp;(!is_nil(sense_lemma(&amp;1))))</p><p class="whitespace-pre-wrap break-words">  kept =
    Enum.filter(list, fn c -&gt;
      case sense_lemma(c) do
        nil     -&gt; true            # no lemma info? keep to be safe
        lemma   -&gt;
          has_space = String.contains?(lemma, " ")
          if mwe?, do: has_space, else: not has_space
      end
    end)</p><p class="whitespace-pre-wrap break-words">  # safe fallback: if the filter nuked everything but we had lemmas, keep original list
  if have_lemma? and kept == [], do: list, else: kept
end</p><p class="whitespace-pre-wrap break-words">defp filter_candidates_for_token(list, _tok), do: list</p><p class="whitespace-pre-wrap break-words">  ##===================== HYGIENE (optional helper) =====================
  defmodule <u>MODULE</u>.Hygiene do
    @moduledoc """
    Post-Stage-1 hygiene pass:
      • Sanitizes score maps (drops non-numeric/NaN)
      • Computes softmax probabilities as <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:probs</code>
      • Adds <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:p_top1</code>
      • Dedups <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:alt_ids</code>
      • Flags <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:needs_rerun</code> (by margin/p_top1/alt_ids)
      • Emits telemetry: [:brain, :hygiene, :wipe]
    """</p><p class="whitespace-pre-wrap break-words">    @type choice :: map()</p><p class="whitespace-pre-wrap break-words">    @spec run(map(), [choice()], keyword()) ::
            {:ok, %{si: map(), choices: [choice()], audit: map()}}
    def run(si, choices, opts \\ []) when is_list(choices) do
      min_margin =
        Keyword.get(opts, :min_margin, Application.get_env(:brain, :lifg_min_margin, 0.12))</p><p class="whitespace-pre-wrap break-words">      p_min =
        Keyword.get(opts, :p_min, Application.get_env(:brain, :lifg_min_p_top1, 0.65))</p><p class="whitespace-pre-wrap break-words">      event = Keyword.get(opts, :event, [:brain, :hygiene, :wipe])
      now_ms = System.system_time(:millisecond)</p><p class="whitespace-pre-wrap break-words">      {cleaned, stats} =
        Enum.map_reduce(choices, %{sanitized: 0, needs_rerun: 0}, fn ch, acc -&gt;
          {probs, dropped} = normalize_scores_map(Map.get(ch, :scores, %{}))
          p1 = max_prob(probs)</p><p class="whitespace-pre-wrap break-words">          alt_ids2 =
            (ch[:alt_ids] || [])
            |&gt; Enum.reject(&amp;(&amp;1 == ch[:chosen_id]))
            |&gt; Enum.uniq()</p><p class="whitespace-pre-wrap break-words">          needs? =
            (ch[:margin] || 0.0) &lt; min_margin or
              p1 &lt; p_min or
              alt_ids2 != []</p><p class="whitespace-pre-wrap break-words">          ch2 =
            ch
            |&gt; Map.put(:alt_ids, alt_ids2)
            |&gt; Map.put(:probs, probs)
            |&gt; Map.put(:p_top1, p1)
            |&gt; Map.put(:needs_rerun, needs?)</p><p class="whitespace-pre-wrap break-words">          acc2 =
            acc
            |&gt; Map.update!(:sanitized, &amp;(&amp;1 + dropped))
            |&gt; Map.update!(:needs_rerun, &amp;(&amp;1 + if(needs?, do: 1, else: 0)))</p><p class="whitespace-pre-wrap break-words">          {ch2, acc2}
        end)</p><p class="whitespace-pre-wrap break-words">      meas = %{total: length(choices), sanitized: stats.sanitized, needs_rerun: stats.needs_rerun, ts_ms: now_ms}
      emit(event, meas, %{min_margin: min_margin, p_min: p_min})
      {:ok, %{si: si, choices: cleaned, audit: meas}}
    end</p><p class="whitespace-pre-wrap break-words">    defp normalize_scores_map(map) when is_map(map) do
      pairs =
        map
        |&gt; Enum.filter(fn {_k, v} -&gt; is_number(v) and v == v end) # (v==v) filters NaN</p><p class="whitespace-pre-wrap break-words">      dropped = map<em>size(map) - length(pairs)
      vals = Enum.map(pairs, fn {</em>, v} -&gt; v end)</p><p class="whitespace-pre-wrap break-words">      probs =
        case vals do
          [] -&gt; %{}
          _ -&gt;
            m = Enum.max([0.0 | vals])
            exps = Enum.map(vals, fn s -&gt; :math.exp(s - m) end)
            z = Enum.sum(exps)</p><p class="whitespace-pre-wrap break-words">            if z == 0.0 do
              Map.new(pairs, fn {k, <em>} -&gt; {k, 0.0} end)
            else
              pairs |&gt; Enum.zip(exps) |&gt; Map.new(fn {{k, </em>}, e} -&gt; {k, e / z} end)
            end
        end</p><p class="whitespace-pre-wrap break-words">      {probs, dropped}
    end</p><p class="whitespace-pre-wrap break-words">    defp max_prob(%{} = probs), do: probs |&gt; Map.values() |&gt; Enum.max(fn -&gt; 0.0 end)</p><p class="whitespace-pre-wrap break-words">    defp emit(ev, meas, meta) do
      if Code.ensure_loaded?(:telemetry) and function_exported?(:telemetry, :execute, 3) do
        :telemetry.execute(ev, meas, meta)
      else
        :ok
      end
    end
  end</p><p class="whitespace-pre-wrap break-words">  ##===================== TOKEN GUARD (compat) ==========================
  defmodule <u>MODULE</u>.Guard do
    @moduledoc """
    Compatibility shim for Core.LIFG.Input.
    Ensures maps, index, and optional span-sort.
    """
    @spec sanitize(list()) :: list()
    def sanitize(tokens) when is_list(tokens) do
      tokens
      |&gt; Enum.map(&amp;mapify/1)
      |&gt; ensure_indexed()
      |&gt; sort_by_span_if_present()
    end</p><p class="whitespace-pre-wrap break-words">    defp mapify(t) when is<em>map(t), do: t
    defp mapify(%</em>{} = s), do: Map.from_struct(s)
    defp mapify(other), do: %{phrase: to_string(other)}</p><p class="whitespace-pre-wrap break-words">    defp ensure_indexed(list) do
      list
      |&gt; Enum.with_index()
      |&gt; Enum.map(fn {t, i} -&gt;
        Map.put_new(t, :index, Map.get(t, :index) || Map.get(t, "index") || i)
      end)
    end</p><p class="whitespace-pre-wrap break-words">    defp sort_by_span_if_present(list) do
      if Enum.all?(list, &amp;valid_span?/1), do: Enum.sort_by(list, &amp;elem(Map.fetch!(&amp;1, :span), 0)), else: list
    end</p><p class="whitespace-pre-wrap break-words">    defp valid_span?(%{span: {s, l}}) when is_integer(s) and is_integer(l) and l &gt; 0, do: true
    defp valid<em>span?(</em>), do: false
  end</p><p class="whitespace-pre-wrap break-words">  ##================== TOKEN BOUNDARY GUARD (compat) ====================
  defmodule <u>MODULE</u>.BoundaryGuard do
    @moduledoc """
    Minimal boundary + char-gram guard (keeps MWEs).
    """
    @type token :: map()
    @spec sanitize([token()]) :: [token()]
    def sanitize(tokens), do: sanitize(tokens, nil)</p><p class="whitespace-pre-wrap break-words">    @spec sanitize([token()], String.t() | nil) :: [token()]
    def sanitize(tokens, sentence) when is_list(tokens) do
      tokens
      |&gt; Enum.map(&amp;mapify/1)
      |&gt; Enum.reject(&amp;chargram?/1)
      |&gt; Enum.filter(fn t -&gt;
        mw? = truthy(Map.get(t, :mw) || Map.get(t, "mw"))
        case {Map.get(t, :span) || Map.get(t, "span"), sentence} do
          {{s, l}, snt} when is_integer(s) and is_integer(l) and l &gt; 0 and is_binary(snt) -&gt;
            boundary<em>aligned?(snt, s, l) or mw?
          </em> -&gt; true
        end
      end)
      |&gt; sort_by_span_if_present()
    end</p><p class="whitespace-pre-wrap break-words">    defp mapify(%_{} = s), do: Map.from_struct(s)
    defp mapify(%{} = m), do: m
    defp mapify(other), do: %{phrase: to_string(other)}</p><p class="whitespace-pre-wrap break-words">    defp chargram?(t),
      do:
        (Map.get(t, :chargram) in [true, "true"]) or
        (Map.get(t, :kind) in [:chargram, "chargram"]) or
        (Map.get(t, :source) in [:chargram, "chargram"])</p><p class="whitespace-pre-wrap break-words">    defp sort_by_span_if_present(list) do
      if Enum.all?(list, &amp;valid_span?/1), do: Enum.sort_by(list, &amp;elem(Map.fetch!(&amp;1, :span), 0)), else: list
    end</p><p class="whitespace-pre-wrap break-words">    defp valid_span?(%{span: {s, l}}) when is_integer(s) and is_integer(l) and l &gt; 0, do: true
    defp valid<em>span?(</em>), do: false</p><p class="whitespace-pre-wrap break-words">    defp boundary_aligned?(snt, s, l) do
      left = s - 1
      right = s + l
      left_ok = s == 0 or not word_char?(String.slice(snt, left, 1))
      right_ok = right &gt;= String.length(snt) or not word_char?(String.slice(snt, right, 1))
      left_ok and right_ok
    end</p><p class="whitespace-pre-wrap break-words">    defp word_char?(nil), do: false
    defp word_char?(""), do: false
    defp word<em>char?(ch), do: Regex.match?(~r/^[\p{L}\p{N}]$/u, ch)
    defp truthy(true), do: true
    defp truthy("true"), do: true
    defp truthy(</em>), do: false
  end</p><p class="whitespace-pre-wrap break-words">  ##========================= STAGE 1 (new) ============================
  defmodule <u>MODULE</u>.Stage1 do
    @moduledoc """
    Stage 1 — fast per-token disambiguation from <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">si.sense_candidates</code>.</p><p class="whitespace-pre-wrap break-words">    Options:
      :weights          — %{lex_fit, rel_prior, activation, intent_bias}
      :scores           — :all | :top2 | :none (default from <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">:lifg_stage1_scores_mode</code>)
      :chargram_event   — telemetry (default [:brain, :lifg, :chargram_violation])
      :boundary_event   — telemetry (default [:brain, :lifg, :boundary_drop])
      :margin_threshold — default 0.15 (for alt_id emission)
    """</p><p class="whitespace-pre-wrap break-words">    @small_k_cutoff 4</p><p class="whitespace-pre-wrap break-words">    @type si :: map()
    @type choice :: %{
            required(:token_index) =&gt; non_neg_integer(),
            required(:chosen_id)   =&gt; String.t(),
            required(:alt_ids)     =&gt; [String.t()],
            required(:margin)      =&gt; float(),
            optional(:scores)      =&gt; map()
          }</p><p class="whitespace-pre-wrap break-words">    @spec run(si(), keyword()) :: {:ok, %{si: si(), choices: [choice()], audit: map()}}
    def run(si, opts \\ []) when is_map(si) and is_list(opts) do
      t0 = System.monotonic_time()</p><p class="whitespace-pre-wrap break-words">      tokens = Map.get(si, :tokens, [])
      slate  = Map.get(si, :sense_candidates, Map.get(si, :candidates_by_token, %{}))</p><p class="whitespace-pre-wrap break-words">      {kept_tokens, dropped} = guard_tokens(tokens, si, opts)</p><p class="whitespace-pre-wrap break-words">      scores_mode =
        Keyword.get(opts, :scores, Application.get_env(:brain, :lifg_stage1_scores_mode, :all))</p><p class="whitespace-pre-wrap break-words">      margin_threshold = Keyword.get(opts, :margin_threshold, 0.15)</p><p class="whitespace-pre-wrap break-words">      choices =
        kept_tokens
        |&gt; Enum.map(fn tok -&gt;
          disambiguate_token(
            tok,
            Map.get(slate, tok.index, []),
            scores: scores_mode,
            margin_threshold: margin_threshold,
            weights: Keyword.get(opts, :weights, %{})
          )
        end)
        |&gt; Enum.reject(&amp;is_nil/1)</p><p class="whitespace-pre-wrap break-words">      timing_ms =
        System.convert_time_unit(System.monotonic_time() - t0, :native, :millisecond)</p><p class="whitespace-pre-wrap break-words">      audit = %{
        stage: :lifg_stage1,
        token_count: length(tokens),
        kept_tokens: length(kept_tokens),
        dropped_tokens: length(dropped),
        timing_ms: timing_ms
      }</p><p class="whitespace-pre-wrap break-words">      {:ok, %{si: si, choices: choices, audit: audit}}
    end</p><p class="whitespace-pre-wrap break-words">    # Back-compat shim (si, ctx, opts)
    @spec run(si(), map(), keyword()) :: {:ok, %{si: si(), choices: [choice()], audit: map()}}
    def run(si, _ctx, opts), do: run(si, opts)</p><p class="whitespace-pre-wrap break-words">    # ── Guards ─────────────────────────────────────────────────────────</p><p class="whitespace-pre-wrap break-words">    defp guard_tokens(tokens, si, opts) do
      char_ev = Keyword.get(opts, :chargram_event, [:brain, :lifg, :chargram_violation])
      bnd_ev  = Keyword.get(opts, :boundary_event,  [:brain, :lifg, :boundary_drop])</p><p class="whitespace-pre-wrap break-words">      Enum.reduce(tokens, {[], []}, fn tok, {kept, dropped} -&gt;
        cond do
          is_chargram?(tok) -&gt;
            emit(char_ev, %{token_index: tok[:index], phrase: tok[:phrase]}, %{})
            {kept, [tok | dropped]}</p><p class="whitespace-pre-wrap break-words">          not boundary_ok?(tok, si) -&gt;
            emit(bnd_ev, %{token_index: tok[:index], phrase: tok[:phrase]}, %{})
            {kept, [tok | dropped]}</p><p class="whitespace-pre-wrap break-words">          true -&gt;
            {[tok | kept], dropped}
        end
      end)
      |&gt; (fn {k, d} -&gt; {Enum.reverse(k), Enum.reverse(d)} end).()
    end</p><p class="whitespace-pre-wrap break-words">    defp is_chargram?(tok) do
      (Map.get(tok, :source) in [:chargram, "chargram"]) or
        (Map.get(tok, :kind)   in [:chargram, "chargram"]) or
        (Map.get(tok, :chargram) in [true, "true"])
    end</p><p class="whitespace-pre-wrap break-words">    defp boundary_ok?(tok, si) do
      # MWEs bypass strictness
      mw? = Map.get(tok, :mw) || Map.get(tok, "mw") || false
      if mw?, do: true, else: do_boundary_check(tok, si)
    end</p><p class="whitespace-pre-wrap break-words">    defp do_boundary_check(tok, si) do
      sent = Map.get(si, :sentence)
      span = Map.get(tok, :span) || Map.get(tok, "span")</p><p class="whitespace-pre-wrap break-words">      cond do
        not is_binary(sent) -&gt; true
        not (is_tuple(span) and tuple_size(span) == 2) -&gt; true
        true -&gt;
          {start, len} = span
          start = as_int(start, 0)
          len   = as_int(len, 0)
          stop  = start + len
          s_len = byte_size(sent)</p><p class="whitespace-pre-wrap break-words">          left_ok?  = start &lt;= 0 or not letter?(String.at(sent, start - 1))
          right_ok? = stop &gt;= s_len or not letter?(String.at(sent, stop))</p><p class="whitespace-pre-wrap break-words">          left_ok? and right_ok?
      end
    end</p><p class="whitespace-pre-wrap break-words">    defp letter?(nil), do: false
    defp letter?(&lt;&lt;c::utf8&gt;&gt;), do: unicode_letter?(c)
    defp unicode_letter?(cp),
      do: (cp &gt;= ?A and cp &lt;= ?Z) or (cp &gt;= ?a and cp &lt;= ?z) or (cp &gt;= ?À and cp &lt;= 0x024F)</p><p class="whitespace-pre-wrap break-words">    # ── Disambiguation per token (hybrid) ──────────────────────────────</p><p class="whitespace-pre-wrap break-words">    defp disambiguate_token(%{} = tok, cand_list, opts) when is_list(cand_list) do
      idx         = tok.index
      thr         = Keyword.get(opts, :margin_threshold, 0.15)
      scores_mode = Keyword.get(opts, :scores, :all)
      w           = weights(opts)</p><p class="whitespace-pre-wrap break-words">      # sanitize input candidates (nil/id-less/dupes) and apply tiny heuristics
      cand_list =
        cand_list
        |&gt; Enum.reject(&amp;is_nil/1)
        |&gt; Enum.reject(&amp;(is_nil(&amp;1.id)))
        |&gt; Enum.uniq_by(&amp; &amp;1.id)
        |&gt; prefer_salutation_interjection(tok)  # &lt;- list, tok (pipe-friendly)
        |&gt; prefer_pronoun_for_I(tok)
        |&gt; compat_filter_for_token(tok)</p><p class="whitespace-pre-wrap break-words">      score_cand = fn c -&gt;
        f = Map.get(c, :features, %{})
        %{
          id: c.id,
          score:
            w.lex_fit     * as_float(f[:lex_fit]     || f["lex_fit"]) +
            w.rel_prior   * as_float(f[:rel_prior]   || f["rel_prior"]) +
            w.activation  * as_float(f[:activation]  || f["activation"]) +
            w.intent_bias * as_float(f[:intent_bias] || f["intent_bias"])
        }
      end</p><p class="whitespace-pre-wrap break-words">      if length(cand_list) &lt;= @small_k_cutoff do
        scored =
          cand_list
          |&gt; Enum.map(score_cand)
          |&gt; Enum.sort_by(&amp;(-&amp;1.score))</p><p class="whitespace-pre-wrap break-words">        case scored do
          [] -&gt;
            nil</p><p class="whitespace-pre-wrap break-words">          [%{id: top_id, score: top_s} | rest] -&gt;
            rest_unique =
              rest
              |&gt; Enum.reject(&amp;(&amp;1.id == top_id))
              |&gt; Enum.uniq_by(&amp; &amp;1.id)</p><p class="whitespace-pre-wrap break-words">            second_s =
              case rest<em>unique do
                [%{score: s2} | </em>] -&gt; s2
                _ -&gt; 0.0
              end</p><p class="whitespace-pre-wrap break-words">            alt_ids =
              if max(top_s - second_s, 0.0) &lt; thr and rest_unique != [] do
                [hd(rest_unique).id]
              else
                []
              end</p><p class="whitespace-pre-wrap break-words">            %{
              token_index: idx,
              chosen_id: top_id,
              alt_ids: alt_ids,
              margin: max(top_s - second_s, 0.0),
              scores: build_scores_map(scored, scores_mode)
            }
        end
      else
        {best, second, scored_rev} =
          Enum.reduce(cand_list, {nil, nil, []}, fn c, {b1, b2, acc} -&gt;
            cur = score_cand.(c)
            scr = cur.score
            {nb1, nb2} =
              cond do
                b1 == nil or scr &gt; b1.score -&gt; {cur, b1}
                b2 == nil or scr &gt; b2.score -&gt; {b1, cur}
                true -&gt; {b1, b2}
              end
            {nb1, nb2, [cur | acc]}
          end)</p><p class="whitespace-pre-wrap break-words">        case best do
          nil -&gt;
            nil</p><p class="whitespace-pre-wrap break-words">          %{id: top_id, score: top_s} -&gt;
            second_s = (second &amp;&amp; second.score) || 0.0
            scored   = :lists.reverse(scored_rev)</p><p class="whitespace-pre-wrap break-words">            alt_ids =
              if max(top_s - second_s, 0.0) &lt; thr and second do
                [second.id]
              else
                []
              end</p><p class="whitespace-pre-wrap break-words">            %{
              token_index: idx,
              chosen_id: top_id,
              alt_ids: alt_ids,
              margin: max(top_s - second_s, 0.0),
              scores: build_scores_map(scored, scores_mode)
            }
        end
      end
    end</p><p class="whitespace-pre-wrap break-words">    # Prefer interjection “greeting” senses for salutations (“hello/hi/hey”), esp. at start
    defp prefer_salutation_interjection(list, tok) do
      phrase = (tok[:phrase] || "") |&gt; to_string()
      at<em>start =
        case tok[:span] do
          {0, </em>} -&gt; true
          _ -&gt; (tok[:index] || 0) == 0
        end</p><p class="whitespace-pre-wrap break-words">      sal? = Regex.match?(~r/^(hello|hi|hey)\b/i, phrase) or at_start</p><p class="whitespace-pre-wrap break-words">      if sal? do
        greet =
          Enum.filter(list, fn c -&gt;
            pos =
              (c[:pos] || get_in(c, [:features, :pos]) || "")
              |&gt; to_string() |&gt; String.downcase()</p><p class="whitespace-pre-wrap break-words">            defn =
              (c[:definition] || get_in(c, [:features, :definition]) || "")
              |&gt; to_string() |&gt; String.downcase()</p><p class="whitespace-pre-wrap break-words">            syns =
              (c[:synonyms] || get_in(c, [:features, :synonyms]) || [])
              |&gt; Enum.map(&amp;String.downcase/1)</p><p class="whitespace-pre-wrap break-words">            String.contains?(pos, "interjection") and
              (String.contains?(defn, "greet") or Enum.any?(syns, &amp;(&amp;1 == "greeting")))
          end)</p><p class="whitespace-pre-wrap break-words">        if greet != [], do: greet, else: list
      else
        list
      end
    end</p><p class="whitespace-pre-wrap break-words">    # Pronoun preference for the token exactly "I"
    defp prefer_pronoun_for_I(list, tok) when is_list(list) do
      phrase = (Map.get(tok, :phrase) || Map.get(tok, "phrase") || "") |&gt; to_string()
      if phrase == "I" do
        pronounish = Enum.filter(list, fn c -&gt; pos_pronoun?(c) or id_pronounish?(c) end)
        if pronounish == [], do: list, else: pronounish
      else
        list
      end
    end</p><p class="whitespace-pre-wrap break-words">    defp pos_pronoun?(c) do
      p =
        Map.get(c, :pos) ||
          get_in(c, [:features, :pos]) ||
          get_in(c, ["features", "pos"])</p><p class="whitespace-pre-wrap break-words">      cond do
        is_nil(p) -&gt; false
        is_atom(p) -&gt; p |&gt; Atom.to_string() |&gt; String.downcase() |&gt; String.contains?("pron")
        is_binary(p) -&gt; p |&gt; String.downcase() |&gt; String.contains?("pron")
        true -&gt; false
      end
    end</p><p class="whitespace-pre-wrap break-words">    defp id_pronounish?(c) do
      id = Map.get(c, :id) |&gt; to_string()
      String.contains?(String.downcase(id), "pron")
    end</p><p class="whitespace-pre-wrap break-words">    # Prefer MWE senses for MWE tokens (and vice versa), with safe fallback
    defp compat_filter_for_token(list, %{n: n} = tok) when is_list(list) and is_integer(n) do
      mwe? = n &gt; 1 or (Map.get(tok, :mw) || Map.get(tok, "mw") || false)
      have_lemma? = Enum.any?(list, &amp;has_readable_lemma?/1)</p><p class="whitespace-pre-wrap break-words">      kept =
        Enum.filter(list, fn c -&gt;
          case sense_lemma(c) do
            nil -&gt; true  # if unknown, keep
            lemma -&gt;
              has_space = String.contains?(lemma, " ")
              if mwe?, do: has_space, else: not has_space
          end
        end)</p><p class="whitespace-pre-wrap break-words">      if have_lemma? and kept == [], do: list, else: kept
    end</p><p class="whitespace-pre-wrap break-words">    defp compat_filter_for_token(list, _tok), do: list</p><p class="whitespace-pre-wrap break-words">    defp has_readable_lemma?(c), do: not is_nil(sense_lemma(c))</p><p class="whitespace-pre-wrap break-words">    defp sense_lemma(c) do
      (Map.get(c, :lemma) ||
         get_in(c, [:features, :lemma]) ||
         get_in(c, ["features", "lemma"]) ||
         Map.get(c, :word))
      |&gt; case do
        nil -&gt; nil
        ""  -&gt; nil
        v   -&gt; to_string(v)
      end
    end</p><p class="whitespace-pre-wrap break-words">    # Build score map per requested mode; default :all for back-compat
    defp build_scores_map(scored, :all),
      do: Map.new(scored, fn %{id: i, score: s} -&gt; {i, s} end)</p><p class="whitespace-pre-wrap break-words">    defp build_scores<em>map(scored, :top2) do
      case scored do
        [] -&gt; %{}
        [a] -&gt; %{a.id =&gt; a.score}
        [a, b | </em>] -&gt; %{a.id =&gt; a.score, b.id =&gt; b.score}
      end
    end</p><p class="whitespace-pre-wrap break-words">    defp build_scores_map(<em>scored, </em>), do: %{}</p><p class="whitespace-pre-wrap break-words">    # ── Utils ──────────────────────────────────────────────────────────</p><p class="whitespace-pre-wrap break-words">    defp weights(opts) do
      env = Application.get_env(:brain, :lifg_stage1_weights, %{})
      base = %{lex_fit: 0.4, rel_prior: 0.3, activation: 0.2, intent_bias: 0.1}</p><p class="whitespace-pre-wrap break-words">      base
      |&gt; Map.merge(env || %{})
      |&gt; Map.merge(Map.new(Keyword.get(opts, :weights, [])))
    end</p><p class="whitespace-pre-wrap break-words">    defp emit(ev, meas, meta) do
      if Code.ensure_loaded?(:telemetry) and function_exported?(:telemetry, :execute, 3) do
        :telemetry.execute(ev, meas, meta)
      else
        :ok
      end
    end</p><p class="whitespace-pre-wrap break-words">    defp as_int(nil, d), do: d
    defp as_int(i, _d) when is_integer(i), do: i
    defp as_int(b, d) when is<em>binary(b) do
      case Integer.parse(b) do
        {n, </em>} -&gt; n
        _ -&gt; d
      end
    end</p><p class="whitespace-pre-wrap break-words">    defp as_float(nil), do: 0.0
    defp as_float(n) when is_number(n), do: n * 1.0
    defp as_float(b) when is<em>binary(b) do
      case Float.parse(b) do
        {f, </em>} -&gt; f
        _ -&gt; 0.0
      end
    end
  end</p><p class="whitespace-pre-wrap break-words">  # ── Full pipeline wrapper (optional) ─────────────────────────────────</p><p class="whitespace-pre-wrap break-words">  @doc """
  Full LIFG pipeline:
    1) ATL finalize → slate (if available)
    2) Attach <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">si.sense_candidates</code>
    3) Stage-1 disambiguation
    4) pMTG consult (sync rerun or async boost/none)</p><p class="whitespace-pre-wrap break-words">  Returns <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">{:ok, %{si, choices, slate}}</code>.
  """
  @spec run(map(), keyword()) :: {:ok, %{si: map(), choices: list(), slate: map()}}
  def run(si, opts \\ []) when is_map(si) do
    # 1) ATL finalize (optional)
    {si, slate} =
      if Code.ensure_loaded?(Brain.ATL) and function_exported?(Brain.ATL, :finalize, 2) do
        Brain.ATL.finalize(si, opts)
      else
        {si, %{}}
      end</p><p class="whitespace-pre-wrap break-words">    # 2) attach slate → sense_candidates (optional)
    si =
      if Code.ensure_loaded?(Brain.ATL) and
           function_exported?(Brain.ATL, :attach_sense_candidates, 3) do
        Brain.ATL.attach_sense_candidates(si, slate,
          top_k: Keyword.get(opts, :top_k, 3),
          margin_window: Keyword.get(opts, :margin_window, 0.05)
        )
      else
        si
      end</p><p class="whitespace-pre-wrap break-words">    # 3) Stage-1
    scores_mode = Keyword.get(opts, :scores, Application.get_env(:brain, :lifg_stage1_scores_mode, :all))
    margin_thr  = Keyword.get(opts, :margin_threshold, 0.15)</p><p class="whitespace-pre-wrap break-words">    {:ok, %{si: si, choices: choices, audit: _a}} =
      <u>MODULE</u>.Stage1.run(si,
        weights: Map.get(opts, :weights, %{
          lex_fit: 0.5, rel_prior: 0.25, activation: 0.15, intent_bias: 0.10
        }),
        scores: scores_mode,
        margin_threshold: margin_thr,
        chargram_event: [:brain, :lifg, :chargram_violation],
        boundary_event: [:brain, :lifg, :boundary_drop]
      )</p><p class="whitespace-pre-wrap break-words">    # 4) pMTG
    pmtg_mode = Keyword.get(opts, :pmtg_mode, Application.get_env(:brain, :pmtg_mode, :boost))</p><p class="whitespace-pre-wrap break-words">    final_choices =
      case {pmtg_mode, Keyword.get(opts, :pmtg_apply?, true)} do
        {:rerun, true} -&gt;
          {:ok, %{choices: merged}} =
            Brain.PMTG.consult_sync(
              choices,
              si.tokens,
              already_needy: false,
              margin_threshold: margin_thr,
              limit: Keyword.get(opts, :limit, 5),
              mode: :rerun,
              rerun_only_if_hits: Keyword.get(opts, :rerun_only_if_hits, true),
              rerun_weights_bump: Keyword.get(opts, :rerun_weights_bump, %{lex_fit: 0.05, rel_prior: 0.05})
            )</p><p class="whitespace-pre-wrap break-words">          merged</p><p class="whitespace-pre-wrap break-words">        _other -&gt;
          Brain.PMTG.consult(
            choices,
            si.tokens,
            margin_threshold: margin_thr,
            limit: Keyword.get(opts, :limit, 5),
            mode: pmtg_mode
          )</p><p class="whitespace-pre-wrap break-words">          choices
      end</p><p class="whitespace-pre-wrap break-words">    {:ok, %{si: si, choices: final_choices, slate: slate}}
  end</p><p class="whitespace-pre-wrap break-words">  # ── weights (outer) ─────────────────────────────────────────────────</p><p class="whitespace-pre-wrap break-words">  defp to_map(nil), do: %{}
  defp to_map(m) when is_map(m), do: m
  defp to_map(kv) when is_list(kv), do: Map.new(kv)
  defp to<em>map(</em>), do: %{}</p><p class="whitespace-pre-wrap break-words">  @type lifg_outer_weights ::
          %{
            required(:lex) =&gt; float(),
            required(:sim) =&gt; float(),
            required(:rel) =&gt; float(),
            required(:prag) =&gt; float(),
            required(:act) =&gt; float(),
            optional(:prime) =&gt; float()
          }</p><p class="whitespace-pre-wrap break-words">  @doc "Default outer LIFG weights (lex/sim/rel/prag/act + optional :prime)."
  @spec default_weights() :: lifg_outer_weights()
  def default_weights, do: %{lex: 0.25, sim: 0.40, rel: 0.15, prag: 0.10, act: 0.10, prime: 0.0}</p><p class="whitespace-pre-wrap break-words">  # Merge order: defaults &lt;- env (lifg_weights OR mapped stage1) &lt;- opts[:weights]
  defp resolved_weights(opts) do
    outer_env = to_map(Application.get_env(:brain, :lifg_weights))</p><p class="whitespace-pre-wrap break-words">    mapped_from_stage1 =
      case to_map(Application.get_env(:brain, :lifg_stage1_weights)) do
        %{} = w1 when map_size(w1) &gt; 0 -&gt;
          %{
            lex:  Map.get(w1, :lex_fit,     default_weights().lex),
            sim:  default_weights().sim, # stage-1 has no :sim
            rel:  Map.get(w1, :rel_prior,   default_weights().rel),
            prag: Map.get(w1, :intent_bias, default_weights().prag),
            act:  Map.get(w1, :activation,  default<em>weights().act)
          }
        </em> -&gt; %{}
      end</p><p class="whitespace-pre-wrap break-words">    env_weights = if outer_env == %{}, do: mapped_from_stage1, else: outer_env
    opt_w      = to_map(Keyword.get(opts, :weights, %{}))</p><p class="whitespace-pre-wrap break-words">    default_weights()
    |&gt; Map.merge(env_weights)
    |&gt; Map.merge(opt_w)
  end
end</p></div></div></div></div></div><div data-test-render-count="1"><div style="height: auto; opacity: 1; transform: none;"><div data-is-streaming="false" class="group  relative pb-8" style="opacity: 1; transform: none;"><div class="font-claude-response  relative  leading-[1.65rem]  [&amp;_pre&gt;div]:bg-bg-000/50  [&amp;_pre&gt;div]:border-0.5  [&amp;_pre&gt;div]:border-border-400  [&amp;_.ignore-pre-bg&gt;div]:bg-transparent  [&amp;_.standard-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2  [&amp;_.standard-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8  [&amp;_.progressive-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2  [&amp;_.progressive-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8"><div><div class="grid-cols-1 grid gap-2.5 [&amp;_&gt;_*]:min-w-0 standard-markdown"><p class="whitespace-normal break-words">Here's the refactored file with the critical fixes for cross-token contamination and MWE handling:</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div class="text-text-500 font-small p-3.5 pb-0">elixir</div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code class="language-elixir" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span class="token" style="color: rgb(198, 120, 221);">defmodule</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Brain</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token module" style="color: rgb(209, 154, 102);">LIFG</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>  </span><span class="token attribute" style="color: rgb(97, 175, 239);">@moduledoc</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">~S"""
</span></span><span>  **Left Inferior Frontal Gyrus (LIFG) — Competitive Sense Selection**
</span><span>
</span><span>  Two entry points:
</span><span>
</span><span>  • Legacy pure stage (kept for back-compat):
</span><span>      `disambiguate_stage1/1,2` — scores candidates from slate or active_cells with optional context similarity.
</span><span>
</span><span>  • New fast pipeline stage:
</span><span>      `Brain.LIFG.Stage1.run/2` — per-token disambiguation from `si.sense_candidates` with guards and tiny heuristics.
</span><span>
</span><span>  Central config (umbrella root `config/config.exs`):
</span><span>
</span><span>      config :brain,
</span><span>        lifg_stage1_weights: %{lex_fit: 0.40, rel_prior: 0.30, activation: 0.20, intent_bias: 0.10},
</span><span>        lifg_stage1_scores_mode: :all,  # or :top2 | :none
</span><span>        pmtg_mode: :boost,
</span><span>        pmtg_margin_threshold: 0.15,
</span><span>        pmtg_window_keep: 50
</span><span><span class="token" style="color: rgb(152, 195, 121);">  """</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">## Region GenServer for status/config/telemetry (stage stays pure)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">use</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Brain</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">region:</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:lifg</span><span>
</span></span><span><span>                                                                        </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ── Optional server API (convenience) ─────────────────────────────────</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">status</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>server </span><span class="token" style="color: rgb(97, 175, 239);">\\</span><span> __MODULE__</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">GenServer</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">call</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>server</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:status</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>                                                                     
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">reload_config</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>new_opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> server </span><span class="token" style="color: rgb(97, 175, 239);">\\</span><span> __MODULE__</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>new_opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>new_opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    </span><span class="token module" style="color: rgb(209, 154, 102);">GenServer</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">cast</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>server</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token atom" style="color: rgb(224, 108, 117);">:reload_config</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">new</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>new_opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token attribute" style="color: rgb(97, 175, 239);">@impl</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">true</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">handle_cast</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token atom" style="color: rgb(224, 108, 117);">:reload_config</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> new_opts</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> state</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token atom" style="color: rgb(224, 108, 117);">:noreply</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>state </span><span class="token" style="color: rgb(97, 175, 239);">|</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">opts:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">merge</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>state</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>opts </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">new</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>new_opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ── Legacy pure Stage-1 API ──────────────────────────────────────────</span><span>
</span></span><span>
</span><span><span>  </span><span class="token doc attribute">@doc</span><span class="token doc"> </span><span class="token doc" style="color: rgb(152, 195, 121);">"Pure, stateless stage-1. Appends a trace event with choices/boosts/inhibitions."</span><span>
</span></span><span><span>  </span><span class="token attribute" style="color: rgb(97, 175, 239);">@spec</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">disambiguate_stage1</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">::</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">disambiguate_stage1</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">disambiguate_stage1</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>  </span><span class="token doc attribute">@doc</span><span class="token doc"> </span><span class="token doc" style="color: rgb(152, 195, 121);">"""
</span></span><span>  Pure stage-1 with options:
</span><span>    * `:weights`           — override weights map (outer {lex, sim, rel, prag, act, prime})
</span><span>    * `:margin_threshold`  — default 0.12
</span><span>    * `:scores`            — :all | :top2 | :none (default :all)
</span><span>    * `:fit?`              — (cand, si) -&gt; boolean (default fn -&gt; true end)
</span><span>    * `:max_flips`         — reanalysis cap (default 1) [stubbed]
</span><span>    * `:prime`             — priming options (stubbed; no-op)
</span><span><span class="token doc" style="color: rgb(152, 195, 121);">  """</span><span>
</span></span><span><span>  </span><span class="token attribute" style="color: rgb(97, 175, 239);">@spec</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">disambiguate_stage1</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">keyword</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">::</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">disambiguate_stage1</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># 1) Tripwire (stub)</span><span>
</span></span><span><span>    tokens </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span>      si
</span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">tripwire_check_and_filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">on_leak:</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:drop</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    ctx </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:context_vec</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    ctxn </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ctx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">l2</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ctx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># 2) Candidate source: prefer slate ; else from active_cells</span><span>
</span></span><span><span>    candidates </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:sense_candidates</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>        slate </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>slate</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">map_size</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>slate</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(97, 175, 239);">candidates_from_slate</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> slate</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>        _ </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(97, 175, 239);">candidates_from_cells</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># 3) Score + normalize per token group, pick winners (+ minimal reanalysis)</span><span>
</span></span><span><span>    weights </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">resolved_weights</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> boosts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> inhibitions</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">disambiguate_groups</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> candidates</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctxn</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> weights</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># 4) Build trace event</span><span>
</span></span><span><span>    ev </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(209, 154, 102);">stage:</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:lifg_stage1</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(209, 154, 102);">ts_ms:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">System</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">system_time</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:millisecond</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(209, 154, 102);">normalize:</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:softmax</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(209, 154, 102);">scores_mode:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Keyword</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:scores</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:all</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(209, 154, 102);">ctx_dim:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">is_list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ctx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;&amp;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">length</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ctx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(209, 154, 102);">groups:</span><span> candidates </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span> </span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>token_index</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">MapSet</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">new</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">MapSet</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">size</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(209, 154, 102);">choices:</span><span> choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(209, 154, 102);">boosts:</span><span> boosts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(209, 154, 102);">inhibitions:</span><span> inhibitions
</span></span><span><span>    </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span>    trace </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span>ev </span><span class="token" style="color: rgb(97, 175, 239);">|</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:trace</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span><span>    </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">put</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:trace</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> trace</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Back-compat shim if callers pass (si, ctx, opts)</span><span>
</span></span><span><span>  </span><span class="token attribute" style="color: rgb(97, 175, 239);">@spec</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">disambiguate_stage1</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">any</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">keyword</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">::</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">disambiguate_stage1</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> _ctx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">disambiguate_stage1</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ── Candidate sources (legacy pure stage) ────────────────────────────</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">candidates_from_slate</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> slate</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">flat_map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>slate</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>idx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> list</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>      lemma </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">lemma_for</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>      </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">List</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">wrap</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> c </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>        feats </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:features</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span>        </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">id:</span><span> c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">token_index:</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">lemma:</span><span> lemma </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">pos:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>feats</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:pos</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">lex_fit:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>feats</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:lex_fit</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.6</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">rel_prior:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:prior</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.5</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">intent_bias:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">intent_bias_from</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> feats</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">activation:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>feats</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:activation</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">embedding:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>feats</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:embedding</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ── FIXED: Strict MWE matching to prevent cross-token contamination ──</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">candidates_from_cells</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    cells </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:active_cells</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Pre-normalize cell info; no token index here yet.</span><span>
</span></span><span><span>    cells_normed </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>      </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cells</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> m </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>        word  </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:word</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span>
</span></span><span><span>        lemma </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:lemma</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> word
</span></span><span><span>        nrm   </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:norm</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> word
</span></span><span>
</span><span><span>        </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">id:</span><span>           </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:id</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">pos:</span><span>          </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:pos</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">lex_fit:</span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:lex_fit</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">rel_prior:</span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:rel_prior</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">intent_bias:</span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:intent_bias</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">activation:</span><span>   </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:activation</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">embedding:</span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:embedding</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">definition:</span><span>   </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:definition</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">__norm__:</span><span>     </span><span class="token" style="color: rgb(97, 175, 239);">norm_phrase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>nrm</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">__lemma__:</span><span>    lemma
</span></span><span><span>        </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span>    tokens
</span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">with_index</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">flat_map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>      tnorm </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">norm_phrase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:phrase</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      is_mwe </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:n</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:mw</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">in</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(209, 154, 102);">true</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"true"</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span>
</span><span>      cells_normed
</span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> c </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># STRICT matching for MWEs to prevent cross-token contamination</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> is_mwe </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># For MWE tokens, ONLY exact match</span><span>
</span></span><span><span>          c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__norm__ </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> tnorm
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">else</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># For single-word tokens, allow fuzzy matching</span><span>
</span></span><span><span>          c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__norm__ </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> tnorm </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span>
</span></span><span><span>            </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tnorm</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__norm__</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span>
</span></span><span><span>            </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__norm__</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tnorm</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> c </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">id:</span><span>          c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">token_index:</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">lemma:</span><span>       c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>__lemma__ </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">pos:</span><span>         c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>pos</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">lex_fit:</span><span>     c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>lex_fit </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.6</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">rel_prior:</span><span>   c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>rel_prior </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.5</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">intent_bias:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>intent_bias </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span>
</span></span><span><span>                         </span><span class="token" style="color: rgb(97, 175, 239);">intent_bias_from</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">pos:</span><span> c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>pos</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">definition:</span><span> c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>definition</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">activation:</span><span>  c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>activation </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">embedding:</span><span>   c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>embedding
</span></span><span><span>        </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">lex_fit_from_phrase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>phrase</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> lemma</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    p </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">downcase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">to_b</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>phrase</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    l </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">downcase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">to_b</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>lemma</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">cond</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>      p </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span> l </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.60</span><span>
</span></span><span><span>      p </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> l             </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1.00</span><span>
</span></span><span><span>      </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>p</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> l</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.85</span><span>
</span></span><span><span>      </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>l</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> p</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.75</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(209, 154, 102);">true</span><span>                  </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.60</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">intent_bias_from</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> feats_or_map</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    tokens </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    cur    </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">at</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>    prev   </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">at</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span>    phrase </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cur</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:phrase</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> cur</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(152, 195, 121);">"phrase"</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">to_b</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    prev_w </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>prev</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:phrase</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> prev</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(152, 195, 121);">"phrase"</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">to_b</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">downcase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    pos  </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>feats_or_map</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:pos</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>feats_or_map</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"pos"</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">to_b</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">downcase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">defn</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>feats_or_map</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:definition</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>feats_or_map</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"definition"</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">to_b</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">downcase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    at_start? </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">match?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">span:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> _</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> cur</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">or</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cur</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:index</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> cur</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(152, 195, 121);">"index"</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span>
</span></span><span>
</span><span><span>    bias </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Salutation: "hello/hi/hey …" → favor interjection at start</span><span>
</span></span><span><span>    bias </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> at_start? </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Regex</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">match?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">~r/^(hello|hi|hey)\b/i</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> phrase</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>pos</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"interjection"</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> bias </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.20</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> bias
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Definitions gated by "(with "the")" → slightly penalize if not preceded by "the"</span><span>
</span></span><span><span>    bias </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">defn</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">~s|(with "the")|</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> prev_w </span><span class="token" style="color: rgb(97, 175, 239);">!=</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"the"</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> bias </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.15</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> bias
</span></span><span>
</span><span>    bias
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ── Group scoring (legacy pure stage) ───────────────────────────────</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">disambiguate_groups</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> candidates</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctxn</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> weights</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    groups </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">group_by</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>candidates</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span> </span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>token_index</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    scores_mode      </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Keyword</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:scores</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:all</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    margin_threshold </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Keyword</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:margin_threshold</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.12</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    fit?             </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Keyword</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:fit</span><span>?</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> _cand</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> _si </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">true</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    prime_opts       </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Keyword</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:prime</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> losers</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>      </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map_reduce</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>groups</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">MapSet</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">new</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>tidx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> cands0</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> acc_losers </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>        tok </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">at</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tidx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> t </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> t
</span></span><span><span>            _ </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>        </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># sanitize: drop nil/id-less, de-dup by id, then apply MWE↔sense compatibility</span><span>
</span></span><span><span>        cands </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span>          cands0
</span><span><span>          </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">reject</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(97, 175, 239);">is_nil</span><span class="token" style="color: rgb(97, 175, 239);">/</span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">reject</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">is_nil</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">uniq_by</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span> </span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">filter_candidates_for_token</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>        </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># If no candidates remain after filtering, skip this token</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> cands </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> acc_losers</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">else</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>_cand_feats</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> normed</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">score_and_normalize</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cands</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctxn</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> weights</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> prime_opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>          </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>best_c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> best_f</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">best_of_normed</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>normed</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>          </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>winner_c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> winner_f</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> best_c </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>              </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">score_norm:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">sim:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">score_raw:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>              bc  </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">fit?</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>bc</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>                  </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>bc</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> best_f</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(198, 120, 221);">else</span><span>
</span></span><span><span>                  </span><span class="token" style="color: rgb(97, 175, 239);">best_of_normed</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">drop</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>normed</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>          </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>_ru_c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ru_f</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> normed </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>              </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span>_only</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>           </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">score_norm:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>              </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span>_</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>c2</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f2</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|</span><span> _</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>c2</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f2</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>              _                 </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">score_norm:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>          margin </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>winner_f</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:score_norm</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ru_f</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:score_norm</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>          </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># build alt ids from top-2 if margin below threshold</span><span>
</span></span><span><span>          alt_ids </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> margin </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> margin_threshold </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">length</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>normed</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>              </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">sort_by</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>normed</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>_c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span>f</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>score_norm </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span>_first</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>c2</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> _</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|</span><span> _</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span>c2</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span><span>                _ </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span><span>              </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">else</span><span>
</span></span><span><span>              </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>          </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> winner_c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">priming_bump</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>winner_c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> prime_opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>          lemma </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">lemma_for</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tidx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>winner_c </span><span class="token" style="color: rgb(97, 175, 239);">&amp;&amp;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>winner_c</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:lemma</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span>
</span></span><span>
</span><span><span>          </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># cache sorted once for :top2 to avoid double sorts</span><span>
</span></span><span><span>          sorted_normed </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> scores_mode </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:all</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">sort_by</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>normed</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>_c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span>f</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>score_norm </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>          scores </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> scores_mode </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>              </span><span class="token atom" style="color: rgb(224, 108, 117);">:all</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>                normed </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">new</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>score_norm</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>              </span><span class="token atom" style="color: rgb(224, 108, 117);">:top2</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> sorted_normed </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>                  </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>                       </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>                  </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>c1</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f1</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>               </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>c1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id </span><span class="token" style="color: rgb(97, 175, 239);">=&gt;</span><span> f1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>score_norm</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>                  </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>c1</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f1</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>c2</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f2</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|</span><span> _</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>c1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id </span><span class="token" style="color: rgb(97, 175, 239);">=&gt;</span><span> f1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>score_norm</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> c2</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id </span><span class="token" style="color: rgb(97, 175, 239);">=&gt;</span><span> f2</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>score_norm</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>              _ </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>          choice </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(209, 154, 102);">token_index:</span><span> tidx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(209, 154, 102);">lemma:</span><span> lemma</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(209, 154, 102);">chosen_id:</span><span> winner_c </span><span class="token" style="color: rgb(97, 175, 239);">&amp;&amp;</span><span> winner_c</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(209, 154, 102);">alt_ids:</span><span> alt_ids</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(209, 154, 102);">scores:</span><span> scores</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(209, 154, 102);">margin:</span><span> margin</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(209, 154, 102);">features:</span><span>
</span></span><span><span>              winner_c </span><span class="token" style="color: rgb(97, 175, 239);">&amp;&amp;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(209, 154, 102);">sim:</span><span> winner_f</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>sim</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(209, 154, 102);">score_raw:</span><span> winner_f</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>score_raw</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(209, 154, 102);">score_norm:</span><span> winner_f</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>score_norm</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(209, 154, 102);">pos:</span><span> winner_c</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:pos</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(209, 154, 102);">lex_fit:</span><span> winner_c</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:lex_fit</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(209, 154, 102);">rel_prior:</span><span> winner_c</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:rel_prior</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(209, 154, 102);">intent_bias:</span><span> winner_c</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:intent_bias</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span>
</span></span><span><span>                </span><span class="token" style="color: rgb(209, 154, 102);">activation:</span><span> winner_c</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:activation</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span><span>              </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span>          losers_here </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> winner_c </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>              </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">MapSet</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">new</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>              wc  </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> cands </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id </span><span class="token" style="color: rgb(97, 175, 239);">!=</span><span> wc</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span> </span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>id</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">MapSet</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">new</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>          </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>choice</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">MapSet</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">union</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>acc_losers</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> losers_here</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">then</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> losers</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> 
</span></span><span><span>        </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># Filter out nil choices from tokens with no valid candidates</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">reject</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(97, 175, 239);">is_nil</span><span class="token" style="color: rgb(97, 175, 239);">/</span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> losers</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    choices </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">sort_by</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span> </span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>token_index</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    boosts      </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">for</span><span> ch </span><span class="token" style="color: rgb(97, 175, 239);">&lt;-</span><span> choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ch</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>chosen_id</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>ch</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>chosen_id</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span class="token" style="color: rgb(209, 154, 102);">0.5</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>    inhibitions </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>losers</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span class="token" style="color: rgb(209, 154, 102);">0.25</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> boosts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> inhibitions</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">score_and_normalize</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cands</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctxn</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> weights</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> prime_opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    w_prime </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>weights</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:prime</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1.0</span><span>
</span></span><span>
</span><span><span>    cand_feats </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>      </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cands</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> cand </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>        sim </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> cand</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>embedding </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span>
</span></span><span><span>            vec </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">cosine_with_ctxnorm</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>vec</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctxn</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>        prime </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> w_prime </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">priming_boost_for</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">to_string</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cand</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:id</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> prime_opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>        score </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>          weights</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>lex </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">safe_num</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cand</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>lex_fit</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span>
</span></span><span><span>            weights</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>sim </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> sim </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span>
</span></span><span><span>            weights</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>rel </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">safe_num</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cand</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>rel_prior</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span>
</span></span><span><span>            weights</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>prag </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">safe_num</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cand</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>intent_bias</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span>
</span></span><span><span>            weights</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>act </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">safe_num</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cand</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>activation</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span>
</span></span><span><span>            w_prime </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> prime
</span></span><span>
</span><span><span>        </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>cand</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">sim:</span><span> sim</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">score_raw:</span><span> score</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    normed_vals </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">normalize_scores</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cand_feats</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>_c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> f</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>score_raw </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    normed </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>      </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">zip</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>cand_feats</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> normed_vals</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>cand</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> feats</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> s_norm</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>cand</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">put</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>feats</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:score_norm</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> s_norm</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>cand_feats</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> normed</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">best_of_normed</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">score_norm:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">best_of_normed</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">max_by</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>_c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> f</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> f</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>score_norm </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">hd</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">phrase_for</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">at</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">phrase:</span><span> p</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_binary</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>p</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> p
</span></span><span><span>      _ </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">lemma_for</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">phrase_for</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> idx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ── Tripwire/Reanalysis/Priming — stubs ─────────────────────────────</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">tripwire_check_and_filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> _opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> tokens
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">priming_bump</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>_id</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> _opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:ok</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">priming_boost_for</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>_id</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> _opts</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ── Math &amp; utils (legacy pure) ──────────────────────────────────────</span><span>
</span></span><span>
</span><span><span>  </span><span class="token attribute" style="color: rgb(97, 175, 239);">@abs_eps</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1.0e-15</span><span>
</span></span><span><span>  </span><span class="token attribute" style="color: rgb(97, 175, 239);">@rel_eps</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1.0e-12</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">zeroish?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>x</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> scale</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_float</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>x</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    ax </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">abs</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>x</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    ax </span><span class="token" style="color: rgb(97, 175, 239);">&lt;=</span><span> </span><span class="token attribute" style="color: rgb(97, 175, 239);">@abs_eps</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span> ax </span><span class="token" style="color: rgb(97, 175, 239);">&lt;=</span><span> </span><span class="token attribute" style="color: rgb(97, 175, 239);">@rel_eps</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">max</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">1.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">abs</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scale</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token doc attribute">@doc</span><span class="token doc"> </span><span class="token doc" style="color: rgb(152, 195, 121);">"Cosine similarity; 0.0 on nil/zero-norm."</span><span>
</span></span><span><span>  </span><span class="token attribute" style="color: rgb(97, 175, 239);">@spec</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">cosine</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(97, 175, 239);">number</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(97, 175, 239);">number</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">::</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">float</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">cosine</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> _</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">cosine</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>_</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">cosine</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>a</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> b</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>a</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>b</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    num </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">dot</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>a</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> b</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    den </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">l2</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>a</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">l2</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>b</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">zeroish?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>den</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> den</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> num </span><span class="token" style="color: rgb(97, 175, 239);">/</span><span> den
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token attribute" style="color: rgb(97, 175, 239);">@spec</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">normalize_scores</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(97, 175, 239);">number</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">::</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(97, 175, 239);">float</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">normalize_scores</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scores</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    m </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">max</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|</span><span> scores</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    exps </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scores</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> s </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:math</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">exp</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>s </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span> m</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    z </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">sum</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>exps</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">zeroish?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>z</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> z</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">List</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">duplicate</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">length</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>scores</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>exps</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">/</span><span> z</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">cosine_with_ctxnorm</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>vec</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctx</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctxn</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">cond</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">is_nil</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>vec</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_nil</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ctx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">zeroish?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ctxn</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctxn</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(209, 154, 102);">true</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>        na </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">l2</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>vec</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>        den </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> na </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> ctxn
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">zeroish?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>den</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> den</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">dot</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>vec</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> ctx</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">/</span><span> den
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">dot</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>a</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> b</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">zip</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>a</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> b</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">reduce</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>x</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> y</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> acc </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> acc </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span> x </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> y </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">l2</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>v</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> v </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">reduce</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> x</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> acc </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> acc </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span> x </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> x </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:math</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">sqrt</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">safe_num</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">safe_num</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>x</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_number</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>x</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> x </span><span class="token" style="color: rgb(97, 175, 239);">*</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1.0</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> k</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_atom</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>k</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> k</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Atom</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">to_string</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>k</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">getf</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> k</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_binary</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>k</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> k</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">to_b</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">to_b</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>v</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_binary</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>v</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> v
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">to_b</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>v</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Kernel</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">to_string</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>v</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># ── NEW: Shared normalization helper ─────────────────────────────────</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">norm_phrase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>phrase</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span>    phrase
</span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">to_b</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">downcase</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">replace</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(152, 195, 121);">~r/\s+/</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">" "</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">trim</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># --- Confidence helpers (pure) ---</span><span>
</span></span><span><span>  </span><span class="token doc attribute">@doc</span><span class="token doc"> </span><span class="token doc" style="color: rgb(152, 195, 121);">"Return p(top1) from a LIFG choice (max over normalized scores)."</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">top1_prob</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>choice</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    choice </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:scores</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">values</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">max</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token doc attribute">@doc</span><span class="token doc"> </span><span class="token doc" style="color: rgb(152, 195, 121);">"""
</span></span><span>  Low-confidence predicate used by pMTG gate.
</span><span>  Defaults: tau_confident=0.20, p_min=0.65. Returns true when pMTG should fire.
</span><span><span class="token doc" style="color: rgb(152, 195, 121);">  """</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">low_confidence?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>choice</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> opts </span><span class="token" style="color: rgb(97, 175, 239);">\\</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    tau   </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Keyword</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:tau_confident</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.20</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    p_min </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Keyword</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:p_min</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.65</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    m     </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>choice</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:margin</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    p1    </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">top1_prob</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>choice</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    alts? </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>choice</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:alt_ids</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">!=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>m </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> tau</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">or</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>p1 </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> p_min</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span> alts?
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sense_lemma</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">do</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:lemma</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span>
</span></span><span><span>       </span><span class="token" style="color: rgb(97, 175, 239);">get_in</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:features</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:lemma</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span>
</span></span><span><span>       </span><span class="token" style="color: rgb(97, 175, 239);">get_in</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(152, 195, 121);">"features"</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"lemma"</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span>
</span></span><span><span>       </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:word</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(152, 195, 121);">""</span><span>  </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span>
</span></span><span><span>      v   </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">to_string</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>v</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">filter_candidates_for_token</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> tok</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># MWE token if n&gt;1 or explicit :mw flag</span><span>
</span></span><span><span>    mwe? </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:n</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">or</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tok</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:mw</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">in</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(209, 154, 102);">true</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"true"</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    have_lemma? </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">any?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">!</span><span class="token" style="color: rgb(97, 175, 239);">is_nil</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">sense_lemma</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    kept </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>      </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> c </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sense_lemma</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>c</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span>     </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">true</span><span>            </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># no lemma info? keep to be safe</span><span>
</span></span><span><span>          lemma   </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>            has_space </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">contains?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>lemma</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">" "</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> mwe?</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> has_space</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">not</span><span> has_space
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># safe fallback: if the filter nuked everything but we had lemmas, keep original list</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> have_lemma? </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> kept </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> kept
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">filter_candidates_for_token</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> _tok</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> list
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">##===================== HYGIENE (optional helper) =====================</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defmodule</span><span> __MODULE__</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token module" style="color: rgb(209, 154, 102);">Hygiene</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    </span><span class="token doc attribute">@moduledoc</span><span class="token doc"> </span><span class="token doc" style="color: rgb(152, 195, 121);">"""
</span></span><span>    Post-Stage-1 hygiene pass:
</span><span>      • Sanitizes score maps (drops non-numeric/NaN)
</span><span>      • Computes softmax probabilities as `:probs`
</span><span>      • Adds `:p_top1`
</span><span>      • Dedups `:alt_ids`
</span><span>      • Flags `:needs_rerun` (by margin/p_top1/alt_ids)
</span><span>      • Emits telemetry: [:brain, :hygiene, :wipe]
</span><span><span class="token doc" style="color: rgb(152, 195, 121);">    """</span><span>
</span></span><span>
</span><span><span>    </span><span class="token attribute" style="color: rgb(97, 175, 239);">@type</span><span> choice </span><span class="token" style="color: rgb(97, 175, 239);">::</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    </span><span class="token attribute" style="color: rgb(97, 175, 239);">@spec</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">run</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(97, 175, 239);">choice</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">keyword</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">::</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token atom" style="color: rgb(224, 108, 117);">:ok</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">si:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">choices:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(97, 175, 239);">choice</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">audit:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">run</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> opts </span><span class="token" style="color: rgb(97, 175, 239);">\\</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>choices</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>      min_margin </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>        </span><span class="token module" style="color: rgb(209, 154, 102);">Keyword</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:min_margin</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Application</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get_env</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:brain</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:lifg_min_margin</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.12</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>      p_min </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>        </span><span class="token module" style="color: rgb(209, 154, 102);">Keyword</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:p_min</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Application</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get_env</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:brain</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:lifg_min_p_top1</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.65</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>      event </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Keyword</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>opts</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:event</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:brain</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:hygiene</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:wipe</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      now_ms </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">System</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">system_time</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:millisecond</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>cleaned</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> stats</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>        </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map_reduce</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>choices</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">sanitized:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">needs_rerun:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> ch</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> acc </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>probs</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> dropped</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">normalize_scores_map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ch</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:scores</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>          p1 </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">max_prob</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>probs</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>          alt_ids2 </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ch</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:alt_ids</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">reject</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> ch</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:chosen_id</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">uniq</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>          needs? </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ch</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token atom" style="color: rgb(224, 108, 117);">:margin</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> min_margin </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span>
</span></span><span><span>              p1 </span><span class="token" style="color: rgb(97, 175, 239);">&lt;</span><span> p_min </span><span class="token" style="color: rgb(198, 120, 221);">or</span><span>
</span></span><span><span>              alt_ids2 </span><span class="token" style="color: rgb(97, 175, 239);">!=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span>
</span><span><span>          ch2 </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span>            ch
</span><span><span>            </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">put</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:alt_ids</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> alt_ids2</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">put</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:probs</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> probs</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">put</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:p_top1</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> p1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">put</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:needs_rerun</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> needs?</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>          acc2 </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span>            acc
</span><span><span>            </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">update!</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:sanitized</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span> dropped</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">update!</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:needs_rerun</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">+</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">if</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>needs?</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>          </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>ch2</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> acc2</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>      meas </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">total:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">length</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>choices</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">sanitized:</span><span> stats</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>sanitized</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">needs_rerun:</span><span> stats</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span>needs_rerun</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">ts_ms:</span><span> now_ms</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">emit</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>event</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> meas</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">min_margin:</span><span> min_margin</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">p_min:</span><span> p_min</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token atom" style="color: rgb(224, 108, 117);">:ok</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">si:</span><span> si</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">choices:</span><span> cleaned</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">audit:</span><span> meas</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">normalize_scores_map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>map</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>map</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>      pairs </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span>        map
</span><span><span>        </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>_k</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> v</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_number</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>v</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> v </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> v </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;"># (v==v) filters NaN</span><span>
</span></span><span>
</span><span><span>      dropped </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">map_size</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>map</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">length</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>pairs</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      vals </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>pairs</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>_</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> v</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> v </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>      probs </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> vals </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>          </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>          _ </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>            m </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">max</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|</span><span> vals</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>            exps </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>vals</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> s </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:math</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">exp</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>s </span><span class="token" style="color: rgb(97, 175, 239);">-</span><span> m</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>            z </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">sum</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>exps</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> z </span><span class="token" style="color: rgb(97, 175, 239);">==</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>              </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">new</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>pairs</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>k</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> _</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>k</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">else</span><span>
</span></span><span><span>              pairs </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">zip</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>exps</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">new</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>k</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> _</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> e</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>k</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> e </span><span class="token" style="color: rgb(97, 175, 239);">/</span><span> z</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>            </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>      </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>probs</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> dropped</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">max_prob</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> probs</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> probs </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">values</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">max</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0.0</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">emit</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ev</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> meas</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> meta</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Code</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">ensure_loaded?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:telemetry</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">function_exported?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token atom" style="color: rgb(224, 108, 117);">:telemetry</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:execute</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">3</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>        </span><span class="token atom" style="color: rgb(224, 108, 117);">:telemetry</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">execute</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>ev</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> meas</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> meta</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">else</span><span>
</span></span><span><span>        </span><span class="token atom" style="color: rgb(224, 108, 117);">:ok</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">##===================== TOKEN GUARD (compat) ==========================</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defmodule</span><span> __MODULE__</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token module" style="color: rgb(209, 154, 102);">Guard</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    </span><span class="token doc attribute">@moduledoc</span><span class="token doc"> </span><span class="token doc" style="color: rgb(152, 195, 121);">"""
</span></span><span>    Compatibility shim for Core.LIFG.Input.
</span><span>    Ensures maps, index, and optional span-sort.
</span><span><span class="token doc" style="color: rgb(152, 195, 121);">    """</span><span>
</span></span><span><span>    </span><span class="token attribute" style="color: rgb(97, 175, 239);">@spec</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sanitize</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">::</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sanitize</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span>      tokens
</span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(97, 175, 239);">mapify</span><span class="token" style="color: rgb(97, 175, 239);">/</span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">ensure_indexed</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sort_by_span_if_present</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">mapify</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> t
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">mapify</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">%</span><span>_</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> s</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">from_struct</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>s</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">mapify</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>other</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">phrase:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">to_string</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>other</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">ensure_indexed</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span>      list
</span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">with_index</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> i</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>        </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">put_new</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:index</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:index</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"index"</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> i</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sort_by_span_if_present</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(198, 120, 221);">if</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">all?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(97, 175, 239);">valid_span?</span><span class="token" style="color: rgb(97, 175, 239);">/</span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">sort_by</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>list</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(97, 175, 239);">elem</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">fetch!</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token argument" style="color: rgb(97, 175, 239);">&amp;1</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:span</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">else:</span><span> list
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">valid_span?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">%</span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token" style="color: rgb(209, 154, 102);">span:</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span>s</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> l</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">}</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_integer</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>s</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_integer</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>l</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">and</span><span> l </span><span class="token" style="color: rgb(97, 175, 239);">&gt;</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">0</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">true</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">defp</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">valid_span?</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>_</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">false</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">end</span><span>
</span></span><span>
</span><span><span>  </span><span class="token" style="color: rgb(92, 99, 112); font-style: italic;">##================== TOKEN BOUNDARY GUARD (compat) ====================</span><span>
</span></span><span><span>  </span><span class="token" style="color: rgb(198, 120, 221);">defmodule</span><span> __MODULE__</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token module" style="color: rgb(209, 154, 102);">BoundaryGuard</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span><span>    </span><span class="token doc attribute">@moduledoc</span><span class="token doc"> </span><span class="token doc" style="color: rgb(152, 195, 121);">"""
</span></span><span>    Minimal boundary + char-gram guard (keeps MWEs).
</span><span><span class="token doc" style="color: rgb(152, 195, 121);">    """</span><span>
</span></span><span><span>    </span><span class="token attribute" style="color: rgb(97, 175, 239);">@type</span><span> token </span><span class="token" style="color: rgb(97, 175, 239);">::</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>    </span><span class="token attribute" style="color: rgb(97, 175, 239);">@spec</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sanitize</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(97, 175, 239);">token</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">::</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(97, 175, 239);">token</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sanitize</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">do:</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sanitize</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span>
</span><span><span>    </span><span class="token attribute" style="color: rgb(97, 175, 239);">@spec</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sanitize</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(97, 175, 239);">token</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">String</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">t</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">|</span><span> </span><span class="token" style="color: rgb(209, 154, 102);">nil</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">::</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">[</span><span class="token" style="color: rgb(97, 175, 239);">token</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">]</span><span>
</span></span><span><span>    </span><span class="token" style="color: rgb(198, 120, 221);">def</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">sanitize</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> sentence</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">when</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">is_list</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>tokens</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(198, 120, 221);">do</span><span>
</span></span><span>      tokens
</span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">map</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(97, 175, 239);">mapify</span><span class="token" style="color: rgb(97, 175, 239);">/</span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">reject</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(97, 175, 239);">&amp;</span><span class="token" style="color: rgb(97, 175, 239);">chargram?</span><span class="token" style="color: rgb(97, 175, 239);">/</span><span class="token" style="color: rgb(209, 154, 102);">1</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>      </span><span class="token" style="color: rgb(97, 175, 239);">|&gt;</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Enum</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">filter</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token" style="color: rgb(198, 120, 221);">fn</span><span> t </span><span class="token" style="color: rgb(97, 175, 239);">-&gt;</span><span>
</span></span><span><span>        mw? </span><span class="token" style="color: rgb(97, 175, 239);">=</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">truthy</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:mw</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"mw"</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span>
</span></span><span><span>        </span><span class="token" style="color: rgb(198, 120, 221);">case</span><span> </span><span class="token" style="color: rgb(171, 178, 191);">{</span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token atom" style="color: rgb(224, 108, 117);">:span</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span> </span><span class="token" style="color: rgb(97, 175, 239);">||</span><span> </span><span class="token module" style="color: rgb(209, 154, 102);">Map</span><span class="token" style="color: rgb(171, 178, 191);">.</span><span class="token" style="color: rgb(97, 175, 239);">get</span><span class="token" style="color: rgb(171, 178, 191);">(</span><span>t</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> </span><span class="token" style="color: rgb(152, 195, 121);">"span"</span><span class="token" style="color: rgb(171, 178, 191);">)</span><span class="token" style="color: rgb(171, 178, 191);">,</span><span> sentence</span></span></code></pre></div></div></div></div></div><div class="absolute bottom-0 right-2 pointer-events-none" style="transform: none;"><div class="rounded-lg transition min-w-max pointer-events-auto translate-x-2 opacity-0 group-hover:opacity-100"><div class="text-text-300 flex items-stretch justify-between"><div class="w-fit" data-state="closed"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95" type="button" data-testid="action-bar-copy"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div><div class="flex items-center"></div></div></div></div><div data-testid="message-warning" class="flex flex-row gap-1 rounded-md p-2 text-xs select-none -mx-1 mb-1 mt-4 outline outline-1 text-text-100 bg-bg-300/80 text-text-300 outline-bg-400/80"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="shrink-0"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></svg><p>Claude does not have the ability to run the code it generates yet.</p></div></div></div></div><div data-test-render-count="1"><div class="mb-1 mt-1"><div class="group  relative  inline-flex  gap-2  bg-bg-300  rounded-xl  pl-2.5  py-2.5  break-words  text-text-100  transition-all  max-w-[75ch]  flex-col pr-6" style="opacity: 1; transform: none;"><div class="flex flex-row gap-2"><div class="shrink-0"><div class="flex shrink-0 items-center justify-center rounded-full font-bold select-none h-7 w-7 text-[12px] bg-text-200 text-bg-100">B</div></div><div data-testid="user-message" class="font-large !font-user-message grid grid-cols-1 gap-2 py-0.5"><p class="whitespace-pre-wrap break-words">Continue</p></div></div></div></div></div><div data-test-render-count="1"><div style="height: auto; opacity: 1; transform: none;"><div data-is-streaming="false" class="group  relative pb-3" style="opacity: 1; transform: none;"><div class="font-claude-response  relative  leading-[1.65rem]  [&amp;_pre&gt;div]:bg-bg-000/50  [&amp;_pre&gt;div]:border-0.5  [&amp;_pre&gt;div]:border-border-400  [&amp;_.ignore-pre-bg&gt;div]:bg-transparent  [&amp;_.standard-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2  [&amp;_.standard-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8  [&amp;_.progressive-markdown_:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2  [&amp;_.progressive-markdown_:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8"><div><div class="grid-cols-1 grid gap-2.5 [&amp;_&gt;_*]:min-w-0 standard-markdown"><p class="whitespace-pre-wrap break-words">} do
{{s, l}, snt} when is_integer(s) and is_integer(l) and l &gt; 0 and is_binary(snt) -&gt;
boundary_aligned?(snt, s, l) or mw?
_ -&gt; true
end
end)
|&gt; sort_by_span_if_present()
end</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre-wrap; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>defp mapify(%_{} = s), do: Map.from_struct(s)
</span></span><span>defp mapify(%{} = m), do: m
</span><span>defp mapify(other), do: %{phrase: to_string(other)}
</span><span>
</span><span>defp chargram?(t),
</span><span>  do:
</span><span>    (Map.get(t, :chargram) in [true, "true"]) or
</span><span>    (Map.get(t, :kind) in [:chargram, "chargram"]) or
</span><span>    (Map.get(t, :source) in [:chargram, "chargram"])
</span><span>
</span><span>defp sort_by_span_if_present(list) do
</span><span>  if Enum.all?(list, &amp;valid_span?/1), do: Enum.sort_by(list, &amp;elem(Map.fetch!(&amp;1, :span), 0)), else: list
</span><span>end
</span><span>
</span><span>defp valid_span?(%{span: {s, l}}) when is_integer(s) and is_integer(l) and l &gt; 0, do: true
</span><span>defp valid_span?(_), do: false
</span><span>
</span><span>defp boundary_aligned?(snt, s, l) do
</span><span>  left = s - 1
</span><span>  right = s + l
</span><span>  left_ok = s == 0 or not word_char?(String.slice(snt, left, 1))
</span><span>  right_ok = right &gt;= String.length(snt) or not word_char?(String.slice(snt, right, 1))
</span><span>  left_ok and right_ok
</span><span>end
</span><span>
</span><span>defp word_char?(nil), do: false
</span><span>defp word_char?(""), do: false
</span><span>defp word_char?(ch), do: Regex.match?(~r/^[\p{L}\p{N}]$/u, ch)
</span><span>defp truthy(true), do: true
</span><span>defp truthy("true"), do: true
</span><span>defp truthy(_), do: false</span></code></pre></div></div>
<p class="whitespace-normal break-words">end</p>
<p class="whitespace-normal break-words">##========================= STAGE 1 (new) ============================
defmodule <strong>MODULE</strong>.Stage1 do
@moduledoc """
Stage 1 — fast per-token disambiguation from <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">si.sense_candidates</code>.</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre-wrap; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>Options:
</span></span><span>  :weights          — %{lex_fit, rel_prior, activation, intent_bias}
</span><span>  :scores           — :all | :top2 | :none (default from `:lifg_stage1_scores_mode`)
</span><span>  :chargram_event   — telemetry (default [:brain, :lifg, :chargram_violation])
</span><span>  :boundary_event   — telemetry (default [:brain, :lifg, :boundary_drop])
</span><span>  :margin_threshold — default 0.15 (for alt_id emission)
</span><span>"""
</span><span>
</span><span>@small_k_cutoff 4
</span><span>
</span><span>@type si :: map()
</span><span>@type choice :: %{
</span><span>        required(:token_index) =&gt; non_neg_integer(),
</span><span>        required(:chosen_id)   =&gt; String.t(),
</span><span>        required(:alt_ids)     =&gt; [String.t()],
</span><span>        required(:margin)      =&gt; float(),
</span><span>        optional(:scores)      =&gt; map()
</span><span>      }
</span><span>
</span><span>@spec run(si(), keyword()) :: {:ok, %{si: si(), choices: [choice()], audit: map()}}
</span><span>def run(si, opts \\ []) when is_map(si) and is_list(opts) do
</span><span>  t0 = System.monotonic_time()
</span><span>
</span><span>  tokens = Map.get(si, :tokens, [])
</span><span>  slate  = Map.get(si, :sense_candidates, Map.get(si, :candidates_by_token, %{}))
</span><span>
</span><span>  {kept_tokens, dropped} = guard_tokens(tokens, si, opts)
</span><span>
</span><span>  scores_mode =
</span><span>    Keyword.get(opts, :scores, Application.get_env(:brain, :lifg_stage1_scores_mode, :all))
</span><span>
</span><span>  margin_threshold = Keyword.get(opts, :margin_threshold, 0.15)
</span><span>
</span><span>  choices =
</span><span>    kept_tokens
</span><span>    |&gt; Enum.map(fn tok -&gt;
</span><span>      disambiguate_token(
</span><span>        tok,
</span><span>        Map.get(slate, tok.index, []),
</span><span>        scores: scores_mode,
</span><span>        margin_threshold: margin_threshold,
</span><span>        weights: Keyword.get(opts, :weights, %{})
</span><span>      )
</span><span>    end)
</span><span>    |&gt; Enum.reject(&amp;is_nil/1)
</span><span>
</span><span>  timing_ms =
</span><span>    System.convert_time_unit(System.monotonic_time() - t0, :native, :millisecond)
</span><span>
</span><span>  audit = %{
</span><span>    stage: :lifg_stage1,
</span><span>    token_count: length(tokens),
</span><span>    kept_tokens: length(kept_tokens),
</span><span>    dropped_tokens: length(dropped),
</span><span>    timing_ms: timing_ms
</span><span>  }
</span><span>
</span><span>  {:ok, %{si: si, choices: choices, audit: audit}}
</span><span>end
</span><span>
</span><span># Back-compat shim (si, ctx, opts)
</span><span>@spec run(si(), map(), keyword()) :: {:ok, %{si: si(), choices: [choice()], audit: map()}}
</span><span>def run(si, _ctx, opts), do: run(si, opts)
</span><span>
</span><span># ── Guards ─────────────────────────────────────────────────────────
</span><span>
</span><span>defp guard_tokens(tokens, si, opts) do
</span><span>  char_ev = Keyword.get(opts, :chargram_event, [:brain, :lifg, :chargram_violation])
</span><span>  bnd_ev  = Keyword.get(opts, :boundary_event,  [:brain, :lifg, :boundary_drop])
</span><span>
</span><span>  Enum.reduce(tokens, {[], []}, fn tok, {kept, dropped} -&gt;
</span><span>    cond do
</span><span>      is_chargram?(tok) -&gt;
</span><span>        emit(char_ev, %{token_index: tok[:index], phrase: tok[:phrase]}, %{})
</span><span>        {kept, [tok | dropped]}
</span><span>
</span><span>      not boundary_ok?(tok, si) -&gt;
</span><span>        emit(bnd_ev, %{token_index: tok[:index], phrase: tok[:phrase]}, %{})
</span><span>        {kept, [tok | dropped]}
</span><span>
</span><span>      true -&gt;
</span><span>        {[tok | kept], dropped}
</span><span>    end
</span><span>  end)
</span><span>  |&gt; (fn {k, d} -&gt; {Enum.reverse(k), Enum.reverse(d)} end).()
</span><span>end
</span><span>
</span><span>defp is_chargram?(tok) do
</span><span>  (Map.get(tok, :source) in [:chargram, "chargram"]) or
</span><span>    (Map.get(tok, :kind)   in [:chargram, "chargram"]) or
</span><span>    (Map.get(tok, :chargram) in [true, "true"])
</span><span>end
</span><span>
</span><span>defp boundary_ok?(tok, si) do
</span><span>  # MWEs bypass strictness
</span><span>  mw? = Map.get(tok, :mw) || Map.get(tok, "mw") || false
</span><span>  if mw?, do: true, else: do_boundary_check(tok, si)
</span><span>end
</span><span>
</span><span>defp do_boundary_check(tok, si) do
</span><span>  sent = Map.get(si, :sentence)
</span><span>  span = Map.get(tok, :span) || Map.get(tok, "span")
</span><span>
</span><span>  cond do
</span><span>    not is_binary(sent) -&gt; true
</span><span>    not (is_tuple(span) and tuple_size(span) == 2) -&gt; true
</span><span>    true -&gt;
</span><span>      {start, len} = span
</span><span>      start = as_int(start, 0)
</span><span>      len   = as_int(len, 0)
</span><span>      stop  = start + len
</span><span>      s_len = byte_size(sent)
</span><span>
</span><span>      left_ok?  = start &lt;= 0 or not letter?(String.at(sent, start - 1))
</span><span>      right_ok? = stop &gt;= s_len or not letter?(String.at(sent, stop))
</span><span>
</span><span>      left_ok? and right_ok?
</span><span>  end
</span><span>end
</span><span>
</span><span>defp letter?(nil), do: false
</span><span>defp letter?(&lt;&lt;c::utf8&gt;&gt;), do: unicode_letter?(c)
</span><span>defp unicode_letter?(cp),
</span><span>  do: (cp &gt;= ?A and cp &lt;= ?Z) or (cp &gt;= ?a and cp &lt;= ?z) or (cp &gt;= ?À and cp &lt;= 0x024F)
</span><span>
</span><span># ── Disambiguation per token (hybrid) ──────────────────────────────
</span><span>
</span><span>defp disambiguate_token(%{} = tok, cand_list, opts) when is_list(cand_list) do
</span><span>  idx         = tok.index
</span><span>  thr         = Keyword.get(opts, :margin_threshold, 0.15)
</span><span>  scores_mode = Keyword.get(opts, :scores, :all)
</span><span>  w           = weights(opts)
</span><span>
</span><span>  # sanitize input candidates (nil/id-less/dupes) and apply tiny heuristics
</span><span>  cand_list =
</span><span>    cand_list
</span><span>    |&gt; Enum.reject(&amp;is_nil/1)
</span><span>    |&gt; Enum.reject(&amp;(is_nil(&amp;1.id)))
</span><span>    |&gt; Enum.uniq_by(&amp; &amp;1.id)
</span><span>    |&gt; prefer_salutation_interjection(tok)
</span><span>    |&gt; prefer_pronoun_for_I(tok)
</span><span>    |&gt; compat_filter_for_token(tok)
</span><span>
</span><span>  score_cand = fn c -&gt;
</span><span>    f = Map.get(c, :features, %{})
</span><span>    %{
</span><span>      id: c.id,
</span><span>      score:
</span><span>        w.lex_fit     * as_float(f[:lex_fit]     || f["lex_fit"]) +
</span><span>        w.rel_prior   * as_float(f[:rel_prior]   || f["rel_prior"]) +
</span><span>        w.activation  * as_float(f[:activation]  || f["activation"]) +
</span><span>        w.intent_bias * as_float(f[:intent_bias] || f["intent_bias"])
</span><span>    }
</span><span>  end
</span><span>
</span><span>  if length(cand_list) &lt;= @small_k_cutoff do
</span><span>    scored =
</span><span>      cand_list
</span><span>      |&gt; Enum.map(score_cand)
</span><span>      |&gt; Enum.sort_by(&amp;(-&amp;1.score))
</span><span>
</span><span>    case scored do
</span><span>      [] -&gt;
</span><span>        nil
</span><span>
</span><span>      [%{id: top_id, score: top_s} | rest] -&gt;
</span><span>        rest_unique =
</span><span>          rest
</span><span>          |&gt; Enum.reject(&amp;(&amp;1.id == top_id))
</span><span>          |&gt; Enum.uniq_by(&amp; &amp;1.id)
</span><span>
</span><span>        second_s =
</span><span>          case rest_unique do
</span><span>            [%{score: s2} | _] -&gt; s2
</span><span>            _ -&gt; 0.0
</span><span>          end
</span><span>
</span><span>        alt_ids =
</span><span>          if max(top_s - second_s, 0.0) &lt; thr and rest_unique != [] do
</span><span>            [hd(rest_unique).id]
</span><span>          else
</span><span>            []
</span><span>          end
</span><span>
</span><span>        %{
</span><span>          token_index: idx,
</span><span>          chosen_id: top_id,
</span><span>          alt_ids: alt_ids,
</span><span>          margin: max(top_s - second_s, 0.0),
</span><span>          scores: build_scores_map(scored, scores_mode)
</span><span>        }
</span><span>    end
</span><span>  else
</span><span>    {best, second, scored_rev} =
</span><span>      Enum.reduce(cand_list, {nil, nil, []}, fn c, {b1, b2, acc} -&gt;
</span><span>        cur = score_cand.(c)
</span><span>        scr = cur.score
</span><span>        {nb1, nb2} =
</span><span>          cond do
</span><span>            b1 == nil or scr &gt; b1.score -&gt; {cur, b1}
</span><span>            b2 == nil or scr &gt; b2.score -&gt; {b1, cur}
</span><span>            true -&gt; {b1, b2}
</span><span>          end
</span><span>        {nb1, nb2, [cur | acc]}
</span><span>      end)
</span><span>
</span><span>    case best do
</span><span>      nil -&gt;
</span><span>        nil
</span><span>
</span><span>      %{id: top_id, score: top_s} -&gt;
</span><span>        second_s = (second &amp;&amp; second.score) || 0.0
</span><span>        scored   = :lists.reverse(scored_rev)
</span><span>
</span><span>        alt_ids =
</span><span>          if max(top_s - second_s, 0.0) &lt; thr and second do
</span><span>            [second.id]
</span><span>          else
</span><span>            []
</span><span>          end
</span><span>
</span><span>        %{
</span><span>          token_index: idx,
</span><span>          chosen_id: top_id,
</span><span>          alt_ids: alt_ids,
</span><span>          margin: max(top_s - second_s, 0.0),
</span><span>          scores: build_scores_map(scored, scores_mode)
</span><span>        }
</span><span>    end
</span><span>  end
</span><span>end
</span><span>
</span><span># Prefer interjection "greeting" senses for salutations ("hello/hi/hey"), esp. at start
</span><span>defp prefer_salutation_interjection(list, tok) do
</span><span>  phrase = (tok[:phrase] || "") |&gt; to_string()
</span><span>  at_start =
</span><span>    case tok[:span] do
</span><span>      {0, _} -&gt; true
</span><span>      _ -&gt; (tok[:index] || 0) == 0
</span><span>    end
</span><span>
</span><span>  sal? = Regex.match?(~r/^(hello|hi|hey)\b/i, phrase) or at_start
</span><span>
</span><span>  if sal? do
</span><span>    greet =
</span><span>      Enum.filter(list, fn c -&gt;
</span><span>        pos =
</span><span>          (c[:pos] || get_in(c, [:features, :pos]) || "")
</span><span>          |&gt; to_string() |&gt; String.downcase()
</span><span>
</span><span>        defn =
</span><span>          (c[:definition] || get_in(c, [:features, :definition]) || "")
</span><span>          |&gt; to_string() |&gt; String.downcase()
</span><span>
</span><span>        syns =
</span><span>          (c[:synonyms] || get_in(c, [:features, :synonyms]) || [])
</span><span>          |&gt; Enum.map(&amp;String.downcase/1)
</span><span>
</span><span>        String.contains?(pos, "interjection") and
</span><span>          (String.contains?(defn, "greet") or Enum.any?(syns, &amp;(&amp;1 == "greeting")))
</span><span>      end)
</span><span>
</span><span>    if greet != [], do: greet, else: list
</span><span>  else
</span><span>    list
</span><span>  end
</span><span>end
</span><span>
</span><span># Pronoun preference for the token exactly "I"
</span><span>defp prefer_pronoun_for_I(list, tok) when is_list(list) do
</span><span>  phrase = (Map.get(tok, :phrase) || Map.get(tok, "phrase") || "") |&gt; to_string()
</span><span>  if phrase == "I" do
</span><span>    pronounish = Enum.filter(list, fn c -&gt; pos_pronoun?(c) or id_pronounish?(c) end)
</span><span>    if pronounish == [], do: list, else: pronounish
</span><span>  else
</span><span>    list
</span><span>  end
</span><span>end
</span><span>
</span><span>defp pos_pronoun?(c) do
</span><span>  p =
</span><span>    Map.get(c, :pos) ||
</span><span>      get_in(c, [:features, :pos]) ||
</span><span>      get_in(c, ["features", "pos"])
</span><span>
</span><span>  cond do
</span><span>    is_nil(p) -&gt; false
</span><span>    is_atom(p) -&gt; p |&gt; Atom.to_string() |&gt; String.downcase() |&gt; String.contains?("pron")
</span><span>    is_binary(p) -&gt; p |&gt; String.downcase() |&gt; String.contains?("pron")
</span><span>    true -&gt; false
</span><span>  end
</span><span>end
</span><span>
</span><span>defp id_pronounish?(c) do
</span><span>  id = Map.get(c, :id) |&gt; to_string()
</span><span>  String.contains?(String.downcase(id), "pron")
</span><span>end
</span><span>
</span><span># Prefer MWE senses for MWE tokens (and vice versa), with safe fallback
</span><span>defp compat_filter_for_token(list, %{n: n} = tok) when is_list(list) and is_integer(n) do
</span><span>  mwe? = n &gt; 1 or (Map.get(tok, :mw) || Map.get(tok, "mw") || false)
</span><span>  have_lemma? = Enum.any?(list, &amp;has_readable_lemma?/1)
</span><span>
</span><span>  kept =
</span><span>    Enum.filter(list, fn c -&gt;
</span><span>      case sense_lemma(c) do
</span><span>        nil -&gt; true  # if unknown, keep
</span><span>        lemma -&gt;
</span><span>          has_space = String.contains?(lemma, " ")
</span><span>          if mwe?, do: has_space, else: not has_space
</span><span>      end
</span><span>    end)
</span><span>
</span><span>  if have_lemma? and kept == [], do: list, else: kept
</span><span>end
</span><span>
</span><span>defp compat_filter_for_token(list, _tok), do: list
</span><span>
</span><span>defp has_readable_lemma?(c), do: not is_nil(sense_lemma(c))
</span><span>
</span><span>defp sense_lemma(c) do
</span><span>  (Map.get(c, :lemma) ||
</span><span>     get_in(c, [:features, :lemma]) ||
</span><span>     get_in(c, ["features", "lemma"]) ||
</span><span>     Map.get(c, :word))
</span><span>  |&gt; case do
</span><span>    nil -&gt; nil
</span><span>    ""  -&gt; nil
</span><span>    v   -&gt; to_string(v)
</span><span>  end
</span><span>end
</span><span>
</span><span># Build score map per requested mode; default :all for back-compat
</span><span>defp build_scores_map(scored, :all),
</span><span>  do: Map.new(scored, fn %{id: i, score: s} -&gt; {i, s} end)
</span><span>
</span><span>defp build_scores_map(scored, :top2) do
</span><span>  case scored do
</span><span>    [] -&gt; %{}
</span><span>    [a] -&gt; %{a.id =&gt; a.score}
</span><span>    [a, b | _] -&gt; %{a.id =&gt; a.score, b.id =&gt; b.score}
</span><span>  end
</span><span>end
</span><span>
</span><span>defp build_scores_map(_scored, _), do: %{}
</span><span>
</span><span># ── Utils ──────────────────────────────────────────────────────────
</span><span>
</span><span>defp weights(opts) do
</span><span>  env = Application.get_env(:brain, :lifg_stage1_weights, %{})
</span><span>  base = %{lex_fit: 0.4, rel_prior: 0.3, activation: 0.2, intent_bias: 0.1}
</span><span>
</span><span>  base
</span><span>  |&gt; Map.merge(env || %{})
</span><span>  |&gt; Map.merge(Map.new(Keyword.get(opts, :weights, [])))
</span><span>end
</span><span>
</span><span>defp emit(ev, meas, meta) do
</span><span>  if Code.ensure_loaded?(:telemetry) and function_exported?(:telemetry, :execute, 3) do
</span><span>    :telemetry.execute(ev, meas, meta)
</span><span>  else
</span><span>    :ok
</span><span>  end
</span><span>end
</span><span>
</span><span>defp as_int(nil, d), do: d
</span><span>defp as_int(i, _d) when is_integer(i), do: i
</span><span>defp as_int(b, d) when is_binary(b) do
</span><span>  case Integer.parse(b) do
</span><span>    {n, _} -&gt; n
</span><span>    _ -&gt; d
</span><span>  end
</span><span>end
</span><span>
</span><span>defp as_float(nil), do: 0.0
</span><span>defp as_float(n) when is_number(n), do: n * 1.0
</span><span>defp as_float(b) when is_binary(b) do
</span><span>  case Float.parse(b) do
</span><span>    {f, _} -&gt; f
</span><span>    _ -&gt; 0.0
</span><span>  end
</span><span>end</span></code></pre></div></div>
<p class="whitespace-normal break-words">end</p>
<h1 class="text-2xl font-bold mt-1 text-text-100">── Full pipeline wrapper (optional) ─────────────────────────────────</h1>
<p class="whitespace-normal break-words">@doc """
Full LIFG pipeline:
1) ATL finalize → slate (if available)
2) Attach <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">si.sense_candidates</code>
3) Stage-1 disambiguation
4) pMTG consult (sync rerun or async boost/none)</p>
<p class="whitespace-normal break-words">Returns <code class="bg-text-200/5 border border-0.5 border-border-300 text-danger-000 whitespace-pre-wrap rounded-[0.4rem] px-1 py-px text-[0.9rem]">{:ok, %{si, choices, slate}}</code>.
"""
@spec run(map(), keyword()) :: {:ok, %{si: map(), choices: list(), slate: map()}}
def run(si, opts \ []) when is_map(si) do
# 1) ATL finalize (optional)
{si, slate} =
if Code.ensure_loaded?(Brain.ATL) and function_exported?(Brain.ATL, :finalize, 2) do
Brain.ATL.finalize(si, opts)
else
{si, %{}}
end</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre-wrap; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span># 2) attach slate → sense_candidates (optional)
</span></span><span>si =
</span><span>  if Code.ensure_loaded?(Brain.ATL) and
</span><span>       function_exported?(Brain.ATL, :attach_sense_candidates, 3) do
</span><span>    Brain.ATL.attach_sense_candidates(si, slate,
</span><span>      top_k: Keyword.get(opts, :top_k, 3),
</span><span>      margin_window: Keyword.get(opts, :margin_window, 0.05)
</span><span>    )
</span><span>  else
</span><span>    si
</span><span>  end
</span><span>
</span><span># 3) Stage-1
</span><span>scores_mode = Keyword.get(opts, :scores, Application.get_env(:brain, :lifg_stage1_scores_mode, :all))
</span><span>margin_thr  = Keyword.get(opts, :margin_threshold, 0.15)
</span><span>
</span><span>{:ok, %{si: si, choices: choices, audit: _a}} =
</span><span>  __MODULE__.Stage1.run(si,
</span><span>    weights: Map.get(opts, :weights, %{
</span><span>      lex_fit: 0.5, rel_prior: 0.25, activation: 0.15, intent_bias: 0.10
</span><span>    }),
</span><span>    scores: scores_mode,
</span><span>    margin_threshold: margin_thr,
</span><span>    chargram_event: [:brain, :lifg, :chargram_violation],
</span><span>    boundary_event: [:brain, :lifg, :boundary_drop]
</span><span>  )
</span><span>
</span><span># 4) pMTG
</span><span>pmtg_mode = Keyword.get(opts, :pmtg_mode, Application.get_env(:brain, :pmtg_mode, :boost))
</span><span>
</span><span>final_choices =
</span><span>  case {pmtg_mode, Keyword.get(opts, :pmtg_apply?, true)} do
</span><span>    {:rerun, true} -&gt;
</span><span>      {:ok, %{choices: merged}} =
</span><span>        Brain.PMTG.consult_sync(
</span><span>          choices,
</span><span>          si.tokens,
</span><span>          already_needy: false,
</span><span>          margin_threshold: margin_thr,
</span><span>          limit: Keyword.get(opts, :limit, 5),
</span><span>          mode: :rerun,
</span><span>          rerun_only_if_hits: Keyword.get(opts, :rerun_only_if_hits, true),
</span><span>          rerun_weights_bump: Keyword.get(opts, :rerun_weights_bump, %{lex_fit: 0.05, rel_prior: 0.05})
</span><span>        )
</span><span>
</span><span>      merged
</span><span>
</span><span>    _other -&gt;
</span><span>      Brain.PMTG.consult(
</span><span>        choices,
</span><span>        si.tokens,
</span><span>        margin_threshold: margin_thr,
</span><span>        limit: Keyword.get(opts, :limit, 5),
</span><span>        mode: pmtg_mode
</span><span>      )
</span><span>
</span><span>      choices
</span><span>  end
</span><span>
</span><span>{:ok, %{si: si, choices: final_choices, slate: slate}}</span></code></pre></div></div>
<p class="whitespace-normal break-words">end</p>
<h1 class="text-2xl font-bold mt-1 text-text-100">── weights (outer) ─────────────────────────────────────────────────</h1>
<p class="whitespace-pre-wrap break-words">defp to_map(nil), do: %{}
defp to_map(m) when is_map(m), do: m
defp to_map(kv) when is_list(kv), do: Map.new(kv)
defp to_map(_), do: %{}</p>
<p class="whitespace-normal break-words">@type lifg_outer_weights ::
%{
required(:lex) =&gt; float(),
required(:sim) =&gt; float(),
required(:rel) =&gt; float(),
required(:prag) =&gt; float(),
required(:act) =&gt; float(),
optional(:prime) =&gt; float()
}</p>
<p class="whitespace-normal break-words">@doc "Default outer LIFG weights (lex/sim/rel/prag/act + optional :prime)."
@spec default_weights() :: lifg_outer_weights()
def default_weights, do: %{lex: 0.25, sim: 0.40, rel: 0.15, prag: 0.10, act: 0.10, prime: 0.0}</p>
<h1 class="text-2xl font-bold mt-1 text-text-100">Merge order: defaults &lt;- env (lifg_weights OR mapped stage1) &lt;- opts[:weights]</h1>
<p class="whitespace-normal break-words">defp resolved_weights(opts) do
outer_env = to_map(Application.get_env(:brain, :lifg_weights))</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre-wrap; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>mapped_from_stage1 =
</span></span><span>  case to_map(Application.get_env(:brain, :lifg_stage1_weights)) do
</span><span>    %{} = w1 when map_size(w1) &gt; 0 -&gt;
</span><span>      %{
</span><span>        lex:  Map.get(w1, :lex_fit,     default_weights().lex),
</span><span>        sim:  default_weights().sim, # stage-1 has no :sim
</span><span>        rel:  Map.get(w1, :rel_prior,   default_weights().rel),
</span><span>        prag: Map.get(w1, :intent_bias, default_weights().prag),
</span><span>        act:  Map.get(w1, :activation,  default_weights().act)
</span><span>      }
</span><span>    _ -&gt; %{}
</span><span>  end
</span><span>
</span><span>env_weights = if outer_env == %{}, do: mapped_from_stage1, else: outer_env
</span><span>opt_w      = to_map(Keyword.get(opts, :weights, %{}))
</span><span>
</span><span>default_weights()
</span><span>|&gt; Map.merge(env_weights)
</span><span>|&gt; Map.merge(opt_w)</span></code></pre></div></div>
<p class="whitespace-pre-wrap break-words">end
end</p>
<div class="relative group/copy bg-bg-000/50 border-0.5 border-border-400 rounded-lg"><div class="sticky opacity-0 group-hover/copy:opacity-100 top-2 py-2 h-12 w-0 float-right"><div class="absolute right-0 h-8 px-2 items-center inline-flex"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95 backdrop-blur-md" type="button" aria-label="Copy to clipboard" data-state="closed"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div></div><div><pre class="code-block__code !my-0 !rounded-lg !text-sm !leading-relaxed" style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none; padding: 1em; margin: 0.5em 0px; overflow: auto; border-radius: 0.3em;"><code style="background: transparent; color: rgb(171, 178, 191); text-shadow: rgba(0, 0, 0, 0.3) 0px 1px; font-family: var(--font-mono); direction: ltr; text-align: left; white-space: pre-wrap; word-spacing: normal; word-break: normal; line-height: 1.5; tab-size: 2; hyphens: none;"><span><span>
</span></span><span>## Key Changes Made:
</span><span>
</span><span>1. **`candidates_from_cells/2`** - Added strict MWE matching. MWE tokens now only match cells with exact normalized phrase matches, preventing "hello there" from picking up "hello" and "there" candidates.
</span><span>
</span><span>2. **`disambiguate_groups/6`** - Added nil-filtering after mapping to handle tokens that have no valid candidates post-filtering.
</span><span>
</span><span>3. **`norm_phrase/1`** - New shared helper function for consistent phrase normalization across the module.
</span><span>
</span><span>Now when you run `Core.resolve_input "hello there"`:
</span><span>- Token 0 (MWE "hello there"): **0 candidates** (no exact match exists) → no choice emitted
</span><span>- Token 1 ("hello"): Clean competition among only "hello" senses
</span><span>- Token 2 ("there"): Clean competition among only "there" senses
</span><span>
</span><span>The losers will now be actual competing senses of the correct word, not a contaminated mix of unrelated words!</span></code></pre></div></div></div></div></div><div class="absolute bottom-0 right-2 pointer-events-none" style="transform: none;"><div class="rounded-lg transition min-w-max pointer-events-auto translate-x-2 translate-y-full pt-2"><div class="text-text-300 flex items-stretch justify-between"><div class="w-fit" data-state="closed"><button class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none text-text-300
          border-transparent
          transition
          font-base
          duration-300
          ease-[cubic-bezier(0.165,0.85,0.45,1)]
          hover:bg-bg-300
          aria-checked:bg-bg-400
          aria-expanded:bg-bg-400
          hover:text-text-100
          aria-pressed:text-text-100
          aria-checked:text-text-100
          aria-expanded:text-text-100 h-8 w-8 rounded-md active:scale-95" type="button" data-testid="action-bar-copy"><div class="relative"><div class="flex items-center justify-center transition-all opacity-100 scale-100" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 transition-all opacity-100 scale-100" aria-hidden="true"><path d="M10 1.5C11.1097 1.5 12.0758 2.10424 12.5947 3H14.5C15.3284 3 16 3.67157 16 4.5V16.5C16 17.3284 15.3284 18 14.5 18H5.5C4.67157 18 4 17.3284 4 16.5V4.5C4 3.67157 4.67157 3 5.5 3H7.40527C7.92423 2.10424 8.89028 1.5 10 1.5ZM5.5 4C5.22386 4 5 4.22386 5 4.5V16.5C5 16.7761 5.22386 17 5.5 17H14.5C14.7761 17 15 16.7761 15 16.5V4.5C15 4.22386 14.7761 4 14.5 4H12.958C12.9853 4.16263 13 4.32961 13 4.5V5.5C13 5.77614 12.7761 6 12.5 6H7.5C7.22386 6 7 5.77614 7 5.5V4.5C7 4.32961 7.0147 4.16263 7.04199 4H5.5ZM12.54 13.3037C12.6486 13.05 12.9425 12.9317 13.1963 13.04C13.45 13.1486 13.5683 13.4425 13.46 13.6963C13.1651 14.3853 12.589 15 11.7998 15C11.3132 14.9999 10.908 14.7663 10.5996 14.4258C10.2913 14.7661 9.88667 14.9999 9.40039 15C8.91365 15 8.50769 14.7665 8.19922 14.4258C7.89083 14.7661 7.48636 15 7 15C6.72386 15 6.5 14.7761 6.5 14.5C6.5 14.2239 6.72386 14 7 14C7.21245 14 7.51918 13.8199 7.74023 13.3037L7.77441 13.2373C7.86451 13.0913 8.02513 13 8.2002 13C8.40022 13.0001 8.58145 13.1198 8.66016 13.3037C8.88121 13.8198 9.18796 14 9.40039 14C9.61284 13.9998 9.9197 13.8197 10.1406 13.3037L10.1748 13.2373C10.2649 13.0915 10.4248 13.0001 10.5996 13C10.7997 13 10.9808 13.1198 11.0596 13.3037C11.2806 13.8198 11.5874 13.9999 11.7998 14C12.0122 14 12.319 13.8198 12.54 13.3037ZM12.54 9.30371C12.6486 9.05001 12.9425 8.93174 13.1963 9.04004C13.45 9.14863 13.5683 9.44253 13.46 9.69629C13.1651 10.3853 12.589 11 11.7998 11C11.3132 10.9999 10.908 10.7663 10.5996 10.4258C10.2913 10.7661 9.88667 10.9999 9.40039 11C8.91365 11 8.50769 10.7665 8.19922 10.4258C7.89083 10.7661 7.48636 11 7 11C6.72386 11 6.5 10.7761 6.5 10.5C6.5 10.2239 6.72386 10 7 10C7.21245 10 7.51918 9.8199 7.74023 9.30371L7.77441 9.2373C7.86451 9.09126 8.02513 9 8.2002 9C8.40022 9.00008 8.58145 9.11981 8.66016 9.30371C8.88121 9.8198 9.18796 10 9.40039 10C9.61284 9.99978 9.9197 9.81969 10.1406 9.30371L10.1748 9.2373C10.2649 9.09147 10.4248 9.00014 10.5996 9C10.7997 9 10.9808 9.11975 11.0596 9.30371C11.2806 9.8198 11.5874 9.99989 11.7998 10C12.0122 10 12.319 9.81985 12.54 9.30371ZM10 2.5C8.89543 2.5 8 3.39543 8 4.5V5H12V4.5C12 3.39543 11.1046 2.5 10 2.5Z"></path></svg></div><div class="flex items-center justify-center absolute top-0 left-0 transition-all opacity-0 scale-50" style="width: 20px; height: 20px;"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="shrink-0 absolute top-0 left-0 transition-all opacity-0 scale-50" aria-hidden="true"><path d="M15.1883 5.10908C15.3699 4.96398 15.6346 4.96153 15.8202 5.11592C16.0056 5.27067 16.0504 5.53125 15.9403 5.73605L15.8836 5.82003L8.38354 14.8202C8.29361 14.9279 8.16242 14.9925 8.02221 14.9989C7.88203 15.0051 7.74545 14.9526 7.64622 14.8534L4.14617 11.3533L4.08172 11.2752C3.95384 11.0811 3.97542 10.817 4.14617 10.6463C4.31693 10.4755 4.58105 10.4539 4.77509 10.5818L4.85321 10.6463L7.96556 13.7586L15.1161 5.1794L15.1883 5.10908Z"></path></svg></div></div></button></div><div class="flex items-center"></div></div></div></div><div data-testid="message-warning" class="flex flex-row gap-1 rounded-md p-2 text-xs select-none -mx-1 mb-1 mt-4 outline outline-1 text-text-100 bg-bg-300/80 text-text-300 outline-bg-400/80"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="shrink-0"><path d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24Zm0,192a88,88,0,1,1,88-88A88.1,88.1,0,0,1,128,216Zm16-40a8,8,0,0,1-8,8,16,16,0,0,1-16-16V128a8,8,0,0,1,0-16,16,16,0,0,1,16,16v40A8,8,0,0,1,144,176ZM112,84a12,12,0,1,1,12,12A12,12,0,0,1,112,84Z"></path></svg><p>Claude does not have the ability to run the code it generates yet.</p></div></div></div></div></div><div class="sticky bottom-0 flex flex-col items-center justify-center gap-3 pb-4 pt-4 pointer-events-none"><div class="pointer-events-auto"><a target="_self" class="inline-flex
  items-center
  justify-center
  relative
  shrink-0
  can-focus
  select-none
  disabled:pointer-events-none
  disabled:opacity-50
  disabled:shadow-none
  disabled:drop-shadow-none bg-text-000
        text-bg-000
        font-base-bold
        relative
        overflow-hidden
        transition-transform
        will-change-transform
        ease-[cubic-bezier(0.165,0.85,0.45,1)]
        duration-150
        hover:scale-y-[1.015]
        hover:scale-x-[1.005]
        backface-hidden
        after:absolute
        after:inset-0
        after:bg-[radial-gradient(at_bottom,hsla(var(--bg-000)/20%),hsla(var(--bg-000)/0%))]
        after:opacity-0
        after:transition
        after:duration-200
        after:translate-y-2
        hover:after:opacity-100
        hover:after:translate-y-0
        focus:!outline-text-000/75 h-9 px-4 py-2 rounded-lg min-w-[5rem] active:scale-[0.985] whitespace-nowrap" href="https://claude.ai/new">Start your own conversation</a></div></div></div></div></div><div class="max-md:hidden group w-2 relative h-full cursor-col-resize -mr-1 z-30 grid place-items-center hidden"><div class="absolute top-0 bottom-0 right-1 w-[0.5px] bg-border-300 transition-all group-hover:delay-75 group-hover:bg-accent-secondary-100 group-hover:w-px group-hover:translate-x-[0.5px]"></div><div class="h-6 w-2 relative rounded-full border-0.5 bg-bg-100 shadow border-border-300 transition duration-200 group-hover:delay-75 group-hover:border-accent-secondary-900 group-hover:bg-accent-secondary-900 cursor-col-resize"></div></div><div class="max-md:absolute top-0 right-0 bottom-0 left-0 z-20 md:flex-grow-0 md:flex-shrink-0 md:basis-0 overflow-hidden h-screen max-md:hidden" style="flex: 0 0 0%;"><div class="flex flex-col h-full overflow-hidden"><div class="h-12 md:hidden bg-bg-000/30 backdrop-blur border-b-0.5 border-border-300"></div><div class="flex-1 overflow-hidden h-full bg-bg-100"></div></div></div></div></div></div><!--/$--><div role="region" aria-label="Notifications (F8)" tabindex="-1" style="pointer-events:none"><ol tabindex="-1" class="fixed right-0 top-0 z-toast flex flex-col gap-4 p-4" role="status"></ol></div><iframe src="cid:frame-CA2E4D72EEFA19BFEE6D632F49F7858D@mhtml.blink" style="display:none" referrerpolicy="no-referrer" sandbox="allow-scripts allow-same-origin" title=""></iframe><iframe height="1" width="1" style="position: absolute; top: 0px; left: 0px; border: none; visibility: hidden;"></iframe><next-route-announcer style="position: absolute;"><template shadowmode="open"><div aria-live="assertive" id="__next-route-announcer__" role="alert" style="position: absolute; border: 0px; height: 1px; margin: -1px; padding: 0px; width: 1px; clip: rect(0px, 0px, 0px, 0px); overflow: hidden; white-space: nowrap; overflow-wrap: normal;"></div></template></next-route-announcer><iframe id="intercom-frame" style="position: absolute !important; opacity: 0 !important; width: 1px !important; height: 1px !important; top: 0 !important; left: 0 !important; border: none !important; display: block !important; z-index: -1 !important; pointer-events: none;" aria-hidden="true" tabindex="-1" title="Intercom"></iframe><div class="intercom-lightweight-app"></div></body></html>
------MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v----
Content-Type: image/png
Content-Transfer-Encoding: binary
Content-Location: https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fsz%3D64%26domain%3Dgithub.com&w=32&q=75

PNG

   IHDR           D   oPLTE$).).2>CG.37,16SW[JNR7<@[_c޿MQUcgjswzПorv}?CHŷCHLwz}ö`  AIDATxm뒃 PmnoZo3,Qc tF+Gg^eFōlD*Ǘ/y LCtmR\/u&dZRR@M# 2I$g$CNi.`u+SJgt;MopCE
2ٛh4#rp@/oZn%b@K2.2;;vn5LJ=bDQMzL>)uvm~eH<Z_,ӓn TVJqCsx*`a+djs_qu9Q\    IENDB`
------MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v----
Content-Type: image/png
Content-Transfer-Encoding: binary
Content-Location: https://claude.ai/_next/image?url=https%3A%2F%2Fwww.google.com%2Fs2%2Ffavicons%3Fdomain%3Dgithub.com%26sz%3D32&w=32&q=75

PNG

   IHDR           D   oPLTE$).).2>CG.37,16SW[JNR7<@[_c޿MQUcgjswzПorv}?CHŷCHLwz}ö`  AIDATxm뒃 PmnoZo3,Qc tF+Gg^eFōlD*Ǘ/y LCtmR\/u&dZRR@M# 2I$g$CNi.`u+SJgt;MopCE
2ٛh4#rp@/oZn%b@K2.2;;vn5LJ=bDQMzL>)uvm~eH<Z_,ӓn TVJqCsx*`a+djs_qu9Q\    IENDB`
------MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v----
Content-Type: text/css
Content-Transfer-Encoding: binary
Content-Location: https://claude.ai/_next/static/css/251bc1cd2efbb3ee.css

@charset "utf-8";

@font-face { font-family: KaTeX_AMS; font-style: normal; font-weight: 400; src: url("/_next/static/media/KaTeX_AMS-Regular.a79f1c31.woff2") format("woff2"), url("/_next/static/media/KaTeX_AMS-Regular.1608a09b.woff") format("woff"), url("/_next/static/media/KaTeX_AMS-Regular.4aafdb68.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Caligraphic; font-style: normal; font-weight: 700; src: url("/_next/static/media/KaTeX_Caligraphic-Bold.ec17d132.woff2") format("woff2"), url("/_next/static/media/KaTeX_Caligraphic-Bold.b6770918.woff") format("woff"), url("/_next/static/media/KaTeX_Caligraphic-Bold.cce5b8ec.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Caligraphic; font-style: normal; font-weight: 400; src: url("/_next/static/media/KaTeX_Caligraphic-Regular.55fac258.woff2") format("woff2"), url("/_next/static/media/KaTeX_Caligraphic-Regular.dad44a7f.woff") format("woff"), url("/_next/static/media/KaTeX_Caligraphic-Regular.07ef19e7.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Fraktur; font-style: normal; font-weight: 700; src: url("/_next/static/media/KaTeX_Fraktur-Bold.d42a5579.woff2") format("woff2"), url("/_next/static/media/KaTeX_Fraktur-Bold.9f256b85.woff") format("woff"), url("/_next/static/media/KaTeX_Fraktur-Bold.b18f59e1.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Fraktur; font-style: normal; font-weight: 400; src: url("/_next/static/media/KaTeX_Fraktur-Regular.d3c882a6.woff2") format("woff2"), url("/_next/static/media/KaTeX_Fraktur-Regular.7c187121.woff") format("woff"), url("/_next/static/media/KaTeX_Fraktur-Regular.ed38e79f.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Main; font-style: normal; font-weight: 700; src: url("/_next/static/media/KaTeX_Main-Bold.c3fb5ac2.woff2") format("woff2"), url("/_next/static/media/KaTeX_Main-Bold.d181c465.woff") format("woff"), url("/_next/static/media/KaTeX_Main-Bold.b74a1a8b.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Main; font-style: italic; font-weight: 700; src: url("/_next/static/media/KaTeX_Main-BoldItalic.6f2bb1df.woff2") format("woff2"), url("/_next/static/media/KaTeX_Main-BoldItalic.e3f82f9d.woff") format("woff"), url("/_next/static/media/KaTeX_Main-BoldItalic.70d8b0a5.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Main; font-style: italic; font-weight: 400; src: url("/_next/static/media/KaTeX_Main-Italic.8916142b.woff2") format("woff2"), url("/_next/static/media/KaTeX_Main-Italic.9024d815.woff") format("woff"), url("/_next/static/media/KaTeX_Main-Italic.47373d1e.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Main; font-style: normal; font-weight: 400; src: url("/_next/static/media/KaTeX_Main-Regular.0462f03b.woff2") format("woff2"), url("/_next/static/media/KaTeX_Main-Regular.7f51fe03.woff") format("woff"), url("/_next/static/media/KaTeX_Main-Regular.b7f8fe9b.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Math; font-style: italic; font-weight: 700; src: url("/_next/static/media/KaTeX_Math-BoldItalic.572d331f.woff2") format("woff2"), url("/_next/static/media/KaTeX_Math-BoldItalic.f1035d8d.woff") format("woff"), url("/_next/static/media/KaTeX_Math-BoldItalic.a879cf83.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Math; font-style: italic; font-weight: 400; src: url("/_next/static/media/KaTeX_Math-Italic.f28c23ac.woff2") format("woff2"), url("/_next/static/media/KaTeX_Math-Italic.5295ba48.woff") format("woff"), url("/_next/static/media/KaTeX_Math-Italic.939bc644.ttf") format("truetype"); }

@font-face { font-family: KaTeX_SansSerif; font-style: normal; font-weight: 700; src: url("/_next/static/media/KaTeX_SansSerif-Bold.8c5b5494.woff2") format("woff2"), url("/_next/static/media/KaTeX_SansSerif-Bold.bf59d231.woff") format("woff"), url("/_next/static/media/KaTeX_SansSerif-Bold.94e1e8dc.ttf") format("truetype"); }

@font-face { font-family: KaTeX_SansSerif; font-style: italic; font-weight: 400; src: url("/_next/static/media/KaTeX_SansSerif-Italic.3b1e59b3.woff2") format("woff2"), url("/_next/static/media/KaTeX_SansSerif-Italic.7c9bc82b.woff") format("woff"), url("/_next/static/media/KaTeX_SansSerif-Italic.b4c20c84.ttf") format("truetype"); }

@font-face { font-family: KaTeX_SansSerif; font-style: normal; font-weight: 400; src: url("/_next/static/media/KaTeX_SansSerif-Regular.ba21ed5f.woff2") format("woff2"), url("/_next/static/media/KaTeX_SansSerif-Regular.74048478.woff") format("woff"), url("/_next/static/media/KaTeX_SansSerif-Regular.d4d7ba48.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Script; font-style: normal; font-weight: 400; src: url("/_next/static/media/KaTeX_Script-Regular.03e9641d.woff2") format("woff2"), url("/_next/static/media/KaTeX_Script-Regular.07505710.woff") format("woff"), url("/_next/static/media/KaTeX_Script-Regular.fe9cbbe1.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Size1; font-style: normal; font-weight: 400; src: url("/_next/static/media/KaTeX_Size1-Regular.eae34984.woff2") format("woff2"), url("/_next/static/media/KaTeX_Size1-Regular.e1e279cb.woff") format("woff"), url("/_next/static/media/KaTeX_Size1-Regular.fabc004a.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Size2; font-style: normal; font-weight: 400; src: url("/_next/static/media/KaTeX_Size2-Regular.5916a24f.woff2") format("woff2"), url("/_next/static/media/KaTeX_Size2-Regular.57727022.woff") format("woff"), url("/_next/static/media/KaTeX_Size2-Regular.d6b476ec.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Size3; font-style: normal; font-weight: 400; src: url("/_next/static/media/KaTeX_Size3-Regular.b4230e7e.woff2") format("woff2"), url("/_next/static/media/KaTeX_Size3-Regular.9acaf01c.woff") format("woff"), url("/_next/static/media/KaTeX_Size3-Regular.a144ef58.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Size4; font-style: normal; font-weight: 400; src: url("/_next/static/media/KaTeX_Size4-Regular.10d95fd3.woff2") format("woff2"), url("/_next/static/media/KaTeX_Size4-Regular.7a996c9d.woff") format("woff"), url("/_next/static/media/KaTeX_Size4-Regular.fbccdabe.ttf") format("truetype"); }

@font-face { font-family: KaTeX_Typewriter; font-style: normal; font-weight: 400; src: url("/_next/static/media/KaTeX_Typewriter-Regular.a8709e36.woff2") format("woff2"), url("/_next/static/media/KaTeX_Typewriter-Regular.6258592b.woff") format("woff"), url("/_next/static/media/KaTeX_Typewriter-Regular.d97aaf4a.ttf") format("truetype"); }

.katex { font: 1.21em / 1.2 KaTeX_Main, "Times New Roman", serif; text-indent: 0px; text-rendering: auto; }

.katex * { border-color: currentcolor; }

.katex .katex-version::after { content: "0.16.21"; }

.katex .katex-mathml { clip: rect(1px, 1px, 1px, 1px); border: 0px; height: 1px; overflow: hidden; padding: 0px; position: absolute; width: 1px; }

.katex .katex-html > .newline { display: block; }

.katex .base { position: relative; white-space: nowrap; width: min-content; }

.katex .base, .katex .strut { display: inline-block; }

.katex .textbf { font-weight: 700; }

.katex .textit { font-style: italic; }

.katex .textrm { font-family: KaTeX_Main; }

.katex .textsf { font-family: KaTeX_SansSerif; }

.katex .texttt { font-family: KaTeX_Typewriter; }

.katex .mathnormal { font-family: KaTeX_Math; font-style: italic; }

.katex .mathit { font-family: KaTeX_Main; font-style: italic; }

.katex .mathrm { font-style: normal; }

.katex .mathbf { font-family: KaTeX_Main; font-weight: 700; }

.katex .boldsymbol { font-family: KaTeX_Math; font-style: italic; font-weight: 700; }

.katex .amsrm, .katex .mathbb, .katex .textbb { font-family: KaTeX_AMS; }

.katex .mathcal { font-family: KaTeX_Caligraphic; }

.katex .mathfrak, .katex .textfrak { font-family: KaTeX_Fraktur; }

.katex .mathboldfrak, .katex .textboldfrak { font-family: KaTeX_Fraktur; font-weight: 700; }

.katex .mathtt { font-family: KaTeX_Typewriter; }

.katex .mathscr, .katex .textscr { font-family: KaTeX_Script; }

.katex .mathsf, .katex .textsf { font-family: KaTeX_SansSerif; }

.katex .mathboldsf, .katex .textboldsf { font-family: KaTeX_SansSerif; font-weight: 700; }

.katex .mathitsf, .katex .mathsfit, .katex .textitsf { font-family: KaTeX_SansSerif; font-style: italic; }

.katex .mainrm { font-family: KaTeX_Main; font-style: normal; }

.katex .vlist-t { border-collapse: collapse; display: inline-table; table-layout: fixed; }

.katex .vlist-r { display: table-row; }

.katex .vlist { display: table-cell; position: relative; vertical-align: bottom; }

.katex .vlist > span { display: block; height: 0px; position: relative; }

.katex .vlist > span > span { display: inline-block; }

.katex .vlist > span > .pstrut { overflow: hidden; width: 0px; }

.katex .vlist-t2 { margin-right: -2px; }

.katex .vlist-s { display: table-cell; font-size: 1px; min-width: 2px; vertical-align: bottom; width: 2px; }

.katex .vbox { align-items: baseline; display: inline-flex; flex-direction: column; }

.katex .hbox { width: 100%; }

.katex .hbox, .katex .thinbox { display: inline-flex; flex-direction: row; }

.katex .thinbox { max-width: 0px; width: 0px; }

.katex .msupsub { text-align: left; }

.katex .mfrac > span > span { text-align: center; }

.katex .mfrac .frac-line { border-bottom-style: solid; display: inline-block; width: 100%; }

.katex .hdashline, .katex .hline, .katex .mfrac .frac-line, .katex .overline .overline-line, .katex .rule, .katex .underline .underline-line { min-height: 1px; }

.katex .mspace { display: inline-block; }

.katex .clap, .katex .llap, .katex .rlap { position: relative; width: 0px; }

.katex .clap > .inner, .katex .llap > .inner, .katex .rlap > .inner { position: absolute; }

.katex .clap > .fix, .katex .llap > .fix, .katex .rlap > .fix { display: inline-block; }

.katex .llap > .inner { right: 0px; }

.katex .clap > .inner, .katex .rlap > .inner { left: 0px; }

.katex .clap > .inner > span { margin-left: -50%; margin-right: 50%; }

.katex .rule { border: 0px solid; display: inline-block; position: relative; }

.katex .hline, .katex .overline .overline-line, .katex .underline .underline-line { border-bottom-style: solid; display: inline-block; width: 100%; }

.katex .hdashline { border-bottom-style: dashed; display: inline-block; width: 100%; }

.katex .sqrt > .root { margin-left: 0.277778em; margin-right: -0.555556em; }

.katex .fontsize-ensurer.reset-size1.size1, .katex .sizing.reset-size1.size1 { font-size: 1em; }

.katex .fontsize-ensurer.reset-size1.size2, .katex .sizing.reset-size1.size2 { font-size: 1.2em; }

.katex .fontsize-ensurer.reset-size1.size3, .katex .sizing.reset-size1.size3 { font-size: 1.4em; }

.katex .fontsize-ensurer.reset-size1.size4, .katex .sizing.reset-size1.size4 { font-size: 1.6em; }

.katex .fontsize-ensurer.reset-size1.size5, .katex .sizing.reset-size1.size5 { font-size: 1.8em; }

.katex .fontsize-ensurer.reset-size1.size6, .katex .sizing.reset-size1.size6 { font-size: 2em; }

.katex .fontsize-ensurer.reset-size1.size7, .katex .sizing.reset-size1.size7 { font-size: 2.4em; }

.katex .fontsize-ensurer.reset-size1.size8, .katex .sizing.reset-size1.size8 { font-size: 2.88em; }

.katex .fontsize-ensurer.reset-size1.size9, .katex .sizing.reset-size1.size9 { font-size: 3.456em; }

.katex .fontsize-ensurer.reset-size1.size10, .katex .sizing.reset-size1.size10 { font-size: 4.148em; }

.katex .fontsize-ensurer.reset-size1.size11, .katex .sizing.reset-size1.size11 { font-size: 4.976em; }

.katex .fontsize-ensurer.reset-size2.size1, .katex .sizing.reset-size2.size1 { font-size: 0.833333em; }

.katex .fontsize-ensurer.reset-size2.size2, .katex .sizing.reset-size2.size2 { font-size: 1em; }

.katex .fontsize-ensurer.reset-size2.size3, .katex .sizing.reset-size2.size3 { font-size: 1.16667em; }

.katex .fontsize-ensurer.reset-size2.size4, .katex .sizing.reset-size2.size4 { font-size: 1.33333em; }

.katex .fontsize-ensurer.reset-size2.size5, .katex .sizing.reset-size2.size5 { font-size: 1.5em; }

.katex .fontsize-ensurer.reset-size2.size6, .katex .sizing.reset-size2.size6 { font-size: 1.66667em; }

.katex .fontsize-ensurer.reset-size2.size7, .katex .sizing.reset-size2.size7 { font-size: 2em; }

.katex .fontsize-ensurer.reset-size2.size8, .katex .sizing.reset-size2.size8 { font-size: 2.4em; }

.katex .fontsize-ensurer.reset-size2.size9, .katex .sizing.reset-size2.size9 { font-size: 2.88em; }

.katex .fontsize-ensurer.reset-size2.size10, .katex .sizing.reset-size2.size10 { font-size: 3.45667em; }

.katex .fontsize-ensurer.reset-size2.size11, .katex .sizing.reset-size2.size11 { font-size: 4.14667em; }

.katex .fontsize-ensurer.reset-size3.size1, .katex .sizing.reset-size3.size1 { font-size: 0.714286em; }

.katex .fontsize-ensurer.reset-size3.size2, .katex .sizing.reset-size3.size2 { font-size: 0.857143em; }

.katex .fontsize-ensurer.reset-size3.size3, .katex .sizing.reset-size3.size3 { font-size: 1em; }

.katex .fontsize-ensurer.reset-size3.size4, .katex .sizing.reset-size3.size4 { font-size: 1.14286em; }

.katex .fontsize-ensurer.reset-size3.size5, .katex .sizing.reset-size3.size5 { font-size: 1.28571em; }

.katex .fontsize-ensurer.reset-size3.size6, .katex .sizing.reset-size3.size6 { font-size: 1.42857em; }

.katex .fontsize-ensurer.reset-size3.size7, .katex .sizing.reset-size3.size7 { font-size: 1.71429em; }

.katex .fontsize-ensurer.reset-size3.size8, .katex .sizing.reset-size3.size8 { font-size: 2.05714em; }

.katex .fontsize-ensurer.reset-size3.size9, .katex .sizing.reset-size3.size9 { font-size: 2.46857em; }

.katex .fontsize-ensurer.reset-size3.size10, .katex .sizing.reset-size3.size10 { font-size: 2.96286em; }

.katex .fontsize-ensurer.reset-size3.size11, .katex .sizing.reset-size3.size11 { font-size: 3.55429em; }

.katex .fontsize-ensurer.reset-size4.size1, .katex .sizing.reset-size4.size1 { font-size: 0.625em; }

.katex .fontsize-ensurer.reset-size4.size2, .katex .sizing.reset-size4.size2 { font-size: 0.75em; }

.katex .fontsize-ensurer.reset-size4.size3, .katex .sizing.reset-size4.size3 { font-size: 0.875em; }

.katex .fontsize-ensurer.reset-size4.size4, .katex .sizing.reset-size4.size4 { font-size: 1em; }

.katex .fontsize-ensurer.reset-size4.size5, .katex .sizing.reset-size4.size5 { font-size: 1.125em; }

.katex .fontsize-ensurer.reset-size4.size6, .katex .sizing.reset-size4.size6 { font-size: 1.25em; }

.katex .fontsize-ensurer.reset-size4.size7, .katex .sizing.reset-size4.size7 { font-size: 1.5em; }

.katex .fontsize-ensurer.reset-size4.size8, .katex .sizing.reset-size4.size8 { font-size: 1.8em; }

.katex .fontsize-ensurer.reset-size4.size9, .katex .sizing.reset-size4.size9 { font-size: 2.16em; }

.katex .fontsize-ensurer.reset-size4.size10, .katex .sizing.reset-size4.size10 { font-size: 2.5925em; }

.katex .fontsize-ensurer.reset-size4.size11, .katex .sizing.reset-size4.size11 { font-size: 3.11em; }

.katex .fontsize-ensurer.reset-size5.size1, .katex .sizing.reset-size5.size1 { font-size: 0.555556em; }

.katex .fontsize-ensurer.reset-size5.size2, .katex .sizing.reset-size5.size2 { font-size: 0.666667em; }

.katex .fontsize-ensurer.reset-size5.size3, .katex .sizing.reset-size5.size3 { font-size: 0.777778em; }

.katex .fontsize-ensurer.reset-size5.size4, .katex .sizing.reset-size5.size4 { font-size: 0.888889em; }

.katex .fontsize-ensurer.reset-size5.size5, .katex .sizing.reset-size5.size5 { font-size: 1em; }

.katex .fontsize-ensurer.reset-size5.size6, .katex .sizing.reset-size5.size6 { font-size: 1.11111em; }

.katex .fontsize-ensurer.reset-size5.size7, .katex .sizing.reset-size5.size7 { font-size: 1.33333em; }

.katex .fontsize-ensurer.reset-size5.size8, .katex .sizing.reset-size5.size8 { font-size: 1.6em; }

.katex .fontsize-ensurer.reset-size5.size9, .katex .sizing.reset-size5.size9 { font-size: 1.92em; }

.katex .fontsize-ensurer.reset-size5.size10, .katex .sizing.reset-size5.size10 { font-size: 2.30444em; }

.katex .fontsize-ensurer.reset-size5.size11, .katex .sizing.reset-size5.size11 { font-size: 2.76444em; }

.katex .fontsize-ensurer.reset-size6.size1, .katex .sizing.reset-size6.size1 { font-size: 0.5em; }

.katex .fontsize-ensurer.reset-size6.size2, .katex .sizing.reset-size6.size2 { font-size: 0.6em; }

.katex .fontsize-ensurer.reset-size6.size3, .katex .sizing.reset-size6.size3 { font-size: 0.7em; }

.katex .fontsize-ensurer.reset-size6.size4, .katex .sizing.reset-size6.size4 { font-size: 0.8em; }

.katex .fontsize-ensurer.reset-size6.size5, .katex .sizing.reset-size6.size5 { font-size: 0.9em; }

.katex .fontsize-ensurer.reset-size6.size6, .katex .sizing.reset-size6.size6 { font-size: 1em; }

.katex .fontsize-ensurer.reset-size6.size7, .katex .sizing.reset-size6.size7 { font-size: 1.2em; }

.katex .fontsize-ensurer.reset-size6.size8, .katex .sizing.reset-size6.size8 { font-size: 1.44em; }

.katex .fontsize-ensurer.reset-size6.size9, .katex .sizing.reset-size6.size9 { font-size: 1.728em; }

.katex .fontsize-ensurer.reset-size6.size10, .katex .sizing.reset-size6.size10 { font-size: 2.074em; }

.katex .fontsize-ensurer.reset-size6.size11, .katex .sizing.reset-size6.size11 { font-size: 2.488em; }

.katex .fontsize-ensurer.reset-size7.size1, .katex .sizing.reset-size7.size1 { font-size: 0.416667em; }

.katex .fontsize-ensurer.reset-size7.size2, .katex .sizing.reset-size7.size2 { font-size: 0.5em; }

.katex .fontsize-ensurer.reset-size7.size3, .katex .sizing.reset-size7.size3 { font-size: 0.583333em; }

.katex .fontsize-ensurer.reset-size7.size4, .katex .sizing.reset-size7.size4 { font-size: 0.666667em; }

.katex .fontsize-ensurer.reset-size7.size5, .katex .sizing.reset-size7.size5 { font-size: 0.75em; }

.katex .fontsize-ensurer.reset-size7.size6, .katex .sizing.reset-size7.size6 { font-size: 0.833333em; }

.katex .fontsize-ensurer.reset-size7.size7, .katex .sizing.reset-size7.size7 { font-size: 1em; }

.katex .fontsize-ensurer.reset-size7.size8, .katex .sizing.reset-size7.size8 { font-size: 1.2em; }

.katex .fontsize-ensurer.reset-size7.size9, .katex .sizing.reset-size7.size9 { font-size: 1.44em; }

.katex .fontsize-ensurer.reset-size7.size10, .katex .sizing.reset-size7.size10 { font-size: 1.72833em; }

.katex .fontsize-ensurer.reset-size7.size11, .katex .sizing.reset-size7.size11 { font-size: 2.07333em; }

.katex .fontsize-ensurer.reset-size8.size1, .katex .sizing.reset-size8.size1 { font-size: 0.347222em; }

.katex .fontsize-ensurer.reset-size8.size2, .katex .sizing.reset-size8.size2 { font-size: 0.416667em; }

.katex .fontsize-ensurer.reset-size8.size3, .katex .sizing.reset-size8.size3 { font-size: 0.486111em; }

.katex .fontsize-ensurer.reset-size8.size4, .katex .sizing.reset-size8.size4 { font-size: 0.555556em; }

.katex .fontsize-ensurer.reset-size8.size5, .katex .sizing.reset-size8.size5 { font-size: 0.625em; }

.katex .fontsize-ensurer.reset-size8.size6, .katex .sizing.reset-size8.size6 { font-size: 0.694444em; }

.katex .fontsize-ensurer.reset-size8.size7, .katex .sizing.reset-size8.size7 { font-size: 0.833333em; }

.katex .fontsize-ensurer.reset-size8.size8, .katex .sizing.reset-size8.size8 { font-size: 1em; }

.katex .fontsize-ensurer.reset-size8.size9, .katex .sizing.reset-size8.size9 { font-size: 1.2em; }

.katex .fontsize-ensurer.reset-size8.size10, .katex .sizing.reset-size8.size10 { font-size: 1.44028em; }

.katex .fontsize-ensurer.reset-size8.size11, .katex .sizing.reset-size8.size11 { font-size: 1.72778em; }

.katex .fontsize-ensurer.reset-size9.size1, .katex .sizing.reset-size9.size1 { font-size: 0.289352em; }

.katex .fontsize-ensurer.reset-size9.size2, .katex .sizing.reset-size9.size2 { font-size: 0.347222em; }

.katex .fontsize-ensurer.reset-size9.size3, .katex .sizing.reset-size9.size3 { font-size: 0.405093em; }

.katex .fontsize-ensurer.reset-size9.size4, .katex .sizing.reset-size9.size4 { font-size: 0.462963em; }

.katex .fontsize-ensurer.reset-size9.size5, .katex .sizing.reset-size9.size5 { font-size: 0.520833em; }

.katex .fontsize-ensurer.reset-size9.size6, .katex .sizing.reset-size9.size6 { font-size: 0.578704em; }

.katex .fontsize-ensurer.reset-size9.size7, .katex .sizing.reset-size9.size7 { font-size: 0.694444em; }

.katex .fontsize-ensurer.reset-size9.size8, .katex .sizing.reset-size9.size8 { font-size: 0.833333em; }

.katex .fontsize-ensurer.reset-size9.size9, .katex .sizing.reset-size9.size9 { font-size: 1em; }

.katex .fontsize-ensurer.reset-size9.size10, .katex .sizing.reset-size9.size10 { font-size: 1.20023em; }

.katex .fontsize-ensurer.reset-size9.size11, .katex .sizing.reset-size9.size11 { font-size: 1.43981em; }

.katex .fontsize-ensurer.reset-size10.size1, .katex .sizing.reset-size10.size1 { font-size: 0.24108em; }

.katex .fontsize-ensurer.reset-size10.size2, .katex .sizing.reset-size10.size2 { font-size: 0.289296em; }

.katex .fontsize-ensurer.reset-size10.size3, .katex .sizing.reset-size10.size3 { font-size: 0.337512em; }

.katex .fontsize-ensurer.reset-size10.size4, .katex .sizing.reset-size10.size4 { font-size: 0.385728em; }

.katex .fontsize-ensurer.reset-size10.size5, .katex .sizing.reset-size10.size5 { font-size: 0.433944em; }

.katex .fontsize-ensurer.reset-size10.size6, .katex .sizing.reset-size10.size6 { font-size: 0.48216em; }

.katex .fontsize-ensurer.reset-size10.size7, .katex .sizing.reset-size10.size7 { font-size: 0.578592em; }

.katex .fontsize-ensurer.reset-size10.size8, .katex .sizing.reset-size10.size8 { font-size: 0.694311em; }

.katex .fontsize-ensurer.reset-size10.size9, .katex .sizing.reset-size10.size9 { font-size: 0.833173em; }

.katex .fontsize-ensurer.reset-size10.size10, .katex .sizing.reset-size10.size10 { font-size: 1em; }

.katex .fontsize-ensurer.reset-size10.size11, .katex .sizing.reset-size10.size11 { font-size: 1.19961em; }

.katex .fontsize-ensurer.reset-size11.size1, .katex .sizing.reset-size11.size1 { font-size: 0.200965em; }

.katex .fontsize-ensurer.reset-size11.size2, .katex .sizing.reset-size11.size2 { font-size: 0.241158em; }

.katex .fontsize-ensurer.reset-size11.size3, .katex .sizing.reset-size11.size3 { font-size: 0.28135em; }

.katex .fontsize-ensurer.reset-size11.size4, .katex .sizing.reset-size11.size4 { font-size: 0.321543em; }

.katex .fontsize-ensurer.reset-size11.size5, .katex .sizing.reset-size11.size5 { font-size: 0.361736em; }

.katex .fontsize-ensurer.reset-size11.size6, .katex .sizing.reset-size11.size6 { font-size: 0.401929em; }

.katex .fontsize-ensurer.reset-size11.size7, .katex .sizing.reset-size11.size7 { font-size: 0.482315em; }

.katex .fontsize-ensurer.reset-size11.size8, .katex .sizing.reset-size11.size8 { font-size: 0.578778em; }

.katex .fontsize-ensurer.reset-size11.size9, .katex .sizing.reset-size11.size9 { font-size: 0.694534em; }

.katex .fontsize-ensurer.reset-size11.size10, .katex .sizing.reset-size11.size10 { font-size: 0.833601em; }

.katex .fontsize-ensurer.reset-size11.size11, .katex .sizing.reset-size11.size11 { font-size: 1em; }

.katex .delimsizing.size1 { font-family: KaTeX_Size1; }

.katex .delimsizing.size2 { font-family: KaTeX_Size2; }

.katex .delimsizing.size3 { font-family: KaTeX_Size3; }

.katex .delimsizing.size4 { font-family: KaTeX_Size4; }

.katex .delimsizing.mult .delim-size1 > span { font-family: KaTeX_Size1; }

.katex .delimsizing.mult .delim-size4 > span { font-family: KaTeX_Size4; }

.katex .nulldelimiter { display: inline-block; width: 0.12em; }

.katex .delimcenter, .katex .op-symbol { position: relative; }

.katex .op-symbol.small-op { font-family: KaTeX_Size1; }

.katex .op-symbol.large-op { font-family: KaTeX_Size2; }

.katex .accent > .vlist-t, .katex .op-limits > .vlist-t { text-align: center; }

.katex .accent .accent-body { position: relative; }

.katex .accent .accent-body:not(.accent-full) { width: 0px; }

.katex .overlay { display: block; }

.katex .mtable .vertical-separator { display: inline-block; min-width: 1px; }

.katex .mtable .arraycolsep { display: inline-block; }

.katex .mtable .col-align-c > .vlist-t { text-align: center; }

.katex .mtable .col-align-l > .vlist-t { text-align: left; }

.katex .mtable .col-align-r > .vlist-t { text-align: right; }

.katex .svg-align { text-align: left; }

.katex svg { fill: currentcolor; stroke: currentcolor; fill-rule: nonzero; fill-opacity: 1; stroke-width: 1; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 4; stroke-dasharray: none; stroke-dashoffset: 0; stroke-opacity: 1; display: block; height: inherit; position: absolute; width: 100%; }

.katex svg path { stroke: none; }

.katex img { border-style: none; max-height: none; max-width: none; min-height: 0px; min-width: 0px; }

.katex .stretchy { display: block; overflow: hidden; position: relative; width: 100%; }

.katex .stretchy::after, .katex .stretchy::before { content: ""; }

.katex .hide-tail { overflow: hidden; position: relative; width: 100%; }

.katex .halfarrow-left { left: 0px; overflow: hidden; position: absolute; width: 50.2%; }

.katex .halfarrow-right { overflow: hidden; position: absolute; right: 0px; width: 50.2%; }

.katex .brace-left { left: 0px; overflow: hidden; position: absolute; width: 25.1%; }

.katex .brace-center { left: 25%; overflow: hidden; position: absolute; width: 50%; }

.katex .brace-right { overflow: hidden; position: absolute; right: 0px; width: 25.1%; }

.katex .x-arrow-pad { padding: 0px 0.5em; }

.katex .cd-arrow-pad { padding: 0px 0.55556em 0px 0.27778em; }

.katex .mover, .katex .munder, .katex .x-arrow { text-align: center; }

.katex .boxpad { padding: 0px 0.3em; }

.katex .fbox, .katex .fcolorbox { border: 0.04em solid; box-sizing: border-box; }

.katex .cancel-pad { padding: 0px 0.2em; }

.katex .cancel-lap { margin-left: -0.2em; margin-right: -0.2em; }

.katex .sout { border-bottom-style: solid; border-bottom-width: 0.08em; }

.katex .angl { border-right: 0.049em solid; border-top: 0.049em solid; box-sizing: border-box; margin-right: 0.03889em; }

.katex .anglpad { padding: 0px 0.03889em; }

.katex .eqn-num::before { content: "(" counter(katexEqnNo) ")"; counter-increment: katexEqnNo 1; }

.katex .mml-eqn-num::before { content: "(" counter(mmlEqnNo) ")"; counter-increment: mmlEqnNo 1; }

.katex .mtr-glue { width: 50%; }

.katex .cd-vert-arrow { display: inline-block; position: relative; }

.katex .cd-label-left { display: inline-block; position: absolute; right: calc(50% + 0.3em); text-align: left; }

.katex .cd-label-right { display: inline-block; left: calc(50% + 0.3em); position: absolute; text-align: right; }

.katex-display { display: block; margin: 1em 0px; text-align: center; }

.katex-display > .katex { display: block; text-align: center; white-space: nowrap; }

.katex-display > .katex > .katex-html { display: block; position: relative; }

.katex-display > .katex > .katex-html > .tag { position: absolute; right: 0px; }

.katex-display.leqno > .katex > .katex-html > .tag { left: 0px; right: auto; }

.katex-display.fleqn > .katex { padding-left: 2em; text-align: left; }

body { counter-reset: katexEqnNo 0 mmlEqnNo 0; }

.ArtifactPreview_markdownPreview__qQ6Rp { --text-base: 0.6rem; --text-h1: 0.75rem; --text-h2: 0.7rem; --text-h3: 0.65rem; --text-code: 0.5rem; --spacing-xs: 2px; --spacing-sm: 3px; --line-height: 0.8rem; font-size: var(--text-base); line-height: var(--line-height); gap: 0.25rem !important; }

.ArtifactPreview_markdownPreview__qQ6Rp * { font-size: var(--text-base) !important; line-height: var(--line-height) !important; }

.ArtifactPreview_markdownPreview__qQ6Rp h1 { font-size: var(--text-h1) !important; margin: var(--spacing-sm) 0 !important; }

.ArtifactPreview_markdownPreview__qQ6Rp h2 { font-size: var(--text-h2) !important; margin: var(--spacing-xs) 0 !important; }

.ArtifactPreview_markdownPreview__qQ6Rp h3 { font-size: var(--text-h3) !important; margin: var(--spacing-xs) 0 !important; }

.ArtifactPreview_markdownPreview__qQ6Rp p { margin: var(--spacing-sm) 0 !important; }

.ArtifactPreview_markdownPreview__qQ6Rp code { font-size: var(--text-code) !important; height: 10px !important; border-radius: 3px !important; padding: 0px 2px !important; }

.ArtifactPreview_markdownPreview__qQ6Rp code > span { width: 6px !important; height: 6px !important; border-radius: 1.5px !important; }

.ArtifactPreview_markdownPreview__qQ6Rp pre, .ArtifactPreview_markdownPreview__qQ6Rp table { box-shadow: none !important; background: transparent !important; }

.ArtifactPreview_markdownPreview__qQ6Rp hr { border-top-width: 0.5px !important; border-top-style: solid !important; border-top-color: hsl(var(--text-500)) !important; }

.ArtifactPreview_markdownPreview__qQ6Rp a { pointer-events: none !important; cursor: default !important; }

.ArtifactPreview_markdownPreview__qQ6Rp button { background: transparent !important; width: 100% !important; border-radius: 8px !important; border: 0.5px solid !important; }

.ArtifactPreview_markdownPreview__qQ6Rp img { width: 100% !important; height: auto !important; max-width: 100% !important; }
------MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v----
Content-Type: text/css
Content-Transfer-Encoding: binary
Content-Location: https://claude.ai/_next/static/css/9e44fef1b2eb310b.css

@charset "utf-8";

*, ::after, ::before { box-sizing: border-box; border: 0px solid; }

::after, ::before { --tw-content: ""; }

:host, html { line-height: 1.5; text-size-adjust: 100%; tab-size: 4; font-family: var(--font-ui); font-feature-settings: normal; font-variation-settings: normal; -webkit-tap-highlight-color: transparent; }

body { margin: 0px; line-height: inherit; }

hr { height: 0px; color: inherit; border-top-width: 1px; }

abbr:where([title]) { text-decoration: underline dotted; }

h1, h2, h3, h4, h5, h6 { font-size: inherit; font-weight: inherit; }

a { text-decoration: inherit; }

b, strong { font-weight: bolder; }

code, kbd, pre, samp { font-family: var(--font-mono); font-feature-settings: normal; font-variation-settings: normal; font-size: 1em; }

small { font-size: 80%; }

sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sub { bottom: -0.25em; }

sup { top: -0.5em; }

table { text-indent: 0px; border-color: inherit; border-collapse: collapse; }

button, input, optgroup, select, textarea { font-family: inherit; font-feature-settings: inherit; font-variation-settings: inherit; font-size: 100%; font-weight: inherit; line-height: inherit; letter-spacing: inherit; color: inherit; margin: 0px; padding: 0px; }

button, select { text-transform: none; }

button, input:where([type="button"]), input:where([type="reset"]), input:where([type="submit"]) { appearance: button; background-color: transparent; background-image: none; }

progress { vertical-align: baseline; }

::-webkit-inner-spin-button, ::-webkit-outer-spin-button { height: auto; }

[type="search"] { appearance: textfield; outline-offset: -2px; }

::-webkit-search-decoration { appearance: none; }

::-webkit-file-upload-button { appearance: button; font: inherit; }

summary { display: list-item; }

blockquote, dd, dl, figure, h1, h2, h3, h4, h5, h6, hr, p, pre { margin: 0px; }

fieldset { margin: 0px; }

fieldset, legend { padding: 0px; }

menu, ol, ul { list-style: none; margin: 0px; padding: 0px; }

dialog { padding: 0px; }

textarea { resize: vertical; }

input::placeholder, textarea::placeholder { opacity: 1; color: rgb(156, 163, 175); }

[role="button"], button { cursor: pointer; }

:disabled { cursor: default; }

audio, canvas, embed, iframe, img, object, svg, video { display: block; vertical-align: middle; }

img, video { max-width: 100%; height: auto; }

[hidden] { display: none; }

*, ::after, ::before { --tw-border-spacing-x: 0; --tw-border-spacing-y: 0; --tw-translate-x: 0; --tw-translate-y: 0; --tw-rotate: 0; --tw-skew-x: 0; --tw-skew-y: 0; --tw-scale-x: 1; --tw-scale-y: 1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness: proximity; --tw-gradient-from-position: ; --tw-gradient-via-position: ; --tw-gradient-to-position: ; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: hsl(var(--accent-secondary-100)/1); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; --tw-contain-size: ; --tw-contain-layout: ; --tw-contain-paint: ; --tw-contain-style: ; }

::backdrop { --tw-border-spacing-x: 0; --tw-border-spacing-y: 0; --tw-translate-x: 0; --tw-translate-y: 0; --tw-rotate: 0; --tw-skew-x: 0; --tw-skew-y: 0; --tw-scale-x: 1; --tw-scale-y: 1; --tw-pan-x: ; --tw-pan-y: ; --tw-pinch-zoom: ; --tw-scroll-snap-strictness: proximity; --tw-gradient-from-position: ; --tw-gradient-via-position: ; --tw-gradient-to-position: ; --tw-ordinal: ; --tw-slashed-zero: ; --tw-numeric-figure: ; --tw-numeric-spacing: ; --tw-numeric-fraction: ; --tw-ring-inset: ; --tw-ring-offset-width: 0px; --tw-ring-offset-color: #fff; --tw-ring-color: hsl(var(--accent-secondary-100)/1); --tw-ring-offset-shadow: 0 0 #0000; --tw-ring-shadow: 0 0 #0000; --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; --tw-blur: ; --tw-brightness: ; --tw-contrast: ; --tw-grayscale: ; --tw-hue-rotate: ; --tw-invert: ; --tw-saturate: ; --tw-sepia: ; --tw-drop-shadow: ; --tw-backdrop-blur: ; --tw-backdrop-brightness: ; --tw-backdrop-contrast: ; --tw-backdrop-grayscale: ; --tw-backdrop-hue-rotate: ; --tw-backdrop-invert: ; --tw-backdrop-opacity: ; --tw-backdrop-saturate: ; --tw-backdrop-sepia: ; --tw-contain-size: ; --tw-contain-layout: ; --tw-contain-paint: ; --tw-contain-style: ; }

.\!container { width: 100% !important; }

.container { width: 100%; }

@media (min-width: 640px) {
  .\!container { max-width: 640px !important; }
  .container { max-width: 640px; }
}

@media (min-width: 768px) {
  .\!container { max-width: 768px !important; }
  .container { max-width: 768px; }
}

@media (min-width: 1024px) {
  .\!container { max-width: 1024px !important; }
  .container { max-width: 1024px; }
}

@media (min-width: 1280px) {
  .\!container { max-width: 1280px !important; }
  .container { max-width: 1280px; }
}

@media (min-width: 1536px) {
  .\!container { max-width: 1536px !important; }
  .container { max-width: 1536px; }
}

.sr-only { position: absolute; width: 1px; height: 1px; padding: 0px; margin: -1px; overflow: hidden; clip: rect(0px, 0px, 0px, 0px); white-space: nowrap; border-width: 0px; }

.pointer-events-none { pointer-events: none; }

.\!pointer-events-auto { pointer-events: auto !important; }

.pointer-events-auto { pointer-events: auto; }

.visible { visibility: visible; }

.invisible { visibility: hidden; }

.collapse { visibility: collapse; }

.static { position: static; }

.fixed { position: fixed; }

.\!absolute { position: absolute !important; }

.absolute { position: absolute; }

.relative { position: relative; }

.sticky { position: sticky; }

.-inset-px { inset: -1px; }

.inset-0 { inset: 0px; }

.inset-2 { inset: 0.5rem; }

.inset-\[50px_8px_8px_8px\] { inset: 50px 8px 8px; }

.inset-x-0 { left: 0px; right: 0px; }

.inset-y-0 { top: 0px; bottom: 0px; }

.\!right-2 { right: 0.5rem !important; }

.\!top-0 { top: 0px !important; }

.\!top-2 { top: 0.5rem !important; }

.-bottom-5 { bottom: -1.25rem; }

.-left-1 { left: -0.25rem; }

.-left-2 { left: -0.5rem; }

.-left-4 { left: -1rem; }

.-right-0 { right: 0px; }

.-right-1 { right: -0.25rem; }

.-right-16 { right: -4rem; }

.-right-2 { right: -0.5rem; }

.-right-4 { right: -1rem; }

.-top-1 { top: -0.25rem; }

.-top-2 { top: -0.5rem; }

.-top-8 { top: -2rem; }

.-top-px { top: -1px; }

.bottom-0 { bottom: 0px; }

.bottom-1 { bottom: 0.25rem; }

.bottom-1\.5 { bottom: 0.375rem; }

.bottom-1\/2 { bottom: 50%; }

.bottom-10 { bottom: 2.5rem; }

.bottom-12 { bottom: 3rem; }

.bottom-16 { bottom: 4rem; }

.bottom-2 { bottom: 0.5rem; }

.bottom-20 { bottom: 5rem; }

.bottom-4 { bottom: 1rem; }

.bottom-5 { bottom: 1.25rem; }

.bottom-6 { bottom: 1.5rem; }

.bottom-\[0\.5px\] { bottom: 0.5px; }

.bottom-\[1px\] { bottom: 1px; }

.bottom-full { bottom: 100%; }

.bottom-px { bottom: 1px; }

.end-3 { inset-inline-end: 0.75rem; }

.left-0 { left: 0px; }

.left-0\.5 { left: 0.125rem; }

.left-1 { left: 0.25rem; }

.left-1\/2 { left: 50%; }

.left-12 { left: 3rem; }

.left-2 { left: 0.5rem; }

.left-20 { left: 5rem; }

.left-3 { left: 0.75rem; }

.left-3\.5 { left: 0.875rem; }

.left-4 { left: 1rem; }

.left-5 { left: 1.25rem; }

.left-\[-24px\] { left: -24px; }

.left-\[1rem\] { left: 1rem; }

.left-\[3\.25rem\] { left: 3.25rem; }

.left-full { left: 100%; }

.right-0 { right: 0px; }

.right-1 { right: 0.25rem; }

.right-1\.5 { right: 0.375rem; }

.right-1\/2 { right: 50%; }

.right-10 { right: 2.5rem; }

.right-12 { right: 3rem; }

.right-16 { right: 4rem; }

.right-2 { right: 0.5rem; }

.right-2\.5 { right: 0.625rem; }

.right-20 { right: 5rem; }

.right-3 { right: 0.75rem; }

.right-3\.5 { right: 0.875rem; }

.right-4 { right: 1rem; }

.right-5 { right: 1.25rem; }

.right-6 { right: 1.5rem; }

.right-8 { right: 2rem; }

.right-\[-24px\] { right: -24px; }

.right-\[0\.5px\] { right: 0.5px; }

.right-full { right: 100%; }

.start-\[2px\] { inset-inline-start: 2px; }

.top-0 { top: 0px; }

.top-0\.5 { top: 0.125rem; }

.top-1 { top: 0.25rem; }

.top-1\.5 { top: 0.375rem; }

.top-1\/2 { top: 50%; }

.top-1\/4 { top: 25%; }

.top-10 { top: 2.5rem; }

.top-2 { top: 0.5rem; }

.top-2\.5 { top: 0.625rem; }

.top-3 { top: 0.75rem; }

.top-3\.5 { top: 0.875rem; }

.top-4 { top: 1rem; }

.top-5 { top: 1.25rem; }

.top-6 { top: 1.5rem; }

.top-8 { top: 2rem; }

.top-\[0\.5px\] { top: 0.5px; }

.top-\[1\%\] { top: 1%; }

.top-\[1\.4rem\] { top: 1.4rem; }

.top-\[11\.5rem\] { top: 11.5rem; }

.top-\[13\.75rem\] { top: 13.75rem; }

.top-\[1px\] { top: 1px; }

.top-\[2\%\] { top: 2%; }

.top-\[2px\] { top: 2px; }

.top-\[60px\] { top: 60px; }

.top-\[6rem\] { top: 6rem; }

.top-\[9px\] { top: 9px; }

.top-full { top: 100%; }

.isolate { isolation: isolate; }

.\!z-\[10000\] { z-index: 10000 !important; }

.-z-10 { z-index: -10; }

.-z-20 { z-index: -20; }

.-z-\[1\] { z-index: -1; }

.z-0 { z-index: 0; }

.z-10 { z-index: 10; }

.z-20 { z-index: 20; }

.z-30 { z-index: 30; }

.z-40 { z-index: 40; }

.z-50 { z-index: 50; }

.z-\[-1\] { z-index: -1; }

.z-\[1000\] { z-index: 1000; }

.z-\[100\] { z-index: 100; }

.z-\[1\] { z-index: 1; }

.z-\[5\] { z-index: 5; }

.z-\[9999\] { z-index: 9999; }

.z-dropdown { z-index: 50; }

.z-header { z-index: 20; }

.z-modal { z-index: 40; }

.z-overlay { z-index: 50; }

.z-sidebar { z-index: 30; }

.z-toast { z-index: 60; }

.z-tooltip { z-index: 50; }

.-order-1 { order: -1; }

.col-span-1 { grid-column: span 1 / span 1; }

.col-span-10 { grid-column: span 10 / span 10; }

.col-span-2 { grid-column: span 2 / span 2; }

.col-span-3 { grid-column: span 3 / span 3; }

.col-span-7 { grid-column: span 7 / span 7; }

.col-start-1 { grid-column-start: 1; }

.col-end-2 { grid-column-end: 2; }

.row-start-1 { grid-row-start: 1; }

.row-end-2 { grid-row-end: 2; }

.float-right { float: right; }

.\!m-0 { margin: 0px !important; }

.-m-1 { margin: -0.25rem; }

.-m-2 { margin: -0.5rem; }

.-m-3 { margin: -0.75rem; }

.-m-32 { margin: -8rem; }

.-m-\[1px\] { margin: -1px; }

.m-0 { margin: 0px; }

.m-0\.5 { margin: 0.125rem; }

.m-1 { margin: 0.25rem; }

.m-2 { margin: 0.5rem; }

.m-3 { margin: 0.75rem; }

.m-3\.5 { margin: 0.875rem; }

.m-4 { margin: 1rem; }

.m-6 { margin: 1.5rem; }

.m-auto { margin: auto; }

.\!my-0 { margin-top: 0px !important; margin-bottom: 0px !important; }

.-mx-0 { margin-left: 0px; margin-right: 0px; }

.-mx-0\.5 { margin-left: -0.125rem; margin-right: -0.125rem; }

.-mx-1 { margin-left: -0.25rem; margin-right: -0.25rem; }

.-mx-1\.5 { margin-left: -0.375rem; margin-right: -0.375rem; }

.-mx-2 { margin-left: -0.5rem; margin-right: -0.5rem; }

.-mx-3 { margin-left: -0.75rem; margin-right: -0.75rem; }

.-mx-3\.5 { margin-left: -0.875rem; margin-right: -0.875rem; }

.-mx-4 { margin-left: -1rem; margin-right: -1rem; }

.-mx-5 { margin-left: -1.25rem; margin-right: -1.25rem; }

.-mx-6 { margin-left: -1.5rem; margin-right: -1.5rem; }

.-my-1 { margin-top: -0.25rem; margin-bottom: -0.25rem; }

.-my-1\.5 { margin-top: -0.375rem; margin-bottom: -0.375rem; }

.-my-2 { margin-top: -0.5rem; margin-bottom: -0.5rem; }

.-my-3 { margin-top: -0.75rem; margin-bottom: -0.75rem; }

.-my-\[0\.225em\] { margin-top: -0.225em; margin-bottom: -0.225em; }

.mx-0 { margin-left: 0px; margin-right: 0px; }

.mx-0\.5 { margin-left: 0.125rem; margin-right: 0.125rem; }

.mx-1 { margin-left: 0.25rem; margin-right: 0.25rem; }

.mx-1\.5 { margin-left: 0.375rem; margin-right: 0.375rem; }

.mx-2 { margin-left: 0.5rem; margin-right: 0.5rem; }

.mx-3 { margin-left: 0.75rem; margin-right: 0.75rem; }

.mx-3\.5 { margin-left: 0.875rem; margin-right: 0.875rem; }

.mx-4 { margin-left: 1rem; margin-right: 1rem; }

.mx-5 { margin-left: 1.25rem; margin-right: 1.25rem; }

.mx-8 { margin-left: 2rem; margin-right: 2rem; }

.mx-auto { margin-left: auto; margin-right: auto; }

.my-0 { margin-top: 0px; margin-bottom: 0px; }

.my-0\.5 { margin-top: 0.125rem; margin-bottom: 0.125rem; }

.my-1 { margin-top: 0.25rem; margin-bottom: 0.25rem; }

.my-1\.5 { margin-top: 0.375rem; margin-bottom: 0.375rem; }

.my-2 { margin-top: 0.5rem; margin-bottom: 0.5rem; }

.my-3 { margin-top: 0.75rem; margin-bottom: 0.75rem; }

.my-4 { margin-top: 1rem; margin-bottom: 1rem; }

.my-6 { margin-top: 1.5rem; margin-bottom: 1.5rem; }

.my-7 { margin-top: 1.75rem; margin-bottom: 1.75rem; }

.my-8 { margin-top: 2rem; margin-bottom: 2rem; }

.\!mb-2 { margin-bottom: 0.5rem !important; }

.\!ml-1 { margin-left: 0.25rem !important; }

.\!mr-0 { margin-right: 0px !important; }

.\!mt-0 { margin-top: 0px !important; }

.-mb-0 { margin-bottom: 0px; }

.-mb-0\.5 { margin-bottom: -0.125rem; }

.-mb-1 { margin-bottom: -0.25rem; }

.-mb-1\.5 { margin-bottom: -0.375rem; }

.-mb-2 { margin-bottom: -0.5rem; }

.-mb-3 { margin-bottom: -0.75rem; }

.-ml-0 { margin-left: 0px; }

.-ml-0\.5 { margin-left: -0.125rem; }

.-ml-1 { margin-left: -0.25rem; }

.-ml-1\.5 { margin-left: -0.375rem; }

.-ml-2 { margin-left: -0.5rem; }

.-ml-3 { margin-left: -0.75rem; }

.-ml-4 { margin-left: -1rem; }

.-ml-9 { margin-left: -2.25rem; }

.-mr-1 { margin-right: -0.25rem; }

.-mr-1\.5 { margin-right: -0.375rem; }

.-mr-2 { margin-right: -0.5rem; }

.-mr-2\.5 { margin-right: -0.625rem; }

.-mr-24 { margin-right: -6rem; }

.-mr-\[0\.1875rem\] { margin-right: -0.1875rem; }

.-mr-\[2px\] { margin-right: -2px; }

.-mt-1 { margin-top: -0.25rem; }

.-mt-2 { margin-top: -0.5rem; }

.-mt-20 { margin-top: -5rem; }

.-mt-3 { margin-top: -0.75rem; }

.-mt-4 { margin-top: -1rem; }

.-mt-6 { margin-top: -1.5rem; }

.-mt-\[0\.1875rem\] { margin-top: -0.1875rem; }

.-mt-px { margin-top: -1px; }

.mb-0 { margin-bottom: 0px; }

.mb-0\.5 { margin-bottom: 0.125rem; }

.mb-1 { margin-bottom: 0.25rem; }

.mb-1\.5 { margin-bottom: 0.375rem; }

.mb-10 { margin-bottom: 2.5rem; }

.mb-11 { margin-bottom: 2.75rem; }

.mb-12 { margin-bottom: 3rem; }

.mb-14 { margin-bottom: 3.5rem; }

.mb-16 { margin-bottom: 4rem; }

.mb-2 { margin-bottom: 0.5rem; }

.mb-20 { margin-bottom: 5rem; }

.mb-24 { margin-bottom: 6rem; }

.mb-3 { margin-bottom: 0.75rem; }

.mb-3\.5 { margin-bottom: 0.875rem; }

.mb-32 { margin-bottom: 8rem; }

.mb-4 { margin-bottom: 1rem; }

.mb-5 { margin-bottom: 1.25rem; }

.mb-6 { margin-bottom: 1.5rem; }

.mb-7 { margin-bottom: 1.75rem; }

.mb-8 { margin-bottom: 2rem; }

.mb-\[15px\] { margin-bottom: 15px; }

.mb-px { margin-bottom: 1px; }

.ml-0 { margin-left: 0px; }

.ml-0\.5 { margin-left: 0.125rem; }

.ml-1 { margin-left: 0.25rem; }

.ml-1\.5 { margin-left: 0.375rem; }

.ml-10 { margin-left: 2.5rem; }

.ml-2 { margin-left: 0.5rem; }

.ml-2\.5 { margin-left: 0.625rem; }

.ml-3 { margin-left: 0.75rem; }

.ml-4 { margin-left: 1rem; }

.ml-5 { margin-left: 1.25rem; }

.ml-6 { margin-left: 1.5rem; }

.ml-7 { margin-left: 1.75rem; }

.ml-\[-1\.25rem\] { margin-left: -1.25rem; }

.ml-\[0\.875rem\] { margin-left: 0.875rem; }

.ml-\[28px\] { margin-left: 28px; }

.ml-\[3px\] { margin-left: 3px; }

.ml-\[clamp\(1\.5rem\,10vw\,3rem\)\] { margin-left: clamp(1.5rem, 10vw, 3rem); }

.ml-auto { margin-left: auto; }

.mr-0 { margin-right: 0px; }

.mr-0\.5 { margin-right: 0.125rem; }

.mr-1 { margin-right: 0.25rem; }

.mr-1\.5 { margin-right: 0.375rem; }

.mr-2 { margin-right: 0.5rem; }

.mr-2\.5 { margin-right: 0.625rem; }

.mr-3 { margin-right: 0.75rem; }

.mr-4 { margin-right: 1rem; }

.mr-auto { margin-right: auto; }

.mr-px { margin-right: 1px; }

.ms-1 { margin-inline-start: 0.25rem; }

.mt-0 { margin-top: 0px; }

.mt-0\.5 { margin-top: 0.125rem; }

.mt-1 { margin-top: 0.25rem; }

.mt-1\.5 { margin-top: 0.375rem; }

.mt-10 { margin-top: 2.5rem; }

.mt-12 { margin-top: 3rem; }

.mt-14 { margin-top: 3.5rem; }

.mt-16 { margin-top: 4rem; }

.mt-2 { margin-top: 0.5rem; }

.mt-2\.5 { margin-top: 0.625rem; }

.mt-20 { margin-top: 5rem; }

.mt-24 { margin-top: 6rem; }

.mt-3 { margin-top: 0.75rem; }

.mt-4 { margin-top: 1rem; }

.mt-40 { margin-top: 10rem; }

.mt-5 { margin-top: 1.25rem; }

.mt-6 { margin-top: 1.5rem; }

.mt-7 { margin-top: 1.75rem; }

.mt-8 { margin-top: 2rem; }

.mt-9 { margin-top: 2.25rem; }

.mt-\[-1\.25rem\] { margin-top: -1.25rem; }

.mt-\[0\.25em\] { margin-top: 0.25em; }

.mt-\[0\.25rem\] { margin-top: 0.25rem; }

.mt-\[1\.125rem\] { margin-top: 1.125rem; }

.mt-\[30px\] { margin-top: 30px; }

.mt-\[5px\] { margin-top: 5px; }

.mt-\[90px\] { margin-top: 90px; }

.mt-\[clamp\(1\.5rem\,10vw\,3rem\)\] { margin-top: clamp(1.5rem, 10vw, 3rem); }

.mt-auto { margin-top: auto; }

.mt-px { margin-top: 1px; }

.box-border { box-sizing: border-box; }

.\!box-content { box-sizing: content-box !important; }

.line-clamp-1 { -webkit-line-clamp: 1; }

.line-clamp-1, .line-clamp-2 { overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; }

.line-clamp-2 { -webkit-line-clamp: 2; }

.line-clamp-3 { -webkit-line-clamp: 3; }

.line-clamp-3, .line-clamp-4 { overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; }

.line-clamp-4 { -webkit-line-clamp: 4; }

.\!block { display: block !important; }

.block { display: block; }

.inline-block { display: inline-block; }

.\!inline { display: inline !important; }

.inline { display: inline; }

.\!flex { display: flex !important; }

.flex { display: flex; }

.inline-flex { display: inline-flex; }

.table { display: table; }

.flow-root { display: flow-root; }

.grid { display: grid; }

.contents { display: contents; }

.hidden { display: none; }

.aspect-\[2\/1\] { aspect-ratio: 2 / 1; }

.aspect-\[258\/240\] { aspect-ratio: 258 / 240; }

.aspect-square { aspect-ratio: 1 / 1; }

.size-2 { width: 0.5rem; height: 0.5rem; }

.size-20 { width: 5rem; height: 5rem; }

.size-4 { width: 1rem; height: 1rem; }

.size-8 { width: 2rem; height: 2rem; }

.size-9 { width: 2.25rem; height: 2.25rem; }

.size-\[3px\] { width: 3px; height: 3px; }

.size-\[6px\] { width: 6px; height: 6px; }

.\!h-10 { height: 2.5rem !important; }

.\!h-11 { height: 2.75rem !important; }

.\!h-12 { height: 3rem !important; }

.\!h-6 { height: 1.5rem !important; }

.\!h-7 { height: 1.75rem !important; }

.\!h-8 { height: 2rem !important; }

.\!h-\[10rem\] { height: 10rem !important; }

.\!h-\[18px\] { height: 18px !important; }

.\!h-\[52px\] { height: 52px !important; }

.\!h-auto { height: auto !important; }

.h-0 { height: 0px; }

.h-1 { height: 0.25rem; }

.h-1\.5 { height: 0.375rem; }

.h-10 { height: 2.5rem; }

.h-11 { height: 2.75rem; }

.h-12 { height: 3rem; }

.h-14 { height: 3.5rem; }

.h-16 { height: 4rem; }

.h-2 { height: 0.5rem; }

.h-2\.5 { height: 0.625rem; }

.h-20 { height: 5rem; }

.h-24 { height: 6rem; }

.h-3 { height: 0.75rem; }

.h-3\.5 { height: 0.875rem; }

.h-32 { height: 8rem; }

.h-4 { height: 1rem; }

.h-40 { height: 10rem; }

.h-5 { height: 1.25rem; }

.h-6 { height: 1.5rem; }

.h-60 { height: 15rem; }

.h-64 { height: 16rem; }

.h-7 { height: 1.75rem; }

.h-72 { height: 18rem; }

.h-8 { height: 2rem; }

.h-9 { height: 2.25rem; }

.h-\[0\.5px\] { height: 0.5px; }

.h-\[0\.975em\] { height: 0.975em; }

.h-\[1\.07em\] { height: 1.07em; }

.h-\[1\.125rem\] { height: 1.125rem; }

.h-\[1\.5em\] { height: 1.5em; }

.h-\[1\.625rem\] { height: 1.625rem; }

.h-\[10\.25rem\] { height: 10.25rem; }

.h-\[100\%\] { height: 100%; }

.h-\[10rem\] { height: 10rem; }

.h-\[111px\] { height: 111px; }

.h-\[112px\] { height: 112px; }

.h-\[12\.5rem\] { height: 12.5rem; }

.h-\[123px\] { height: 123px; }

.h-\[130px\] { height: 130px; }

.h-\[140px\] { height: 140px; }

.h-\[14px\] { height: 14px; }

.h-\[164px\] { height: 164px; }

.h-\[16px\] { height: 16px; }

.h-\[17px\] { height: 17px; }

.h-\[180px\] { height: 180px; }

.h-\[18px\] { height: 18px; }

.h-\[1px\] { height: 1px; }

.h-\[2\.25rem\] { height: 2.25rem; }

.h-\[2\.625rem\] { height: 2.625rem; }

.h-\[220px\] { height: 220px; }

.h-\[22px\] { height: 22px; }

.h-\[22rem\] { height: 22rem; }

.h-\[232px\] { height: 232px; }

.h-\[24rem\] { height: 24rem; }

.h-\[250px\] { height: 250px; }

.h-\[28px\] { height: 28px; }

.h-\[29px\] { height: 29px; }

.h-\[2rem\] { height: 2rem; }

.h-\[3\.25rem\] { height: 3.25rem; }

.h-\[30px\] { height: 30px; }

.h-\[32px\] { height: 32px; }

.h-\[32rem\] { height: 32rem; }

.h-\[34px\] { height: 34px; }

.h-\[35rem\] { height: 35rem; }

.h-\[36px\] { height: 36px; }

.h-\[38px\] { height: 38px; }

.h-\[3rem\] { height: 3rem; }

.h-\[4\.5rem\] { height: 4.5rem; }

.h-\[40rem\] { height: 40rem; }

.h-\[42px\] { height: 42px; }

.h-\[460px\] { height: 460px; }

.h-\[471px\] { height: 471px; }

.h-\[475px\] { height: 475px; }

.h-\[5\.5rem\] { height: 5.5rem; }

.h-\[500px\] { height: 500px; }

.h-\[50vh\] { height: 50vh; }

.h-\[52px\] { height: 52px; }

.h-\[550px\] { height: 550px; }

.h-\[56px\] { height: 56px; }

.h-\[600px\] { height: 600px; }

.h-\[60px\] { height: 60px; }

.h-\[700px\] { height: 700px; }

.h-\[71px\] { height: 71px; }

.h-\[72px\] { height: 72px; }

.h-\[82px\] { height: 82px; }

.h-\[84px\] { height: 84px; }

.h-\[85vh\] { height: 85vh; }

.h-\[96\%\] { height: 96%; }

.h-\[98\%\] { height: 98%; }

.h-\[99px\] { height: 99px; }

.h-\[calc\(100vh-224px\)\] { height: calc(-224px + 100vh); }

.h-\[clamp\(10\.5rem\,28\.1vw\,23\.45rem\)\] { height: clamp(10.5rem, 28.1vw, 23.45rem); }

.h-\[clamp\(10rem\,62vw\,30\.75rem\)\] { height: clamp(10rem, 62vw, 30.75rem); }

.h-\[clamp\(40rem\,89vh\,89vh\)\] { height: clamp(40rem, 89vh, 89vh); }

.h-\[clamp\(40rem\,93vh\,93vh\)\] { height: clamp(40rem, 93vh, 93vh); }

.h-\[clamp\(40rem\,97vh\,97vh\)\] { height: clamp(40rem, 97vh, 97vh); }

.h-\[unset\] { height: unset; }

.h-auto { height: auto; }

.h-fit { height: fit-content; }

.h-full { height: 100%; }

.h-px { height: 1px; }

.\!max-h-\[238px\] { max-height: 238px !important; }

.\!max-h-none { max-height: none !important; }

.max-h-0 { max-height: 0px; }

.max-h-12 { max-height: 3rem; }

.max-h-20 { max-height: 5rem; }

.max-h-32 { max-height: 8rem; }

.max-h-36 { max-height: 9rem; }

.max-h-40 { max-height: 10rem; }

.max-h-48 { max-height: 12rem; }

.max-h-56 { max-height: 14rem; }

.max-h-60 { max-height: 15rem; }

.max-h-80 { max-height: 20rem; }

.max-h-96 { max-height: 24rem; }

.max-h-\[10rem\] { max-height: 10rem; }

.max-h-\[160px\] { max-height: 160px; }

.max-h-\[16rem\] { max-height: 16rem; }

.max-h-\[200px\] { max-height: 200px; }

.max-h-\[238px\] { max-height: 238px; }

.max-h-\[240px\] { max-height: 240px; }

.max-h-\[300px\] { max-height: 300px; }

.max-h-\[400px\] { max-height: 400px; }

.max-h-\[40vh\] { max-height: 40vh; }

.max-h-\[500px\] { max-height: 500px; }

.max-h-\[50vh\] { max-height: 50vh; }

.max-h-\[550px\] { max-height: 550px; }

.max-h-\[6\.5rem\] { max-height: 6.5rem; }

.max-h-\[60vh\] { max-height: 60vh; }

.max-h-\[calc\(100vh-1rem\)\] { max-height: calc(-1rem + 100vh); }

.max-h-\[calc\(100vh-4rem\)\] { max-height: calc(-4rem + 100vh); }

.max-h-\[min\(100vh\,var\(--dropdown-max-height\)\)\] { max-height: min(100vh,var(--dropdown-max-height)); }

.max-h-\[min\(56rem\,100\%\)\] { max-height: min(56rem, 100%); }

.max-h-\[min\(var\(--radix-dropdown-menu-content-available-height\)\,var\(--dropdown-max-height\)\)\] { max-height: min(var(--radix-dropdown-menu-content-available-height),var(--dropdown-max-height)); }

.max-h-full { max-height: 100%; }

.max-h-screen { max-height: 100vh; }

.\!min-h-0 { min-height: 0px !important; }

.min-h-0 { min-height: 0px; }

.min-h-12 { min-height: 3rem; }

.min-h-14 { min-height: 3.5rem; }

.min-h-16 { min-height: 4rem; }

.min-h-4 { min-height: 1rem; }

.min-h-48 { min-height: 12rem; }

.min-h-5 { min-height: 1.25rem; }

.min-h-96 { min-height: 24rem; }

.min-h-\[0px\] { min-height: 0px; }

.min-h-\[1\.5rem\] { min-height: 1.5rem; }

.min-h-\[100px\] { min-height: 100px; }

.min-h-\[2\.125rem\] { min-height: 2.125rem; }

.min-h-\[2\.5rem\] { min-height: 2.5rem; }

.min-h-\[2\.625rem\] { min-height: 2.625rem; }

.min-h-\[200px\] { min-height: 200px; }

.min-h-\[20rem\] { min-height: 20rem; }

.min-h-\[250px\] { min-height: 250px; }

.min-h-\[25rem\] { min-height: 25rem; }

.min-h-\[3\.5rem\] { min-height: 3.5rem; }

.min-h-\[300px\] { min-height: 300px; }

.min-h-\[3rem\] { min-height: 3rem; }

.min-h-\[400px\] { min-height: 400px; }

.min-h-\[41px\] { min-height: 41px; }

.min-h-\[44px\] { min-height: 44px; }

.min-h-\[490px\] { min-height: 490px; }

.min-h-\[4rem\] { min-height: 4rem; }

.min-h-\[500px\] { min-height: 500px; }

.min-h-\[550px\] { min-height: 550px; }

.min-h-\[5rem\] { min-height: 5rem; }

.min-h-\[6\.125rem\] { min-height: 6.125rem; }

.min-h-\[89vh\] { min-height: 89vh; }

.min-h-\[97vh\] { min-height: 97vh; }

.min-h-\[99px\] { min-height: 99px; }

.min-h-\[calc\(\.\.\.\)\] { }

.min-h-full { min-height: 100%; }

.min-h-min { min-height: min-content; }

.\!w-10 { width: 2.5rem !important; }

.\!w-11 { width: 2.75rem !important; }

.\!w-16 { width: 4rem !important; }

.\!w-6 { width: 1.5rem !important; }

.\!w-7 { width: 1.75rem !important; }

.\!w-8 { width: 2rem !important; }

.\!w-80 { width: 20rem !important; }

.\!w-\[18px\] { width: 18px !important; }

.\!w-\[337px\] { width: 337px !important; }

.\!w-\[8rem\] { width: 8rem !important; }

.\!w-auto { width: auto !important; }

.\!w-fit { width: fit-content !important; }

.\!w-full { width: 100% !important; }

.w-0 { width: 0px; }

.w-0\.5 { width: 0.125rem; }

.w-1 { width: 0.25rem; }

.w-1\.5 { width: 0.375rem; }

.w-1\/2 { width: 50%; }

.w-1\/3 { width: 33.3333%; }

.w-1\/6 { width: 16.6667%; }

.w-10 { width: 2.5rem; }

.w-10\/12 { width: 83.3333%; }

.w-11 { width: 2.75rem; }

.w-11\/12 { width: 91.6667%; }

.w-12 { width: 3rem; }

.w-14 { width: 3.5rem; }

.w-16 { width: 4rem; }

.w-2 { width: 0.5rem; }

.w-2\.5 { width: 0.625rem; }

.w-2\/12 { width: 16.6667%; }

.w-2\/3 { width: 66.6667%; }

.w-20 { width: 5rem; }

.w-24 { width: 6rem; }

.w-28 { width: 7rem; }

.w-3 { width: 0.75rem; }

.w-3\.5 { width: 0.875rem; }

.w-3\/12 { width: 25%; }

.w-3\/4 { width: 75%; }

.w-32 { width: 8rem; }

.w-36 { width: 9rem; }

.w-4 { width: 1rem; }

.w-4\/12 { width: 33.3333%; }

.w-4\/5 { width: 80%; }

.w-40 { width: 10rem; }

.w-48 { width: 12rem; }

.w-5 { width: 1.25rem; }

.w-5\/6 { width: 83.3333%; }

.w-6 { width: 1.5rem; }

.w-6\/12 { width: 50%; }

.w-60 { width: 15rem; }

.w-64 { width: 16rem; }

.w-7 { width: 1.75rem; }

.w-72 { width: 18rem; }

.w-8 { width: 2rem; }

.w-80 { width: 20rem; }

.w-9 { width: 2.25rem; }

.w-9\/12 { width: 75%; }

.w-96 { width: 24rem; }

.w-\[0\.5px\] { width: 0.5px; }

.w-\[1\.125rem\] { width: 1.125rem; }

.w-\[1\.875rem\] { width: 1.875rem; }

.w-\[100\%\] { width: 100%; }

.w-\[128px\] { width: 128px; }

.w-\[130px\] { width: 130px; }

.w-\[15rem\] { width: 15rem; }

.w-\[160px\] { width: 160px; }

.w-\[16px\] { width: 16px; }

.w-\[17rem\] { width: 17rem; }

.w-\[18px\] { width: 18px; }

.w-\[190px\] { width: 190px; }

.w-\[1px\] { width: 1px; }

.w-\[200px\] { width: 200px; }

.w-\[20rem\] { width: 20rem; }

.w-\[21rem\] { width: 21rem; }

.w-\[220px\] { width: 220px; }

.w-\[22px\] { width: 22px; }

.w-\[24rem\] { width: 24rem; }

.w-\[260px\] { width: 260px; }

.w-\[26rem\] { width: 26rem; }

.w-\[27rem\] { width: 27rem; }

.w-\[280px\] { width: 280px; }

.w-\[28px\] { width: 28px; }

.w-\[2px\] { width: 2px; }

.w-\[30\%\] { width: 30%; }

.w-\[300px\] { width: 300px; }

.w-\[30rem\] { width: 30rem; }

.w-\[32px\] { width: 32px; }

.w-\[332px\] { width: 332px; }

.w-\[348px\] { width: 348px; }

.w-\[34px\] { width: 34px; }

.w-\[384px\] { width: 384px; }

.w-\[38px\] { width: 38px; }

.w-\[3rem\] { width: 3rem; }

.w-\[400px\] { width: 400px; }

.w-\[40rem\] { width: 40rem; }

.w-\[507px\] { width: 507px; }

.w-\[52px\] { width: 52px; }

.w-\[640px\] { width: 640px; }

.w-\[68px\] { width: 68px; }

.w-\[7\.5rem\] { width: 7.5rem; }

.w-\[70\%\] { width: 70%; }

.w-\[800px\] { width: 800px; }

.w-\[85\%\] { width: 85%; }

.w-\[90\%\] { width: 90%; }

.w-\[calc\(100\%-1\.75rem\)\] { width: calc(100% - 1.75rem); }

.w-\[calc\(100\%-2\.5rem\)\] { width: calc(100% - 2.5rem); }

.w-\[calc\(100\%-8px\)\] { width: calc(100% - 8px); }

.w-\[clamp\(30rem\,100\%\,100\%\)\] { width: clamp(30rem, 100%, 100%); }

.w-auto { width: auto; }

.w-fit { width: fit-content; }

.w-full { width: 100%; }

.w-max { width: max-content; }

.w-px { width: 1px; }

.w-screen { width: 100vw; }

.\!min-w-0 { min-width: 0px !important; }

.\!min-w-10 { min-width: 2.5rem !important; }

.\!min-w-52 { min-width: 13rem !important; }

.\!min-w-9 { min-width: 2.25rem !important; }

.\!min-w-\[200px\] { min-width: 200px !important; }

.min-w-0 { min-width: 0px; }

.min-w-10 { min-width: 2.5rem; }

.min-w-16 { min-width: 4rem; }

.min-w-24 { min-width: 6rem; }

.min-w-28 { min-width: 7rem; }

.min-w-32 { min-width: 8rem; }

.min-w-36 { min-width: 9rem; }

.min-w-4 { min-width: 1rem; }

.min-w-40 { min-width: 10rem; }

.min-w-48 { min-width: 12rem; }

.min-w-5 { min-width: 1.25rem; }

.min-w-60 { min-width: 15rem; }

.min-w-7 { min-width: 1.75rem; }

.min-w-72 { min-width: 18rem; }

.min-w-8 { min-width: 2rem; }

.min-w-80 { min-width: 20rem; }

.min-w-\[100px\] { min-width: 100px; }

.min-w-\[120px\] { min-width: 120px; }

.min-w-\[12rem\] { min-width: 12rem; }

.min-w-\[13rem\] { min-width: 13rem; }

.min-w-\[140px\] { min-width: 140px; }

.min-w-\[150px\] { min-width: 150px; }

.min-w-\[15rem\] { min-width: 15rem; }

.min-w-\[16rem\] { min-width: 16rem; }

.min-w-\[175px\] { min-width: 175px; }

.min-w-\[180px\] { min-width: 180px; }

.min-w-\[18rem\] { min-width: 18rem; }

.min-w-\[200px\] { min-width: 200px; }

.min-w-\[340px\] { min-width: 340px; }

.min-w-\[38px\] { min-width: 38px; }

.min-w-\[4rem\] { min-width: 4rem; }

.min-w-\[50px\] { min-width: 50px; }

.min-w-\[5rem\] { min-width: 5rem; }

.min-w-\[6rem\] { min-width: 6rem; }

.min-w-\[80px\] { min-width: 80px; }

.min-w-\[85px\] { min-width: 85px; }

.min-w-\[8rem\] { min-width: 8rem; }

.min-w-fit { min-width: fit-content; }

.min-w-full { min-width: 100%; }

.min-w-max { min-width: max-content; }

.\!max-w-96 { max-width: 24rem !important; }

.\!max-w-\[282px\] { max-width: 282px !important; }

.\!max-w-\[310px\] { max-width: 310px !important; }

.\!max-w-\[33\.5rem\] { max-width: 33.5rem !important; }

.\!max-w-\[586px\] { max-width: 586px !important; }

.\!max-w-xl { max-width: 36rem !important; }

.max-w-20 { max-width: 5rem; }

.max-w-24 { max-width: 6rem; }

.max-w-2xl { max-width: 42rem; }

.max-w-32 { max-width: 8rem; }

.max-w-3xl { max-width: 48rem; }

.max-w-40 { max-width: 10rem; }

.max-w-48 { max-width: 12rem; }

.max-w-4xl { max-width: 56rem; }

.max-w-5xl { max-width: 64rem; }

.max-w-60 { max-width: 15rem; }

.max-w-64 { max-width: 16rem; }

.max-w-6xl { max-width: 72rem; }

.max-w-72 { max-width: 18rem; }

.max-w-7xl { max-width: 80rem; }

.max-w-96 { max-width: 24rem; }

.max-w-\[1100px\] { max-width: 1100px; }

.max-w-\[1120px\] { max-width: 1120px; }

.max-w-\[1200px\] { max-width: 1200px; }

.max-w-\[12ch\] { max-width: 12ch; }

.max-w-\[13rem\] { max-width: 13rem; }

.max-w-\[14\.5rem\] { max-width: 14.5rem; }

.max-w-\[1400px\] { max-width: 1400px; }

.max-w-\[150px\] { max-width: 150px; }

.max-w-\[16\.6rem\] { max-width: 16.6rem; }

.max-w-\[16rem\] { max-width: 16rem; }

.max-w-\[180px\] { max-width: 180px; }

.max-w-\[20rem\] { max-width: 20rem; }

.max-w-\[280px\] { max-width: 280px; }

.max-w-\[300px\] { max-width: 300px; }

.max-w-\[32\.5rem\] { max-width: 32.5rem; }

.max-w-\[33\.333\%\] { max-width: 33.333%; }

.max-w-\[337px\] { max-width: 337px; }

.max-w-\[356px\] { max-width: 356px; }

.max-w-\[400px\] { max-width: 400px; }

.max-w-\[40rem\] { max-width: 40rem; }

.max-w-\[456px\] { max-width: 456px; }

.max-w-\[50rem\] { max-width: 50rem; }

.max-w-\[50vw\] { max-width: 50vw; }

.max-w-\[536px\] { max-width: 536px; }

.max-w-\[550px\] { max-width: 550px; }

.max-w-\[569px\] { max-width: 569px; }

.max-w-\[60\%\] { max-width: 60%; }

.max-w-\[601px\] { max-width: 601px; }

.max-w-\[640px\] { max-width: 640px; }

.max-w-\[75\%\] { max-width: 75%; }

.max-w-\[75ch\] { max-width: 75ch; }

.max-w-\[80\%\] { max-width: 80%; }

.max-w-\[800px\] { max-width: 800px; }

.max-w-\[85\%\] { max-width: 85%; }

.max-w-\[90rem\] { max-width: 90rem; }

.max-w-\[960px\] { max-width: 960px; }

.max-w-\[calc\(100vw-16px\)\] { max-width: calc(-16px + 100vw); }

.max-w-\[calc\(100vw-1rem\)\] { max-width: calc(-1rem + 100vw); }

.max-w-\[calc\(100vw-2rem\)\] { max-width: calc(-2rem + 100vw); }

.max-w-\[calc\(33\.333\%-0\.5rem\)\] { max-width: calc(33.333% - 0.5rem); }

.max-w-full { max-width: 100%; }

.max-w-lg { max-width: 32rem; }

.max-w-md { max-width: 28rem; }

.max-w-min { max-width: min-content; }

.max-w-none { max-width: none; }

.max-w-sm { max-width: 24rem; }

.max-w-xl { max-width: 36rem; }

.max-w-xs { max-width: 20rem; }

.\!flex-1 { flex: 1 1 0% !important; }

.\!flex-\[2\] { flex: 2 1 0% !important; }

.flex-1 { flex: 1 1 0%; }

.flex-initial { flex: 0 1 auto; }

.flex-none { flex: 0 0 auto; }

.\!flex-shrink { flex-shrink: 1 !important; }

.flex-shrink { flex-shrink: 1; }

.flex-shrink-0 { flex-shrink: 0; }

.\!shrink { flex-shrink: 1 !important; }

.\!shrink-0 { flex-shrink: 0 !important; }

.\!shrink-\[2\] { flex-shrink: 2 !important; }

.shrink { flex-shrink: 1; }

.shrink-0 { flex-shrink: 0; }

.shrink-\[4\] { flex-shrink: 4; }

.flex-grow, .grow { flex-grow: 1; }

.grow-\[3\] { flex-grow: 3; }

.basis-0 { flex-basis: 0px; }

.table-fixed { table-layout: fixed; }

.border-collapse { border-collapse: collapse; }

.border-separate { border-collapse: separate; }

.border-spacing-0 { --tw-border-spacing-x: 0px; --tw-border-spacing-y: 0px; border-spacing: var(--tw-border-spacing-x) var(--tw-border-spacing-y); }

.origin-center { transform-origin: center center; }

.origin-top-left { transform-origin: left top; }

.-translate-x-0 { --tw-translate-x: -0px; }

.-translate-x-0, .-translate-x-0\.5 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-translate-x-0\.5 { --tw-translate-x: -0.125rem; }

.-translate-x-1 { --tw-translate-x: -0.25rem; }

.-translate-x-1, .-translate-x-1\/2 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-translate-x-1\/2 { --tw-translate-x: -50%; }

.-translate-x-2 { --tw-translate-x: -0.5rem; }

.-translate-x-2, .-translate-x-4 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-translate-x-4 { --tw-translate-x: -1rem; }

.-translate-x-px { --tw-translate-x: -1px; }

.-translate-x-px, .-translate-y-0 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-translate-y-0 { --tw-translate-y: -0px; }

.-translate-y-0\.5 { --tw-translate-y: -0.125rem; }

.-translate-y-0\.5, .-translate-y-1 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-translate-y-1 { --tw-translate-y: -0.25rem; }

.-translate-y-1\.5 { --tw-translate-y: -0.375rem; }

.-translate-y-1\.5, .-translate-y-1\/2 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-translate-y-1\/2 { --tw-translate-y: -50%; }

.-translate-y-1\/4 { --tw-translate-y: -25%; }

.-translate-y-1\/4, .-translate-y-2 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-translate-y-2 { --tw-translate-y: -0.5rem; }

.-translate-y-2\.5 { --tw-translate-y: -0.625rem; }

.-translate-y-2\.5, .-translate-y-8 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-translate-y-8 { --tw-translate-y: -2rem; }

.-translate-y-\[0\.75px\] { --tw-translate-y: -0.75px; }

.-translate-y-\[0\.75px\], .-translate-y-px { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-translate-y-px { --tw-translate-y: -1px; }

.translate-x-0 { --tw-translate-x: 0px; }

.translate-x-0, .translate-x-1 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.translate-x-1 { --tw-translate-x: 0.25rem; }

.translate-x-1\/2 { --tw-translate-x: 50%; }

.translate-x-1\/2, .translate-x-1\/4 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.translate-x-1\/4 { --tw-translate-x: 25%; }

.translate-x-2 { --tw-translate-x: 0.5rem; }

.translate-x-2, .translate-x-4 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.translate-x-4 { --tw-translate-x: 1rem; }

.translate-x-5 { --tw-translate-x: 1.25rem; }

.translate-x-5, .translate-x-\[var\(--radix-toast-swipe-move-x\)\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.translate-x-\[var\(--radix-toast-swipe-move-x\)\] { --tw-translate-x: var(--radix-toast-swipe-move-x); }

.translate-x-full { --tw-translate-x: 100%; }

.translate-x-full, .translate-y-0 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.translate-y-0 { --tw-translate-y: 0px; }

.translate-y-0\.5 { --tw-translate-y: 0.125rem; }

.translate-y-0\.5, .translate-y-1 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.translate-y-1 { --tw-translate-y: 0.25rem; }

.translate-y-1\.5 { --tw-translate-y: 0.375rem; }

.translate-y-1\.5, .translate-y-1\/2 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.translate-y-1\/2 { --tw-translate-y: 50%; }

.translate-y-4 { --tw-translate-y: 1rem; }

.translate-y-4, .translate-y-\[-0\.05em\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.translate-y-\[-0\.05em\] { --tw-translate-y: -0.05em; }

.translate-y-\[0\.05em\] { --tw-translate-y: 0.05em; }

.translate-y-\[0\.05em\], .translate-y-\[0\.5px\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.translate-y-\[0\.5px\] { --tw-translate-y: 0.5px; }

.translate-y-\[10px\] { --tw-translate-y: 10px; }

.translate-y-\[10px\], .translate-y-\[120\%\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.translate-y-\[120\%\] { --tw-translate-y: 120%; }

.translate-y-\[19\%\] { --tw-translate-y: 19%; }

.translate-y-\[19\%\], .translate-y-\[2px\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.translate-y-\[2px\] { --tw-translate-y: 2px; }

.translate-y-full { --tw-translate-y: 100%; }

.translate-y-full, .translate-y-px { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.translate-y-px { --tw-translate-y: 1px; }

.-rotate-12 { --tw-rotate: -12deg; }

.-rotate-12, .-rotate-180 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-rotate-180 { --tw-rotate: -180deg; }

.-rotate-3 { --tw-rotate: -3deg; }

.-rotate-3, .-rotate-45 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-rotate-45 { --tw-rotate: -45deg; }

.-rotate-6 { --tw-rotate: -6deg; }

.-rotate-6, .-rotate-90 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-rotate-90 { --tw-rotate: -90deg; }

.-rotate-\[0\.1rad\] { --tw-rotate: -0.1rad; }

.-rotate-\[0\.1rad\], .-rotate-\[36deg\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.-rotate-\[36deg\] { --tw-rotate: -36deg; }

.rotate-0 { --tw-rotate: 0deg; }

.rotate-0, .rotate-12 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.rotate-12 { --tw-rotate: 12deg; }

.rotate-180 { --tw-rotate: 180deg; }

.rotate-180, .rotate-2 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.rotate-2 { --tw-rotate: 2deg; }

.rotate-45 { --tw-rotate: 45deg; }

.rotate-45, .rotate-6 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.rotate-6 { --tw-rotate: 6deg; }

.rotate-90 { --tw-rotate: 90deg; }

.rotate-90, .rotate-\[0\.1rad\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.rotate-\[0\.1rad\] { --tw-rotate: 0.1rad; }

.rotate-\[20deg\] { --tw-rotate: 20deg; }

.rotate-\[20deg\], .rotate-\[36deg\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.rotate-\[36deg\] { --tw-rotate: 36deg; }

.\!scale-100 { --tw-scale-x: 1 !important; --tw-scale-y: 1 !important; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)) !important; }

.scale-100 { --tw-scale-x: 1; --tw-scale-y: 1; }

.scale-100, .scale-110 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.scale-110 { --tw-scale-x: 1.1; --tw-scale-y: 1.1; }

.scale-50 { --tw-scale-x: .5; --tw-scale-y: .5; }

.scale-50, .scale-75 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.scale-75 { --tw-scale-x: .75; --tw-scale-y: .75; }

.scale-90 { --tw-scale-x: .9; --tw-scale-y: .9; }

.scale-90, .scale-95 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.scale-95 { --tw-scale-x: .95; --tw-scale-y: .95; }

.scale-\[0\.975\] { --tw-scale-x: 0.975; --tw-scale-y: 0.975; }

.scale-\[0\.975\], .scale-\[1\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.scale-\[1\] { --tw-scale-x: 1; --tw-scale-y: 1; }

.scale-\[80\%\] { --tw-scale-x: 80%; --tw-scale-y: 80%; }

.scale-\[80\%\], .scale-x-\[1\.0025\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.scale-x-\[1\.0025\] { --tw-scale-x: 1.0025; }

.scale-y-\[1\.015\] { --tw-scale-y: 1.015; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.\!transform { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)) !important; }

.transform { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.animate-\[fade_125ms_ease-out_reverse_forwards\] { animation: 125ms ease-out 0s 1 reverse forwards running fade; }

.animate-\[fade_200ms_ease-in_forwards\] { animation: 0.2s ease-in 0s 1 normal forwards running fade; }

.animate-\[fade_250ms_ease-in_forwards\] { animation: 0.25s ease-in 0s 1 normal forwards running fade; }

@keyframes shimmertext { 
  0% { background-position: 100% 0px; }
  65% { background-position: 0px 0px; }
  100% { background-position: 0px 0px; }
}

.animate-\[shimmertext_2\.25s_infinite\] { animation: 2.25s ease 0s infinite normal none running shimmertext; }

.animate-\[slide-down_300ms_ease-out\] { animation: 0.3s ease-out 0s 1 normal none running slide-down; }

.animate-\[slide-up_300ms_ease-out\] { animation: 0.3s ease-out 0s 1 normal none running slide-up; }

.animate-\[slideDown_0\.5s_ease-out\] { animation: 0.5s ease-out 0s 1 normal none running slideDown; }

.animate-\[spin_1\.5s_linear_infinite\] { animation: 1.5s linear 0s infinite normal none running spin; }

.animate-\[translate-x_100ms_ease-out\] { animation: 0.1s ease-out 0s 1 normal none running translate-x; }

.animate-\[translate-x_200ms_cubic-bezier\(0\.16\,1\,0\.3\,1\)_forwards\] { animation: 0.2s cubic-bezier(0.16, 1, 0.3, 1) 0s 1 normal forwards running translate-x; }

.animate-\[zoom_125ms_ease-out_reverse_forwards\] { animation: 125ms ease-out 0s 1 reverse forwards running zoom; }

.animate-\[zoom_250ms_ease-in_forwards\] { animation: 0.25s ease-in 0s 1 normal forwards running zoom; }

@keyframes ping { 
  75%, 100% { transform: scale(2); opacity: 0; }
}

.animate-ping { animation: 1s cubic-bezier(0, 0, 0.2, 1) 0s infinite normal none running ping; }

@keyframes pulse { 
  50% { opacity: 0.5; }
}

.animate-pulse { animation: 2s cubic-bezier(0.4, 0, 0.6, 1) 0s infinite normal none running pulse; }

@keyframes spin { 
  100% { transform: rotate(1turn); }
}

.animate-spin { animation: 1s linear 0s infinite normal none running spin; }

.\!cursor-default { cursor: default !important; }

.\!cursor-pointer { cursor: pointer !important; }

.cursor-col-resize { cursor: col-resize; }

.cursor-default { cursor: default; }

.cursor-help { cursor: help; }

.cursor-move { cursor: move; }

.cursor-not-allowed { cursor: not-allowed; }

.cursor-pointer { cursor: pointer; }

.cursor-text { cursor: text; }

.select-none { user-select: none; }

.select-all { user-select: all; }

.resize-none { resize: none; }

.resize { resize: both; }

.scroll-pb-6 { scroll-padding-bottom: 1.5rem; }

.list-outside { list-style-position: outside; }

.list-decimal { list-style-type: decimal; }

.list-disc { list-style-type: disc; }

.list-none { list-style-type: none; }

.appearance-none { appearance: none; }

.break-inside-avoid { break-inside: avoid; }

.auto-rows-fr { grid-auto-rows: minmax(0px, 1fr); }

.auto-rows-min { grid-auto-rows: min-content; }

.\!grid-cols-\[max-content_auto\] { grid-template-columns: max-content auto !important; }

.grid-cols-1 { grid-template-columns: repeat(1, minmax(0px, 1fr)); }

.grid-cols-12 { grid-template-columns: repeat(12, minmax(0px, 1fr)); }

.grid-cols-2 { grid-template-columns: repeat(2, minmax(0px, 1fr)); }

.grid-cols-3 { grid-template-columns: repeat(3, minmax(0px, 1fr)); }

.grid-cols-4 { grid-template-columns: repeat(4, minmax(0px, 1fr)); }

.grid-cols-7 { grid-template-columns: repeat(7, minmax(0px, 1fr)); }

.grid-cols-\[20px_1fr\] { grid-template-columns: 20px 1fr; }

.grid-cols-\[auto_1fr\] { grid-template-columns: auto 1fr; }

.grid-cols-\[minmax\(0\,_1fr\)_auto\] { grid-template-columns: minmax(0px, 1fr) auto; }

.grid-cols-\[repeat\(auto-fill\,minmax\(120px\,1fr\)\)\] { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); }

.grid-rows-1 { grid-template-rows: repeat(1, minmax(0px, 1fr)); }

.grid-rows-2 { grid-template-rows: repeat(2, minmax(0px, 1fr)); }

.flex-row { flex-direction: row; }

.flex-row-reverse { flex-direction: row-reverse; }

.flex-col { flex-direction: column; }

.flex-col-reverse { flex-direction: column-reverse; }

.flex-wrap { flex-wrap: wrap; }

.flex-nowrap { flex-wrap: nowrap; }

.place-content-center { place-content: center; }

.place-items-center { place-items: center; }

.\!items-start { align-items: flex-start !important; }

.items-start { align-items: flex-start; }

.items-end { align-items: flex-end; }

.\!items-center { align-items: center !important; }

.items-center { align-items: center; }

.items-baseline { align-items: baseline; }

.items-stretch { align-items: stretch; }

.\!justify-start { justify-content: flex-start !important; }

.justify-start { justify-content: flex-start; }

.justify-end { justify-content: flex-end; }

.\!justify-center { justify-content: center !important; }

.justify-center { justify-content: center; }

.justify-between { justify-content: space-between; }

.justify-stretch { justify-content: stretch; }

.justify-items-center { justify-items: center; }

.justify-items-stretch { justify-items: stretch; }

.\!gap-0 { gap: 0px !important; }

.\!gap-1 { gap: 0.25rem !important; }

.\!gap-1\.5 { gap: 0.375rem !important; }

.\!gap-2 { gap: 0.5rem !important; }

.\!gap-3 { gap: 0.75rem !important; }

.\!gap-3\.5 { gap: 0.875rem !important; }

.gap-0 { gap: 0px; }

.gap-0\.5 { gap: 0.125rem; }

.gap-1 { gap: 0.25rem; }

.gap-1\.5 { gap: 0.375rem; }

.gap-10 { gap: 2.5rem; }

.gap-2 { gap: 0.5rem; }

.gap-2\.5 { gap: 0.625rem; }

.gap-20 { gap: 5rem; }

.gap-3 { gap: 0.75rem; }

.gap-3\.5 { gap: 0.875rem; }

.gap-4 { gap: 1rem; }

.gap-5 { gap: 1.25rem; }

.gap-6 { gap: 1.5rem; }

.gap-7 { gap: 1.75rem; }

.gap-8 { gap: 2rem; }

.gap-\[0\.3em\] { gap: 0.3em; }

.gap-\[10px\] { gap: 10px; }

.gap-\[13px\] { gap: 13px; }

.gap-\[1px\] { gap: 1px; }

.gap-\[3px\] { gap: 3px; }

.gap-\[4px\] { gap: 4px; }

.gap-\[7px\] { gap: 7px; }

.gap-px { gap: 1px; }

.gap-x-2 { column-gap: 0.5rem; }

.gap-x-3 { column-gap: 0.75rem; }

.gap-x-4 { column-gap: 1rem; }

.gap-x-6 { column-gap: 1.5rem; }

.gap-x-8, .gap-x-\[2rem\] { column-gap: 2rem; }

.gap-y-0 { row-gap: 0px; }

.gap-y-1 { row-gap: 0.25rem; }

.gap-y-12 { row-gap: 3rem; }

.gap-y-2 { row-gap: 0.5rem; }

.gap-y-20 { row-gap: 5rem; }

.gap-y-3 { row-gap: 0.75rem; }

.gap-y-6 { row-gap: 1.5rem; }

.gap-y-8 { row-gap: 2rem; }

.gap-y-\[2\.5rem\] { row-gap: 2.5rem; }

.-space-x-2 > :not([hidden]) ~ :not([hidden]) { --tw-space-x-reverse: 0; margin-right: calc(-.5rem * var(--tw-space-x-reverse)); margin-left: calc(-.5rem * calc(1 - var(--tw-space-x-reverse))); }

.space-x-1 > :not([hidden]) ~ :not([hidden]) { --tw-space-x-reverse: 0; margin-right: calc(.25rem * var(--tw-space-x-reverse)); margin-left: calc(.25rem * calc(1 - var(--tw-space-x-reverse))); }

.space-x-2 > :not([hidden]) ~ :not([hidden]) { --tw-space-x-reverse: 0; margin-right: calc(.5rem * var(--tw-space-x-reverse)); margin-left: calc(.5rem * calc(1 - var(--tw-space-x-reverse))); }

.space-x-3 > :not([hidden]) ~ :not([hidden]) { --tw-space-x-reverse: 0; margin-right: calc(.75rem * var(--tw-space-x-reverse)); margin-left: calc(.75rem * calc(1 - var(--tw-space-x-reverse))); }

.space-x-4 > :not([hidden]) ~ :not([hidden]) { --tw-space-x-reverse: 0; margin-right: calc(1rem * var(--tw-space-x-reverse)); margin-left: calc(1rem * calc(1 - var(--tw-space-x-reverse))); }

.space-x-6 > :not([hidden]) ~ :not([hidden]) { --tw-space-x-reverse: 0; margin-right: calc(1.5rem * var(--tw-space-x-reverse)); margin-left: calc(1.5rem * calc(1 - var(--tw-space-x-reverse))); }

.space-y-0 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(0px * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(0px * var(--tw-space-y-reverse)); }

.space-y-0\.5 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(.125rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(.125rem * var(--tw-space-y-reverse)); }

.space-y-1 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(.25rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(.25rem * var(--tw-space-y-reverse)); }

.space-y-1\.5 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(.375rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(.375rem * var(--tw-space-y-reverse)); }

.space-y-10 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(2.5rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(2.5rem * var(--tw-space-y-reverse)); }

.space-y-2 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(.5rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(.5rem * var(--tw-space-y-reverse)); }

.space-y-20 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(5rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(5rem * var(--tw-space-y-reverse)); }

.space-y-3 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(.75rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(.75rem * var(--tw-space-y-reverse)); }

.space-y-4 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(1rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(1rem * var(--tw-space-y-reverse)); }

.space-y-5 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(1.25rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(1.25rem * var(--tw-space-y-reverse)); }

.space-y-6 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(1.5rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(1.5rem * var(--tw-space-y-reverse)); }

.space-y-8 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(2rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(2rem * var(--tw-space-y-reverse)); }

.divide-y > :not([hidden]) ~ :not([hidden]) { --tw-divide-y-reverse: 0; border-top-width: calc(1px * calc(1 - var(--tw-divide-y-reverse))); border-bottom-width: calc(1px * var(--tw-divide-y-reverse)); }

.divide-\[0\.5px\] > :not([hidden]) ~ :not([hidden]) { }

.divide-border-300 > :not([hidden]) ~ :not([hidden]) { border-color: hsl(var(--border-300)/.15); }

.divide-text-300\/20 > :not([hidden]) ~ :not([hidden]) { border-color: hsl(var(--text-300)/.2); }

.place-self-center { place-self: center; }

.self-start { align-self: flex-start; }

.self-end { align-self: flex-end; }

.self-center { align-self: center; }

.self-stretch { align-self: stretch; }

.overflow-auto { overflow: auto; }

.overflow-hidden { overflow: hidden; }

.overflow-visible { overflow: visible; }

.overflow-scroll { overflow: scroll; }

.overflow-x-auto { overflow-x: auto; }

.overflow-y-auto { overflow-y: auto; }

.overflow-x-hidden { overflow-x: hidden; }

.overflow-y-hidden { overflow-y: hidden; }

.overflow-x-clip { overflow-x: clip; }

.overflow-x-visible { overflow-x: visible; }

.overflow-y-visible { overflow-y: visible; }

.overflow-x-scroll { overflow-x: scroll; }

.overflow-y-scroll { overflow-y: scroll; }

.overscroll-auto { overscroll-behavior: auto; }

.overscroll-contain { overscroll-behavior: contain; }

.scroll-smooth { scroll-behavior: smooth; }

.\!truncate { overflow: hidden !important; text-overflow: ellipsis !important; white-space: nowrap !important; }

.truncate { overflow: hidden; white-space: nowrap; }

.overflow-ellipsis, .text-ellipsis, .truncate { text-overflow: ellipsis; }

.hyphens-auto { hyphens: auto; }

.\!whitespace-normal { white-space: normal !important; }

.whitespace-normal { white-space: normal; }

.whitespace-nowrap { white-space: nowrap; }

.whitespace-pre { white-space: pre; }

.whitespace-pre-line { white-space: pre-line; }

.whitespace-pre-wrap { white-space: pre-wrap; }

.whitespace-break-spaces { white-space: break-spaces; }

.text-wrap { text-wrap: wrap; }

.text-nowrap { text-wrap: nowrap; }

.text-balance { text-wrap: balance; }

.text-pretty { text-wrap: pretty; }

.break-words { overflow-wrap: break-word; }

.break-all { word-break: break-all; }

.\!rounded { border-radius: 0.25rem !important; }

.\!rounded-2xl { border-radius: 1rem !important; }

.\!rounded-\[0\.9rem\] { border-radius: 0.9rem !important; }

.\!rounded-\[32px\] { border-radius: 32px !important; }

.\!rounded-\[8rem\] { border-radius: 8rem !important; }

.\!rounded-full { border-radius: 9999px !important; }

.\!rounded-lg { border-radius: 0.5rem !important; }

.\!rounded-md { border-radius: 0.375rem !important; }

.\!rounded-none { border-radius: 0px !important; }

.\!rounded-xl { border-radius: 0.75rem !important; }

.rounded { border-radius: 0.25rem; }

.rounded-2xl { border-radius: 1rem; }

.rounded-3xl { border-radius: 1.5rem; }

.rounded-\[\.625rem\] { border-radius: 0.625rem; }

.rounded-\[0\.25rem\] { border-radius: 0.25rem; }

.rounded-\[0\.4rem\] { border-radius: 0.4rem; }

.rounded-\[0\.6rem\] { border-radius: 0.6rem; }

.rounded-\[0\.9rem\] { border-radius: 0.9rem; }

.rounded-\[14px\] { border-radius: 14px; }

.rounded-\[20px\] { border-radius: 20px; }

.rounded-\[24px\] { border-radius: 24px; }

.rounded-\[2rem\] { border-radius: 2rem; }

.rounded-\[30px\] { border-radius: 30px; }

.rounded-\[6px\] { border-radius: 6px; }

.rounded-\[inherit\] { border-radius: inherit; }

.rounded-full { border-radius: 9999px; }

.rounded-lg { border-radius: 0.5rem; }

.rounded-md { border-radius: 0.375rem; }

.rounded-sm { border-radius: 0.125rem; }

.rounded-xl { border-radius: 0.75rem; }

.\!rounded-l-none { border-top-left-radius: 0px !important; border-bottom-left-radius: 0px !important; }

.rounded-b-2xl { border-bottom-right-radius: 1rem; border-bottom-left-radius: 1rem; }

.rounded-b-lg { border-bottom-right-radius: 0.5rem; border-bottom-left-radius: 0.5rem; }

.rounded-b-xl { border-bottom-right-radius: 0.75rem; border-bottom-left-radius: 0.75rem; }

.rounded-e-2xl { border-start-end-radius: 1rem; border-end-end-radius: 1rem; }

.rounded-l-\[24px\] { border-top-left-radius: 24px; border-bottom-left-radius: 24px; }

.rounded-l-\[inherit\] { border-top-left-radius: inherit; border-bottom-left-radius: inherit; }

.rounded-l-lg { border-top-left-radius: 0.5rem; border-bottom-left-radius: 0.5rem; }

.rounded-r-\[24px\] { border-top-right-radius: 24px; border-bottom-right-radius: 24px; }

.rounded-r-full { border-top-right-radius: 9999px; border-bottom-right-radius: 9999px; }

.rounded-r-lg { border-top-right-radius: 0.5rem; border-bottom-right-radius: 0.5rem; }

.rounded-t { border-top-left-radius: 0.25rem; border-top-right-radius: 0.25rem; }

.rounded-t-2xl { border-top-left-radius: 1rem; border-top-right-radius: 1rem; }

.rounded-t-\[24px\] { border-top-left-radius: 24px; border-top-right-radius: 24px; }

.rounded-t-lg { border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem; }

.rounded-t-none { border-top-left-radius: 0px; border-top-right-radius: 0px; }

.rounded-t-xl { border-top-left-radius: 0.75rem; border-top-right-radius: 0.75rem; }

.rounded-ee-lg { border-end-end-radius: 0.5rem; }

.rounded-ss-md { border-start-start-radius: 0.375rem; }

.rounded-tl-\[0px\] { border-top-left-radius: 0px; }

.rounded-tl-xl { border-top-left-radius: 0.75rem; }

.rounded-tr-\[0px\] { border-top-right-radius: 0px; }

.rounded-tr-xl { border-top-right-radius: 0.75rem; }

.\!border { border-width: 1px !important; }

.\!border-0 { border-width: 0px !important; }

.\!border-0\.5 { border-width: 0.5px !important; }

.border { border-width: 1px; }

.border-0 { border-width: 0px; }

.border-0\.5 { border-width: 0.5px; }

.border-1\.5 { border-width: 1.5px; }

.border-2 { border-width: 2px; }

.border-4 { border-width: 4px; }

.border-8 { border-width: 8px; }

.border-\[0\.5px\] { border-width: 0.5px; }

.border-\[1\.5px\] { border-width: 1.5px; }

.border-\[1\.5rem\] { border-width: 1.5rem; }

.border-\[1px\] { border-width: 1px; }

.border-y { border-top-width: 1px; border-bottom-width: 1px; }

.border-y-0 { border-top-width: 0px; border-bottom-width: 0px; }

.border-y-0\.5 { border-top-width: 0.5px; border-bottom-width: 0.5px; }

.\!border-l-0 { border-left-width: 0px !important; }

.\!border-l-0\.5 { border-left-width: 0.5px !important; }

.border-b { border-bottom-width: 1px; }

.border-b-0 { border-bottom-width: 0px; }

.border-b-0\.5 { border-bottom-width: 0.5px; }

.border-b-1\.5 { border-bottom-width: 1.5px; }

.border-b-2 { border-bottom-width: 2px; }

.border-b-\[0\.5px\] { border-bottom-width: 0.5px; }

.border-l { border-left-width: 1px; }

.border-l-0 { border-left-width: 0px; }

.border-l-0\.5 { border-left-width: 0.5px; }

.border-l-2 { border-left-width: 2px; }

.border-l-4 { border-left-width: 4px; }

.border-r { border-right-width: 1px; }

.border-r-0 { border-right-width: 0px; }

.border-r-0\.5, .border-r-\[0\.5px\] { border-right-width: 0.5px; }

.border-t { border-top-width: 1px; }

.border-t-0 { border-top-width: 0px; }

.border-t-0\.5 { border-top-width: 0.5px; }

.border-t-2 { border-top-width: 2px; }

.border-t-\[0\.5px\] { border-top-width: 0.5px; }

.border-solid { border-style: solid; }

.border-dashed { border-style: dashed; }

.border-dotted { border-style: dotted; }

.\!border-none { border-style: none !important; }

.border-none { border-style: none; }

.\!border-accent-main-900 { --tw-border-opacity: 1 !important; border-color: hsl(var(--accent-main-900)/var(--tw-border-opacity)) !important; }

.\!border-accent-secondary-000 { --tw-border-opacity: 1 !important; border-color: hsl(var(--accent-secondary-000)/var(--tw-border-opacity)) !important; }

.\!border-accent-secondary-100 { --tw-border-opacity: 1 !important; border-color: hsl(var(--accent-secondary-100)/var(--tw-border-opacity)) !important; }

.\!border-accent-secondary-100\/30 { border-color: hsl(var(--accent-secondary-100)/.3) !important; }

.\!border-accent-secondary-100\/80 { border-color: hsl(var(--accent-secondary-100)/.8) !important; }

.\!border-accent-secondary-200 { --tw-border-opacity: 1 !important; border-color: hsl(var(--accent-secondary-200)/var(--tw-border-opacity)) !important; }

.\!border-border-200 { border-color: hsl(var(--border-200)/.3) !important; }

.\!border-border-300 { border-color: hsl(var(--border-300)/.15) !important; }

.\!border-border-300\/25 { border-color: hsl(var(--border-300)/.25) !important; }

.\!border-danger-200 { --tw-border-opacity: 1 !important; border-color: hsl(var(--danger-200)/var(--tw-border-opacity)) !important; }

.\!border-danger-200\/50 { border-color: hsl(var(--danger-200)/.5) !important; }

.\!border-transparent { border-color: transparent !important; }

.border-\[\#706B5721\] { border-color: rgba(112, 107, 87, 0.13); }

.border-accent-brand\/30 { border-color: hsl(var(--accent-brand)/.3); }

.border-accent-main-100 { --tw-border-opacity: 1; border-color: hsl(var(--accent-main-100)/var(--tw-border-opacity)); }

.border-accent-main-200 { --tw-border-opacity: 1; border-color: hsl(var(--accent-main-200)/var(--tw-border-opacity)); }

.border-accent-main-900 { --tw-border-opacity: 1; border-color: hsl(var(--accent-main-900)/var(--tw-border-opacity)); }

.border-accent-pro-100 { --tw-border-opacity: 1; border-color: hsl(var(--accent-pro-100)/var(--tw-border-opacity)); }

.border-accent-pro-100\/10 { border-color: hsl(var(--accent-pro-100)/.1); }

.border-accent-pro-100\/20 { border-color: hsl(var(--accent-pro-100)/.2); }

.border-accent-pro-100\/50 { border-color: hsl(var(--accent-pro-100)/.5); }

.border-accent-secondary-000 { --tw-border-opacity: 1; border-color: hsl(var(--accent-secondary-000)/var(--tw-border-opacity)); }

.border-accent-secondary-000\/20 { border-color: hsl(var(--accent-secondary-000)/.2); }

.border-accent-secondary-000\/40 { border-color: hsl(var(--accent-secondary-000)/.4); }

.border-accent-secondary-100 { --tw-border-opacity: 1; border-color: hsl(var(--accent-secondary-100)/var(--tw-border-opacity)); }

.border-accent-secondary-100\/20 { border-color: hsl(var(--accent-secondary-100)/.2); }

.border-accent-secondary-100\/50 { border-color: hsl(var(--accent-secondary-100)/.5); }

.border-accent-secondary-200 { --tw-border-opacity: 1; border-color: hsl(var(--accent-secondary-200)/var(--tw-border-opacity)); }

.border-accent-secondary-200\/20 { border-color: hsl(var(--accent-secondary-200)/.2); }

.border-accent-secondary-900 { --tw-border-opacity: 1; border-color: hsl(var(--accent-secondary-900)/var(--tw-border-opacity)); }

.border-always-black\/10 { border-color: hsl(var(--always-black)/.1); }

.border-always-white { --tw-border-opacity: 1; border-color: hsl(var(--always-white)/var(--tw-border-opacity)); }

.border-always-white\/10 { border-color: hsl(var(--always-white)/.1); }

.border-bg-000 { --tw-border-opacity: 1; border-color: hsl(var(--bg-000)/var(--tw-border-opacity)); }

.border-bg-100 { --tw-border-opacity: 1; border-color: hsl(var(--bg-100)/var(--tw-border-opacity)); }

.border-bg-200 { --tw-border-opacity: 1; border-color: hsl(var(--bg-200)/var(--tw-border-opacity)); }

.border-bg-300 { --tw-border-opacity: 1; border-color: hsl(var(--bg-300)/var(--tw-border-opacity)); }

.border-border-100 { border-color: hsl(var(--border-100)/.4); }

.border-border-100\/50 { border-color: hsl(var(--border-100)/.5); }

.border-border-200 { border-color: hsl(var(--border-200)/.3); }

.border-border-300, .border-border-300\/15 { border-color: hsl(var(--border-300)/.15); }

.border-border-300\/25 { border-color: hsl(var(--border-300)/.25); }

.border-border-400 { border-color: hsl(var(--border-400)/.15); }

.border-border-400\/10 { border-color: hsl(var(--border-400)/.1); }

.border-border-400\/15 { border-color: hsl(var(--border-400)/.15); }

.border-current { border-color: currentcolor; }

.border-danger-000 { --tw-border-opacity: 1; border-color: hsl(var(--danger-000)/var(--tw-border-opacity)); }

.border-danger-000\/10 { border-color: hsl(var(--danger-000)/.1); }

.border-danger-000\/30 { border-color: hsl(var(--danger-000)/.3); }

.border-danger-100 { --tw-border-opacity: 1; border-color: hsl(var(--danger-100)/var(--tw-border-opacity)); }

.border-danger-200 { --tw-border-opacity: 1; border-color: hsl(var(--danger-200)/var(--tw-border-opacity)); }

.border-danger-200\/50 { border-color: hsl(var(--danger-200)/.5); }

.border-text-000 { --tw-border-opacity: 1; border-color: hsl(var(--text-000)/var(--tw-border-opacity)); }

.border-text-100 { --tw-border-opacity: 1; border-color: hsl(var(--text-100)/var(--tw-border-opacity)); }

.border-text-300 { --tw-border-opacity: 1; border-color: hsl(var(--text-300)/var(--tw-border-opacity)); }

.border-transparent { border-color: transparent; }

.border-warning-orange { --tw-border-opacity: 1; border-color: rgb(255 184 0/var(--tw-border-opacity)); }

.border-warning-orange\/50 { border-color: rgba(255, 184, 0, 0.5); }

.border-x-bg-200 { --tw-border-opacity: 1; border-left-color: hsl(var(--bg-200)/var(--tw-border-opacity)); border-right-color: hsl(var(--bg-200)/var(--tw-border-opacity)); }

.\!border-l-border-200 { border-left-color: hsl(var(--border-200)/.3) !important; }

.border-b-bg-200 { --tw-border-opacity: 1; border-bottom-color: hsl(var(--bg-200)/var(--tw-border-opacity)); }

.border-b-border-100\/50 { border-bottom-color: hsl(var(--border-100)/.5); }

.border-r-transparent { border-right-color: transparent; }

.border-t-bg-200 { --tw-border-opacity: 1; border-top-color: hsl(var(--bg-200)/var(--tw-border-opacity)); }

.border-t-border-100\/50 { border-top-color: hsl(var(--border-100)/.5); }

.border-t-transparent { border-top-color: transparent; }

.\!border-opacity-100 { --tw-border-opacity: 1 !important; }

.\!border-opacity-40 { --tw-border-opacity: 0.4 !important; }

.border-opacity-100 { --tw-border-opacity: 1; }

.border-opacity-25 { --tw-border-opacity: 0.25; }

.border-opacity-30 { --tw-border-opacity: 0.3; }

.\!bg-\[green\] { --tw-bg-opacity: 1 !important; background-color: rgb(0 128 0/var(--tw-bg-opacity)) !important; }

.\!bg-accent-brand { --tw-bg-opacity: 1 !important; background-color: hsl(var(--accent-brand)/var(--tw-bg-opacity)) !important; }

.\!bg-accent-main-100\/10 { background-color: hsl(var(--accent-main-100)/.1) !important; }

.\!bg-accent-main-900 { --tw-bg-opacity: 1 !important; background-color: hsl(var(--accent-main-900)/var(--tw-bg-opacity)) !important; }

.\!bg-accent-pro-100 { --tw-bg-opacity: 1 !important; background-color: hsl(var(--accent-pro-100)/var(--tw-bg-opacity)) !important; }

.\!bg-accent-secondary-000 { --tw-bg-opacity: 1 !important; background-color: hsl(var(--accent-secondary-000)/var(--tw-bg-opacity)) !important; }

.\!bg-accent-secondary-100 { --tw-bg-opacity: 1 !important; background-color: hsl(var(--accent-secondary-100)/var(--tw-bg-opacity)) !important; }

.\!bg-accent-secondary-900 { --tw-bg-opacity: 1 !important; background-color: hsl(var(--accent-secondary-900)/var(--tw-bg-opacity)) !important; }

.\!bg-accent-secondary-900\/50 { background-color: hsl(var(--accent-secondary-900)/.5) !important; }

.\!bg-bg-000 { --tw-bg-opacity: 1 !important; background-color: hsl(var(--bg-000)/var(--tw-bg-opacity)) !important; }

.\!bg-bg-000\/50 { background-color: hsl(var(--bg-000)/.5) !important; }

.\!bg-bg-100 { background-color: hsl(var(--bg-100)/var(--tw-bg-opacity)) !important; }

.\!bg-bg-100, .\!bg-bg-200 { --tw-bg-opacity: 1 !important; }

.\!bg-bg-200 { background-color: hsl(var(--bg-200)/var(--tw-bg-opacity)) !important; }

.\!bg-bg-300\/60 { background-color: hsl(var(--bg-300)/.6) !important; }

.\!bg-bg-400 { --tw-bg-opacity: 1 !important; background-color: hsl(var(--bg-400)/var(--tw-bg-opacity)) !important; }

.\!bg-border-400 { background-color: hsl(var(--border-400)/.15) !important; }

.\!bg-danger-900 { --tw-bg-opacity: 1 !important; background-color: hsl(var(--danger-900)/var(--tw-bg-opacity)) !important; }

.\!bg-transparent { background-color: transparent !important; }

.bg-\[\#282c34\] { --tw-bg-opacity: 1; background-color: rgb(40 44 52/var(--tw-bg-opacity)); }

.bg-\[\#CBCADB\] { --tw-bg-opacity: 1; background-color: rgb(203 202 219/var(--tw-bg-opacity)); }

.bg-\[\#F5DB9A\] { --tw-bg-opacity: 1; background-color: rgb(245 219 154/var(--tw-bg-opacity)); }

.bg-\[green\] { --tw-bg-opacity: 1; background-color: rgb(0 128 0/var(--tw-bg-opacity)); }

.bg-\[hsl\(var\(--always-white\)\/80\%\)\] { background-color: hsl(var(--always-white)/80%); }

.bg-\[orange\] { --tw-bg-opacity: 1; background-color: rgb(255 165 0/var(--tw-bg-opacity)); }

.bg-\[red\] { --tw-bg-opacity: 1; background-color: rgb(255 0 0/var(--tw-bg-opacity)); }

.bg-accent-brand { --tw-bg-opacity: 1; background-color: hsl(var(--accent-brand)/var(--tw-bg-opacity)); }

.bg-accent-main-000 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-main-000)/var(--tw-bg-opacity)); }

.bg-accent-main-000\/10 { background-color: hsl(var(--accent-main-000)/.1); }

.bg-accent-main-100 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-main-100)/var(--tw-bg-opacity)); }

.bg-accent-main-100\/10 { background-color: hsl(var(--accent-main-100)/.1); }

.bg-accent-main-100\/20 { background-color: hsl(var(--accent-main-100)/.2); }

.bg-accent-main-200 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-main-200)/var(--tw-bg-opacity)); }

.bg-accent-main-200\/10 { background-color: hsl(var(--accent-main-200)/.1); }

.bg-accent-main-900 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-main-900)/var(--tw-bg-opacity)); }

.bg-accent-main-900\/20 { background-color: hsl(var(--accent-main-900)/.2); }

.bg-accent-pro-100 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-pro-100)/var(--tw-bg-opacity)); }

.bg-accent-pro-100\/10 { background-color: hsl(var(--accent-pro-100)/.1); }

.bg-accent-pro-100\/5 { background-color: hsl(var(--accent-pro-100)/.05); }

.bg-accent-pro-100\/90 { background-color: hsl(var(--accent-pro-100)/.9); }

.bg-accent-pro-900 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-pro-900)/var(--tw-bg-opacity)); }

.bg-accent-secondary-000 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-secondary-000)/var(--tw-bg-opacity)); }

.bg-accent-secondary-000\/10 { background-color: hsl(var(--accent-secondary-000)/.1); }

.bg-accent-secondary-100 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-secondary-100)/var(--tw-bg-opacity)); }

.bg-accent-secondary-100\/5 { background-color: hsl(var(--accent-secondary-100)/.05); }

.bg-accent-secondary-100\/\[8\%\] { background-color: hsl(var(--accent-secondary-100)/8%); }

.bg-accent-secondary-200 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-secondary-200)/var(--tw-bg-opacity)); }

.bg-accent-secondary-200\/10 { background-color: hsl(var(--accent-secondary-200)/.1); }

.bg-accent-secondary-200\/20 { background-color: hsl(var(--accent-secondary-200)/.2); }

.bg-accent-secondary-900 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-secondary-900)/var(--tw-bg-opacity)); }

.bg-accent-secondary-900\/40 { background-color: hsl(var(--accent-secondary-900)/.4); }

.bg-accent-secondary-900\/50 { background-color: hsl(var(--accent-secondary-900)/.5); }

.bg-accent-secondary-900\/75 { background-color: hsl(var(--accent-secondary-900)/.75); }

.bg-always-black { --tw-bg-opacity: 1; background-color: hsl(var(--always-black)/var(--tw-bg-opacity)); }

.bg-always-black\/30 { background-color: hsl(var(--always-black)/.3); }

.bg-always-black\/50 { background-color: hsl(var(--always-black)/.5); }

.bg-always-black\/80 { background-color: hsl(var(--always-black)/.8); }

.bg-always-black\/\[5\%\] { background-color: hsl(var(--always-black)/5%); }

.bg-always-white { --tw-bg-opacity: 1; background-color: hsl(var(--always-white)/var(--tw-bg-opacity)); }

.bg-always-white\/20 { background-color: hsl(var(--always-white)/.2); }

.bg-always-white\/50 { background-color: hsl(var(--always-white)/.5); }

.bg-bg-000 { --tw-bg-opacity: 1; background-color: hsl(var(--bg-000)/var(--tw-bg-opacity)); }

.bg-bg-000\/0 { background-color: hsl(var(--bg-000)/0); }

.bg-bg-000\/20 { background-color: hsl(var(--bg-000)/.2); }

.bg-bg-000\/25 { background-color: hsl(var(--bg-000)/.25); }

.bg-bg-000\/30 { background-color: hsl(var(--bg-000)/.3); }

.bg-bg-000\/50 { background-color: hsl(var(--bg-000)/.5); }

.bg-bg-000\/60 { background-color: hsl(var(--bg-000)/.6); }

.bg-bg-000\/70 { background-color: hsl(var(--bg-000)/.7); }

.bg-bg-000\/80 { background-color: hsl(var(--bg-000)/.8); }

.bg-bg-000\/90 { background-color: hsl(var(--bg-000)/.9); }

.bg-bg-000\/\[10\%\] { background-color: hsl(var(--bg-000)/10%); }

.bg-bg-000\/\[98\%\] { background-color: hsl(var(--bg-000)/98%); }

.bg-bg-100 { --tw-bg-opacity: 1; background-color: hsl(var(--bg-100)/var(--tw-bg-opacity)); }

.bg-bg-100\/20 { background-color: hsl(var(--bg-100)/.2); }

.bg-bg-100\/30 { background-color: hsl(var(--bg-100)/.3); }

.bg-bg-100\/5 { background-color: hsl(var(--bg-100)/.05); }

.bg-bg-100\/50 { background-color: hsl(var(--bg-100)/.5); }

.bg-bg-100\/60 { background-color: hsl(var(--bg-100)/.6); }

.bg-bg-100\/80 { background-color: hsl(var(--bg-100)/.8); }

.bg-bg-100\/90 { background-color: hsl(var(--bg-100)/.9); }

.bg-bg-100\/95 { background-color: hsl(var(--bg-100)/.95); }

.bg-bg-200 { --tw-bg-opacity: 1; background-color: hsl(var(--bg-200)/var(--tw-bg-opacity)); }

.bg-bg-200\/20 { background-color: hsl(var(--bg-200)/.2); }

.bg-bg-200\/80 { background-color: hsl(var(--bg-200)/.8); }

.bg-bg-300 { --tw-bg-opacity: 1; background-color: hsl(var(--bg-300)/var(--tw-bg-opacity)); }

.bg-bg-300\/0 { background-color: hsl(var(--bg-300)/0); }

.bg-bg-300\/30 { background-color: hsl(var(--bg-300)/.3); }

.bg-bg-300\/50 { background-color: hsl(var(--bg-300)/.5); }

.bg-bg-300\/60 { background-color: hsl(var(--bg-300)/.6); }

.bg-bg-300\/80 { background-color: hsl(var(--bg-300)/.8); }

.bg-bg-400 { --tw-bg-opacity: 1; background-color: hsl(var(--bg-400)/var(--tw-bg-opacity)); }

.bg-bg-400\/50 { background-color: hsl(var(--bg-400)/.5); }

.bg-bg-500 { --tw-bg-opacity: 1; background-color: hsl(var(--bg-500)/var(--tw-bg-opacity)); }

.bg-bg-500\/10 { background-color: hsl(var(--bg-500)/.1); }

.bg-bg-500\/20 { background-color: hsl(var(--bg-500)/.2); }

.bg-bg-500\/25 { background-color: hsl(var(--bg-500)/.25); }

.bg-bg-500\/40 { background-color: hsl(var(--bg-500)/.4); }

.bg-black { --tw-bg-opacity: 1; background-color: rgb(0 0 0/var(--tw-bg-opacity)); }

.bg-black\/80 { background-color: rgba(0, 0, 0, 0.8); }

.bg-border-200 { background-color: hsl(var(--border-200)/.3); }

.bg-border-300 { background-color: hsl(var(--border-300)/.15); }

.bg-border-300\/\[0\.02\] { background-color: hsl(var(--border-300)/.02); }

.bg-border-400 { background-color: hsl(var(--border-400)/.15); }

.bg-border-400\/\[0\.03\] { background-color: hsl(var(--border-400)/.03); }

.bg-current { background-color: currentcolor; }

.bg-danger-000\/10 { background-color: hsl(var(--danger-000)/.1); }

.bg-danger-100 { --tw-bg-opacity: 1; background-color: hsl(var(--danger-100)/var(--tw-bg-opacity)); }

.bg-danger-200 { --tw-bg-opacity: 1; background-color: hsl(var(--danger-200)/var(--tw-bg-opacity)); }

.bg-danger-200\/5 { background-color: hsl(var(--danger-200)/.05); }

.bg-danger-900 { --tw-bg-opacity: 1; background-color: hsl(var(--danger-900)/var(--tw-bg-opacity)); }

.bg-danger-900\/20 { background-color: hsl(var(--danger-900)/.2); }

.bg-danger-900\/25 { background-color: hsl(var(--danger-900)/.25); }

.bg-danger-900\/50 { background-color: hsl(var(--danger-900)/.5); }

.bg-inherit { background-color: inherit; }

.bg-oncolor-100\/10 { background-color: hsl(var(--oncolor-100)/.1); }

.bg-success-100 { --tw-bg-opacity: 1; background-color: hsl(var(--success-100)/var(--tw-bg-opacity)); }

.bg-success-900 { --tw-bg-opacity: 1; background-color: hsl(var(--success-900)/var(--tw-bg-opacity)); }

.bg-text-000 { --tw-bg-opacity: 1; background-color: hsl(var(--text-000)/var(--tw-bg-opacity)); }

.bg-text-100 { --tw-bg-opacity: 1; background-color: hsl(var(--text-100)/var(--tw-bg-opacity)); }

.bg-text-200 { --tw-bg-opacity: 1; background-color: hsl(var(--text-200)/var(--tw-bg-opacity)); }

.bg-text-200\/5 { background-color: hsl(var(--text-200)/.05); }

.bg-text-300 { --tw-bg-opacity: 1; background-color: hsl(var(--text-300)/var(--tw-bg-opacity)); }

.bg-text-300\/5 { background-color: hsl(var(--text-300)/.05); }

.bg-text-400 { --tw-bg-opacity: 1; background-color: hsl(var(--text-400)/var(--tw-bg-opacity)); }

.bg-text-500 { --tw-bg-opacity: 1; background-color: hsl(var(--text-500)/var(--tw-bg-opacity)); }

.bg-text-500\/20 { background-color: hsl(var(--text-500)/.2); }

.bg-text-500\/30 { background-color: hsl(var(--text-500)/.3); }

.bg-text-500\/50 { background-color: hsl(var(--text-500)/.5); }

.bg-transparent { background-color: transparent; }

.bg-warning-orange { --tw-bg-opacity: 1; background-color: rgb(255 184 0/var(--tw-bg-opacity)); }

.bg-white { --tw-bg-opacity: 1; background-color: rgb(255 255 255/var(--tw-bg-opacity)); }

.bg-opacity-0 { --tw-bg-opacity: 0; }

.bg-opacity-10 { --tw-bg-opacity: 0.1; }

.bg-opacity-20 { --tw-bg-opacity: 0.2; }

.bg-opacity-5 { --tw-bg-opacity: 0.05; }

.bg-opacity-50 { --tw-bg-opacity: 0.5; }

.bg-opacity-80 { --tw-bg-opacity: 0.8; }

.\!bg-gradient-to-b { background-image: linear-gradient(to bottom,var(--tw-gradient-stops)) !important; }

.bg-\[radial-gradient\(ellipse\,_var\(--tw-gradient-stops\)\)\] { background-image: radial-gradient(ellipse,var(--tw-gradient-stops)); }

.bg-gradient-to-b { background-image: linear-gradient(to bottom,var(--tw-gradient-stops)); }

.bg-gradient-to-bl { background-image: linear-gradient(to bottom left,var(--tw-gradient-stops)); }

.bg-gradient-to-l { background-image: linear-gradient(to left,var(--tw-gradient-stops)); }

.bg-gradient-to-r { background-image: linear-gradient(to right,var(--tw-gradient-stops)); }

.bg-gradient-to-t { background-image: linear-gradient(to top,var(--tw-gradient-stops)); }

.bg-none { background-image: none; }

.from-\[hsl\(var\(--always-black\)\/0\%\)\] { --tw-gradient-from: hsl(var(--always-black)/0%) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--always-black)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-\[rgba\(201\,192\,161\,0\)\] { --tw-gradient-from: rgba(201,192,161,0) var(--tw-gradient-from-position); --tw-gradient-to: rgba(201,192,161,0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-accent-brand { --tw-gradient-from: hsl(var(--accent-brand)/1) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--accent-brand)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-accent-main-200\/50 { --tw-gradient-from: hsl(var(--accent-main-200)/0.5) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--accent-main-200)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-accent-main-200\/70 { --tw-gradient-from: hsl(var(--accent-main-200)/0.7) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--accent-main-200)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-accent-pro-200 { --tw-gradient-from: hsl(var(--accent-pro-200)/1) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--accent-pro-200)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-accent-pro-900\/20 { --tw-gradient-from: hsl(var(--accent-pro-900)/0.2) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--accent-pro-900)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-accent-secondary-100\/0 { --tw-gradient-from: hsl(var(--accent-secondary-100)/0) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--accent-secondary-100)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-accent-secondary-200\/5 { --tw-gradient-from: hsl(var(--accent-secondary-200)/0.05) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--accent-secondary-200)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-accent-secondary-900\/0 { --tw-gradient-from: hsl(var(--accent-secondary-900)/0) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--accent-secondary-900)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-accent-secondary-900\/50 { --tw-gradient-from: hsl(var(--accent-secondary-900)/0.5) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--accent-secondary-900)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-accent-secondary-900\/75 { --tw-gradient-from: hsl(var(--accent-secondary-900)/0.75) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--accent-secondary-900)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-always-black\/0 { --tw-gradient-from: hsl(var(--always-black)/0) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--always-black)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-bg-000 { --tw-gradient-from: hsl(var(--bg-000)/1) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-000)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-bg-000\/30 { --tw-gradient-from: hsl(var(--bg-000)/0.3) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-000)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-bg-000\/50 { --tw-gradient-from: hsl(var(--bg-000)/0.5) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-000)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-bg-100 { --tw-gradient-from: hsl(var(--bg-100)/1) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-100)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-bg-200 { --tw-gradient-from: hsl(var(--bg-200)/1) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-200)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-bg-200\/30 { --tw-gradient-from: hsl(var(--bg-200)/0.3) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-200)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-bg-300 { --tw-gradient-from: hsl(var(--bg-300)/1) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-300)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-bg-300\/0 { --tw-gradient-from: hsl(var(--bg-300)/0) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-300)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-bg-400\/10 { --tw-gradient-from: hsl(var(--bg-400)/0.1) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-400)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-bg-500\/0 { --tw-gradient-from: hsl(var(--bg-500)/0) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-500)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-bg-500\/10 { --tw-gradient-from: hsl(var(--bg-500)/0.1) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-500)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-bg-500\/30 { --tw-gradient-from: hsl(var(--bg-500)/0.3) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-500)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-text-100 { --tw-gradient-from: hsl(var(--text-100)/1) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--text-100)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-text-300 { --tw-gradient-from: hsl(var(--text-300)/1) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--text-300)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-text-400 { --tw-gradient-from: hsl(var(--text-400)/1) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--text-400)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-transparent { --tw-gradient-from: transparent var(--tw-gradient-from-position); --tw-gradient-to: rgb(0 0 0/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.from-30\% { --tw-gradient-from-position: 30%; }

.from-40\% { --tw-gradient-from-position: 40%; }

.from-50\% { --tw-gradient-from-position: 50%; }

.via-accent-secondary-900\/100 { --tw-gradient-to: hsl(var(--accent-secondary-900)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),hsl(var(--accent-secondary-900)/1) var(--tw-gradient-via-position),var(--tw-gradient-to); }

.via-always-white\/20 { --tw-gradient-to: hsl(var(--always-white)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),hsl(var(--always-white)/0.2) var(--tw-gradient-via-position),var(--tw-gradient-to); }

.via-always-white\/70 { --tw-gradient-to: hsl(var(--always-white)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),hsl(var(--always-white)/0.7) var(--tw-gradient-via-position),var(--tw-gradient-to); }

.via-bg-000\/90 { --tw-gradient-to: hsl(var(--bg-000)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),hsl(var(--bg-000)/0.9) var(--tw-gradient-via-position),var(--tw-gradient-to); }

.via-bg-100 { --tw-gradient-to: hsl(var(--bg-100)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),hsl(var(--bg-100)/1) var(--tw-gradient-via-position),var(--tw-gradient-to); }

.via-bg-200\/90 { --tw-gradient-to: hsl(var(--bg-200)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),hsl(var(--bg-200)/0.9) var(--tw-gradient-via-position),var(--tw-gradient-to); }

.via-bg-300\/80 { --tw-gradient-to: hsl(var(--bg-300)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),hsl(var(--bg-300)/0.8) var(--tw-gradient-via-position),var(--tw-gradient-to); }

.via-bg-300\/90 { --tw-gradient-to: hsl(var(--bg-300)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),hsl(var(--bg-300)/0.9) var(--tw-gradient-via-position),var(--tw-gradient-to); }

.via-30\% { --tw-gradient-via-position: 30%; }

.via-65\% { --tw-gradient-via-position: 65%; }

.via-80\% { --tw-gradient-via-position: 80%; }

.to-\[hsl\(var\(--always-black\)\/2\.5\%\)\] { --tw-gradient-to: hsl(var(--always-black)/2.5%) var(--tw-gradient-to-position); }

.to-\[rgba\(201\,192\,161\,0\.1\)\] { --tw-gradient-to: rgba(201,192,161,0.1) var(--tw-gradient-to-position); }

.to-accent-brand { --tw-gradient-to: hsl(var(--accent-brand)/1) var(--tw-gradient-to-position); }

.to-accent-main-100 { --tw-gradient-to: hsl(var(--accent-main-100)/1) var(--tw-gradient-to-position); }

.to-accent-main-200\/0 { --tw-gradient-to: hsl(var(--accent-main-200)/0) var(--tw-gradient-to-position); }

.to-accent-main-900\/30 { --tw-gradient-to: hsl(var(--accent-main-900)/0.3) var(--tw-gradient-to-position); }

.to-accent-pro-100 { --tw-gradient-to: hsl(var(--accent-pro-100)/1) var(--tw-gradient-to-position); }

.to-accent-pro-900\/50 { --tw-gradient-to: hsl(var(--accent-pro-900)/0.5) var(--tw-gradient-to-position); }

.to-accent-secondary-100\/5 { --tw-gradient-to: hsl(var(--accent-secondary-100)/0.05) var(--tw-gradient-to-position); }

.to-accent-secondary-900\/10 { --tw-gradient-to: hsl(var(--accent-secondary-900)/0.1) var(--tw-gradient-to-position); }

.to-accent-secondary-900\/100 { --tw-gradient-to: hsl(var(--accent-secondary-900)/1) var(--tw-gradient-to-position); }

.to-accent-secondary-900\/25 { --tw-gradient-to: hsl(var(--accent-secondary-900)/0.25) var(--tw-gradient-to-position); }

.to-always-black\/5 { --tw-gradient-to: hsl(var(--always-black)/0.05) var(--tw-gradient-to-position); }

.to-bg-000\/0 { --tw-gradient-to: hsl(var(--bg-000)/0) var(--tw-gradient-to-position); }

.to-bg-000\/20 { --tw-gradient-to: hsl(var(--bg-000)/0.2) var(--tw-gradient-to-position); }

.to-bg-000\/75 { --tw-gradient-to: hsl(var(--bg-000)/0.75) var(--tw-gradient-to-position); }

.to-bg-100 { --tw-gradient-to: hsl(var(--bg-100)/1) var(--tw-gradient-to-position); }

.to-bg-100\/0 { --tw-gradient-to: hsl(var(--bg-100)/0) var(--tw-gradient-to-position); }

.to-bg-100\/30 { --tw-gradient-to: hsl(var(--bg-100)/0.3) var(--tw-gradient-to-position); }

.to-bg-200 { --tw-gradient-to: hsl(var(--bg-200)/1) var(--tw-gradient-to-position); }

.to-bg-200\/0 { --tw-gradient-to: hsl(var(--bg-200)/0) var(--tw-gradient-to-position); }

.to-bg-200\/40 { --tw-gradient-to: hsl(var(--bg-200)/0.4) var(--tw-gradient-to-position); }

.to-bg-300 { --tw-gradient-to: hsl(var(--bg-300)/1) var(--tw-gradient-to-position); }

.to-bg-300\/50 { --tw-gradient-to: hsl(var(--bg-300)/0.5) var(--tw-gradient-to-position); }

.to-bg-400\/30 { --tw-gradient-to: hsl(var(--bg-400)/0.3) var(--tw-gradient-to-position); }

.to-bg-500\/30 { --tw-gradient-to: hsl(var(--bg-500)/0.3) var(--tw-gradient-to-position); }

.to-bg-500\/40 { --tw-gradient-to: hsl(var(--bg-500)/0.4) var(--tw-gradient-to-position); }

.to-bg-500\/70 { --tw-gradient-to: hsl(var(--bg-500)/0.7) var(--tw-gradient-to-position); }

.to-text-300 { --tw-gradient-to: hsl(var(--text-300)/1) var(--tw-gradient-to-position); }

.to-text-400 { --tw-gradient-to: hsl(var(--text-400)/1) var(--tw-gradient-to-position); }

.to-transparent { --tw-gradient-to: transparent var(--tw-gradient-to-position); }

.to-60\% { --tw-gradient-to-position: 60%; }

.to-80\% { --tw-gradient-to-position: 80%; }

.bg-\[length\:400\%_100\%\] { background-size: 400% 100%; }

.bg-fixed { background-attachment: fixed; }

.bg-clip-padding { background-clip: padding-box; }

.bg-clip-text { background-clip: text; }

.bg-no-repeat { background-repeat: no-repeat; }

.fill-\[\#141413\] { fill: rgb(20, 20, 19); }

.fill-\[\#BCD1CA\] { fill: rgb(188, 209, 202); }

.fill-\[\#E8E6DC\] { fill: rgb(232, 230, 220); }

.fill-accent-brand { fill: hsl(var(--accent-brand)/1); }

.fill-accent-secondary-100\/50 { fill: hsl(var(--accent-secondary-100)/.5); }

.fill-accent-secondary-100\/70 { fill: hsl(var(--accent-secondary-100)/.7); }

.fill-accent-secondary-900 { fill: hsl(var(--accent-secondary-900)/1); }

.fill-bg-000 { fill: hsl(var(--bg-000)/1); }

.fill-bg-200 { fill: hsl(var(--bg-200)/1); }

.fill-bg-300 { fill: hsl(var(--bg-300)/1); }

.fill-bg-400 { fill: hsl(var(--bg-400)/1); }

.fill-bg-500 { fill: hsl(var(--bg-500)/1); }

.fill-border-300 { fill: hsl(var(--border-300)/.15); }

.fill-current { fill: currentcolor; }

.fill-none { fill: none; }

.fill-text-100 { fill: hsl(var(--text-100)/1); }

.fill-text-200 { fill: hsl(var(--text-200)/1); }

.stroke-none { stroke: none; }

.stroke-text-200 { stroke: hsl(var(--text-200)/1); }

.object-contain { object-fit: contain; }

.object-cover { object-fit: cover; }

.object-center { object-position: center center; }

.object-top { object-position: center top; }

.\!p-0 { padding: 0px !important; }

.\!p-3 { padding: 0.75rem !important; }

.\!p-3\.5 { padding: 0.875rem !important; }

.\!p-8 { padding: 2rem !important; }

.p-0 { padding: 0px; }

.p-0\.5 { padding: 0.125rem; }

.p-1 { padding: 0.25rem; }

.p-1\.5 { padding: 0.375rem; }

.p-10 { padding: 2.5rem; }

.p-12 { padding: 3rem; }

.p-2 { padding: 0.5rem; }

.p-2\.5 { padding: 0.625rem; }

.p-3 { padding: 0.75rem; }

.p-3\.5 { padding: 0.875rem; }

.p-32 { padding: 8rem; }

.p-4 { padding: 1rem; }

.p-5 { padding: 1.25rem; }

.p-6 { padding: 1.5rem; }

.p-7 { padding: 1.75rem; }

.p-8 { padding: 2rem; }

.p-\[0\.5px\] { padding: 0.5px; }

.p-\[32px\] { padding: 32px; }

.p-px { padding: 1px; }

.\!px-0 { padding-left: 0px !important; padding-right: 0px !important; }

.\!px-0\.5 { padding-left: 0.125rem !important; padding-right: 0.125rem !important; }

.\!px-1 { padding-left: 0.25rem !important; padding-right: 0.25rem !important; }

.\!px-1\.5 { padding-left: 0.375rem !important; padding-right: 0.375rem !important; }

.\!px-12 { padding-left: 3rem !important; padding-right: 3rem !important; }

.\!px-2 { padding-left: 0.5rem !important; padding-right: 0.5rem !important; }

.\!px-2\.5 { padding-left: 0.625rem !important; padding-right: 0.625rem !important; }

.\!px-3 { padding-left: 0.75rem !important; padding-right: 0.75rem !important; }

.\!px-6 { padding-left: 1.5rem !important; padding-right: 1.5rem !important; }

.\!px-8 { padding-left: 2rem !important; padding-right: 2rem !important; }

.\!py-0 { padding-top: 0px !important; padding-bottom: 0px !important; }

.\!py-0\.5 { padding-top: 0.125rem !important; padding-bottom: 0.125rem !important; }

.\!py-1 { padding-top: 0.25rem !important; padding-bottom: 0.25rem !important; }

.\!py-16 { padding-top: 4rem !important; padding-bottom: 4rem !important; }

.\!py-2 { padding-top: 0.5rem !important; padding-bottom: 0.5rem !important; }

.\!py-3 { padding-top: 0.75rem !important; padding-bottom: 0.75rem !important; }

.\!py-3\.5 { padding-top: 0.875rem !important; padding-bottom: 0.875rem !important; }

.px-0 { padding-left: 0px; padding-right: 0px; }

.px-0\.5 { padding-left: 0.125rem; padding-right: 0.125rem; }

.px-1 { padding-left: 0.25rem; padding-right: 0.25rem; }

.px-1\.5 { padding-left: 0.375rem; padding-right: 0.375rem; }

.px-10 { padding-left: 2.5rem; padding-right: 2.5rem; }

.px-12 { padding-left: 3rem; padding-right: 3rem; }

.px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }

.px-2\.5 { padding-left: 0.625rem; padding-right: 0.625rem; }

.px-24 { padding-left: 6rem; padding-right: 6rem; }

.px-3 { padding-left: 0.75rem; padding-right: 0.75rem; }

.px-3\.5 { padding-left: 0.875rem; padding-right: 0.875rem; }

.px-4 { padding-left: 1rem; padding-right: 1rem; }

.px-5 { padding-left: 1.25rem; padding-right: 1.25rem; }

.px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }

.px-8 { padding-left: 2rem; padding-right: 2rem; }

.px-\[0\.3125rem\] { padding-left: 0.3125rem; padding-right: 0.3125rem; }

.px-\[1\.375rem\] { padding-left: 1.375rem; padding-right: 1.375rem; }

.px-\[7\.5px\] { padding-left: 7.5px; padding-right: 7.5px; }

.py-0 { padding-top: 0px; padding-bottom: 0px; }

.py-0\.5 { padding-top: 0.125rem; padding-bottom: 0.125rem; }

.py-1 { padding-top: 0.25rem; padding-bottom: 0.25rem; }

.py-1\.5 { padding-top: 0.375rem; padding-bottom: 0.375rem; }

.py-10 { padding-top: 2.5rem; padding-bottom: 2.5rem; }

.py-12 { padding-top: 3rem; padding-bottom: 3rem; }

.py-16 { padding-top: 4rem; padding-bottom: 4rem; }

.py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }

.py-2\.5 { padding-top: 0.625rem; padding-bottom: 0.625rem; }

.py-20 { padding-top: 5rem; padding-bottom: 5rem; }

.py-24 { padding-top: 6rem; padding-bottom: 6rem; }

.py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }

.py-3\.5 { padding-top: 0.875rem; padding-bottom: 0.875rem; }

.py-4 { padding-top: 1rem; padding-bottom: 1rem; }

.py-5 { padding-top: 1.25rem; padding-bottom: 1.25rem; }

.py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }

.py-7 { padding-top: 1.75rem; padding-bottom: 1.75rem; }

.py-8 { padding-top: 2rem; padding-bottom: 2rem; }

.py-\[0\.2rem\] { padding-top: 0.2rem; padding-bottom: 0.2rem; }

.py-\[2px\] { padding-top: 2px; padding-bottom: 2px; }

.py-\[3px\] { padding-top: 3px; padding-bottom: 3px; }

.py-\[65px\] { padding-top: 65px; padding-bottom: 65px; }

.py-px { padding-top: 1px; padding-bottom: 1px; }

.\!pb-0 { padding-bottom: 0px !important; }

.\!pb-7 { padding-bottom: 1.75rem !important; }

.\!pb-8 { padding-bottom: 2rem !important; }

.\!pl-1 { padding-left: 0.25rem !important; }

.\!pl-1\.5 { padding-left: 0.375rem !important; }

.\!pr-0 { padding-right: 0px !important; }

.\!pr-1 { padding-right: 0.25rem !important; }

.\!pt-0 { padding-top: 0px !important; }

.\!pt-10 { padding-top: 2.5rem !important; }

.\!pt-5 { padding-top: 1.25rem !important; }

.\!pt-8 { padding-top: 2rem !important; }

.pb-0 { padding-bottom: 0px; }

.pb-1 { padding-bottom: 0.25rem; }

.pb-1\.5 { padding-bottom: 0.375rem; }

.pb-10 { padding-bottom: 2.5rem; }

.pb-12 { padding-bottom: 3rem; }

.pb-14 { padding-bottom: 3.5rem; }

.pb-16 { padding-bottom: 4rem; }

.pb-2 { padding-bottom: 0.5rem; }

.pb-2\.5 { padding-bottom: 0.625rem; }

.pb-20 { padding-bottom: 5rem; }

.pb-24 { padding-bottom: 6rem; }

.pb-3 { padding-bottom: 0.75rem; }

.pb-3\.5 { padding-bottom: 0.875rem; }

.pb-32 { padding-bottom: 8rem; }

.pb-4 { padding-bottom: 1rem; }

.pb-5 { padding-bottom: 1.25rem; }

.pb-6 { padding-bottom: 1.5rem; }

.pb-8 { padding-bottom: 2rem; }

.pb-\[3rem\] { padding-bottom: 3rem; }

.pb-px { padding-bottom: 1px; }

.pl-0 { padding-left: 0px; }

.pl-0\.5 { padding-left: 0.125rem; }

.pl-1 { padding-left: 0.25rem; }

.pl-1\.5 { padding-left: 0.375rem; }

.pl-10 { padding-left: 2.5rem; }

.pl-11 { padding-left: 2.75rem; }

.pl-12 { padding-left: 3rem; }

.pl-16 { padding-left: 4rem; }

.pl-2 { padding-left: 0.5rem; }

.pl-2\.5 { padding-left: 0.625rem; }

.pl-24 { padding-left: 6rem; }

.pl-3 { padding-left: 0.75rem; }

.pl-3\.5 { padding-left: 0.875rem; }

.pl-4 { padding-left: 1rem; }

.pl-5 { padding-left: 1.25rem; }

.pl-6 { padding-left: 1.5rem; }

.pl-7 { padding-left: 1.75rem; }

.pl-8 { padding-left: 2rem; }

.pl-\[133px\] { padding-left: 133px; }

.pl-\[90px\] { padding-left: 90px; }

.pl-\[clamp\(1\.5rem\,3\.5vw\,3\.125rem\)\] { padding-left: clamp(1.5rem, 3.5vw, 3.125rem); }

.pr-0 { padding-right: 0px; }

.pr-0\.5 { padding-right: 0.125rem; }

.pr-1 { padding-right: 0.25rem; }

.pr-1\.5 { padding-right: 0.375rem; }

.pr-10 { padding-right: 2.5rem; }

.pr-12 { padding-right: 3rem; }

.pr-16 { padding-right: 4rem; }

.pr-2 { padding-right: 0.5rem; }

.pr-2\.5 { padding-right: 0.625rem; }

.pr-20 { padding-right: 5rem; }

.pr-3 { padding-right: 0.75rem; }

.pr-3\.5 { padding-right: 0.875rem; }

.pr-4 { padding-right: 1rem; }

.pr-5 { padding-right: 1.25rem; }

.pr-6 { padding-right: 1.5rem; }

.pr-7 { padding-right: 1.75rem; }

.pr-8 { padding-right: 2rem; }

.pr-\[100px\] { padding-right: 100px; }

.pr-\[140px\] { padding-right: 140px; }

.pr-\[2\.5px\] { padding-right: 2.5px; }

.pr-\[3\.5rem\] { padding-right: 3.5rem; }

.ps-6 { padding-inline-start: 1.5rem; }

.pt-0 { padding-top: 0px; }

.pt-0\.5 { padding-top: 0.125rem; }

.pt-1 { padding-top: 0.25rem; }

.pt-1\.5 { padding-top: 0.375rem; }

.pt-10 { padding-top: 2.5rem; }

.pt-12 { padding-top: 3rem; }

.pt-16 { padding-top: 4rem; }

.pt-2 { padding-top: 0.5rem; }

.pt-2\.5 { padding-top: 0.625rem; }

.pt-24 { padding-top: 6rem; }

.pt-3 { padding-top: 0.75rem; }

.pt-4 { padding-top: 1rem; }

.pt-5 { padding-top: 1.25rem; }

.pt-6 { padding-top: 1.5rem; }

.pt-7 { padding-top: 1.75rem; }

.pt-8 { padding-top: 2rem; }

.pt-\[10vh\] { padding-top: 10vh; }

.pt-\[52px\] { padding-top: 52px; }

.pt-\[60px\] { padding-top: 60px; }

.pt-\[72px\] { padding-top: 72px; }

.pt-\[clamp\(1\.5rem\,3\.5vw\,3\.125rem\)\] { padding-top: clamp(1.5rem, 3.5vw, 3.125rem); }

.\!text-left { text-align: left !important; }

.text-left { text-align: left; }

.text-center { text-align: center; }

.text-right { text-align: right; }

.text-justify { text-align: justify; }

.text-start { text-align: start; }

.align-top { vertical-align: top; }

.align-middle { vertical-align: middle; }

.align-\[-0\.125em\] { vertical-align: -0.125em; }

.align-\[1px\] { vertical-align: 1px; }

.font-sans { font-family: var(--font-ui); }

.font-serif { font-family: var(--font-ui-serif); }

.\!text-4xl { font-size: 2.25rem !important; line-height: 2.5rem !important; }

.\!text-6xl { font-size: 3.75rem !important; line-height: 1 !important; }

.\!text-\[0\.6875rem\] { font-size: 0.6875rem !important; }

.\!text-base { font-size: 1rem !important; line-height: 1.5rem !important; }

.\!text-sm { font-size: 0.875rem !important; line-height: 1.25rem !important; }

.\!text-xs { font-size: 0.75rem !important; line-height: 1rem !important; }

.text-2xl { font-size: 1.5rem; line-height: 2rem; }

.text-3xl { font-size: 1.875rem; line-height: 2.25rem; }

.text-3xl\/6 { font-size: 1.875rem; line-height: 1.5rem; }

.text-4xl { font-size: 2.25rem; line-height: 2.5rem; }

.text-5xl { font-size: 3rem; line-height: 1; }

.text-\[0\.3rem\] { font-size: 0.3rem; }

.text-\[0\.4rem\] { font-size: 0.4rem; }

.text-\[0\.5625rem\] { font-size: 0.5625rem; }

.text-\[0\.5rem\] { font-size: 0.5rem; }

.text-\[0\.625rem\] { font-size: 0.625rem; }

.text-\[0\.65rem\] { font-size: 0.65rem; }

.text-\[0\.6875rem\] { font-size: 0.6875rem; }

.text-\[0\.6rem\] { font-size: 0.6rem; }

.text-\[0\.75rem\] { font-size: 0.75rem; }

.text-\[0\.7rem\] { font-size: 0.7rem; }

.text-\[0\.8125rem\] { font-size: 0.8125rem; }

.text-\[0\.875rem\] { font-size: 0.875rem; }

.text-\[0\.9375rem\] { font-size: 0.9375rem; }

.text-\[0\.9rem\] { font-size: 0.9rem; }

.text-\[1\.75rem\] { font-size: 1.75rem; }

.text-\[10px\] { font-size: 10px; }

.text-\[11px\] { font-size: 11px; }

.text-\[12px\] { font-size: 12px; }

.text-\[13px\] { font-size: 13px; }

.text-\[14px\] { font-size: 14px; }

.text-\[15px\] { font-size: 15px; }

.text-\[16px\] { font-size: 16px; }

.text-\[17px\] { font-size: 17px; }

.text-\[20px\] { font-size: 20px; }

.text-\[24px\] { font-size: 24px; }

.text-\[3\.5rem\] { font-size: 3.5rem; }

.text-\[7px\] { font-size: 7px; }

.text-\[8px\] { font-size: 8px; }

.text-\[9px\] { font-size: 9px; }

.text-base { font-size: 1rem; line-height: 1.5rem; }

.text-lg { font-size: 1.125rem; line-height: 1.75rem; }

.text-sm { font-size: 0.875rem; line-height: 1.25rem; }

.text-sm\/3 { font-size: 0.875rem; line-height: 0.75rem; }

.text-xl { font-size: 1.25rem; line-height: 1.75rem; }

.text-xs { font-size: 0.75rem; line-height: 1rem; }

.\!font-normal { font-weight: 400 !important; }

.font-\[450\] { font-weight: 450; }

.font-black { font-weight: 900; }

.font-bold { font-weight: 700; }

.font-extrabold { font-weight: 800; }

.font-extralight { font-weight: 200; }

.font-light { font-weight: 300; }

.font-medium { font-weight: 500; }

.font-normal { font-weight: 400; }

.font-semibold { font-weight: 600; }

.font-thin { font-weight: 100; }

.uppercase { text-transform: uppercase; }

.lowercase { text-transform: lowercase; }

.capitalize { text-transform: capitalize; }

.\!normal-case { text-transform: none !important; }

.italic { font-style: italic; }

.ordinal { --tw-ordinal: ordinal; }

.lining-nums, .ordinal { font-variant-numeric: var(--tw-ordinal) var(--tw-slashed-zero) var(--tw-numeric-figure) var(--tw-numeric-spacing) var(--tw-numeric-fraction); }

.lining-nums { --tw-numeric-figure: lining-nums; }

.proportional-nums { --tw-numeric-spacing: proportional-nums; }

.proportional-nums, .tabular-nums { font-variant-numeric: var(--tw-ordinal) var(--tw-slashed-zero) var(--tw-numeric-figure) var(--tw-numeric-spacing) var(--tw-numeric-fraction); }

.tabular-nums { --tw-numeric-spacing: tabular-nums; }

.\!leading-relaxed { line-height: 1.625 !important; }

.leading-3 { line-height: 0.75rem; }

.leading-4 { line-height: 1rem; }

.leading-5 { line-height: 1.25rem; }

.leading-6 { line-height: 1.5rem; }

.leading-7 { line-height: 1.75rem; }

.leading-\[0\.85rem\] { line-height: 0.85rem; }

.leading-\[0\.8rem\] { line-height: 0.8rem; }

.leading-\[0\.9em\] { line-height: 0.9em; }

.leading-\[1\.15\] { line-height: 1.15; }

.leading-\[1\.3\] { line-height: 1.3; }

.leading-\[1\.4\] { line-height: 1.4; }

.leading-\[1\.65rem\] { line-height: 1.65rem; }

.leading-\[1\.88888\] { line-height: 1.88888; }

.leading-\[109\%\] { line-height: 109%; }

.leading-\[13px\] { line-height: 13px; }

.leading-\[140\%\] { line-height: 140%; }

.leading-\[1em\] { line-height: 1em; }

.leading-none { line-height: 1; }

.leading-normal { line-height: 1.5; }

.leading-relaxed { line-height: 1.625; }

.leading-snug { line-height: 1.375; }

.leading-tight { line-height: 1.25; }

.\!text-accent-main-000 { --tw-text-opacity: 1 !important; color: hsl(var(--accent-main-000)/var(--tw-text-opacity)) !important; }

.\!text-accent-secondary-000 { --tw-text-opacity: 1 !important; color: hsl(var(--accent-secondary-000)/var(--tw-text-opacity)) !important; }

.\!text-accent-secondary-100 { --tw-text-opacity: 1 !important; color: hsl(var(--accent-secondary-100)/var(--tw-text-opacity)) !important; }

.\!text-always-white { --tw-text-opacity: 1 !important; color: hsl(var(--always-white)/var(--tw-text-opacity)) !important; }

.\!text-bg-000 { --tw-text-opacity: 1 !important; color: hsl(var(--bg-000)/var(--tw-text-opacity)) !important; }

.\!text-danger-000 { --tw-text-opacity: 1 !important; color: hsl(var(--danger-000)/var(--tw-text-opacity)) !important; }

.\!text-danger-100 { --tw-text-opacity: 1 !important; color: hsl(var(--danger-100)/var(--tw-text-opacity)) !important; }

.\!text-danger-200 { --tw-text-opacity: 1 !important; color: hsl(var(--danger-200)/var(--tw-text-opacity)) !important; }

.\!text-oncolor-100 { --tw-text-opacity: 1 !important; color: hsl(var(--oncolor-100)/var(--tw-text-opacity)) !important; }

.\!text-text-000 { --tw-text-opacity: 1 !important; color: hsl(var(--text-000)/var(--tw-text-opacity)) !important; }

.\!text-text-100 { --tw-text-opacity: 1 !important; color: hsl(var(--text-100)/var(--tw-text-opacity)) !important; }

.\!text-text-300 { --tw-text-opacity: 1 !important; color: hsl(var(--text-300)/var(--tw-text-opacity)) !important; }

.\!text-text-400 { --tw-text-opacity: 1 !important; color: hsl(var(--text-400)/var(--tw-text-opacity)) !important; }

.\!text-text-500 { --tw-text-opacity: 1 !important; color: hsl(var(--text-500)/var(--tw-text-opacity)) !important; }

.text-\[\#A29F95\] { --tw-text-opacity: 1; color: rgb(162 159 149/var(--tw-text-opacity)); }

.text-\[\#D97757\] { --tw-text-opacity: 1; color: rgb(217 119 87/var(--tw-text-opacity)); }

.text-\[\#abb2bf\] { --tw-text-opacity: 1; color: rgb(171 178 191/var(--tw-text-opacity)); }

.text-accent-brand { --tw-text-opacity: 1; color: hsl(var(--accent-brand)/var(--tw-text-opacity)); }

.text-accent-main-000 { --tw-text-opacity: 1; color: hsl(var(--accent-main-000)/var(--tw-text-opacity)); }

.text-accent-main-100 { --tw-text-opacity: 1; color: hsl(var(--accent-main-100)/var(--tw-text-opacity)); }

.text-accent-main-200 { --tw-text-opacity: 1; color: hsl(var(--accent-main-200)/var(--tw-text-opacity)); }

.text-accent-main-900 { --tw-text-opacity: 1; color: hsl(var(--accent-main-900)/var(--tw-text-opacity)); }

.text-accent-pro-000 { --tw-text-opacity: 1; color: hsl(var(--accent-pro-000)/var(--tw-text-opacity)); }

.text-accent-secondary-000 { --tw-text-opacity: 1; color: hsl(var(--accent-secondary-000)/var(--tw-text-opacity)); }

.text-accent-secondary-100 { --tw-text-opacity: 1; color: hsl(var(--accent-secondary-100)/var(--tw-text-opacity)); }

.text-accent-secondary-200 { --tw-text-opacity: 1; color: hsl(var(--accent-secondary-200)/var(--tw-text-opacity)); }

.text-always-black\/80 { color: hsl(var(--always-black)/.8); }

.text-always-white { --tw-text-opacity: 1; color: hsl(var(--always-white)/var(--tw-text-opacity)); }

.text-always-white\/0 { color: hsl(var(--always-white)/0); }

.text-always-white\/90 { color: hsl(var(--always-white)/.9); }

.text-bg-000 { --tw-text-opacity: 1; color: hsl(var(--bg-000)/var(--tw-text-opacity)); }

.text-bg-100 { --tw-text-opacity: 1; color: hsl(var(--bg-100)/var(--tw-text-opacity)); }

.text-bg-300 { --tw-text-opacity: 1; color: hsl(var(--bg-300)/var(--tw-text-opacity)); }

.text-black { --tw-text-opacity: 1; color: rgb(0 0 0/var(--tw-text-opacity)); }

.text-border-100 { color: hsl(var(--border-100)/.4); }

.text-border-200 { color: hsl(var(--border-200)/.3); }

.text-border-300 { color: hsl(var(--border-300)/.15); }

.text-danger-000 { --tw-text-opacity: 1; color: hsl(var(--danger-000)/var(--tw-text-opacity)); }

.text-forest-green { --tw-text-opacity: 1; color: rgb(54 136 74/var(--tw-text-opacity)); }

.text-oncolor-100 { --tw-text-opacity: 1; color: hsl(var(--oncolor-100)/var(--tw-text-opacity)); }

.text-oncolor-200 { color: hsl(var(--oncolor-200)/.75); }

.text-success-000 { --tw-text-opacity: 1; color: hsl(var(--success-000)/var(--tw-text-opacity)); }

.text-success-100 { --tw-text-opacity: 1; color: hsl(var(--success-100)/var(--tw-text-opacity)); }

.text-success-200 { --tw-text-opacity: 1; color: hsl(var(--success-200)/var(--tw-text-opacity)); }

.text-text-000 { --tw-text-opacity: 1; color: hsl(var(--text-000)/var(--tw-text-opacity)); }

.text-text-000\/40 { color: hsl(var(--text-000)/.4); }

.text-text-100 { --tw-text-opacity: 1; color: hsl(var(--text-100)/var(--tw-text-opacity)); }

.text-text-100\/90 { color: hsl(var(--text-100)/.9); }

.text-text-200 { --tw-text-opacity: 1; color: hsl(var(--text-200)/var(--tw-text-opacity)); }

.text-text-300 { --tw-text-opacity: 1; color: hsl(var(--text-300)/var(--tw-text-opacity)); }

.text-text-400 { --tw-text-opacity: 1; color: hsl(var(--text-400)/var(--tw-text-opacity)); }

.text-text-400\/40 { color: hsl(var(--text-400)/.4); }

.text-text-500 { --tw-text-opacity: 1; color: hsl(var(--text-500)/var(--tw-text-opacity)); }

.text-text-500\/50 { color: hsl(var(--text-500)/.5); }

.text-transparent { color: transparent; }

.text-warning-orange { --tw-text-opacity: 1; color: rgb(255 184 0/var(--tw-text-opacity)); }

.text-white { --tw-text-opacity: 1; color: rgb(255 255 255/var(--tw-text-opacity)); }

.underline { text-decoration-line: underline; }

.line-through { text-decoration-line: line-through; }

.underline-offset-2 { text-underline-offset: 2px; }

.antialiased { -webkit-font-smoothing: antialiased; }

.placeholder-text-400::placeholder { --tw-placeholder-opacity: 1; color: hsl(var(--text-400)/var(--tw-placeholder-opacity)); }

.placeholder-text-500::placeholder { --tw-placeholder-opacity: 1; color: hsl(var(--text-500)/var(--tw-placeholder-opacity)); }

.placeholder-text-500\/80::placeholder { color: hsl(var(--text-500)/.8); }

.\!opacity-0 { opacity: 0 !important; }

.\!opacity-100 { opacity: 1 !important; }

.opacity-0 { opacity: 0; }

.opacity-10 { opacity: 0.1; }

.opacity-100 { opacity: 1; }

.opacity-15 { opacity: 0.15; }

.opacity-20 { opacity: 0.2; }

.opacity-25 { opacity: 0.25; }

.opacity-30 { opacity: 0.3; }

.opacity-40 { opacity: 0.4; }

.opacity-50 { opacity: 0.5; }

.opacity-60 { opacity: 0.6; }

.opacity-65 { opacity: 0.65; }

.opacity-70 { opacity: 0.7; }

.opacity-75 { opacity: 0.75; }

.opacity-80 { opacity: 0.8; }

.opacity-90 { opacity: 0.9; }

.opacity-\[0\%\] { opacity: 0; }

.opacity-\[0\.02\] { opacity: 0.02; }

.mix-blend-normal { mix-blend-mode: normal; }

.mix-blend-luminosity { mix-blend-mode: luminosity; }

.\!shadow-\[0_2px_8px_0_hsl\(var\(--accent-secondary-200\)\/16\%\)\] { --tw-shadow: 0 2px 8px 0 hsl(var(--accent-secondary-200)/16%) !important; --tw-shadow-colored: 0 2px 8px 0 var(--tw-shadow-color) !important; box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow) !important; }

.\!shadow-\[0_4px_24px_0_hsl\(var\(--accent-secondary-200\)\/22\%\)\] { --tw-shadow: 0 4px 24px 0 hsl(var(--accent-secondary-200)/22%) !important; --tw-shadow-colored: 0 4px 24px 0 var(--tw-shadow-color) !important; }

.\!shadow-\[0_4px_24px_0_hsl\(var\(--accent-secondary-200\)\/22\%\)\], .\!shadow-none { box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow) !important; }

.\!shadow-none { --tw-shadow: 0 0 #0000 !important; --tw-shadow-colored: 0 0 #0000 !important; }

.\!shadow-sm { --tw-shadow: 0 1px 2px 0 rgb(0 0 0/0.05) !important; --tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color) !important; box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow) !important; }

.shadow { --tw-shadow: 0 1px 3px 0 rgb(0 0 0/0.1),0 1px 2px -1px rgb(0 0 0/0.1); --tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color); }

.shadow, .shadow-2xl { box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-2xl { --tw-shadow: 0 25px 50px -12px rgb(0 0 0/0.25); --tw-shadow-colored: 0 25px 50px -12px var(--tw-shadow-color); }

.shadow-\[0_0\.25rem_1\.25rem_hsl\(var\(--always-black\)\/3\.5\%\)\,0_0_0_0\.5px_hsla\(var\(--border-300\)\/0\.15\)\] { --tw-shadow: 0 0.25rem 1.25rem hsl(var(--always-black)/3.5%),0 0 0 0.5px hsla(var(--border-300)/0.15); --tw-shadow-colored: 0 0.25rem 1.25rem var(--tw-shadow-color),0 0 0 0.5px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_0\.25rem_1\.25rem_hsl\(var\(--always-black\)\/3\.5\%\)\] { --tw-shadow: 0 0.25rem 1.25rem hsl(var(--always-black)/3.5%); --tw-shadow-colored: 0 0.25rem 1.25rem var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_0\.8px_1\.6px_0_hsl\(var\(--always-black\)\/5\%\)\] { --tw-shadow: 0 0.8px 1.6px 0 hsl(var(--always-black)/5%); --tw-shadow-colored: 0 0.8px 1.6px 0 var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_0_0_100px_hsl\(var\(--text-000\)\)\] { --tw-shadow: 0 0 0 100px hsl(var(--text-000)); --tw-shadow-colored: 0 0 0 100px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_0_0_1px_hsl\(var\(--accent-secondary-100\)\)\] { --tw-shadow: 0 0 0 1px hsl(var(--accent-secondary-100)); --tw-shadow-colored: 0 0 0 1px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_0_15px_hsl\(var\(--always-black\)\/8\%\)\] { --tw-shadow: 0 0 15px hsl(var(--always-black)/8%); --tw-shadow-colored: 0 0 15px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_2px_12px_hsl\(var\(--always-black\)\/5\%\)\] { --tw-shadow: 0 2px 12px hsl(var(--always-black)/5%); --tw-shadow-colored: 0 2px 12px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_2px_8px_0_hsl\(var\(--always-black\)\/4\%\)\] { --tw-shadow: 0 2px 8px 0 hsl(var(--always-black)/4%); --tw-shadow-colored: 0 2px 8px 0 var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_40px_80px_hsl\(var\(--always-black\)\/10\%\)\] { --tw-shadow: 0 40px 80px hsl(var(--always-black)/10%); --tw-shadow-colored: 0 40px 80px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_4px_10px_hsl\(var\(--always-black\)\/4\%\)\] { --tw-shadow: 0 4px 10px hsl(var(--always-black)/4%); --tw-shadow-colored: 0 4px 10px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_4px_20px_0_hsl\(var\(--always-black\)\/4\%\)\] { --tw-shadow: 0 4px 20px 0 hsl(var(--always-black)/4%); --tw-shadow-colored: 0 4px 20px 0 var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_4px_20px_0_rgba\(0\,0\,0\,0\.04\)\] { --tw-shadow: 0 4px 20px 0 rgba(0,0,0,0.04); --tw-shadow-colored: 0 4px 20px 0 var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_4px_24px_0_hsl\(var\(--always-black\)\/1\.57\%\)\,0_4px_32px_0_hsl\(var\(--always-black\)\/1\.57\%\)\,0_2px_64px_0_hsl\(var\(--always-black\)\/1\.18\%\)\,0_16px_32px_0_hsl\(var\(--always-black\)\/1\.18\%\)\] { --tw-shadow: 0 4px 24px 0 hsl(var(--always-black)/1.57%),0 4px 32px 0 hsl(var(--always-black)/1.57%),0 2px 64px 0 hsl(var(--always-black)/1.18%),0 16px 32px 0 hsl(var(--always-black)/1.18%); --tw-shadow-colored: 0 4px 24px 0 var(--tw-shadow-color),0 4px 32px 0 var(--tw-shadow-color),0 2px 64px 0 var(--tw-shadow-color),0 16px 32px 0 var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_4px_32px_hsl\(var\(--always-black\)\/30\%\)\,_0_0_0_0\.5px_hsl\(var\(--always-black\)\/25\%\)\] { --tw-shadow: 0 4px 32px hsl(var(--always-black)/30%),0 0 0 0.5px hsl(var(--always-black)/25%); --tw-shadow-colored: 0 4px 32px var(--tw-shadow-color),0 0 0 0.5px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0_6px_22px_0_hsl\(var\(--always-black\)\/5\%\)\] { --tw-shadow: 0 6px 22px 0 hsl(var(--always-black)/5%); --tw-shadow-colored: 0 6px 22px 0 var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0px_0px_32px_0px_hsl\(var\(--accent-main-900\)\/12\%\)\] { --tw-shadow: 0px 0px 32px 0px hsl(var(--accent-main-900)/12%); --tw-shadow-colored: 0px 0px 32px 0px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0px_1px_0px_0px_theme\(colors\.border-300\)\] { --tw-shadow: 0px 1px 0px 0px hsl(var(--border-300)/0.15); --tw-shadow-colored: 0px 1px 0px 0px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0px_1px_2px_0px_hsl\(var\(--always-black\)\/5\.1\%\)\] { --tw-shadow: 0px 1px 2px 0px hsl(var(--always-black)/5.1%); --tw-shadow-colored: 0px 1px 2px 0px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0px_4px_20px_0px_hsl\(var\(--always-black\)\/20\%\)\] { --tw-shadow: 0px 4px 20px 0px hsl(var(--always-black)/20%); --tw-shadow-colored: 0px 4px 20px 0px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[0px_8px_28px_0px_hsl\(var\(--always-black\)\/25\%\)\] { --tw-shadow: 0px 8px 28px 0px hsl(var(--always-black)/25%); --tw-shadow-colored: 0px 8px 28px 0px var(--tw-shadow-color); }

.shadow-\[0px_8px_28px_0px_hsl\(var\(--always-black\)\/25\%\)\], .shadow-diffused { box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-diffused { --tw-shadow: 0 4px 24px var(--tw-shadow-color); --tw-shadow-colored: 0 4px 24px var(--tw-shadow-color); }

.shadow-element { --tw-shadow: 0 0 0 0.5px rgba(0,0,0,0.1),0 0 20px rgba(0,0,0,0.05),0 1px 5px rgba(0,0,0,0.1); --tw-shadow-colored: 0 0 0 0.5px var(--tw-shadow-color),0 0 20px var(--tw-shadow-color),0 1px 5px var(--tw-shadow-color); }

.shadow-element, .shadow-inset-border-0\.5 { box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-inset-border-0\.5 { --tw-shadow: inset 0 0 0 0.5px var(--tw-shadow-color); --tw-shadow-colored: inset 0 0 0 0.5px var(--tw-shadow-color); }

.shadow-lg { --tw-shadow: 0 10px 15px -3px rgb(0 0 0/0.1),0 4px 6px -4px rgb(0 0 0/0.1); --tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color); }

.shadow-lg, .shadow-md { box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-md { --tw-shadow: 0 4px 6px -1px rgb(0 0 0/0.1),0 2px 4px -2px rgb(0 0 0/0.1); --tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color); }

.shadow-none { --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; }

.shadow-none, .shadow-sm { box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-sm { --tw-shadow: 0 1px 2px 0 rgb(0 0 0/0.05); --tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color); }

.shadow-xl { --tw-shadow: 0 20px 25px -5px rgb(0 0 0/0.1),0 8px 10px -6px rgb(0 0 0/0.1); --tw-shadow-colored: 0 20px 25px -5px var(--tw-shadow-color),0 8px 10px -6px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.shadow-\[hsl\(var\(--accent-secondary-000\)\/10\%\)\] { --tw-shadow-color: hsl(var(--accent-secondary-000)/10%); --tw-shadow: var(--tw-shadow-colored); }

.shadow-\[hsl\(var\(--always-black\)\/1\.96\%\)\] { --tw-shadow-color: hsl(var(--always-black)/1.96%); --tw-shadow: var(--tw-shadow-colored); }

.shadow-\[hsl\(var\(--always-black\)\/4\%\)\] { --tw-shadow-color: hsl(var(--always-black)/4%); --tw-shadow: var(--tw-shadow-colored); }

.shadow-\[hsl\(var\(--always-black\)\/6\%\)\] { --tw-shadow-color: hsl(var(--always-black)/6%); --tw-shadow: var(--tw-shadow-colored); }

.shadow-always-black\/5 { --tw-shadow-color: hsl(var(--always-black)/0.05); --tw-shadow: var(--tw-shadow-colored); }

.shadow-border-100 { --tw-shadow-color: hsl(var(--border-100)/0.40); --tw-shadow: var(--tw-shadow-colored); }

.\!outline-none { outline: transparent solid 2px !important; outline-offset: 2px !important; }

.outline-none { outline: transparent solid 2px; outline-offset: 2px; }

.outline { outline-style: solid; }

.outline-1 { outline-width: 1px; }

.outline-\[0\.50px\] { outline-width: 0.5px; }

.\!outline-offset-1 { outline-offset: 1px !important; }

.outline-offset-\[-0\.50px\] { outline-offset: -0.5px; }

.outline-accent-secondary-200\/30 { outline-color: hsl(var(--accent-secondary-200)/.3); }

.outline-bg-400\/80 { outline-color: hsl(var(--bg-400)/.8); }

.outline-border-300\/25 { outline-color: hsl(var(--border-300)/.25); }

.outline-danger-000\/25 { outline-color: hsl(var(--danger-000)/.25); }

.ring { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color); }

.ring, .ring-1 { box-shadow: var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000); }

.ring-1 { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color); }

.\!ring-border-200 { --tw-ring-color: hsl(var(--border-200)/0.30) !important; }

.ring-accent-main-100 { --tw-ring-opacity: 1; --tw-ring-color: hsl(var(--accent-main-100)/var(--tw-ring-opacity)); }

.ring-accent-secondary-100\/70 { --tw-ring-color: hsl(var(--accent-secondary-100)/0.7); }

.ring-border-300\/50 { --tw-ring-color: hsl(var(--border-300)/0.5); }

.\!ring-offset-0 { --tw-ring-offset-width: 0px !important; }

.ring-offset-2 { --tw-ring-offset-width: 2px; }

.ring-offset-bg-300 { --tw-ring-offset-color: hsl(var(--bg-300)/1); }

.blur { --tw-blur: blur(8px); }

.blur, .blur-\[2px\] { filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow); }

.blur-\[2px\] { --tw-blur: blur(2px); }

.blur-md { --tw-blur: blur(12px); }

.blur-md, .blur-sm { filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow); }

.blur-sm { --tw-blur: blur(4px); }

.drop-shadow { --tw-drop-shadow: drop-shadow(0 1px 2px rgb(0 0 0/0.1)) drop-shadow(0 1px 1px rgb(0 0 0/0.06)); }

.drop-shadow, .drop-shadow-\[0_2px_8px_hsl\(var\(--always-black\)\/5\%\)\] { filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow); }

.drop-shadow-\[0_2px_8px_hsl\(var\(--always-black\)\/5\%\)\] { --tw-drop-shadow: drop-shadow(0 2px 8px hsl(var(--always-black)/5%)); }

.drop-shadow-lg { --tw-drop-shadow: drop-shadow(0 10px 8px rgb(0 0 0/0.04)) drop-shadow(0 4px 3px rgb(0 0 0/0.1)); }

.drop-shadow-lg, .drop-shadow-sm { filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow); }

.drop-shadow-sm { --tw-drop-shadow: drop-shadow(0 1px 1px rgb(0 0 0/0.05)); }

.grayscale { --tw-grayscale: grayscale(100%); }

.grayscale, .invert { filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow); }

.invert { --tw-invert: invert(100%); }

.\!filter { filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow) !important; }

.filter { filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow); }

.backdrop-blur { --tw-backdrop-blur: blur(8px); }

.backdrop-blur, .backdrop-blur-\[1px\] { backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia); }

.backdrop-blur-\[1px\] { --tw-backdrop-blur: blur(1px); }

.backdrop-blur-\[2px\] { --tw-backdrop-blur: blur(2px); }

.backdrop-blur-\[2px\], .backdrop-blur-\[6px\] { backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia); }

.backdrop-blur-\[6px\] { --tw-backdrop-blur: blur(6px); }

.backdrop-blur-lg { --tw-backdrop-blur: blur(16px); }

.backdrop-blur-lg, .backdrop-blur-md { backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia); }

.backdrop-blur-md { --tw-backdrop-blur: blur(12px); }

.backdrop-blur-sm { --tw-backdrop-blur: blur(4px); }

.backdrop-blur-sm, .backdrop-blur-xl { backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia); }

.backdrop-blur-xl { --tw-backdrop-blur: blur(24px); }

.backdrop-brightness-75 { --tw-backdrop-brightness: brightness(.75); backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia); }

.\!transition-all { transition-property: all !important; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1) !important; transition-duration: 0.15s !important; }

.\!transition-none { transition-property: none !important; }

.transition { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-backdrop-filter; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-\[border\] { transition-property: border; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-\[clip-path\] { transition-property: clip-path, -webkit-clip-path; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-\[height\] { transition-property: height; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-\[margin\] { transition-property: margin; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-\[max-height\,opacity\,margin\] { transition-property: max-height, opacity, margin; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-\[min-width\] { transition-property: min-width; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-\[opacity\] { transition-property: opacity; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-\[width\] { transition-property: width; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-colors { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-none { transition-property: none; }

.transition-opacity { transition-property: opacity; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-shadow { transition-property: box-shadow; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.transition-transform { transition-property: transform; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.delay-150 { transition-delay: 0.15s; }

.delay-300 { transition-delay: 0.3s; }

.delay-75 { transition-delay: 75ms; }

.duration-0 { transition-duration: 0s; }

.duration-100 { transition-duration: 0.1s; }

.duration-1000 { transition-duration: 1s; }

.duration-150 { transition-duration: 0.15s; }

.duration-200 { transition-duration: 0.2s; }

.duration-300 { transition-duration: 0.3s; }

.duration-500 { transition-duration: 0.5s; }

.duration-700 { transition-duration: 0.7s; }

.duration-75 { transition-duration: 75ms; }

.duration-\[250ms\] { transition-duration: 0.25s; }

.duration-\[500ms\] { transition-duration: 0.5s; }

.\!ease-out { transition-timing-function: cubic-bezier(0, 0, 0.2, 1) !important; }

.ease-\[cubic-bezier\(0\.165\,0\.85\,0\.45\,1\)\] { transition-timing-function: cubic-bezier(0.165, 0.85, 0.45, 1); }

.ease-\[cubic-bezier\(0\.17\,0\.67\,0\.3\,1\.2\)\] { transition-timing-function: cubic-bezier(0.17, 0.67, 0.3, 1.2); }

.ease-in { transition-timing-function: cubic-bezier(0.4, 0, 1, 1); }

.ease-in-out { transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); }

.ease-out { transition-timing-function: cubic-bezier(0, 0, 0.2, 1); }

.ease-snappy-out { transition-timing-function: cubic-bezier(0.19, 1, 0.22, 1); }

.will-change-contents { will-change: contents; }

.will-change-transform { will-change: transform; }

.font-mono { font-family: var(--font-mono); }

.font-ui { font-family: var(--font-ui); }

.font-ui-serif { font-family: var(--font-ui-serif); }

.\!font-user-message { font-family: var(--font-user-message) !important; }

.font-user-message { font-family: var(--font-user-message); }

.font-claude-response { font-family: var(--font-claude-response); }

.\!font-base { font-family: var(--font-ui) !important; font-size: 0.875rem !important; font-weight: 430 !important; line-height: 1.4 !important; }

.font-base { font-weight: 430; }

.font-base, .font-base-bold { font-family: var(--font-ui); font-size: 0.875rem; line-height: 1.4; }

.font-base-bold { font-weight: 500; }

.font-display { font-family: var(--font-ui-serif); font-size: 2.375rem; font-weight: 330; line-height: 1.2; font-variation-settings: "opsz" 48; }

.font-heading { font-family: var(--font-ui-serif); font-size: 1.5rem; font-weight: 500; line-height: 1.3; font-variation-settings: "opsz" 24; }

.font-large { font-weight: 430; }

.font-large, .font-large-bold { font-family: var(--font-ui); font-size: 1rem; line-height: 1.4; }

.font-large-bold { font-weight: 600; }

.font-small { font-weight: 430; }

.font-small, .font-small-bold { font-family: var(--font-ui); font-size: 0.75rem; line-height: 1.4; }

.font-small-bold { font-weight: 600; }

.font-title { font-family: var(--font-ui-serif); font-size: 1.75rem; font-weight: 500; line-height: 1.3; font-variation-settings: "opsz" 28; }

.font-xl { font-weight: 400; font-variation-settings: "opsz" 20; }

.font-xl, .font-xl-bold { font-family: var(--font-ui); font-size: 1.25rem; line-height: 1.4; }

.font-xl-bold { font-weight: 600; font-variation-settings: "opsz" 20; }

.font-claude-response-body { font-weight: 400; }

.font-claude-response-body, .font-claude-response-body-bold { font-family: var(--font-claude-response); font-size: 1rem; line-height: 1.5; }

.font-claude-response-body-bold { font-weight: 600; }

.font-claude-response-code { font-size: 0.813rem; }

.font-claude-response-code, .font-claude-response-code-small { font-family: var(--font-mono); font-weight: 400; line-height: 1.5; }

.font-claude-response-code-small { font-size: 0.688rem; }

.font-claude-response-heading { font-family: var(--font-claude-response); font-size: 1.25rem; font-weight: 600; line-height: 1.4; font-variation-settings: "opsz" 20; }

.font-claude-response-small { font-weight: 400; }

.font-claude-response-small, .font-claude-response-small-bold { font-family: var(--font-claude-response); font-size: 0.875rem; line-height: 1.5; }

.font-claude-response-small-bold { font-weight: 600; }

.font-claude-response-subheading { font-family: var(--font-claude-response); font-size: 1rem; font-weight: 600; line-height: 1.35; }

.font-claude-response-title { font-family: var(--font-claude-response); font-size: 1.75rem; font-weight: 600; line-height: 1.3; font-variation-settings: "opsz" 28; }

.\[-webkit-overflow-scrolling\:touch\] { }

.\[animation-direction\:reverse\] { animation-direction: reverse; }

.\[animation-name\:shimmertext\] { animation-name: shimmertext; }

.\[direction\:rtl\] { direction: rtl; }

.\[font-feature-settings\:\'liga\'_1\] { font-feature-settings: "liga"; }

.\[grid-area\:1\/1\] { grid-area: 1 / 1; }

.\[letter-spacing\:-0\.03em\] { letter-spacing: -0.03em; }

.\[mask-image\:linear-gradient\(to_bottom\,_hsl\(var\(--always-black\)\/100\%\)_0\%\,_hsl\(var\(--always-black\)\/0\%\)_100\%\)\] { mask-image: linear-gradient(to bottom,hsl(var(--always-black)/100%) 0,hsl(var(--always-black)/0%) 100%); }

.\[mask-image\:linear-gradient\(to_bottom\,hsl\(var\(--always-black\)\/80\%\)_0\%\,_hsl\(var\(--always-black\)\/10\%\)_100\%\)\] { mask-image: linear-gradient(to bottom,hsl(var(--always-black)/80%) 0,hsl(var(--always-black)/10%) 100%); }

.\[mask-image\:linear-gradient\(to_right\,hsl\(var\(--always-black\)\)_78\%\,transparent_95\%\)\] { mask-image: linear-gradient(to right,hsl(var(--always-black)) 78%,transparent 95%); }

.\[mask-image\:linear-gradient\(to_top\,_hsl\(var\(--always-black\)\/0\%\)_0\%\,hsl\(var\(--always-black\)\/100\%\)_75\%\,_hsl\(var\(--always-black\)\/0\%\)_100\%\)\] { mask-image: linear-gradient(to top,hsl(var(--always-black)/0%) 0,hsl(var(--always-black)/100%) 75%,hsl(var(--always-black)/0%) 100%); }

.\[mask-image\:linear-gradient\(to_top\,hsl\(var\(--always-black\)\/0\%\)_0\%\,_hsl\(var\(--always-black\)\/100\%\)_3\%\)\] { mask-image: linear-gradient(to top,hsl(var(--always-black)/0%) 0,hsl(var(--always-black)/100%) 3%); }

.\[mask-size\:100\%_100\%\] { mask-size: 100% 100%; }

.\[options\:IParseOptions\] { }

.\[outline\:none\!important\] { outline: none !important; }

.\[overflow-wrap\:anywhere\] { overflow-wrap: anywhere; }

.\[root\:Root\] { }

.\[scrollbar-color\:hsl\(var\(--text-500\)\)\] { scrollbar-color: hsl(var(--text-500)); }

.\!\[text-shadow\:_none\] { text-shadow: none !important; }

.\[text-wrap\:pretty\] { text-wrap: pretty; }

*, ::after, ::before { border-color: hsl(var(--border-100)); }

.can-focus, a, button, input, textarea { outline: 2px solid hsla(var(--accent-secondary-000)/0%); outline-offset: 2px; }

.can-focus-within:focus-within, .can-focus:focus-visible, .peer:focus-visible ~ .peer\:can-focus, a:not([role="menuitem"]):not(.hide-focus-ring):focus-visible, button:not([role="menuitem"]):not(.hide-focus-ring):focus-visible, input:not(.hide-focus-ring):focus-visible, textarea:not(.hide-focus-ring):focus-visible { outline: 2px solid hsl(var(--accent-secondary-000)/70%); transition: outline 0.2s !important; }

.PhoneInput .PhoneInputInput { outline: none !important; }

[data-mode="dark"] .PhoneInputCountrySelect { background-color: hsl(var(--bg-200)); color: hsl(var(--text-000)); }

.h-screen { height: 100dvh; }

.min-h-screen { min-height: 100dvh; }

[data-headlessui-portal] + [data-headlessui-portal]:last-child .dialog-panel--enter { border-top: 0.5px solid rgba(0, 0, 0, 0.25); transition-timing-function: cubic-bezier(0.75, 0, 0, 1.15); transition-duration: 0.5s; }

[data-headlessui-portal]:not(:last-child) .dialog-panel--enter { filter: brightness(0.75); transform: scale(0.975) translateY(-16px); overflow: hidden; }

[data-headlessui-portal]:not(:last-child) .dialog-panel--enter .dialog-panel__inner { opacity: 0.25; filter: blur(2px); }

img, svg { flex-shrink: 0; }

body, html { padding: 0px; margin: 0px; }

a { color: inherit; text-decoration: none; }

.mdx-link { text-decoration-thickness: 1px; }

.mdx-link:hover { text-decoration-thickness: 1.5px; }

* { box-sizing: border-box; outline-color: hsl(var(--accent-secondary-100)); scrollbar-width: thin; scrollbar-color: hsla(var(--border-300)/35%) transparent; }

.ProseMirror { font-feature-settings: inherit !important; font-variant-ligatures: inherit !important; }

.ProseMirror:focus { outline: none; }

.ProseMirror p.is-editor-empty:first-child::before { color: rgb(173, 181, 189); content: attr(data-placeholder); float: left; height: 0px; pointer-events: none; }

.swagger-ui { width: 100%; }

div.ProseMirror h1 { font-size: 1.6rem; }

div.ProseMirror h1, div.ProseMirror h2 { margin: 0.1rem 0px 0.3rem; font-weight: 600; }

div.ProseMirror h3 { margin: 0.1rem 0px 0.3rem; font-size: 1rem; font-weight: 500; }

div.ProseMirror ul { list-style-type: unset; padding-left: 2rem; }

div.ProseMirror ol { list-style-type: decimal; padding-left: 2rem; }

div.ProseMirror a { cursor: pointer; font-weight: 500; color: rgb(80, 74, 147); }

div.ProseMirror a:hover { color: rgb(153, 149, 203); }

div.ProseMirror table { margin: 1.2rem 0px; }

div.ProseMirror th { border: 1px solid rgb(213, 211, 209); padding: 0.5rem; color: rgb(67, 64, 60); font-size: 0.875rem; }

div.ProseMirror td { border: 1px solid rgb(213, 211, 209); padding: 0.4rem; color: rgb(119, 113, 109); }

div.ProseMirror > p > code { border: .5px solid rgb(from hsl(var(--border-300)) r g b/.25); background-color: rgb(from hsl(var(--text-200)) r g b/.05); font-size: 0.9rem; color: hsl(var(--danger-000)); padding: 1px 4px; border-radius: 0.3rem; white-space: pre-wrap; }

.anthropic-animated-logo * { fill: currentcolor !important; }

.fade-out-bottom { mask-image: linear-gradient(rgb(0, 0, 0) 65%, rgba(0, 0, 0, 0)); mask-size: 100% 100%; mask-repeat: no-repeat; }

.ReactMarkdown h1 { font-size: 1.6rem; }

.ReactMarkdown h1, .ReactMarkdown h2 { margin: 0.1rem 0px 0.3rem; font-weight: 600; }

.ReactMarkdown h3 { margin: 0.1rem 0px 0.3rem; font-size: 1rem; font-weight: 500; }

.ReactMarkdown a { cursor: pointer; font-weight: 500; color: rgb(80, 74, 147); }

.ReactMarkdown a:hover { color: rgb(153, 149, 203); }

.ReactMarkdown table { display: block; overflow-x: scroll; }

.ReactMarkdown td, .ReactMarkdown th { border: 1px solid rgb(213, 211, 209); padding: 0.5rem; }

.ReactMarkdown code { border: .5px solid rgb(from hsl(var(--border-300)) r g b/.25); background-color: rgb(from hsl(var(--text-200)) r g b/.05); font-size: 0.9rem; color: hsl(var(--danger-000)); padding: 1px 4px; border-radius: 0.3rem; white-space: pre-wrap; }

.grecaptcha-badge { visibility: hidden; }

:root { --dropdown-max-height: 480px; }

.shadow-level-1 { box-shadow: rgba(0, 0, 0, 0.1) -80px 200px 120px 0px, rgba(0, 0, 0, 0.15) -8px 20px 48px 0px; }

.animated-loading-background { background-image: linear-gradient(45deg,hsl(var(--bg-000)),hsl(var(--bg-200))); background-size: 250% 250%; animation: 2s linear 0s infinite normal none running loading-background; }

@keyframes loading-background { 
  0%, 100% { background-position: 0px 0px; }
  25% { background-position: 100% 0px; }
  50% { background-position: 100% 100%; }
  75% { background-position: 0px 100%; }
}

.code-block__code span::selection, .code-block__code::selection { background-color: hsl(var(--accent-secondary-100)); color: hsl(var(--oncolor-100)) !important; }

.code-block__code .table { display: inline; }

.code-block__code .linenumber::after { content: attr(data-line-number); user-select: none !important; pointer-events: none !important; }

.u-hidden-scrollbar { scrollbar-width: none; }

.u-hidden-scrollbar::-webkit-scrollbar { width: 0px; opacity: 0; }

[data-mode="dark"] input[type="date"] { color-scheme: dark; }

.draggable { app-region: drag; user-select: none; }

.draggable a, .draggable button, .draggable input, .draggable select, .draggable textarea, .draggable-none { app-region: no-drag; }

.\*\:absolute > * { position: absolute; }

.\*\:w-full > * { width: 100%; }

.\*\:rounded-lg > * { border-radius: 0.5rem; }

.\*\:border > * { border-width: 1px; }

.\*\:border-border-300 > * { border-color: hsl(var(--border-300)/.15); }

.\*\:bg-always-white > * { --tw-bg-opacity: 1; background-color: hsl(var(--always-white)/var(--tw-bg-opacity)); }

.\*\:transition > * { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-backdrop-filter; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.\*\:transition-all > * { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.\*\:duration-300 > * { transition-duration: 0.3s; }

.\*\:ease-in-out > * { transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); }

.placeholder\:text-sm::placeholder { font-size: 0.875rem; line-height: 1.25rem; }

.placeholder\:text-text-400::placeholder { --tw-text-opacity: 1; color: hsl(var(--text-400)/var(--tw-text-opacity)); }

.placeholder\:text-text-500::placeholder { --tw-text-opacity: 1; color: hsl(var(--text-500)/var(--tw-text-opacity)); }

.placeholder\:text-text-500\/70::placeholder { color: hsl(var(--text-500)/.7); }

.placeholder\:opacity-75::placeholder { opacity: 0.75; }

.placeholder\:font-base::placeholder { font-family: var(--font-ui); font-size: 0.875rem; font-weight: 430; line-height: 1.4; }

.before\:whitespace-nowrap::before { content: var(--tw-content); white-space: nowrap; }

.before\:\!text-text-500::before { content: var(--tw-content); --tw-text-opacity: 1 !important; color: hsl(var(--text-500)/var(--tw-text-opacity)) !important; }

.before\:content-\[open-quote\]::before { --tw-content: open-quote; content: var(--tw-content); }

.after\:absolute::after { content: var(--tw-content); position: absolute; }

.after\:inset-0::after { content: var(--tw-content); inset: 0px; }

.after\:bottom-0::after { content: var(--tw-content); bottom: 0px; }

.after\:left-0::after { content: var(--tw-content); left: 0px; }

.after\:right-0::after { content: var(--tw-content); right: 0px; }

.after\:translate-x-\[-100\%\]::after { --tw-translate-x: -100%; }

.after\:translate-x-\[-100\%\]::after, .after\:translate-y-2::after { content: var(--tw-content); transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.after\:translate-y-2::after { --tw-translate-y: 0.5rem; }

@keyframes shimmer { 
  0% { content: var(--tw-content); transform: translateX(-100%); }
  60% { content: var(--tw-content); transform: translateX(100%); }
  100% { content: var(--tw-content); transform: translateX(100%); }
}

.after\:animate-\[shimmer_1\.5s_infinite\]::after { content: var(--tw-content); animation: 1.5s ease 0s infinite normal none running shimmer; }

.after\:border-b-0::after { content: var(--tw-content); border-bottom-width: 0px; }

.after\:border-b-0\.5::after { content: var(--tw-content); border-bottom-width: 0.5px; }

.after\:border-border-300::after { content: var(--tw-content); border-color: hsl(var(--border-300)/.15); }

.after\:bg-\[radial-gradient\(at_bottom\,hsla\(var\(--bg-000\)\/20\%\)\,hsla\(var\(--bg-000\)\/0\%\)\)\]::after { content: var(--tw-content); background-image: radial-gradient(at bottom,hsla(var(--bg-000)/20%),hsla(var(--bg-000)/0%)); }

.after\:bg-gradient-to-r::after { content: var(--tw-content); background-image: linear-gradient(to right,var(--tw-gradient-stops)); }

.after\:from-always-white\/0::after { content: var(--tw-content); --tw-gradient-from: hsl(var(--always-white)/0) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--always-white)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.after\:from-bg-000\/0::after { content: var(--tw-content); --tw-gradient-from: hsl(var(--bg-000)/0) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-000)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.after\:from-0\%::after { content: var(--tw-content); --tw-gradient-from-position: 0%; }

.after\:\!via-always-white\/50::after { content: var(--tw-content); --tw-gradient-to: hsl(var(--always-white)/0) var(--tw-gradient-to-position) !important; --tw-gradient-stops: var(--tw-gradient-from),hsl(var(--always-white)/0.5) var(--tw-gradient-via-position),var(--tw-gradient-to) !important; }

.after\:via-always-white\/20::after { content: var(--tw-content); --tw-gradient-to: hsl(var(--always-white)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),hsl(var(--always-white)/0.2) var(--tw-gradient-via-position),var(--tw-gradient-to); }

.after\:via-bg-000\/20::after { content: var(--tw-content); --tw-gradient-to: hsl(var(--bg-000)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),hsl(var(--bg-000)/0.2) var(--tw-gradient-via-position),var(--tw-gradient-to); }

.after\:via-50\%::after { content: var(--tw-content); --tw-gradient-via-position: 50%; }

.after\:to-always-white\/0::after { content: var(--tw-content); --tw-gradient-to: hsl(var(--always-white)/0) var(--tw-gradient-to-position); }

.after\:to-bg-000\/0::after { content: var(--tw-content); --tw-gradient-to: hsl(var(--bg-000)/0) var(--tw-gradient-to-position); }

.after\:to-100\%::after { content: var(--tw-content); --tw-gradient-to-position: 100%; }

.after\:opacity-0::after { content: var(--tw-content); opacity: 0; }

.after\:transition::after { content: var(--tw-content); transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter, -webkit-backdrop-filter; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.after\:duration-200::after { content: var(--tw-content); transition-duration: 0.2s; }

.last\:border-0:last-child { border-width: 0px; }

.last\:border-b-0:last-child { border-bottom-width: 0px; }

.read-only\:text-text-200:read-only { --tw-text-opacity: 1; color: hsl(var(--text-200)/var(--tw-text-opacity)); }

.read-only\:\!opacity-100:read-only { opacity: 1 !important; }

.read-only\:opacity-50:read-only { opacity: 0.5; }

.focus-within\:-translate-y-px:focus-within { --tw-translate-y: -1px; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.focus-within\:\!border-accent-main-200\/50:focus-within { border-color: hsl(var(--accent-main-200)/.5) !important; }

.focus-within\:border-accent-main-100:focus-within { --tw-border-opacity: 1; border-color: hsl(var(--accent-main-100)/var(--tw-border-opacity)); }

.focus-within\:border-accent-secondary-100:focus-within { --tw-border-opacity: 1; border-color: hsl(var(--accent-secondary-100)/var(--tw-border-opacity)); }

.focus-within\:border-border-200:focus-within { border-color: hsl(var(--border-200)/.3); }

.focus-within\:bg-bg-000\/90:focus-within { background-color: hsl(var(--bg-000)/.9); }

.focus-within\:text-text-100:focus-within { --tw-text-opacity: 1; color: hsl(var(--text-100)/var(--tw-text-opacity)); }

.focus-within\:shadow-\[0_0\.25rem_1\.25rem_hsl\(var\(--always-black\)\/7\.5\%\)\,0_0_0_0\.5px_hsla\(var\(--border-200\)\/0\.3\)\]:focus-within { --tw-shadow: 0 0.25rem 1.25rem hsl(var(--always-black)/7.5%),0 0 0 0.5px hsla(var(--border-200)/0.3); --tw-shadow-colored: 0 0.25rem 1.25rem var(--tw-shadow-color),0 0 0 0.5px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.focus-within\:shadow-\[0_0\.25rem_1\.25rem_hsl\(var\(--always-black\)\/7\.5\%\)\]:focus-within { --tw-shadow: 0 0.25rem 1.25rem hsl(var(--always-black)/7.5%); --tw-shadow-colored: 0 0.25rem 1.25rem var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.focus-within\:shadow-\[0_0_0_3px_hsl\(var\(--always-black\)\/5\%\)\]:focus-within { --tw-shadow: 0 0 0 3px hsl(var(--always-black)/5%); --tw-shadow-colored: 0 0 0 3px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.focus-within\:shadow-\[0_6px_24px_hsl\(var\(--accent-main-200\)_\/_0\.15\)\,_0_3px_12px_hsl\(var\(--always-black\)_\/_0\.08\)\]:focus-within { --tw-shadow: 0 6px 24px hsl(var(--accent-main-200)/0.15),0 3px 12px hsl(var(--always-black)/0.08); --tw-shadow-colored: 0 6px 24px var(--tw-shadow-color),0 3px 12px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.focus-within\:shadow-\[inset_0_1px_4px_2px_hsl\(var\(--always-black\)\/12\%\)\]:focus-within { --tw-shadow: inset 0 1px 4px 2px hsl(var(--always-black)/12%); --tw-shadow-colored: inset 0 1px 4px 2px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.focus-within\:outline-2:focus-within { outline-width: 2px; }

.focus-within\:outline-accent-main-200:focus-within { outline-color: hsl(var(--accent-main-200)/1); }

.focus-within\:ring:focus-within { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000); }

.focus-within\:ring-4:focus-within { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(4px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000); }

.hover\:w-1:hover { width: 0.25rem; }

.hover\:-translate-y-px:hover { --tw-translate-y: -1px; }

.hover\:-translate-y-px:hover, .hover\:scale-105:hover { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.hover\:scale-105:hover { --tw-scale-x: 1.05; --tw-scale-y: 1.05; }

.hover\:scale-110:hover { --tw-scale-x: 1.1; --tw-scale-y: 1.1; }

.hover\:scale-110:hover, .hover\:scale-\[1\.01\]:hover { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.hover\:scale-\[1\.01\]:hover { --tw-scale-x: 1.01; --tw-scale-y: 1.01; }

.hover\:scale-x-\[1\.005\]:hover { --tw-scale-x: 1.005; }

.hover\:scale-x-\[1\.005\]:hover, .hover\:scale-y-\[1\.015\]:hover { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.hover\:scale-y-\[1\.015\]:hover { --tw-scale-y: 1.015; }

.hover\:rounded-full:hover { border-radius: 9999px; }

.hover\:\!border-border-100:hover { border-color: hsl(var(--border-100)/.4) !important; }

.hover\:\!border-danger-200\/90:hover { border-color: hsl(var(--danger-200)/.9) !important; }

.hover\:\!border-text-300:hover { --tw-border-opacity: 1 !important; border-color: hsl(var(--text-300)/var(--tw-border-opacity)) !important; }

.hover\:border-accent-pro-200:hover { --tw-border-opacity: 1; border-color: hsl(var(--accent-pro-200)/var(--tw-border-opacity)); }

.hover\:border-accent-secondary-100:hover { --tw-border-opacity: 1; border-color: hsl(var(--accent-secondary-100)/var(--tw-border-opacity)); }

.hover\:border-accent-secondary-100\/50:hover { border-color: hsl(var(--accent-secondary-100)/.5); }

.hover\:border-accent-secondary-100\/80:hover { border-color: hsl(var(--accent-secondary-100)/.8); }

.hover\:border-bg-300:hover { --tw-border-opacity: 1; border-color: hsl(var(--bg-300)/var(--tw-border-opacity)); }

.hover\:border-border-100:hover { border-color: hsl(var(--border-100)/.4); }

.hover\:border-border-200:hover { border-color: hsl(var(--border-200)/.3); }

.hover\:border-border-200\/50:hover { border-color: hsl(var(--border-200)/.5); }

.hover\:border-border-300:hover { border-color: hsl(var(--border-300)/.15); }

.hover\:border-border-300\/0:hover { border-color: hsl(var(--border-300)/0); }

.hover\:border-border-300\/30:hover { border-color: hsl(var(--border-300)/.3); }

.hover\:border-border-400:hover { border-color: hsl(var(--border-400)/.15); }

.hover\:border-danger-200:hover { --tw-border-opacity: 1; border-color: hsl(var(--danger-200)/var(--tw-border-opacity)); }

.hover\:border-text-200:hover { --tw-border-opacity: 1; border-color: hsl(var(--text-200)/var(--tw-border-opacity)); }

.hover\:border-text-300:hover { --tw-border-opacity: 1; border-color: hsl(var(--text-300)/var(--tw-border-opacity)); }

.hover\:border-text-400:hover { --tw-border-opacity: 1; border-color: hsl(var(--text-400)/var(--tw-border-opacity)); }

.hover\:border-text-500:hover { --tw-border-opacity: 1; border-color: hsl(var(--text-500)/var(--tw-border-opacity)); }

.hover\:border-transparent:hover { border-color: transparent; }

.hover\:\!bg-accent-main-000\/\[0\.08\]:hover { background-color: hsl(var(--accent-main-000)/.08) !important; }

.hover\:\!bg-accent-secondary-100:hover { --tw-bg-opacity: 1 !important; background-color: hsl(var(--accent-secondary-100)/var(--tw-bg-opacity)) !important; }

.hover\:\!bg-accent-secondary-100\/10:hover { background-color: hsl(var(--accent-secondary-100)/.1) !important; }

.hover\:\!bg-accent-secondary-100\/15:hover { background-color: hsl(var(--accent-secondary-100)/.15) !important; }

.hover\:\!bg-accent-secondary-200:hover { --tw-bg-opacity: 1 !important; background-color: hsl(var(--accent-secondary-200)/var(--tw-bg-opacity)) !important; }

.hover\:\!bg-accent-secondary-900:hover { --tw-bg-opacity: 1 !important; background-color: hsl(var(--accent-secondary-900)/var(--tw-bg-opacity)) !important; }

.hover\:\!bg-bg-000:hover { --tw-bg-opacity: 1 !important; background-color: hsl(var(--bg-000)/var(--tw-bg-opacity)) !important; }

.hover\:\!bg-bg-000\/10:hover { background-color: hsl(var(--bg-000)/.1) !important; }

.hover\:\!bg-bg-200:hover { --tw-bg-opacity: 1 !important; background-color: hsl(var(--bg-200)/var(--tw-bg-opacity)) !important; }

.hover\:\!bg-bg-400:hover { --tw-bg-opacity: 1 !important; background-color: hsl(var(--bg-400)/var(--tw-bg-opacity)) !important; }

.hover\:\!bg-transparent:hover { background-color: transparent !important; }

.hover\:bg-accent-main-100:hover { --tw-bg-opacity: 1; background-color: hsl(var(--accent-main-100)/var(--tw-bg-opacity)); }

.hover\:bg-accent-main-200:hover { --tw-bg-opacity: 1; background-color: hsl(var(--accent-main-200)/var(--tw-bg-opacity)); }

.hover\:bg-accent-pro-200:hover { --tw-bg-opacity: 1; background-color: hsl(var(--accent-pro-200)/var(--tw-bg-opacity)); }

.hover\:bg-accent-pro-900:hover { --tw-bg-opacity: 1; background-color: hsl(var(--accent-pro-900)/var(--tw-bg-opacity)); }

.hover\:bg-accent-secondary-100:hover { --tw-bg-opacity: 1; background-color: hsl(var(--accent-secondary-100)/var(--tw-bg-opacity)); }

.hover\:bg-accent-secondary-100\/\[12\%\]:hover { background-color: hsl(var(--accent-secondary-100)/12%); }

.hover\:bg-accent-secondary-200:hover { --tw-bg-opacity: 1; background-color: hsl(var(--accent-secondary-200)/var(--tw-bg-opacity)); }

.hover\:bg-accent-secondary-900:hover { --tw-bg-opacity: 1; background-color: hsl(var(--accent-secondary-900)/var(--tw-bg-opacity)); }

.hover\:bg-accent-secondary-900\/10:hover { background-color: hsl(var(--accent-secondary-900)/.1); }

.hover\:bg-accent-secondary-900\/50:hover { background-color: hsl(var(--accent-secondary-900)/.5); }

.hover\:bg-always-black\/5:hover { background-color: hsl(var(--always-black)/.05); }

.hover\:bg-always-white\/10:hover { background-color: hsl(var(--always-white)/.1); }

.hover\:bg-bg-000:hover { --tw-bg-opacity: 1; background-color: hsl(var(--bg-000)/var(--tw-bg-opacity)); }

.hover\:bg-bg-000\/10:hover { background-color: hsl(var(--bg-000)/.1); }

.hover\:bg-bg-000\/20:hover { background-color: hsl(var(--bg-000)/.2); }

.hover\:bg-bg-000\/50:hover { background-color: hsl(var(--bg-000)/.5); }

.hover\:bg-bg-000\/80:hover { background-color: hsl(var(--bg-000)/.8); }

.hover\:bg-bg-100:hover { --tw-bg-opacity: 1; background-color: hsl(var(--bg-100)/var(--tw-bg-opacity)); }

.hover\:bg-bg-100\/90:hover { background-color: hsl(var(--bg-100)/.9); }

.hover\:bg-bg-100\/95:hover { background-color: hsl(var(--bg-100)/.95); }

.hover\:bg-bg-200:hover { --tw-bg-opacity: 1; background-color: hsl(var(--bg-200)/var(--tw-bg-opacity)); }

.hover\:bg-bg-200\/50:hover { background-color: hsl(var(--bg-200)/.5); }

.hover\:bg-bg-300:hover { --tw-bg-opacity: 1; background-color: hsl(var(--bg-300)/var(--tw-bg-opacity)); }

.hover\:bg-bg-300\/50:hover { background-color: hsl(var(--bg-300)/.5); }

.hover\:bg-bg-300\/60:hover { background-color: hsl(var(--bg-300)/.6); }

.hover\:bg-bg-300\/90:hover { background-color: hsl(var(--bg-300)/.9); }

.hover\:bg-bg-400:hover { --tw-bg-opacity: 1; background-color: hsl(var(--bg-400)/var(--tw-bg-opacity)); }

.hover\:bg-bg-400\/40:hover { background-color: hsl(var(--bg-400)/.4); }

.hover\:bg-bg-500:hover { --tw-bg-opacity: 1; background-color: hsl(var(--bg-500)/var(--tw-bg-opacity)); }

.hover\:bg-bg-500\/30:hover { background-color: hsl(var(--bg-500)/.3); }

.hover\:bg-bg-500\/40:hover { background-color: hsl(var(--bg-500)/.4); }

.hover\:bg-bg-500\/60:hover { background-color: hsl(var(--bg-500)/.6); }

.hover\:bg-danger-200\/20:hover { background-color: hsl(var(--danger-200)/.2); }

.hover\:bg-danger-900\/75:hover { background-color: hsl(var(--danger-900)/.75); }

.hover\:bg-transparent:hover { background-color: transparent; }

.hover\:bg-opacity-10:hover { --tw-bg-opacity: 0.1; }

.hover\:from-bg-000:hover { --tw-gradient-from: hsl(var(--bg-000)/1) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-000)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.hover\:from-bg-000\/70:hover { --tw-gradient-from: hsl(var(--bg-000)/0.7) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-000)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.hover\:from-bg-400\/0:hover { --tw-gradient-from: hsl(var(--bg-400)/0) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--bg-400)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.hover\:to-bg-000\/50:hover { --tw-gradient-to: hsl(var(--bg-000)/0.5) var(--tw-gradient-to-position); }

.hover\:to-bg-000\/80:hover { --tw-gradient-to: hsl(var(--bg-000)/0.8) var(--tw-gradient-to-position); }

.hover\:to-bg-400\/50:hover { --tw-gradient-to: hsl(var(--bg-400)/0.5) var(--tw-gradient-to-position); }

.hover\:pl-2:hover { padding-left: 0.5rem; }

.hover\:\!text-accent-secondary-100:hover { --tw-text-opacity: 1 !important; color: hsl(var(--accent-secondary-100)/var(--tw-text-opacity)) !important; }

.hover\:\!text-oncolor-100:hover { --tw-text-opacity: 1 !important; color: hsl(var(--oncolor-100)/var(--tw-text-opacity)) !important; }

.hover\:\!text-text-100:hover { --tw-text-opacity: 1 !important; color: hsl(var(--text-100)/var(--tw-text-opacity)) !important; }

.hover\:\!text-text-400:hover { --tw-text-opacity: 1 !important; color: hsl(var(--text-400)/var(--tw-text-opacity)) !important; }

.hover\:text-accent-main-000:hover { --tw-text-opacity: 1; color: hsl(var(--accent-main-000)/var(--tw-text-opacity)); }

.hover\:text-accent-main-100:hover { --tw-text-opacity: 1; color: hsl(var(--accent-main-100)/var(--tw-text-opacity)); }

.hover\:text-accent-main-200:hover { --tw-text-opacity: 1; color: hsl(var(--accent-main-200)/var(--tw-text-opacity)); }

.hover\:text-accent-pro-000:hover { --tw-text-opacity: 1; color: hsl(var(--accent-pro-000)/var(--tw-text-opacity)); }

.hover\:text-accent-secondary-000:hover { --tw-text-opacity: 1; color: hsl(var(--accent-secondary-000)/var(--tw-text-opacity)); }

.hover\:text-accent-secondary-100:hover { --tw-text-opacity: 1; color: hsl(var(--accent-secondary-100)/var(--tw-text-opacity)); }

.hover\:text-accent-secondary-200:hover { --tw-text-opacity: 1; color: hsl(var(--accent-secondary-200)/var(--tw-text-opacity)); }

.hover\:text-always-white\/80:hover { color: hsl(var(--always-white)/.8); }

.hover\:text-always-white\/90:hover { color: hsl(var(--always-white)/.9); }

.hover\:text-danger-000:hover { --tw-text-opacity: 1; color: hsl(var(--danger-000)/var(--tw-text-opacity)); }

.hover\:text-danger-100:hover { --tw-text-opacity: 1; color: hsl(var(--danger-100)/var(--tw-text-opacity)); }

.hover\:text-oncolor-100:hover { --tw-text-opacity: 1; color: hsl(var(--oncolor-100)/var(--tw-text-opacity)); }

.hover\:text-success-000:hover { --tw-text-opacity: 1; color: hsl(var(--success-000)/var(--tw-text-opacity)); }

.hover\:text-text-000:hover { --tw-text-opacity: 1; color: hsl(var(--text-000)/var(--tw-text-opacity)); }

.hover\:text-text-100:hover { --tw-text-opacity: 1; color: hsl(var(--text-100)/var(--tw-text-opacity)); }

.hover\:text-text-200:hover { --tw-text-opacity: 1; color: hsl(var(--text-200)/var(--tw-text-opacity)); }

.hover\:text-text-200\/90:hover { color: hsl(var(--text-200)/.9); }

.hover\:text-text-300:hover { --tw-text-opacity: 1; color: hsl(var(--text-300)/var(--tw-text-opacity)); }

.hover\:text-text-400:hover { --tw-text-opacity: 1; color: hsl(var(--text-400)/var(--tw-text-opacity)); }

.hover\:underline:hover { text-decoration-line: underline; }

.hover\:no-underline:hover { text-decoration-line: none; }

.hover\:opacity-100:hover { opacity: 1; }

.hover\:opacity-60:hover { opacity: 0.6; }

.hover\:opacity-70:hover { opacity: 0.7; }

.hover\:opacity-80:hover { opacity: 0.8; }

.hover\:opacity-90:hover { opacity: 0.9; }

.hover\:opacity-95:hover { opacity: 0.95; }

.hover\:shadow:hover { --tw-shadow: 0 1px 3px 0 rgb(0 0 0/0.1),0 1px 2px -1px rgb(0 0 0/0.1); --tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color),0 1px 2px -1px var(--tw-shadow-color); }

.hover\:shadow-2xl:hover, .hover\:shadow:hover { box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.hover\:shadow-2xl:hover { --tw-shadow: 0 25px 50px -12px rgb(0 0 0/0.25); --tw-shadow-colored: 0 25px 50px -12px var(--tw-shadow-color); }

.hover\:shadow-\[0_0\.25rem_1\.25rem_hsl\(var\(--always-black\)\/3\.5\%\)\,0_0_0_0\.5px_hsla\(var\(--border-200\)\/0\.3\)\]:hover { --tw-shadow: 0 0.25rem 1.25rem hsl(var(--always-black)/3.5%),0 0 0 0.5px hsla(var(--border-200)/0.3); --tw-shadow-colored: 0 0.25rem 1.25rem var(--tw-shadow-color),0 0 0 0.5px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.hover\:shadow-\[0_4px_20px_0_hsl\(var\(--always-black\)\/4\%\)\]:hover { --tw-shadow: 0 4px 20px 0 hsl(var(--always-black)/4%); --tw-shadow-colored: 0 4px 20px 0 var(--tw-shadow-color); }

.hover\:shadow-\[0_4px_20px_0_hsl\(var\(--always-black\)\/4\%\)\]:hover, .hover\:shadow-lg:hover { box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.hover\:shadow-lg:hover { --tw-shadow: 0 10px 15px -3px rgb(0 0 0/0.1),0 4px 6px -4px rgb(0 0 0/0.1); --tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color); }

.hover\:shadow-md:hover { --tw-shadow: 0 4px 6px -1px rgb(0 0 0/0.1),0 2px 4px -2px rgb(0 0 0/0.1); --tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color); }

.hover\:shadow-md:hover, .hover\:shadow-sm:hover { box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.hover\:shadow-sm:hover { --tw-shadow: 0 1px 2px 0 rgb(0 0 0/0.05); --tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color); }

.hover\:shadow-always-black\/10:hover { --tw-shadow-color: hsl(var(--always-black)/0.1); --tw-shadow: var(--tw-shadow-colored); }

.hover\:shadow-bg-300\/50:hover { --tw-shadow-color: hsl(var(--bg-300)/0.5); --tw-shadow: var(--tw-shadow-colored); }

.hover\:outline-danger-000\/50:hover { outline-color: hsl(var(--danger-000)/.5); }

.hover\:ring-2:hover { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000); }

.hover\:ring-border-400\/30:hover { --tw-ring-color: hsl(var(--border-400)/0.3); }

.hover\:ring-offset-2:hover { --tw-ring-offset-width: 2px; }

.hover\:ring-offset-bg-100:hover { --tw-ring-offset-color: hsl(var(--bg-100)/1); }

.hover\:drop-shadow-sm:hover { --tw-drop-shadow: drop-shadow(0 1px 1px rgb(0 0 0/0.05)); filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow); }

.hover\:after\:translate-y-0:hover::after { content: var(--tw-content); --tw-translate-y: 0px; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.hover\:after\:opacity-100:hover::after { content: var(--tw-content); opacity: 1; }

.read-only\:hover\:border-border-300:hover:read-only { border-color: hsl(var(--border-300)/.15); }

.hover\:focus-within\:shadow-\[0_0\.25rem_1\.25rem_hsl\(var\(--always-black\)\/7\.5\%\)\,0_0_0_0\.5px_hsla\(var\(--border-200\)\/0\.3\)\]:focus-within:hover { --tw-shadow: 0 0.25rem 1.25rem hsl(var(--always-black)/7.5%),0 0 0 0.5px hsla(var(--border-200)/0.3); --tw-shadow-colored: 0 0.25rem 1.25rem var(--tw-shadow-color),0 0 0 0.5px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.focus\:\!border-danger-200:focus { --tw-border-opacity: 1 !important; border-color: hsl(var(--danger-200)/var(--tw-border-opacity)) !important; }

.focus\:border-accent-secondary-100:focus { --tw-border-opacity: 1; border-color: hsl(var(--accent-secondary-100)/var(--tw-border-opacity)); }

.focus\:border-border-100:focus { border-color: hsl(var(--border-100)/.4); }

.focus\:border-border-200:focus { border-color: hsl(var(--border-200)/.3); }

.focus\:border-danger-200:focus { --tw-border-opacity: 1; border-color: hsl(var(--danger-200)/var(--tw-border-opacity)); }

.focus\:border-text-000:focus { --tw-border-opacity: 1; border-color: hsl(var(--text-000)/var(--tw-border-opacity)); }

.focus\:border-transparent:focus { border-color: transparent; }

.focus\:bg-bg-200:focus { --tw-bg-opacity: 1; background-color: hsl(var(--bg-200)/var(--tw-bg-opacity)); }

.focus\:bg-bg-300:focus { --tw-bg-opacity: 1; background-color: hsl(var(--bg-300)/var(--tw-bg-opacity)); }

.focus\:opacity-100:focus { opacity: 1; }

.focus\:\!outline-none:focus { outline: transparent solid 2px !important; outline-offset: 2px !important; }

.focus\:outline-none:focus { outline: transparent solid 2px; outline-offset: 2px; }

.focus\:outline-2:focus { outline-width: 2px; }

.focus\:outline-offset-2:focus { outline-offset: 2px; }

.focus\:\!outline-accent-main-100\/75:focus { outline-color: hsl(var(--accent-main-100)/.75) !important; }

.focus\:\!outline-danger-100\/50:focus { outline-color: hsl(var(--danger-100)/.5) !important; }

.focus\:\!outline-text-000\/75:focus { outline-color: hsl(var(--text-000)/.75) !important; }

.focus\:ring:focus { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(3px + var(--tw-ring-offset-width)) var(--tw-ring-color); }

.focus\:ring-0:focus, .focus\:ring:focus { box-shadow: var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000); }

.focus\:ring-0:focus { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(0px + var(--tw-ring-offset-width)) var(--tw-ring-color); }

.focus\:ring-1:focus { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color); }

.focus\:ring-1:focus, .focus\:ring-2:focus { box-shadow: var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000); }

.focus\:ring-2:focus { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color); }

.focus\:ring-accent-main-000:focus { --tw-ring-opacity: 1; --tw-ring-color: hsl(var(--accent-main-000)/var(--tw-ring-opacity)); }

.focus\:ring-accent-main-100:focus { --tw-ring-opacity: 1; --tw-ring-color: hsl(var(--accent-main-100)/var(--tw-ring-opacity)); }

.focus\:ring-accent-main-200:focus { --tw-ring-opacity: 1; --tw-ring-color: hsl(var(--accent-main-200)/var(--tw-ring-opacity)); }

.focus\:ring-bg-500:focus { --tw-ring-opacity: 1; --tw-ring-color: hsl(var(--bg-500)/var(--tw-ring-opacity)); }

.focus-visible\:outline-none:focus-visible { outline: transparent solid 2px; outline-offset: 2px; }

.focus-visible\:outline:focus-visible { outline-style: solid; }

.focus-visible\:outline-2:focus-visible { outline-width: 2px; }

.focus-visible\:outline-offset-2:focus-visible { outline-offset: 2px; }

.focus-visible\:ring-1:focus-visible { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000); }

.active\:\!scale-100:active { --tw-scale-x: 1 !important; --tw-scale-y: 1 !important; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)) !important; }

.active\:scale-90:active { --tw-scale-x: .9; --tw-scale-y: .9; }

.active\:scale-90:active, .active\:scale-95:active { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.active\:scale-95:active { --tw-scale-x: .95; --tw-scale-y: .95; }

.active\:scale-\[0\.985\]:active { --tw-scale-x: 0.985; --tw-scale-y: 0.985; }

.active\:scale-\[0\.985\]:active, .active\:scale-\[0\.9875\]:active { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.active\:scale-\[0\.9875\]:active { --tw-scale-x: 0.9875; --tw-scale-y: 0.9875; }

.active\:scale-\[0\.98\]:active { --tw-scale-x: 0.98; --tw-scale-y: 0.98; }

.active\:scale-\[0\.98\]:active, .active\:scale-\[0\.995\]:active { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.active\:scale-\[0\.995\]:active { --tw-scale-x: 0.995; --tw-scale-y: 0.995; }

.active\:scale-\[1\.015\]:active { --tw-scale-x: 1.015; --tw-scale-y: 1.015; }

.active\:scale-\[1\.015\]:active, .active\:scale-\[1\.0\]:active { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.active\:scale-\[1\.0\]:active { --tw-scale-x: 1.0; --tw-scale-y: 1.0; }

.active\:scale-x-\[0\.985\]:active { --tw-scale-x: 0.985; }

.active\:scale-x-\[0\.985\]:active, .active\:scale-y-\[0\.995\]:active { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.active\:scale-y-\[0\.995\]:active { --tw-scale-y: 0.995; }

.active\:\!bg-accent-brand\/15:active { background-color: hsl(var(--accent-brand)/.15) !important; }

.active\:\!bg-transparent:active { background-color: transparent !important; }

.active\:bg-bg-400:active { --tw-bg-opacity: 1; background-color: hsl(var(--bg-400)/var(--tw-bg-opacity)); }

.active\:bg-bg-500\/50:active { background-color: hsl(var(--bg-500)/.5); }

.active\:text-text-500:active { --tw-text-opacity: 1; color: hsl(var(--text-500)/var(--tw-text-opacity)); }

.hover\:enabled\:border-accent-secondary-200\/50:enabled:hover { border-color: hsl(var(--accent-secondary-200)/.5); }

.hover\:enabled\:from-accent-secondary-200\/0:enabled:hover { --tw-gradient-from: hsl(var(--accent-secondary-200)/0) var(--tw-gradient-from-position); --tw-gradient-to: hsl(var(--accent-secondary-200)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),var(--tw-gradient-to); }

.hover\:enabled\:to-accent-secondary-200\/10:enabled:hover { --tw-gradient-to: hsl(var(--accent-secondary-200)/0.1) var(--tw-gradient-to-position); }

.hover\:enabled\:shadow-lg:enabled:hover { --tw-shadow: 0 10px 15px -3px rgb(0 0 0/0.1),0 4px 6px -4px rgb(0 0 0/0.1); --tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.disabled\:pointer-events-none:disabled { pointer-events: none; }

.disabled\:cursor-not-allowed:disabled { cursor: not-allowed; }

.disabled\:bg-always-black\/50:disabled { background-color: hsl(var(--always-black)/.5); }

.disabled\:bg-bg-200:disabled { --tw-bg-opacity: 1; background-color: hsl(var(--bg-200)/var(--tw-bg-opacity)); }

.disabled\:text-always-white\/50:disabled { color: hsl(var(--always-white)/.5); }

.disabled\:text-text-300:disabled { --tw-text-opacity: 1; color: hsl(var(--text-300)/var(--tw-text-opacity)); }

.disabled\:text-text-500:disabled { --tw-text-opacity: 1; color: hsl(var(--text-500)/var(--tw-text-opacity)); }

.disabled\:opacity-100:disabled { opacity: 1; }

.disabled\:opacity-30:disabled { opacity: 0.3; }

.disabled\:opacity-50:disabled { opacity: 0.5; }

.disabled\:shadow-none:disabled { --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.disabled\:drop-shadow-none:disabled { --tw-drop-shadow: drop-shadow(0 0 #0000); filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow); }

.group:focus-within .group-focus-within\:block { display: block; }

.group\/thumbnail:focus-within .group-focus-within\/thumbnail\:opacity-100 { opacity: 1; }

.group:focus-within .group-focus-within\:opacity-100 { opacity: 1; }

.group:focus-within .group-focus-within\:\[mask-image\:linear-gradient\(to_right\,hsl\(var\(--always-black\)\)_78\%\,transparent_95\%\)\] { mask-image: linear-gradient(to right,hsl(var(--always-black)) 78%,transparent 95%); }

.group:hover .group-hover\:visible { visibility: visible; }

.group:hover .group-hover\:right-5, .group\/outer:hover .group-hover\/outer\:right-5 { right: 1.25rem; }

.group:hover .group-hover\:top-\[2\%\] { top: 2%; }

.group:hover .group-hover\:ml-1 { margin-left: 0.25rem; }

.group:hover .group-hover\:ml-\[10px\] { margin-left: 10px; }

.group:hover .group-hover\:ml-\[5px\] { margin-left: 5px; }

.group:hover .group-hover\:block { display: block; }

.group:hover .group-hover\:inline-block { display: inline-block; }

.group:hover .group-hover\:flex { display: flex; }

.group:hover .group-hover\:w-3 { width: 0.75rem; }

.group:hover .group-hover\:w-4 { width: 1rem; }

.group:hover .group-hover\:w-px { width: 1px; }

.group:hover .group-hover\:max-w-\[calc\(100\%-20px\)\] { max-width: calc(100% - 20px); }

.group:hover .group-hover\:-translate-x-2 { --tw-translate-x: -0.5rem; }

.group:hover .group-hover\:-translate-x-2, .group:hover .group-hover\:-translate-x-\[0\.5px\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:-translate-x-\[0\.5px\] { --tw-translate-x: -0.5px; }

.group:hover .group-hover\:-translate-x-\[1px\] { --tw-translate-x: -1px; }

.group:hover .group-hover\:-translate-x-\[1px\], .group:hover .group-hover\:-translate-y-\[1\.4px\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:-translate-y-\[1\.4px\] { --tw-translate-y: -1.4px; }

.group:hover .group-hover\:-translate-y-\[2\.8px\] { --tw-translate-y: -2.8px; }

.group:hover .group-hover\:-translate-y-\[2\.8px\], .group:hover .group-hover\:translate-x-0 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:translate-x-0 { --tw-translate-x: 0px; }

.group:hover .group-hover\:translate-x-0\.5 { --tw-translate-x: 0.125rem; }

.group:hover .group-hover\:translate-x-0\.5, .group:hover .group-hover\:translate-x-1 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:translate-x-1 { --tw-translate-x: 0.25rem; }

.group:hover .group-hover\:translate-x-\[0\.5px\] { --tw-translate-x: 0.5px; }

.group:hover .group-hover\:translate-x-\[0\.5px\], .group:hover .group-hover\:translate-x-\[1px\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:translate-x-\[1px\] { --tw-translate-x: 1px; }

.group:hover .group-hover\:translate-x-px { --tw-translate-x: 1px; }

.group:hover .group-hover\:translate-x-px, .group:hover .group-hover\:translate-y-0 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:translate-y-0 { --tw-translate-y: 0px; }

.group\/artifact-block:hover .group-hover\/artifact-block\:-rotate-\[0\.065rad\] { --tw-rotate: -0.065rad; }

.group\/artifact-block:hover .group-hover\/artifact-block\:-rotate-\[0\.065rad\], .group\/artifact-block:hover .group-hover\/artifact-block\:rotate-\[0\.065rad\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group\/artifact-block:hover .group-hover\/artifact-block\:rotate-\[0\.065rad\] { --tw-rotate: 0.065rad; }

.group\/banner:hover .group-hover\/banner\:rotate-0 { --tw-rotate: 0deg; }

.group:hover .group-hover\:-rotate-1, .group\/banner:hover .group-hover\/banner\:rotate-0 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:-rotate-1 { --tw-rotate: -1deg; }

.group:hover .group-hover\:-rotate-2 { --tw-rotate: -2deg; }

.group:hover .group-hover\:-rotate-2, .group:hover .group-hover\:-rotate-3 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:-rotate-3 { --tw-rotate: -3deg; }

.group:hover .group-hover\:-rotate-90 { --tw-rotate: -90deg; }

.group:hover .group-hover\:-rotate-90, .group:hover .group-hover\:rotate-2 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:rotate-2 { --tw-rotate: 2deg; }

.group:hover .group-hover\:rotate-3 { --tw-rotate: 3deg; }

.group:hover .group-hover\:rotate-3, .group:hover .group-hover\:rotate-6 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:rotate-6 { --tw-rotate: 6deg; }

.group:hover .group-hover\:rotate-90 { --tw-rotate: 90deg; }

.group:hover .group-hover\:rotate-90, .group:hover .group-hover\:rotate-\[10deg\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:rotate-\[10deg\] { --tw-rotate: 10deg; }

.group:hover .group-hover\:rotate-\[120deg\] { --tw-rotate: 120deg; }

.group:hover .group-hover\:rotate-\[120deg\], .group\/artifact-block:hover .group-hover\/artifact-block\:scale-\[1\.035\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group\/artifact-block:hover .group-hover\/artifact-block\:scale-\[1\.035\] { --tw-scale-x: 1.035; --tw-scale-y: 1.035; }

.group\/banner:hover .group-hover\/banner\:scale-75 { --tw-scale-x: .75; --tw-scale-y: .75; }

.group\/banner:hover .group-hover\/banner\:scale-75, .group\/row:hover .group-hover\/row\:scale-100 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group\/row:hover .group-hover\/row\:scale-100 { --tw-scale-x: 1; --tw-scale-y: 1; }

.group\/row:hover .group-hover\/row\:scale-75 { --tw-scale-x: .75; --tw-scale-y: .75; }

.group\/row:hover .group-hover\/row\:scale-75, .group\/summary:hover .group-hover\/summary\:scale-100 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group\/summary:hover .group-hover\/summary\:scale-100 { --tw-scale-x: 1; --tw-scale-y: 1; }

.group\/summary:hover .group-hover\/summary\:scale-\[55\%\] { --tw-scale-x: 55%; --tw-scale-y: 55%; }

.group\/summary:hover .group-hover\/summary\:scale-\[55\%\], .group\/tag:hover .group-hover\/tag\:scale-\[100\%\] { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group\/tag:hover .group-hover\/tag\:scale-\[100\%\] { --tw-scale-x: 100%; --tw-scale-y: 100%; }

.group:hover .group-hover\:scale-100 { --tw-scale-x: 1; --tw-scale-y: 1; }

.group:hover .group-hover\:scale-100, .group:hover .group-hover\:scale-105 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:scale-105 { --tw-scale-x: 1.05; --tw-scale-y: 1.05; }

.group:hover .group-hover\:scale-110 { --tw-scale-x: 1.1; --tw-scale-y: 1.1; }

.group:hover .group-hover\:scale-110, .group:hover .group-hover\:scale-75 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:scale-75 { --tw-scale-x: .75; --tw-scale-y: .75; }

.group:hover .group-hover\:scale-90 { --tw-scale-x: .9; --tw-scale-y: .9; }

.group:hover .group-hover\:scale-90, .group:hover .group-hover\:scale-95 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:scale-95 { --tw-scale-x: .95; --tw-scale-y: .95; }

.group:hover .group-hover\:scale-\[1\.15\] { --tw-scale-x: 1.15; --tw-scale-y: 1.15; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:hover .group-hover\:animate-\[blink_4s_ease-in-out_infinite\] { animation: 4s ease-in-out 0s infinite normal none running blink; }

.group:hover .group-hover\:animate-\[look-around_2\.4s_ease-in-out_infinite\] { animation: 2.4s ease-in-out 0s infinite normal none running look-around; }

@keyframes bounce { 
  0%, 100% { transform: translateY(-25%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
  50% { transform: none; animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
}

.group:hover .group-hover\:animate-bounce { animation: 1s ease 0s infinite normal none running bounce; }

.group\/tag:hover .group-hover\/tag\:border-accent-secondary-100\/60 { border-color: hsl(var(--accent-secondary-100)/.6); }

.group:hover .group-hover\:border-accent-secondary-000\/70 { border-color: hsl(var(--accent-secondary-000)/.7); }

.group:hover .group-hover\:border-accent-secondary-100\/40 { border-color: hsl(var(--accent-secondary-100)/.4); }

.group:hover .group-hover\:border-accent-secondary-100\/50 { border-color: hsl(var(--accent-secondary-100)/.5); }

.group:hover .group-hover\:border-accent-secondary-200\/40 { border-color: hsl(var(--accent-secondary-200)/.4); }

.group:hover .group-hover\:border-accent-secondary-900 { --tw-border-opacity: 1; border-color: hsl(var(--accent-secondary-900)/var(--tw-border-opacity)); }

.group\/tag:hover .group-hover\/tag\:bg-accent-secondary-900 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-secondary-900)/var(--tw-bg-opacity)); }

.group:hover .group-hover\:bg-accent-secondary-100 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-secondary-100)/var(--tw-bg-opacity)); }

.group:hover .group-hover\:bg-accent-secondary-900 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-secondary-900)/var(--tw-bg-opacity)); }

.group:hover .group-hover\:bg-bg-000 { --tw-bg-opacity: 1; background-color: hsl(var(--bg-000)/var(--tw-bg-opacity)); }

.group:hover .group-hover\:bg-bg-100 { --tw-bg-opacity: 1; background-color: hsl(var(--bg-100)/var(--tw-bg-opacity)); }

.group:hover .group-hover\:bg-bg-300 { --tw-bg-opacity: 1; background-color: hsl(var(--bg-300)/var(--tw-bg-opacity)); }

.group:hover .group-hover\:bg-gradient-to-t { background-image: linear-gradient(to top,var(--tw-gradient-stops)); }

.group\/collapse-indicator:hover .group-hover\/collapse-indicator\:text-text-300 { --tw-text-opacity: 1; color: hsl(var(--text-300)/var(--tw-text-opacity)); }

.group\/snippet:hover .group-hover\/snippet\:text-text-200, .group\/tag:hover .group-hover\/tag\:text-text-200 { --tw-text-opacity: 1; color: hsl(var(--text-200)/var(--tw-text-opacity)); }

.group:hover .group-hover\:\!text-text-200\/40 { color: hsl(var(--text-200)/.4) !important; }

.group:hover .group-hover\:\!text-text-400 { --tw-text-opacity: 1 !important; color: hsl(var(--text-400)/var(--tw-text-opacity)) !important; }

.group:hover .group-hover\:text-accent-pro-000 { --tw-text-opacity: 1; color: hsl(var(--accent-pro-000)/var(--tw-text-opacity)); }

.group:hover .group-hover\:text-accent-secondary-000 { --tw-text-opacity: 1; color: hsl(var(--accent-secondary-000)/var(--tw-text-opacity)); }

.group:hover .group-hover\:text-accent-secondary-000\/80 { color: hsl(var(--accent-secondary-000)/.8); }

.group:hover .group-hover\:text-accent-secondary-200 { --tw-text-opacity: 1; color: hsl(var(--accent-secondary-200)/var(--tw-text-opacity)); }

.group:hover .group-hover\:text-text-000 { --tw-text-opacity: 1; color: hsl(var(--text-000)/var(--tw-text-opacity)); }

.group:hover .group-hover\:text-text-100 { --tw-text-opacity: 1; color: hsl(var(--text-100)/var(--tw-text-opacity)); }

.group:hover .group-hover\:text-text-300 { --tw-text-opacity: 1; color: hsl(var(--text-300)/var(--tw-text-opacity)); }

.group\/avatar:hover .group-hover\/avatar\:opacity-100 { opacity: 1; }

.group\/banner:hover .group-hover\/banner\:opacity-0 { opacity: 0; }

.group\/banner:hover .group-hover\/banner\:opacity-75 { opacity: 0.75; }

.group\/copy:hover .group-hover\/copy\:opacity-100, .group\/outer:hover .group-hover\/outer\:opacity-100 { opacity: 1; }

.group\/row:hover .group-hover\/row\:opacity-0 { opacity: 0; }

.group\/row:hover .group-hover\/row\:opacity-100 { opacity: 1; }

.group\/switch:hover .group-hover\/switch\:opacity-80 { opacity: 0.8; }

.group\/tag:hover .group-hover\/tag\:opacity-\[100\%\] { opacity: 1; }

.group\/thumbnail:hover .group-hover\/thumbnail\:opacity-100 { opacity: 1; }

.group:hover .group-hover\:opacity-0 { opacity: 0; }

.group:hover .group-hover\:opacity-100 { opacity: 1; }

.group:hover .group-hover\:opacity-40 { opacity: 0.4; }

.group:hover .group-hover\:opacity-70 { opacity: 0.7; }

.group:hover .group-hover\:shadow-\[0_6px_12px_0px_hsl\(var\(--always-black\)\/8\%\)\] { --tw-shadow: 0 6px 12px 0px hsl(var(--always-black)/8%); --tw-shadow-colored: 0 6px 12px 0px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.group:hover .group-hover\:shadow-lg { --tw-shadow: 0 10px 15px -3px rgb(0 0 0/0.1),0 4px 6px -4px rgb(0 0 0/0.1); --tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color),0 4px 6px -4px var(--tw-shadow-color); }

.group:hover .group-hover\:shadow-lg, .group:hover .group-hover\:shadow-md { box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.group:hover .group-hover\:shadow-md { --tw-shadow: 0 4px 6px -1px rgb(0 0 0/0.1),0 2px 4px -2px rgb(0 0 0/0.1); --tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color),0 2px 4px -2px var(--tw-shadow-color); }

.group:hover .group-hover\:shadow-sm { --tw-shadow: 0 1px 2px 0 rgb(0 0 0/0.05); --tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.group:hover .group-hover\:blur-\[3px\] { --tw-blur: blur(3px); }

.group:hover .group-hover\:blur-\[3px\], .group:hover .group-hover\:grayscale-0 { filter: var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow); }

.group:hover .group-hover\:grayscale-0 { --tw-grayscale: grayscale(0); }

.group:hover .group-hover\:delay-75 { transition-delay: 75ms; }

.group\/artifact-block:hover .group-hover\/artifact-block\:ease-\[cubic-bezier\(0\,0\.9\,0\.5\,1\.35\)\] { transition-timing-function: cubic-bezier(0, 0.9, 0.5, 1.35); }

.group\/tag:hover .group-hover\/tag\:ease-out { transition-timing-function: cubic-bezier(0, 0, 0.2, 1); }

.group:hover .group-hover\:\[mask-image\:linear-gradient\(to_right\,hsl\(var\(--always-black\)\)_78\%\,transparent_95\%\)\] { mask-image: linear-gradient(to right,hsl(var(--always-black)) 78%,transparent 95%); }

.group:hover .\*\:group-hover\:border-accent-secondary-100\/50 > * { border-color: hsl(var(--accent-secondary-100)/.5); }

.group:focus-visible .group-focus-visible\:scale-100 { --tw-scale-x: 1; --tw-scale-y: 1; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:focus-visible .group-focus-visible\:border-accent-secondary-100\/50 { border-color: hsl(var(--accent-secondary-100)/.5); }

.group:focus-visible .group-focus-visible\:text-text-100 { --tw-text-opacity: 1; color: hsl(var(--text-100)/var(--tw-text-opacity)); }

.group:focus-visible .group-focus-visible\:opacity-100 { opacity: 1; }

.group:focus-visible .group-focus-visible\:outline-2 { outline-width: 2px; }

.group:focus-visible .group-focus-visible\:outline-offset-2 { outline-offset: 2px; }

.group:active .group-active\:translate-x-0 { --tw-translate-x: 0px; }

.group:active .group-active\:translate-x-0, .group:active .group-active\:translate-y-0 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:active .group-active\:translate-y-0 { --tw-translate-y: 0px; }

.group:active .group-active\:rotate-6 { --tw-rotate: 6deg; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group:active .group-active\:\!scale-\[0\.98\] { --tw-scale-x: 0.98 !important; --tw-scale-y: 0.98 !important; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)) !important; }

.group:active .group-active\:animate-none { animation: auto ease 0s 1 normal none running none; }

.group:active .group-active\:bg-accent-main-200 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-main-200)/var(--tw-bg-opacity)); }

.group:active .group-active\:\!shadow-none { --tw-shadow: 0 0 #0000 !important; --tw-shadow-colored: 0 0 #0000 !important; box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow) !important; }

.group[data-state="open"] .group-\[\&\[data-state\=open\]\]\:opacity-100 { opacity: 1; }

.peer:checked ~ .peer-checked\:bg-accent-secondary-100 { --tw-bg-opacity: 1; background-color: hsl(var(--accent-secondary-100)/var(--tw-bg-opacity)); }

.peer:checked ~ .peer-checked\:bg-text-100 { --tw-bg-opacity: 1; background-color: hsl(var(--text-100)/var(--tw-bg-opacity)); }

.peer:focus-visible ~ .peer-focus-visible\:ring-1 { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(1px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow,0 0 #0000); }

.peer:disabled ~ .peer-disabled\:opacity-50 { opacity: 0.5; }

.group\/row:has(:focus-visible) .group-has-\[\:focus-visible\]\/row\:scale-100 { --tw-scale-x: 1; --tw-scale-y: 1; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group\/row:has(:focus-visible) .group-has-\[\:focus-visible\]\/row\:opacity-100 { opacity: 1; }

.aria-checked\:bg-bg-400[aria-checked="true"] { --tw-bg-opacity: 1; background-color: hsl(var(--bg-400)/var(--tw-bg-opacity)); }

.aria-checked\:text-text-100[aria-checked="true"] { --tw-text-opacity: 1; color: hsl(var(--text-100)/var(--tw-text-opacity)); }

.aria-expanded\:\!bg-bg-400[aria-expanded="true"] { --tw-bg-opacity: 1 !important; background-color: hsl(var(--bg-400)/var(--tw-bg-opacity)) !important; }

.aria-expanded\:bg-bg-400[aria-expanded="true"] { --tw-bg-opacity: 1; background-color: hsl(var(--bg-400)/var(--tw-bg-opacity)); }

.aria-expanded\:bg-transparent[aria-expanded="true"] { background-color: transparent; }

.aria-expanded\:text-text-100[aria-expanded="true"] { --tw-text-opacity: 1; color: hsl(var(--text-100)/var(--tw-text-opacity)); }

.aria-expanded\:hover\:bg-bg-300:hover[aria-expanded="true"] { --tw-bg-opacity: 1; background-color: hsl(var(--bg-300)/var(--tw-bg-opacity)); }

.aria-pressed\:text-text-100[aria-pressed="true"] { --tw-text-opacity: 1; color: hsl(var(--text-100)/var(--tw-text-opacity)); }

.data-\[swipe\=\"move\"\]\:translate-x-\[var\(--radix-toast-swipe-move-x\)\][data-swipe="move"] { --tw-translate-x: var(--radix-toast-swipe-move-x); transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.data-\[state\=\"closed\"\]\:animate-\[fade_125ms_ease-out_reverse_forwards\][data-state="closed"] { animation: 125ms ease-out 0s 1 reverse forwards running fade; }

.data-\[state\=\"closed\"\]\:animate-\[fade_200ms_ease-in_forwards\][data-state="closed"] { animation: 0.2s ease-in 0s 1 normal forwards running fade; }

@keyframes slide-up { 
  0% { height: var(--radix-accordion-content-height); }
  100% { height: 0px; }
}

.data-\[state\=\"closed\"\]\:animate-\[slide-up_300ms_ease-out\][data-state="closed"] { animation: 0.3s ease-out 0s 1 normal none running slide-up; }

.data-\[state\=\"closed\"\]\:animate-\[zoom_125ms_ease-out_reverse_forwards\][data-state="closed"] { animation: 125ms ease-out 0s 1 reverse forwards running zoom; }

.data-\[state\=\"open\"\]\:animate-\[fade_250ms_ease-in_forwards\][data-state="open"] { animation: 0.25s ease-in 0s 1 normal forwards running fade; }

@keyframes slide-down { 
  0% { height: 0px; }
  100% { height: var(--radix-accordion-content-height); }
}

.data-\[state\=\"open\"\]\:animate-\[slide-down_300ms_ease-out\][data-state="open"] { animation: 0.3s ease-out 0s 1 normal none running slide-down; }

.data-\[state\=\"open\"\]\:animate-\[translate-x_200ms_cubic-bezier\(0\.16\,1\,0\.3\,1\)_forwards\][data-state="open"] { animation: 0.2s cubic-bezier(0.16, 1, 0.3, 1) 0s 1 normal forwards running translate-x; }

.data-\[state\=\"open\"\]\:animate-\[zoom_250ms_ease-in_forwards\][data-state="open"] { animation: 0.25s ease-in 0s 1 normal forwards running zoom; }

.data-\[state\=closed\]\:animate-\[fade_125ms_ease-out_reverse_forwards\][data-state="closed"] { animation: 125ms ease-out 0s 1 reverse forwards running fade; }

.data-\[state\=closed\]\:animate-\[zoom_125ms_ease-out_reverse_forwards\][data-state="closed"] { animation: 125ms ease-out 0s 1 reverse forwards running zoom; }

@keyframes fade { 
  0% { opacity: 0; }
  100% { opacity: 1; }
}

.data-\[state\=open\]\:animate-\[fade_250ms_ease-in_forwards\][data-state="open"] { animation: 0.25s ease-in 0s 1 normal forwards running fade; }

@keyframes zoom { 
  0% { transform: scale(0.95); }
  100% { transform: scale(1); }
}

.data-\[state\=open\]\:animate-\[zoom_250ms_ease-in_forwards\][data-state="open"] { animation: 0.25s ease-in 0s 1 normal forwards running zoom; }

@keyframes translate-x { 
  100% { transform: translateX(100%); }
}

.data-\[swipe\=\"end\"\]\:animate-\[translate-x_100ms_ease-out\][data-swipe="end"] { animation: 0.1s ease-out 0s 1 normal none running translate-x; }

.data-\[state\=open\]\:border-accent-secondary-100[data-state="open"] { --tw-border-opacity: 1; border-color: hsl(var(--accent-secondary-100)/var(--tw-border-opacity)); }

.data-\[selected\]\:bg-bg-200[data-selected] { --tw-bg-opacity: 1; background-color: hsl(var(--bg-200)/var(--tw-bg-opacity)); }

.data-\[state\=\'on\'\]\:text-text-100[data-state="on"] { --tw-text-opacity: 1; color: hsl(var(--text-100)/var(--tw-text-opacity)); }

.data-\[state\=open\]\:opacity-100[data-state="open"] { opacity: 1; }

.data-\[swipe\=\"cancel\"\]\:transition-transform[data-swipe="cancel"] { transition-property: transform; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }

.data-\[swipe\=\"cancel\"\]\:duration-200[data-swipe="cancel"] { transition-duration: 0.2s; }

.data-\[swipe\=\"cancel\"\]\:ease-out[data-swipe="cancel"] { transition-timing-function: cubic-bezier(0, 0, 0.2, 1); }

.data-\[state\=\"closed\"\]\:\[animation-direction\:reverse\][data-state="closed"], .data-\[state\=\"open\"\]\:\[animation-direction\:reverse\][data-state="open"] { animation-direction: reverse; }

.group[data-state="closed"] .group-data-\[state\=closed\]\:hidden, .group[data-state="open"] .group-data-\[state\=open\]\:hidden, .group[data-state="unchecked"] .group-data-\[state\=unchecked\]\:hidden { display: none; }

.group[data-state="open"] .group-data-\[state\=\"open\"\]\:rotate-45 { --tw-rotate: 45deg; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.group[data-state="closed"] .group-data-\[state\=\"closed\"\]\:text-text-400 { --tw-text-opacity: 1; color: hsl(var(--text-400)/var(--tw-text-opacity)); }

.group[data-state="checked"] .group-data-\[state\=checked\]\:shadow-inset-border { --tw-shadow: inset 0 0 0 1px var(--tw-shadow-color); --tw-shadow-colored: inset 0 0 0 1px var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }

.group[data-state="checked"] .group-data-\[state\=checked\]\:shadow-accent-secondary-000 { --tw-shadow-color: hsl(var(--accent-secondary-000)/1); --tw-shadow: var(--tw-shadow-colored); }

.group[data-state="closed"] .group-data-\[state\=\"closed\"\]\:hover\:text-text-200:hover { --tw-text-opacity: 1; color: hsl(var(--text-200)/var(--tw-text-opacity)); }

.next-sibling-hover\:border-transparent:has(+ :hover) { border-color: transparent; }

@media (prefers-reduced-motion: reduce) {
  @keyframes spin { 
  100% { transform: rotate(1turn); }
}
  .motion-reduce\:animate-\[spin_1\.5s_linear_infinite\] { animation: 1.5s linear 0s infinite normal none running spin; }
  .motion-reduce\:duration-0 { transition-duration: 0s; }
}

@media not all and (min-width: 768px) {
  .max-md\:pointer-events-none { pointer-events: none; }
  .max-md\:pointer-events-auto { pointer-events: auto; }
  .max-md\:fixed { position: fixed; }
  .max-md\:absolute { position: absolute; }
  .max-md\:inset-0 { inset: 0px; }
  .max-md\:inset-x-0 { left: 0px; right: 0px; }
  .max-md\:bottom-0 { bottom: 0px; }
  .max-md\:left-0 { left: 0px; }
  .max-md\:top-0 { top: 0px; }
  .max-md\:z-50 { z-index: 50; }
  .max-md\:z-header { z-index: 20; }
  .max-md\:ml-2 { margin-left: 0.5rem; }
  .max-md\:mt-2 { margin-top: 0.5rem; }
  .max-md\:line-clamp-2 { overflow: hidden; display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 2; }
  .max-md\:flex { display: flex; }
  .max-md\:hidden { display: none; }
  .max-md\:h-screen { height: 100vh; }
  .max-md\:w-fit { width: fit-content; }
  .max-md\:max-w-\[23\.5rem\] { max-width: 23.5rem; }
  .max-md\:max-w-\[33rem\] { max-width: 33rem; }
  .max-md\:flex-1 { flex: 1 1 0%; }
  .max-md\:-translate-x-full { --tw-translate-x: -100%; }
  .max-md\:-translate-x-full, .max-md\:translate-x-0 { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }
  .max-md\:translate-x-0 { --tw-translate-x: 0px; }
  .max-md\:transform { transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }
  .max-md\:flex-col { flex-direction: column; }
  .max-md\:self-end { align-self: flex-end; }
  .max-md\:break-words { overflow-wrap: break-word; }
  .max-md\:border-0 { border-width: 0px; }
  .max-md\:border-t { border-top-width: 1px; }
  .max-md\:border-border-300 { border-color: hsl(var(--border-300)/.15); }
  .max-md\:bg-bg-100 { --tw-bg-opacity: 1; background-color: hsl(var(--bg-100)/var(--tw-bg-opacity)); }
  .max-md\:via-90\% { --tw-gradient-via-position: 90%; }
  .max-md\:pl-1 { padding-left: 0.25rem; }
  .max-md\:pt-4 { padding-top: 1rem; }
  .max-md\:transition-transform { transition-property: transform; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }
  .max-md\:duration-300 { transition-duration: 0.3s; }
  .max-md\:ease-in-out { transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); }
}

@media not all and (min-width: 640px) {
  .max-sm\:mx-1 { margin-left: 0.25rem; margin-right: 0.25rem; }
  .max-sm\:mx-1\.5 { margin-left: 0.375rem; margin-right: 0.375rem; }
  .max-sm\:-mb-2 { margin-bottom: -0.5rem; }
  .max-sm\:ml-1 { margin-left: 0.25rem; }
  .max-sm\:mt-3 { margin-top: 0.75rem; }
  .max-sm\:hidden { display: none; }
  .max-sm\:w-full { width: 100%; }
  .max-sm\:min-w-8 { min-width: 2rem; }
  .max-sm\:flex-1 { flex: 1 1 0%; }
  .max-sm\:flex-col { flex-direction: column; }
  .max-sm\:\!px-1 { padding-left: 0.25rem !important; padding-right: 0.25rem !important; }
  .max-sm\:px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
  .max-sm\:pb-8 { padding-bottom: 2rem; }
  .max-sm\:text-sm { font-size: 0.875rem; line-height: 1.25rem; }
}

@media (min-width: 350px) {
  .min-\[350px\]\:text-\[3\.2rem\] { font-size: 3.2rem; }
}

@media (min-width: 500px) {
  .min-\[500px\]\:flex { display: flex; }
  .min-\[500px\]\:text-\[3\.5rem\] { font-size: 3.5rem; }
}

@media (min-width: 640px) {
  .sm\:static { position: static; }
  .sm\:absolute { position: absolute; }
  .sm\:bottom-4 { bottom: 1rem; }
  .sm\:bottom-6 { bottom: 1.5rem; }
  .sm\:right-16 { right: 4rem; }
  .sm\:right-4 { right: 1rem; }
  .sm\:right-6 { right: 1.5rem; }
  .sm\:top-5 { top: 1.25rem; }
  .sm\:top-6 { top: 1.5rem; }
  .sm\:col-span-1 { grid-column: span 1 / span 1; }
  .sm\:col-span-2 { grid-column: span 2 / span 2; }
  .sm\:row-span-2 { grid-row: span 2 / span 2; }
  .sm\:-mx-20 { margin-left: -5rem; margin-right: -5rem; }
  .sm\:-mx-4 { margin-left: -1rem; margin-right: -1rem; }
  .sm\:mx-auto { margin-left: auto; margin-right: auto; }
  .sm\:-ml-0 { margin-left: 0px; }
  .sm\:-ml-0\.5 { margin-left: -0.125rem; }
  .sm\:mb-12 { margin-bottom: 3rem; }
  .sm\:mb-2 { margin-bottom: 0.5rem; }
  .sm\:mb-4 { margin-bottom: 1rem; }
  .sm\:ml-2 { margin-left: 0.5rem; }
  .sm\:mt-0 { margin-top: 0px; }
  .sm\:mt-1 { margin-top: 0.25rem; }
  .sm\:mt-10 { margin-top: 2.5rem; }
  .sm\:mt-5 { margin-top: 1.25rem; }
  .sm\:mt-8 { margin-top: 2rem; }
  .sm\:block { display: block; }
  .sm\:inline { display: inline; }
  .sm\:flex { display: flex; }
  .sm\:table-row { display: table-row; }
  .sm\:grid { display: grid; }
  .sm\:hidden { display: none; }
  .sm\:h-28 { height: 7rem; }
  .sm\:h-6 { height: 1.5rem; }
  .sm\:h-7 { height: 1.75rem; }
  .sm\:h-8 { height: 2rem; }
  .sm\:h-full { height: 100%; }
  .sm\:w-2\/12 { width: 16.6667%; }
  .sm\:w-3\/12 { width: 25%; }
  .sm\:w-4\/12 { width: 33.3333%; }
  .sm\:w-48 { width: 12rem; }
  .sm\:w-5\/12 { width: 41.6667%; }
  .sm\:w-6 { width: 1.5rem; }
  .sm\:w-6\/12 { width: 50%; }
  .sm\:w-8 { width: 2rem; }
  .sm\:w-\[30rem\] { width: 30rem; }
  .sm\:w-auto { width: auto; }
  .sm\:min-w-0 { min-width: 0px; }
  .sm\:min-w-\[180px\] { min-width: 180px; }
  .sm\:min-w-\[30rem\] { min-width: 30rem; }
  .sm\:max-w-56 { max-width: 14rem; }
  .sm\:max-w-\[calc\(100vw-3rem\)\] { max-width: calc(-3rem + 100vw); }
  .sm\:max-w-md { max-width: 28rem; }
  .sm\:max-w-xl { max-width: 36rem; }
  .sm\:max-w-xs { max-width: 20rem; }
  .sm\:flex-1 { flex: 1 1 0%; }
  .sm\:grow { flex-grow: 1; }
  .sm\:table-auto { table-layout: auto; }
  .sm\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0px, 1fr)); }
  .sm\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0px, 1fr)); }
  .sm\:grid-rows-2 { grid-template-rows: repeat(2, minmax(0px, 1fr)); }
  .sm\:flex-row { flex-direction: row; }
  .sm\:flex-col { flex-direction: column; }
  .sm\:flex-nowrap { flex-wrap: nowrap; }
  .sm\:items-start { align-items: flex-start; }
  .sm\:items-center { align-items: center; }
  .sm\:justify-start { justify-content: flex-start; }
  .sm\:justify-end { justify-content: flex-end; }
  .sm\:justify-between { justify-content: space-between; }
  .sm\:gap-0 { gap: 0px; }
  .sm\:gap-10 { gap: 2.5rem; }
  .sm\:gap-3 { gap: 0.75rem; }
  .sm\:gap-4 { gap: 1rem; }
  .sm\:gap-8 { gap: 2rem; }
  .sm\:gap-\[0\.15em\] { gap: 0.15em; }
  .sm\:gap-\[0\.25em\] { gap: 0.25em; }
  .sm\:self-end { align-self: flex-end; }
  .sm\:whitespace-nowrap { white-space: nowrap; }
  .sm\:break-normal { overflow-wrap: normal; word-break: normal; }
  .sm\:rounded-none { border-radius: 0px; }
  .sm\:rounded-xl { border-radius: 0.75rem; }
  .sm\:border-l { border-left-width: 1px; }
  .sm\:bg-transparent { background-color: transparent; }
  .sm\:p-3 { padding: 0.75rem; }
  .sm\:p-3\.5 { padding: 0.875rem; }
  .sm\:p-8 { padding: 2rem; }
  .sm\:\!px-12 { padding-left: 3rem !important; padding-right: 3rem !important; }
  .sm\:\!px-8 { padding-left: 2rem !important; padding-right: 2rem !important; }
  .sm\:\!py-20 { padding-top: 5rem !important; padding-bottom: 5rem !important; }
  .sm\:px-0 { padding-left: 0px; padding-right: 0px; }
  .sm\:px-1 { padding-left: 0.25rem; padding-right: 0.25rem; }
  .sm\:px-12 { padding-left: 3rem; padding-right: 3rem; }
  .sm\:px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
  .sm\:px-2\.5 { padding-left: 0.625rem; padding-right: 0.625rem; }
  .sm\:px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
  .sm\:px-8 { padding-left: 2rem; padding-right: 2rem; }
  .sm\:py-20 { padding-top: 5rem; padding-bottom: 5rem; }
  .sm\:\!pb-8 { padding-bottom: 2rem !important; }
  .sm\:\!pt-10 { padding-top: 2.5rem !important; }
  .sm\:\!pt-8 { padding-top: 2rem !important; }
  .sm\:pb-0 { padding-bottom: 0px; }
  .sm\:pb-0\.5 { padding-bottom: 0.125rem; }
  .sm\:pb-12 { padding-bottom: 3rem; }
  .sm\:pb-20 { padding-bottom: 5rem; }
  .sm\:pl-3 { padding-left: 0.75rem; }
  .sm\:pr-2 { padding-right: 0.5rem; }
  .sm\:pr-3 { padding-right: 0.75rem; }
  .sm\:pr-4 { padding-right: 1rem; }
  .sm\:pr-8 { padding-right: 2rem; }
  .sm\:pt-0 { padding-top: 0px; }
  .sm\:pt-14 { padding-top: 3.5rem; }
  .sm\:pt-9 { padding-top: 2.25rem; }
  .sm\:text-left { text-align: left; }
  .sm\:text-center { text-align: center; }
  .sm\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
  .sm\:text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
  .sm\:text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
  .sm\:text-\[0\.75rem\] { font-size: 0.75rem; }
  .sm\:text-\[2rem\] { font-size: 2rem; }
  .sm\:text-base { font-size: 1rem; line-height: 1.5rem; }
  .sm\:text-lg { font-size: 1.125rem; line-height: 1.75rem; }
  .sm\:text-sm { font-size: 0.875rem; line-height: 1.25rem; }
  .sm\:text-xl { font-size: 1.25rem; line-height: 1.75rem; }
  .sm\:text-xs { font-size: 0.75rem; line-height: 1rem; }
  .sm\:leading-none { line-height: 1; }
  .sm\:shadow-\[0_4px_20px_0_hsl\(var\(--always-black\)\/4\%\)\] { --tw-shadow: 0 4px 20px 0 hsl(var(--always-black)/4%); --tw-shadow-colored: 0 4px 20px 0 var(--tw-shadow-color); box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }
  .sm\:font-base { font-family: var(--font-ui); font-size: 0.875rem; font-weight: 430; line-height: 1.4; }
  .group:hover .sm\:group-hover\:rotate-2 { --tw-rotate: 2deg; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }
}

@media (min-width: 768px) {
  .md\:pointer-events-none { pointer-events: none; }
  .md\:absolute { position: absolute; }
  .md\:sticky { position: sticky; }
  .md\:right-0 { right: 0px; }
  .md\:right-10 { right: 2.5rem; }
  .md\:right-2 { right: 0.5rem; }
  .md\:top-0 { top: 0px; }
  .md\:top-10 { top: 2.5rem; }
  .md\:top-2 { top: 0.5rem; }
  .md\:top-4 { top: 1rem; }
  .md\:z-0 { z-index: 0; }
  .md\:order-1 { order: 1; }
  .md\:col-span-1 { grid-column: span 1 / span 1; }
  .md\:col-span-4 { grid-column: span 4 / span 4; }
  .md\:col-span-8 { grid-column: span 8 / span 8; }
  .md\:float-none { float: none; }
  .md\:m-0 { margin: 0px; }
  .md\:m-2 { margin: 0.5rem; }
  .md\:mx-0 { margin-left: 0px; margin-right: 0px; }
  .md\:mx-auto { margin-left: auto; margin-right: auto; }
  .md\:my-8 { margin-top: 2rem; margin-bottom: 2rem; }
  .md\:-ml-4 { margin-left: -1rem; }
  .md\:-mr-3 { margin-right: -0.75rem; }
  .md\:-mt-6 { margin-top: -1.5rem; }
  .md\:mb-0 { margin-bottom: 0px; }
  .md\:mb-12 { margin-bottom: 3rem; }
  .md\:mb-48 { margin-bottom: 12rem; }
  .md\:mb-6 { margin-bottom: 1.5rem; }
  .md\:mb-8 { margin-bottom: 2rem; }
  .md\:mr-2 { margin-right: 0.5rem; }
  .md\:mr-3 { margin-right: 0.75rem; }
  .md\:mt-10 { margin-top: 2.5rem; }
  .md\:mt-12 { margin-top: 3rem; }
  .md\:mt-14 { margin-top: 3.5rem; }
  .md\:mt-6 { margin-top: 1.5rem; }
  .md\:mt-8 { margin-top: 2rem; }
  .md\:mt-\[62px\] { margin-top: 62px; }
  .md\:mt-\[80px\] { margin-top: 80px; }
  .md\:block { display: block; }
  .md\:inline { display: inline; }
  .md\:flex { display: flex; }
  .md\:grid { display: grid; }
  .md\:hidden { display: none; }
  .md\:h-24 { height: 6rem; }
  .md\:h-36 { height: 9rem; }
  .md\:h-5 { height: 1.25rem; }
  .md\:h-\[540px\] { height: 540px; }
  .md\:h-\[72px\] { height: 72px; }
  .md\:h-\[calc\(100\%-56px\)\] { height: calc(100% - 56px); }
  .md\:w-1\/2 { width: 50%; }
  .md\:w-5\/6 { width: 83.3333%; }
  .md\:w-7\/12 { width: 58.3333%; }
  .md\:w-\[23rem\] { width: 23rem; }
  .md\:w-\[27rem\] { width: 27rem; }
  .md\:w-\[342px\] { width: 342px; }
  .md\:w-\[384px\] { width: 384px; }
  .md\:w-\[9rem\] { width: 9rem; }
  .md\:w-\[calc\(50vw-2\.5rem\)\] { width: calc(-2.5rem + 50vw); }
  .md\:w-auto { width: auto; }
  .md\:w-fit { width: fit-content; }
  .md\:w-full { width: 100%; }
  .md\:max-w-2xl { max-width: 42rem; }
  .md\:max-w-3xl { max-width: 48rem; }
  .md\:max-w-4xl { max-width: 56rem; }
  .md\:max-w-\[350px\] { max-width: 350px; }
  .md\:max-w-\[545px\] { max-width: 545px; }
  .md\:max-w-\[calc\(100vw-4rem\)\] { max-width: calc(-4rem + 100vw); }
  .md\:max-w-md { max-width: 28rem; }
  .md\:max-w-none { max-width: none; }
  .md\:max-w-xl { max-width: 36rem; }
  .md\:flex-1 { flex: 1 1 0%; }
  .md\:flex-shrink-0 { flex-shrink: 0; }
  .md\:flex-grow-0 { flex-grow: 0; }
  .md\:basis-0 { flex-basis: 0px; }
  @keyframes fade { 
  0% { opacity: 0; }
  100% { opacity: 1; }
}
  .md\:animate-\[fade_0\.3s_ease-in-out_0\.1s_forwards\] { animation: 0.3s ease-in-out 0.1s 1 normal forwards running fade; }
  .md\:grid-cols-12 { grid-template-columns: repeat(12, minmax(0px, 1fr)); }
  .md\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0px, 1fr)); }
  .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0px, 1fr)); }
  .md\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0px, 1fr)); }
  .md\:grid-cols-\[220px_minmax\(0px\,_1fr\)\] { grid-template-columns: 220px minmax(0px, 1fr); }
  .md\:grid-rows-1 { grid-template-rows: repeat(1, minmax(0px, 1fr)); }
  .md\:flex-row { flex-direction: row; }
  .md\:flex-col { flex-direction: column; }
  .md\:items-end { align-items: flex-end; }
  .md\:items-center { align-items: center; }
  .md\:items-stretch { align-items: stretch; }
  .md\:justify-center { justify-content: center; }
  .md\:justify-between { justify-content: space-between; }
  .md\:gap-12 { gap: 3rem; }
  .md\:gap-2 { gap: 0.5rem; }
  .md\:gap-3 { gap: 0.75rem; }
  .md\:gap-32 { gap: 8rem; }
  .md\:gap-4 { gap: 1rem; }
  .md\:gap-6 { gap: 1.5rem; }
  .md\:gap-8 { gap: 2rem; }
  .md\:gap-\[10px\] { gap: 10px; }
  .md\:gap-\[2rem\] { gap: 2rem; }
  .md\:space-x-4 > :not([hidden]) ~ :not([hidden]) { --tw-space-x-reverse: 0; margin-right: calc(1rem * var(--tw-space-x-reverse)); margin-left: calc(1rem * calc(1 - var(--tw-space-x-reverse))); }
  .md\:space-y-0 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(0px * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(0px * var(--tw-space-y-reverse)); }
  .md\:overflow-hidden { overflow: hidden; }
  .md\:overflow-ellipsis { text-overflow: ellipsis; }
  .md\:rounded-2xl { border-radius: 1rem; }
  .md\:rounded-xl { border-radius: 0.75rem; }
  .md\:rounded-e-none { border-start-end-radius: 0px; border-end-end-radius: 0px; }
  .md\:rounded-s-2xl { border-start-start-radius: 1rem; border-end-start-radius: 1rem; }
  .md\:border-0 { border-width: 0px; }
  .md\:border-0\.5 { border-width: 0.5px; }
  .md\:border-border-300 { border-color: hsl(var(--border-300)/.15); }
  .md\:bg-bg-000 { --tw-bg-opacity: 1; background-color: hsl(var(--bg-000)/var(--tw-bg-opacity)); }
  .md\:\!p-8 { padding: 2rem !important; }
  .md\:p-10 { padding: 2.5rem; }
  .md\:p-3 { padding: 0.75rem; }
  .md\:p-6 { padding: 1.5rem; }
  .md\:p-8 { padding: 2rem; }
  .md\:px-0 { padding-left: 0px; padding-right: 0px; }
  .md\:px-10 { padding-left: 2.5rem; padding-right: 2.5rem; }
  .md\:px-11 { padding-left: 2.75rem; padding-right: 2.75rem; }
  .md\:px-12 { padding-left: 3rem; padding-right: 3rem; }
  .md\:px-14 { padding-left: 3.5rem; padding-right: 3.5rem; }
  .md\:px-16 { padding-left: 4rem; padding-right: 4rem; }
  .md\:px-2 { padding-left: 0.5rem; padding-right: 0.5rem; }
  .md\:px-24 { padding-left: 6rem; padding-right: 6rem; }
  .md\:px-4 { padding-left: 1rem; padding-right: 1rem; }
  .md\:px-8 { padding-left: 2rem; padding-right: 2rem; }
  .md\:py-20 { padding-top: 5rem; padding-bottom: 5rem; }
  .md\:py-24 { padding-top: 6rem; padding-bottom: 6rem; }
  .md\:py-6 { padding-top: 1.5rem; padding-bottom: 1.5rem; }
  .md\:py-7 { padding-top: 1.75rem; padding-bottom: 1.75rem; }
  .md\:pb-0 { padding-bottom: 0px; }
  .md\:pb-10 { padding-bottom: 2.5rem; }
  .md\:pb-12 { padding-bottom: 3rem; }
  .md\:pb-20 { padding-bottom: 5rem; }
  .md\:pb-3 { padding-bottom: 0.75rem; }
  .md\:pb-8 { padding-bottom: 2rem; }
  .md\:pb-\[140px\] { padding-bottom: 140px; }
  .md\:pe-6 { padding-inline-end: 1.5rem; }
  .md\:pl-3 { padding-left: 0.75rem; }
  .md\:pl-5 { padding-left: 1.25rem; }
  .md\:pl-8 { padding-left: 2rem; }
  .md\:pl-\[133px\] { padding-left: 133px; }
  .md\:pr-14 { padding-right: 3.5rem; }
  .md\:pr-2 { padding-right: 0.5rem; }
  .md\:pr-3 { padding-right: 0.75rem; }
  .md\:pt-1 { padding-top: 0.25rem; }
  .md\:pt-10 { padding-top: 2.5rem; }
  .md\:pt-12 { padding-top: 3rem; }
  .md\:pt-2 { padding-top: 0.5rem; }
  .md\:pt-20 { padding-top: 5rem; }
  .md\:pt-24 { padding-top: 6rem; }
  .md\:pt-6 { padding-top: 1.5rem; }
  .md\:pt-8 { padding-top: 2rem; }
  .md\:pt-9 { padding-top: 2.25rem; }
  .md\:pt-\[20vh\] { padding-top: 20vh; }
  .md\:text-left { text-align: left; }
  .md\:text-2xl { font-size: 1.5rem; line-height: 2rem; }
  .md\:text-3xl { font-size: 1.875rem; line-height: 2.25rem; }
  .md\:text-4xl { font-size: 2.25rem; line-height: 2.5rem; }
  .md\:text-6xl { font-size: 3.75rem; line-height: 1; }
  .md\:text-lg { font-size: 1.125rem; line-height: 1.75rem; }
  .md\:opacity-0 { opacity: 0; }
  .md\:opacity-100 { opacity: 1; }
  .md\:shadow-\[0px_1px_0px_0px_theme\(colors\.border-300\)\] { --tw-shadow: 0px 1px 0px 0px hsl(var(--border-300)/0.15); --tw-shadow-colored: 0px 1px 0px 0px var(--tw-shadow-color); }
  .md\:shadow-\[0px_1px_0px_0px_theme\(colors\.border-300\)\], .md\:shadow-sm { box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }
  .md\:shadow-sm { --tw-shadow: 0 1px 2px 0 rgb(0 0 0/0.05); --tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color); }
  .md\:transition-\[width\] { transition-property: width; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }
  .md\:transition-opacity { transition-property: opacity; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 0.15s; }
  .md\:duration-300 { transition-duration: 0.3s; }
  .md\:ease-in-out { transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); }
  .md\:font-large { font-family: var(--font-ui); font-size: 1rem; font-weight: 430; line-height: 1.4; }
  .md\:font-xl { font-weight: 400; font-variation-settings: "opsz" 20; }
  .md\:font-xl, .md\:font-xl-bold { font-family: var(--font-ui); font-size: 1.25rem; line-height: 1.4; }
  .md\:font-xl-bold { font-weight: 600; font-variation-settings: "opsz" 20; }
}

@media (min-width: 1000px) {
  .min-\[1000px\]\:flex { display: flex; }
  .min-\[1000px\]\:hidden { display: none; }
  .min-\[1000px\]\:h-\[5\.25rem\] { height: 5.25rem; }
  .min-\[1000px\]\:max-w-7xl { max-width: 80rem; }
  .min-\[1000px\]\:max-w-\[30rem\] { max-width: 30rem; }
  .min-\[1000px\]\:max-w-\[90rem\] { max-width: 90rem; }
  .min-\[1000px\]\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0px, 1fr)); }
  .min-\[1000px\]\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0px, 1fr)); }
  .min-\[1000px\]\:justify-center { justify-content: center; }
  .min-\[1000px\]\:gap-8 { gap: 2rem; }
  .min-\[1000px\]\:px-16 { padding-left: 4rem; padding-right: 4rem; }
}

@media (min-width: 1024px) {
  .lg\:sticky { position: sticky; }
  .lg\:col-span-3 { grid-column: span 3 / span 3; }
  .lg\:col-span-5 { grid-column: span 5 / span 5; }
  .lg\:col-span-9 { grid-column: span 9 / span 9; }
  .lg\:mx-0 { margin-left: 0px; margin-right: 0px; }
  .lg\:mx-auto { margin-left: auto; margin-right: auto; }
  .lg\:mb-0 { margin-bottom: 0px; }
  .lg\:mb-\[38px\] { margin-bottom: 38px; }
  .lg\:ml-2 { margin-left: 0.5rem; }
  .lg\:mt-0 { margin-top: 0px; }
  .lg\:mt-2 { margin-top: 0.5rem; }
  .lg\:mt-6 { margin-top: 1.5rem; }
  .lg\:mt-\[38px\] { margin-top: 38px; }
  .lg\:mt-\[50px\] { margin-top: 50px; }
  .lg\:block { display: block; }
  .lg\:inline { display: inline; }
  .lg\:flex { display: flex; }
  .lg\:hidden { display: none; }
  .lg\:h-6 { height: 1.5rem; }
  .lg\:h-\[42px\] { height: 42px; }
  .lg\:h-\[96px\] { height: 96px; }
  .lg\:min-h-\[600px\] { min-height: 600px; }
  .lg\:\!w-\[65\%\] { width: 65% !important; }
  .lg\:w-52 { width: 13rem; }
  .lg\:w-6 { width: 1.5rem; }
  .lg\:w-\[24rem\] { width: 24rem; }
  .lg\:w-\[28rem\] { width: 28rem; }
  .lg\:w-\[412px\] { width: 412px; }
  .lg\:w-\[42px\] { width: 42px; }
  .lg\:w-\[calc\(50vw-2rem\)\] { width: calc(-2rem + 50vw); }
  .lg\:max-w-3xl { max-width: 48rem; }
  .lg\:max-w-7xl { max-width: 80rem; }
  .lg\:max-w-\[1000px\] { max-width: 1000px; }
  .lg\:max-w-\[500px\] { max-width: 500px; }
  .lg\:max-w-\[65\%\] { max-width: 65%; }
  .lg\:flex-\[2\.2\] { flex: 2.2 1 0%; }
  .lg\:flex-\[2\.8\] { flex: 2.8 1 0%; }
  .lg\:grid-cols-12 { grid-template-columns: repeat(12, minmax(0px, 1fr)); }
  .lg\:grid-cols-2 { grid-template-columns: repeat(2, minmax(0px, 1fr)); }
  .lg\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0px, 1fr)); }
  .lg\:grid-cols-4 { grid-template-columns: repeat(4, minmax(0px, 1fr)); }
  .lg\:flex-row { flex-direction: row; }
  .lg\:flex-row-reverse { flex-direction: row-reverse; }
  .lg\:items-start { align-items: flex-start; }
  .lg\:items-center { align-items: center; }
  .lg\:justify-start { justify-content: flex-start; }
  .lg\:gap-0 { gap: 0px; }
  .lg\:gap-2 { gap: 0.5rem; }
  .lg\:gap-5 { gap: 1.25rem; }
  .lg\:gap-x-6 { column-gap: 1.5rem; }
  .lg\:gap-y-6 { row-gap: 1.5rem; }
  .lg\:px-0 { padding-left: 0px; padding-right: 0px; }
  .lg\:px-16 { padding-left: 4rem; padding-right: 4rem; }
  .lg\:px-24 { padding-left: 6rem; padding-right: 6rem; }
  .lg\:px-4 { padding-left: 1rem; padding-right: 1rem; }
  .lg\:px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
  .lg\:px-8 { padding-left: 2rem; padding-right: 2rem; }
  .lg\:px-\[100px\] { padding-left: 100px; padding-right: 100px; }
  .lg\:px-\[160px\] { padding-left: 160px; padding-right: 160px; }
  .lg\:py-\[120px\] { padding-top: 120px; padding-bottom: 120px; }
  .lg\:pb-0 { padding-bottom: 0px; }
  .lg\:pb-\[120px\] { padding-bottom: 120px; }
  .lg\:pl-0 { padding-left: 0px; }
  .lg\:pl-12 { padding-left: 3rem; }
  .lg\:pl-4 { padding-left: 1rem; }
  .lg\:pl-\[clamp\(0px\,7vw\,80px\)\] { padding-left: clamp(0px, 7vw, 80px); }
  .lg\:pr-0 { padding-right: 0px; }
  .lg\:pr-16 { padding-right: 4rem; }
  .lg\:pr-3 { padding-right: 0.75rem; }
  .lg\:pr-4 { padding-right: 1rem; }
  .lg\:pt-\[100px\] { padding-top: 100px; }
  .lg\:pt-\[40px\] { padding-top: 40px; }
  .lg\:text-left { text-align: left; }
  .lg\:shadow-none { --tw-shadow: 0 0 #0000; --tw-shadow-colored: 0 0 #0000; box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow); }
  .lg\:font-xl { font-family: var(--font-ui); font-size: 1.25rem; font-weight: 400; line-height: 1.4; font-variation-settings: "opsz" 20; }
}

@media (min-width: 1536px) {
  .\32 xl\:pr-20 { padding-right: 5rem; }
}

.dark\:block:where([data-mode="dark"], [data-mode="dark"] *) { display: block; }

.dark\:hidden:where([data-mode="dark"], [data-mode="dark"] *) { display: none; }

.dark\:border-0:where([data-mode="dark"], [data-mode="dark"] *) { border-width: 0px; }

.dark\:border-always-white\/20:where([data-mode="dark"], [data-mode="dark"] *) { border-color: hsl(var(--always-white)/.2); }

.dark\:border-always-white\/\[9\%\]:where([data-mode="dark"], [data-mode="dark"] *) { border-color: hsl(var(--always-white)/9%); }

.dark\:bg-\[\#797979\]\/50:where([data-mode="dark"], [data-mode="dark"] *) { background-color: rgba(121, 121, 121, 0.5); }

.dark\:bg-always-white\/\[6\%\]:where([data-mode="dark"], [data-mode="dark"] *) { background-color: hsl(var(--always-white)/6%); }

.dark\:bg-bg-200:where([data-mode="dark"], [data-mode="dark"] *) { --tw-bg-opacity: 1; background-color: hsl(var(--bg-200)/var(--tw-bg-opacity)); }

.dark\:bg-bg-300:where([data-mode="dark"], [data-mode="dark"] *) { --tw-bg-opacity: 1; background-color: hsl(var(--bg-300)/var(--tw-bg-opacity)); }

.dark\:bg-bg-400:where([data-mode="dark"], [data-mode="dark"] *) { --tw-bg-opacity: 1; background-color: hsl(var(--bg-400)/var(--tw-bg-opacity)); }

.dark\:bg-bg-500:where([data-mode="dark"], [data-mode="dark"] *) { --tw-bg-opacity: 1; background-color: hsl(var(--bg-500)/var(--tw-bg-opacity)); }

.dark\:bg-border-200:where([data-mode="dark"], [data-mode="dark"] *) { background-color: hsl(var(--border-200)/.3); }

.dark\:via-always-white\/10:where([data-mode="dark"], [data-mode="dark"] *) { --tw-gradient-to: hsl(var(--always-white)/0) var(--tw-gradient-to-position); --tw-gradient-stops: var(--tw-gradient-from),hsl(var(--always-white)/0.1) var(--tw-gradient-via-position),var(--tw-gradient-to); }

.dark\:fill-\[\#3D3D3A\]:where([data-mode="dark"], [data-mode="dark"] *) { fill: rgb(61, 61, 58); }

.dark\:fill-\[\#FAF9F5\]:where([data-mode="dark"], [data-mode="dark"] *) { fill: rgb(250, 249, 245); }

.dark\:text-bg-000:where([data-mode="dark"], [data-mode="dark"] *) { --tw-text-opacity: 1; color: hsl(var(--bg-000)/var(--tw-text-opacity)); }

.dark\:text-bg-500:where([data-mode="dark"], [data-mode="dark"] *) { --tw-text-opacity: 1; color: hsl(var(--bg-500)/var(--tw-text-opacity)); }

.dark\:text-text-100:where([data-mode="dark"], [data-mode="dark"] *) { --tw-text-opacity: 1; color: hsl(var(--text-100)/var(--tw-text-opacity)); }

.dark\:text-text-400:where([data-mode="dark"], [data-mode="dark"] *) { --tw-text-opacity: 1; color: hsl(var(--text-400)/var(--tw-text-opacity)); }

.dark\:ring-border-300\/50:where([data-mode="dark"], [data-mode="dark"] *) { --tw-ring-color: hsl(var(--border-300)/0.5); }

.dark\:backdrop-blur-\[14px\]:where([data-mode="dark"], [data-mode="dark"] *) { --tw-backdrop-blur: blur(14px); backdrop-filter: var(--tw-backdrop-blur) var(--tw-backdrop-brightness) var(--tw-backdrop-contrast) var(--tw-backdrop-grayscale) var(--tw-backdrop-hue-rotate) var(--tw-backdrop-invert) var(--tw-backdrop-opacity) var(--tw-backdrop-saturate) var(--tw-backdrop-sepia); }

.peer:checked ~ .dark\:peer-checked\:bg-text-500:where([data-mode="dark"], [data-mode="dark"] *) { --tw-bg-opacity: 1; background-color: hsl(var(--text-500)/var(--tw-bg-opacity)); }

.\[\&\.has-bottom-scroll\]\:\[mask-image\:linear-gradient\(to_top\,rgba\(0\,0\,0\,0\)_0\%\,_rgba\(0\,0\,0\,1\)_3\%\)\].has-bottom-scroll { mask-image: linear-gradient(0deg, rgba(0, 0, 0, 0) 0px, rgb(0, 0, 0) 3%); }

.\[\&\:\:-webkit-calendar-picker-indicator\]\:scale-75::-webkit-calendar-picker-indicator { --tw-scale-x: .75; --tw-scale-y: .75; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.\[\&\:\:-webkit-calendar-picker-indicator\]\:cursor-pointer::-webkit-calendar-picker-indicator { cursor: pointer; }

.\[\&\:\:-webkit-calendar-picker-indicator\]\:opacity-50::-webkit-calendar-picker-indicator { opacity: 0.5; }

.\[\&\:\:-webkit-calendar-picker-indicator\]\:hover\:opacity-100:hover::-webkit-calendar-picker-indicator { opacity: 1; }

.\[\&\:\:-webkit-scrollbar-thumb\:hover\]\:bg-text-500::-webkit-scrollbar-thumb:hover { --tw-bg-opacity: 1; background-color: hsl(var(--text-500)/var(--tw-bg-opacity)); }

.\[\&\:\:-webkit-scrollbar-thumb\]\:rounded-\[1em\]::-webkit-scrollbar-thumb { border-radius: 1em; }

.\[\&\:\:-webkit-scrollbar-thumb\]\:border-\[0\.25rem\]::-webkit-scrollbar-thumb { border-width: 0.25rem; }

.\[\&\:\:-webkit-scrollbar-thumb\]\:border-transparent::-webkit-scrollbar-thumb { border-color: transparent; }

.\[\&\:\:-webkit-scrollbar-thumb\]\:bg-text-500\/80::-webkit-scrollbar-thumb { background-color: hsl(var(--text-500)/.8); }

.\[\&\:\:-webkit-scrollbar-thumb\]\:bg-clip-padding::-webkit-scrollbar-thumb { background-clip: padding-box; }

.\[\&\:\:-webkit-scrollbar-track\]\:my-1::-webkit-scrollbar-track { margin-top: 0.25rem; margin-bottom: 0.25rem; }

.\[\&\:\:-webkit-scrollbar-track\]\:bg-transparent::-webkit-scrollbar-track { background-color: transparent; }

.\[\&\:\:-webkit-scrollbar\]\:mt-4::-webkit-scrollbar { margin-top: 1rem; }

.\[\&\:\:-webkit-scrollbar\]\:w-\[0\.25rem\]::-webkit-scrollbar { width: 0.25rem; }

.\[\&\:hover\]\:border-border-300:hover { border-color: hsl(var(--border-300)/.15); }

.\[\&\:hover\]\:bg-transparent:hover { background-color: transparent; }

.\[\&\:not\(\:first-child\)\]\:border-l-\[0\.5px\]:not(:first-child) { border-left-width: 0.5px; }

.\[\&\:not\(\:last-child\)_ol\]\:pb-1:not(:last-child) ol, .\[\&\:not\(\:last-child\)_ul\]\:pb-1:not(:last-child) ul { padding-bottom: 0.25rem; }

.\[\&\>\*\:first-child\]\:pt-4 > :first-child { padding-top: 1rem; }

.\[\&\>\*\:not\(\:first-child\)\]\:border-t > :not(:first-child) { border-top-width: 1px; }

.\[\&\>\*\:not\(\:first-child\)\]\:border-border-300 > :not(:first-child) { border-color: hsl(var(--border-300)/.15); }

.\[\&\>\*\]\:py-5 > * { padding-top: 1.25rem; padding-bottom: 1.25rem; }

.\[\&\>div\>div\>\:is\(p\,blockquote\,h1\,h2\,h3\,h4\,h5\,h6\)\]\:pl-2 > div > div > :is(p, blockquote, h1, h2, h3, h4, h5, h6) { padding-left: 0.5rem; }

.\[\&\>div\>div\>\:is\(p\,blockquote\,ul\,ol\,h1\,h2\,h3\,h4\,h5\,h6\)\]\:pr-8 > div > div > :is(p, blockquote, ul, ol, h1, h2, h3, h4, h5, h6) { padding-right: 2rem; }

.\[\&\>div\]\:\!rounded-lg > div { border-radius: 0.5rem !important; }

.\[\&\>svg\]\:block > svg { display: block; }

.\[\&\>svg\]\:w-full > svg { width: 100%; }

.\[\&\>svg\]\:fill-current > svg { fill: currentcolor; }

.\[\&\[data-disabled\]\]\:cursor-default[data-disabled] { cursor: default; }

.\[\&\[data-disabled\]\]\:cursor-not-allowed[data-disabled] { cursor: not-allowed; }

.\[\&\[data-disabled\]\]\:bg-bg-100[data-disabled] { --tw-bg-opacity: 1; background-color: hsl(var(--bg-100)/var(--tw-bg-opacity)); }

.\[\&\[data-disabled\]\]\:\!text-text-500[data-disabled] { --tw-text-opacity: 1 !important; color: hsl(var(--text-500)/var(--tw-text-opacity)) !important; }

.\[\&\[data-disabled\]\]\:opacity-50[data-disabled] { opacity: 0.5; }

.\[\&\[data-highlighted\]\]\:bg-bg-200[data-highlighted] { --tw-bg-opacity: 1; background-color: hsl(var(--bg-200)/var(--tw-bg-opacity)); }

.\[\&\[data-highlighted\]\]\:bg-danger-900[data-highlighted] { --tw-bg-opacity: 1; background-color: hsl(var(--danger-900)/var(--tw-bg-opacity)); }

.\[\&\[data-highlighted\]\]\:text-danger-000[data-highlighted] { --tw-text-opacity: 1; color: hsl(var(--danger-000)/var(--tw-text-opacity)); }

.\[\&\[data-highlighted\]\]\:text-text-000[data-highlighted] { --tw-text-opacity: 1; color: hsl(var(--text-000)/var(--tw-text-opacity)); }

.\[\&\[data-highlighted\]\]\:text-text-300[data-highlighted] { --tw-text-opacity: 1; color: hsl(var(--text-300)/var(--tw-text-opacity)); }

.\[\&\[data-placeholder\]\]\:text-text-400[data-placeholder] { --tw-text-opacity: 1; color: hsl(var(--text-400)/var(--tw-text-opacity)); }

.\[\&\[data-state\=open\]\>\.icon\]\:rotate-180[data-state="open"] > .icon { --tw-rotate: 180deg; transform: translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y)); }

.\[\&\[open\]\>summary\]\:hidden[open] > summary { display: none; }

.\[\&_\*\]\:gap-\[0\.05rem\] * { gap: 0.05rem; }

.\[\&_\*\]\:text-text-300 * { --tw-text-opacity: 1; color: hsl(var(--text-300)/var(--tw-text-opacity)); }

.\[\&_\.AccordionContent\]\:mb-4 .AccordionContent { margin-bottom: 1rem; }

.\[\&_\.AccordionItem\]\:border-b .AccordionItem { border-bottom-width: 1px; }

.\[\&_\.AccordionItem\]\:border-b-0\.5 .AccordionItem { border-bottom-width: 0.5px; }

.\[\&_\.AccordionItem\]\:border-border-300 .AccordionItem { border-color: hsl(var(--border-300)/.15); }

.\[\&_\.AccordionItem\]\:pb-6 .AccordionItem { padding-bottom: 1.5rem; }

.\[\&_\.PhoneInputInput\]\:border-none .PhoneInputInput { border-style: none; }

.\[\&_\.PhoneInputInput\]\:bg-transparent .PhoneInputInput { background-color: transparent; }

.\[\&_\.PhoneInputInput\]\:pl-1\.5 .PhoneInputInput { padding-left: 0.375rem; }

.\[\&_\.PhoneInputInput\]\:\!shadow-none .PhoneInputInput { --tw-shadow: 0 0 #0000 !important; --tw-shadow-colored: 0 0 #0000 !important; box-shadow: var(--tw-ring-offset-shadow,0 0 #0000),var(--tw-ring-shadow,0 0 #0000),var(--tw-shadow) !important; }

.\[\&_\.group\\\/segmented-control\]\:h-\[40px\] .group\/segmented-control { height: 40px; }

.\[\&_\.group\\\/segmented-control\]\:p-0\.5 .group\/segmented-control { padding: 0.125rem; }

.\[\&_\.ignore-pre-bg\>div\]\:bg-transparent .ignore-pre-bg > div { background-color: transparent; }

.\[\&_\.linenumber\]\:\!not-italic .linenumber { font-style: normal !important; }

.\[\&_\.peer\+div\]\:\!bg-text-100 .peer + div { --tw-bg-opacity: 1 !important; background-color: hsl(var(--text-100)/var(--tw-bg-opacity)) !important; }

.\[\&_\.progressive-markdown_\:is\(p\,blockquote\,h1\,h2\,h3\,h4\,h5\,h6\)\]\:pl-2 .progressive-markdown :is(p, blockquote, h1, h2, h3, h4, h5, h6) { padding-left: 0.5rem; }

.\[\&_\.progressive-markdown_\:is\(p\,blockquote\,ul\,ol\,h1\,h2\,h3\,h4\,h5\,h6\)\]\:pr-8 .progressive-markdown :is(p, blockquote, ul, ol, h1, h2, h3, h4, h5, h6) { padding-right: 2rem; }

.\[\&_\.standard-markdown_\:is\(p\,blockquote\,h1\,h2\,h3\,h4\,h5\,h6\)\]\:pl-2 .standard-markdown :is(p, blockquote, h1, h2, h3, h4, h5, h6) { padding-left: 0.5rem; }

.\[\&_\.standard-markdown_\:is\(p\,blockquote\,ul\,ol\,h1\,h2\,h3\,h4\,h5\,h6\)\]\:pr-8 .standard-markdown :is(p, blockquote, ul, ol, h1, h2, h3, h4, h5, h6) { padding-right: 2rem; }

.\[\&_\>_\*\]\:min-w-0 > * { min-width: 0px; }

.\[\&_a\]\:font-medium a { font-weight: 500; }

.\[\&_a\]\:hover\:underline:hover a, .\[\&_a\]\:underline a { text-decoration-line: underline; }

.\[\&_button\]\:\!h-9 button { height: 2.25rem !important; }

.\[\&_button\]\:\!text-xs button { font-size: 0.75rem !important; line-height: 1rem !important; }

.\[\&_label\]\:hidden label { display: none; }

.\[\&_li\]\:my-1 li { margin-top: 0.25rem; margin-bottom: 0.25rem; }

.\[\&_ol\]\:my-2 ol { margin-top: 0.5rem; margin-bottom: 0.5rem; }

.\[\&_ol\]\:list-decimal ol { list-style-type: decimal; }

.\[\&_ol\]\:pl-6 ol { padding-left: 1.5rem; }

.\[\&_p\:first-child\]\:mt-0 p:first-child { margin-top: 0px; }

.\[\&_p\]\:my-3 p { margin-top: 0.75rem; margin-bottom: 0.75rem; }

.\[\&_pre\>div\]\:border-0\.5 pre > div { border-width: 0.5px; }

.\[\&_pre\>div\]\:border-border-400 pre > div { border-color: hsl(var(--border-400)/.15); }

.\[\&_pre\>div\]\:bg-bg-000\/50 pre > div { background-color: hsl(var(--bg-000)/.5); }

.\[\&_span\]\:\[backface-visibility\:hidden\] span { backface-visibility: hidden; }

.\[\&_td\]\:px-4 td { padding-left: 1rem; padding-right: 1rem; }

.\[\&_td\]\:py-4 td { padding-top: 1rem; padding-bottom: 1rem; }

.\[\&_th\]\:px-4 th { padding-left: 1rem; padding-right: 1rem; }

.\[\&_th\]\:py-4 th { padding-top: 1rem; padding-bottom: 1rem; }

.\[\&_th\]\:pb-4 th { padding-bottom: 1rem; }

.\[\&_ul\]\:my-2 ul { margin-top: 0.5rem; margin-bottom: 0.5rem; }

.\[\&_ul\]\:list-disc ul { list-style-type: disc; }

.\[\&_ul\]\:pl-6 ul { padding-left: 1.5rem; }

:disabled .\[\*\:disabled_\&\]\:hidden { display: none; }

fieldset:disabled .\[fieldset\:disabled_\&\]\:pointer-events-none { pointer-events: none; }

fieldset:disabled .\[fieldset\:disabled_\&\]\:opacity-50 { opacity: 0.5; }

fieldset:not(:disabled) .\[fieldset\:not\(\:disabled\)_\&\]\:hover\:bg-bg-400:hover { --tw-bg-opacity: 1; background-color: hsl(var(--bg-400)/var(--tw-bg-opacity)); }

tbody > .\[tbody\>\&\]\:odd\:bg-bg-500\/10:nth-child(2n+1) { background-color: hsl(var(--bg-500)/.1); }
------MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v----
Content-Type: text/css
Content-Transfer-Encoding: binary
Content-Location: https://claude.ai/_next/static/css/f5369fd91af7636b.css

@charset "utf-8";

@font-face { font-family: jetbrains; src: url("/_next/static/media/b8c97ebabd0473a4-s.p.woff2") format("woff2"); font-display: swap; font-weight: 400; font-style: normal; }

@font-face { font-family: "jetbrains Fallback"; src: local("Arial"); ascent-override: 77.57%; descent-override: 22.82%; line-gap-override: 0%; size-adjust: 131.49%; }

.__className_e4195f { font-family: jetbrains, "jetbrains Fallback", ui-monospace, SFMono-Regular, Menlo, Monaco, monospace; font-weight: 400; font-style: normal; }

.__variable_e4195f { --font-jetbrains: "jetbrains","jetbrains Fallback",ui-monospace,SFMono-Regular,Menlo,Monaco,monospace; }

pre code.hljs { display: block; overflow-x: auto; padding: 1em; }

code.hljs { padding: 3px 5px; }

.hljs { color: rgb(171, 178, 191); background: rgb(40, 44, 52); }

.hljs-comment, .hljs-quote { color: rgb(92, 99, 112); font-style: italic; }

.hljs-doctag, .hljs-formula, .hljs-keyword { color: rgb(198, 120, 221); }

.hljs-deletion, .hljs-name, .hljs-section, .hljs-selector-tag, .hljs-subst { color: rgb(224, 108, 117); }

.hljs-literal { color: rgb(86, 182, 194); }

.hljs-addition, .hljs-attribute, .hljs-meta .hljs-string, .hljs-regexp, .hljs-string { color: rgb(152, 195, 121); }

.hljs-attr, .hljs-number, .hljs-selector-attr, .hljs-selector-class, .hljs-selector-pseudo, .hljs-template-variable, .hljs-type, .hljs-variable { color: rgb(209, 154, 102); }

.hljs-bullet, .hljs-link, .hljs-meta, .hljs-selector-id, .hljs-symbol, .hljs-title { color: rgb(97, 174, 238); }

.hljs-built_in, .hljs-class .hljs-title, .hljs-title.class_ { color: rgb(230, 192, 123); }

.hljs-emphasis { font-style: italic; }

.hljs-strong { font-weight: 700; }

.hljs-link { text-decoration: underline; }

:root { --always-white: 0 0% 100%; --always-black: 0 0% 0%; }

[data-theme="claude"], [data-theme="claude"][data-mode="light"] { --accent-brand: 15 63.1% 59.6%; --accent-main-000: 15 54.2% 51.2%; --accent-main-100: 15 54.2% 51.2%; --accent-main-200: 15 63.1% 59.6%; --accent-main-900: 0 0% 0%; --accent-pro-000: 251 34.2% 33.3%; --accent-pro-100: 251 40% 45.1%; --accent-pro-200: 251 61% 72.2%; --accent-pro-900: 253 33.3% 91.8%; --accent-secondary-000: 210 73.7% 40.2%; --accent-secondary-100: 210 70.9% 51.6%; --accent-secondary-200: 210 70.9% 51.6%; --accent-secondary-900: 211 72% 90%; --bg-000: 0 0% 100%; --bg-100: 48 33.3% 97.1%; --bg-200: 53 28.6% 94.5%; --bg-300: 48 25% 92.2%; --bg-400: 50 20.7% 88.6%; --bg-500: 50 20.7% 88.6%; --border-100: 30 3.3% 11.8%; --border-200: 30 3.3% 11.8%; --border-300: 30 3.3% 11.8%; --border-400: 30 3.3% 11.8%; --danger-000: 0 58.6% 34.1%; --danger-100: 0 56.2% 45.4%; --danger-200: 0 56.2% 45.4%; --danger-900: 0 50% 95%; --oncolor-100: 0 0% 100%; --oncolor-200: 60 6.7% 97.1%; --oncolor-300: 60 6.7% 97.1%; --success-000: 125 100% 18%; --success-100: 103 72.3% 26.9%; --success-200: 103 72.3% 26.9%; --success-900: 86 45.1% 90%; --text-000: 60 2.6% 7.6%; --text-100: 60 2.6% 7.6%; --text-200: 60 2.5% 23.3%; --text-300: 60 2.5% 23.3%; --text-400: 51 3.1% 43.7%; --text-500: 51 3.1% 43.7%; }

[data-theme="claude"][data-mode="dark"] { --accent-brand: 15 63.1% 59.6%; --accent-main-000: 15 54.2% 51.2%; --accent-main-100: 15 63.1% 59.6%; --accent-main-200: 15 63.1% 59.6%; --accent-main-900: 0 0% 0%; --accent-pro-000: 251 84.6% 74.5%; --accent-pro-100: 251 40.2% 54.1%; --accent-pro-200: 251 40% 45.1%; --accent-pro-900: 250 25.3% 19.4%; --accent-secondary-000: 210 71.1% 62%; --accent-secondary-100: 210 70.9% 51.6%; --accent-secondary-200: 210 70.9% 51.6%; --accent-secondary-900: 210 55.9% 24.6%; --bg-000: 60 2.1% 18.4%; --bg-100: 60 2.7% 14.5%; --bg-200: 30 3.3% 11.8%; --bg-300: 60 2.6% 7.6%; --bg-400: 0 0% 0%; --bg-500: 0 0% 0%; --border-100: 51 16.5% 84.5%; --border-200: 51 16.5% 84.5%; --border-300: 51 16.5% 84.5%; --border-400: 51 16.5% 84.5%; --danger-000: 0 82.4% 66.7%; --danger-100: 0 58.6% 34.1%; --danger-200: 0 58.6% 34.1%; --danger-900: 0 23% 15.6%; --oncolor-100: 0 0% 100%; --oncolor-200: 60 6.7% 97.1%; --oncolor-300: 60 6.7% 97.1%; --success-000: 97 50.9% 43.1%; --success-100: 125 100% 18%; --success-200: 125 100% 18%; --success-900: 135 88.2% 10%; --text-000: 48 33.3% 97.1%; --text-100: 48 33.3% 97.1%; --text-200: 50 9% 73.7%; --text-300: 50 9% 73.7%; --text-400: 48 4.8% 59.2%; --text-500: 48 4.8% 59.2%; }

@media (prefers-color-scheme: dark) {
  [data-theme="claude"] { --accent-brand: 15 63.1% 59.6%; --accent-main-000: 15 54.2% 51.2%; --accent-main-100: 15 63.1% 59.6%; --accent-main-200: 15 63.1% 59.6%; --accent-main-900: 0 0% 0%; --accent-pro-000: 251 84.6% 74.5%; --accent-pro-100: 251 40.2% 54.1%; --accent-pro-200: 251 40% 45.1%; --accent-pro-900: 250 25.3% 19.4%; --accent-secondary-000: 210 71.1% 62%; --accent-secondary-100: 210 70.9% 51.6%; --accent-secondary-200: 210 70.9% 51.6%; --accent-secondary-900: 210 55.9% 24.6%; --bg-000: 60 2.1% 18.4%; --bg-100: 60 2.7% 14.5%; --bg-200: 30 3.3% 11.8%; --bg-300: 60 2.6% 7.6%; --bg-400: 0 0% 0%; --bg-500: 0 0% 0%; --border-100: 51 16.5% 84.5%; --border-200: 51 16.5% 84.5%; --border-300: 51 16.5% 84.5%; --border-400: 51 16.5% 84.5%; --danger-000: 0 82.4% 66.7%; --danger-100: 0 58.6% 34.1%; --danger-200: 0 58.6% 34.1%; --danger-900: 0 23% 15.6%; --oncolor-100: 0 0% 100%; --oncolor-200: 60 6.7% 97.1%; --oncolor-300: 60 6.7% 97.1%; --success-000: 97 50.9% 43.1%; --success-100: 125 100% 18%; --success-200: 125 100% 18%; --success-900: 135 88.2% 10%; --text-000: 48 33.3% 97.1%; --text-100: 48 33.3% 97.1%; --text-200: 50 9% 73.7%; --text-300: 50 9% 73.7%; --text-400: 48 4.8% 59.2%; --text-500: 48 4.8% 59.2%; }
}

[data-theme="console"], [data-theme="console"][data-mode="dark"] { --accent-brand: 15 63.1% 59.6%; --accent-main-000: 18 50.4% 47.5%; --accent-main-100: 18 56.8% 43.5%; --accent-main-200: 19 58.3% 40.4%; --accent-main-900: 16 21.6% 20%; --accent-pro-000: 251 40.2% 54.1%; --accent-pro-100: 251 40% 45.1%; --accent-pro-200: 251 34.2% 33.3%; --accent-pro-900: 249 25% 19.4%; --accent-secondary-000: 158 68% 32%; --accent-secondary-100: 158 80.4% 28%; --accent-secondary-200: 158 79.2% 24.5%; --accent-secondary-900: 160 18.1% 16.3%; --bg-000: 0 0% 6%; --bg-100: 0 0% 10%; --bg-200: 0 0% 14%; --bg-300: 0 0% 17%; --bg-400: 0 0% 19%; --bg-500: 0 0% 23%; --border-100: 51 16.5% 84.5%; --border-200: 51 16.5% 84.5%; --border-300: 51 16.5% 84.5%; --border-400: 51 16.5% 84.5%; --danger-000: 4 90.4% 79.5%; --danger-100: 5 91.7% 72.5%; --danger-200: 5 58.4% 33.9%; --danger-900: 0 48.2% 16.5%; --oncolor-100: 0 0% 100%; --oncolor-200: 60 6.7% 97.1%; --oncolor-300: 60 6.7% 97.1%; --success-000: 97 50.9% 43.1%; --success-100: 125 100% 18%; --success-200: 125 100% 18%; --success-900: 135 88.2% 10%; --text-000: 0 0% 100%; --text-100: 60 3.7% 94.7%; --text-200: 60 1.5% 86.9%; --text-300: 30 1.4% 71.8%; --text-400: 50 0.8% 65.1%; --text-500: 45 0.6% 48%; }

:root { --font-mono: var(--font-jetbrains); --font-ui: var(--font-anthropic-sans); --font-ui-serif: var(--font-anthropic-serif); --font-claude-response: var(--font-anthropic-serif); --font-user-message: var(--font-ui); --font-sans-serif: var(--font-ui); --font-serif: var(--font-ui-serif); --font-system: system-ui,sans-serif; --font-dyslexia: var(--font-open-dyslexic),"Comic Sans MS",ui-serif,Georgia,serif; }

body, html { font-family: var(--font-ui); }

.font-system { font-family: var(--font-system); }

.font-normal { font-weight: 430; }

.font-medium { font-weight: 550; }

.font-semibold { font-weight: 580; }

.font-bold, .font-bolder, b, strong { font-weight: 600; }

.font-mono, [class*="font-mono"], code, kbd, pre, samp { font-variant-ligatures: none; font-feature-settings: "calt" 0, "liga" 0; }
------MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v----
Content-Type: text/css
Content-Transfer-Encoding: binary
Content-Location: https://claude.ai/_next/static/css/9246a64ba77808ea.css

@charset "utf-8";

@font-face { font-family: anthropicSans; src: url("/_next/static/media/0cd27f4e808e3c8d-s.p.woff2") format("woff2"); font-display: swap; font-weight: 300 800; font-style: normal; }

@font-face { font-family: anthropicSans; src: url("/_next/static/media/b5f39ee185750359-s.p.woff2") format("woff2"); font-display: swap; font-weight: 300 800; font-style: italic; }

@font-face { font-family: "anthropicSans Fallback"; src: local("Arial"); ascent-override: 94.91%; descent-override: 24.62%; line-gap-override: 0%; size-adjust: 104.58%; }

.__className_13e552 { font-family: anthropicSans, "anthropicSans Fallback", system-ui, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

.__variable_13e552 { --font-anthropic-sans: "anthropicSans","anthropicSans Fallback",system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }

@font-face { font-family: anthropicSerif; src: url("/_next/static/media/75014e9053556df0-s.p.woff2") format("woff2"); font-display: swap; font-weight: 300 800; font-style: normal; }

@font-face { font-family: anthropicSerif; src: url("/_next/static/media/06fe80d45fc12f7f-s.p.woff2") format("woff2"); font-display: swap; font-weight: 300 800; font-style: italic; }

@font-face { font-family: "anthropicSerif Fallback"; src: local("Arial"); ascent-override: 96.2%; descent-override: 24.96%; line-gap-override: 0%; size-adjust: 103.17%; }

.__className_a8848c { font-family: anthropicSerif, "anthropicSerif Fallback", Georgia, "Times New Roman", Times, serif; }

.__variable_a8848c { --font-anthropic-serif: "anthropicSerif","anthropicSerif Fallback",Georgia,Times New Roman,Times,serif; }

@font-face { font-family: openDyslexic; src: url("/_next/static/media/a72997480c14a9d4-s.p.woff2") format("woff2"); font-display: swap; font-weight: 500; font-style: normal; }

@font-face { font-family: openDyslexic; src: url("/_next/static/media/a0eafab536ffd221-s.p.woff2") format("woff2"); font-display: swap; font-weight: 500; font-style: italic; }

@font-face { font-family: openDyslexic; src: url("/_next/static/media/b96accb76593e50d-s.p.woff2") format("woff2"); font-display: swap; font-weight: 400; font-style: normal; }

@font-face { font-family: openDyslexic; src: url("/_next/static/media/d4ad98ce6ee578c0-s.p.woff2") format("woff2"); font-display: swap; font-weight: 400; font-style: italic; }

@font-face { font-family: "openDyslexic Fallback"; src: local("Arial"); ascent-override: 100.7%; descent-override: 40.28%; line-gap-override: 0%; size-adjust: 124.14%; }

.__className_e4ce97 { font-family: openDyslexic, "openDyslexic Fallback"; }

.__variable_e4ce97 { --font-open-dyslexic: "openDyslexic","openDyslexic Fallback"; }
------MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v----
Content-Type: text/css
Content-Transfer-Encoding: binary
Content-Location: cid:css-0b0b216b-2444-42a8-927a-c522fcc62cb6@mhtml.blink

@charset "utf-8";

@keyframes intercom-lightweight-app-launcher { 
  0% { opacity: 0; transform: scale(0.5); }
  100% { opacity: 1; transform: scale(1); }
}

@keyframes intercom-lightweight-app-gradient { 
  0% { opacity: 0; }
  100% { opacity: 1; }
}

@keyframes intercom-lightweight-app-messenger { 
  0% { opacity: 0; transform: scale(0); }
  40% { opacity: 1; }
  100% { transform: scale(1); }
}

.intercom-lightweight-app { position: fixed; z-index: 2147483001; width: 0px; height: 0px; font-family: system-ui, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"; }

.intercom-lightweight-app-gradient { position: fixed; z-index: 2147483002; width: 500px; height: 500px; bottom: 0px; right: 0px; pointer-events: none; background: radial-gradient(at right bottom, rgba(29, 39, 54, 0.16) 0%, rgba(29, 39, 54, 0) 72%); animation: 200ms ease-out 0s 1 normal none running intercom-lightweight-app-gradient; }

.intercom-lightweight-app-launcher { position: fixed; z-index: 2147483003; border: none; bottom: 20px; right: 20px; max-width: 48px; width: 48px; max-height: 48px; height: 48px; border-radius: 50%; background: rgb(0, 153, 204); cursor: pointer; box-shadow: rgba(0, 0, 0, 0.06) 0px 1px 6px 0px, rgba(0, 0, 0, 0.16) 0px 2px 32px 0px; transition: transform 167ms cubic-bezier(0.33, 0, 0, 1); box-sizing: content-box; padding: 0px !important; margin: 0px !important; }

.intercom-lightweight-app-launcher:hover { transition: transform 250ms cubic-bezier(0.33, 0, 0, 1); transform: scale(1.1); }

.intercom-lightweight-app-launcher:active { transform: scale(0.85); transition: transform 134ms cubic-bezier(0.45, 0, 0.2, 1); }

.intercom-lightweight-app-launcher:focus { outline: none; }

.intercom-lightweight-app-launcher-icon { display: flex; align-items: center; justify-content: center; position: absolute; top: 0px; left: 0px; width: 48px; height: 48px; transition: transform 100ms linear, opacity 80ms linear; }

.intercom-lightweight-app-launcher-icon-open { opacity: 1; transform: rotate(0deg) scale(1); }

.intercom-lightweight-app-launcher-icon-open svg { width: 24px; height: 24px; }

.intercom-lightweight-app-launcher-icon-open svg path { fill: rgb(255, 255, 255); }

.intercom-lightweight-app-launcher-icon-self-serve { opacity: 1; transform: rotate(0deg) scale(1); }

.intercom-lightweight-app-launcher-icon-self-serve svg { height: 44px; }

.intercom-lightweight-app-launcher-icon-self-serve svg path { fill: rgb(255, 255, 255); }

.intercom-lightweight-app-launcher-custom-icon-open { max-height: 24px; max-width: 24px; opacity: 1; transform: rotate(0deg) scale(1); }

.intercom-lightweight-app-launcher-icon-minimize { opacity: 0; transform: rotate(-60deg) scale(0); }

.intercom-lightweight-app-launcher-icon-minimize svg path { fill: rgb(255, 255, 255); }

.intercom-lightweight-app-launcher.intercom-launcher-extended { width: calc(150px); max-width: calc(150px); height: calc(19px); max-height: calc(19px); border-radius: 12px; display: flex; align-items: center; justify-content: flex-start; gap: 6px; background: rgb(0, 153, 204); border: 1px solid rgba(255, 255, 255, 0.15); box-shadow: rgba(0, 0, 0, 0.1) 0px -2px 50px; padding: 12px 16px 12px 12px !important; }

.intercom-lightweight-app-launcher.intercom-launcher-extended .intercom-lightweight-app-launcher-icon { position: relative; width: 24px; height: 24px; }

.intercom-lightweight-app-launcher-text { color: rgb(255, 255, 255); font-size: 14px; font-weight: 600; line-height: 1.5; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 140px; opacity: 1; transition: opacity 80ms linear; }

.intercom-lightweight-app-messenger { position: fixed; z-index: 2147483003; overflow: hidden; background-color: rgb(255, 255, 255); animation: 250ms cubic-bezier(0, 1, 1, 1) 0s 1 normal none running intercom-lightweight-app-messenger; transform-origin: right bottom; inset: 0px; border-radius: 16px; }

.intercom-lightweight-app-messenger-header { height: 64px; border-bottom: none; background: rgb(255, 255, 255); }

.intercom-lightweight-app-messenger-footer { position: absolute; bottom: 0px; width: 100%; height: 80px; background: rgb(255, 255, 255); font-size: 14px; line-height: 21px; border-top: 1px solid rgba(0, 0, 0, 0.05); box-shadow: rgba(0, 0, 0, 0.05) 0px 0px 25px; }

@media print {
  .intercom-lightweight-app { display: none; }
}
------MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v----
Content-Type: text/html
Content-ID: <frame-CA2E4D72EEFA19BFEE6D632F49F7858D@mhtml.blink>
Content-Transfer-Encoding: binary
Content-Location: https://claude.ai/isolated-segment.html?v=c51a4576f3

<!DOCTYPE html><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    </head><body>// This script is copied from Segment's official snippet:
    https://segment.com/docs/connections/sources/catalog/libraries/website/javascript/quickstart/
    // With the following changes: // 1. Removed the default analytics.load
    method so that we can rewrite the cdnHostname // 2. Removed un-used methods
    form analytics.methods
    
    
  
  
    <h1 style="display: none">Isolated Segment</h1>
  

</body></html>
------MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v----
Content-Type: text/html
Content-ID: <frame-2E46441F193F2DC987A06D4244E066C5@mhtml.blink>
Content-Transfer-Encoding: binary

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body></body></html>
------MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v----
Content-Type: text/html
Content-ID: <frame-1465A972ADD49874CA69F29B34ED36A0@mhtml.blink>
Content-Transfer-Encoding: binary

<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
      </head>
      <body>
      
    </body></html>
------MultipartBoundary--gisQtZJi6YAtjtH36af4MJYndwlhvxK5waNiiFWD8v------
